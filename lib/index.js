var fa=Object.create;var yt=Object.defineProperty,ya=Object.defineProperties,ba=Object.getOwnPropertyDescriptor,ga=Object.getOwnPropertyDescriptors,Pa=Object.getOwnPropertyNames,$t=Object.getOwnPropertySymbols,wa=Object.getPrototypeOf,No=Object.prototype.hasOwnProperty,Wr=Object.prototype.propertyIsEnumerable;var Cr=(o,t,e)=>t in o?yt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,S=(o,t)=>{for(var e in t||(t={}))No.call(t,e)&&Cr(o,e,t[e]);if($t)for(var e of $t(t))Wr.call(t,e)&&Cr(o,e,t[e]);return o},O=(o,t)=>ya(o,ga(t));var oe=(o,t)=>{var e={};for(var n in o)No.call(o,n)&&t.indexOf(n)<0&&(e[n]=o[n]);if(o!=null&&$t)for(var n of $t(o))t.indexOf(n)<0&&Wr.call(o,n)&&(e[n]=o[n]);return e};var ha=(o,t)=>{for(var e in t)yt(o,e,{get:t[e],enumerable:!0})},Ur=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Pa(t))!No.call(o,r)&&r!==e&&yt(o,r,{get:()=>t[r],enumerable:!(n=ba(t,r))||n.enumerable});return o};var X=(o,t,e)=>(e=o!=null?fa(wa(o)):{},Ur(t||!o||!o.__esModule?yt(e,"default",{value:o,enumerable:!0}):e,o)),ka=o=>Ur(yt({},"__esModule",{value:!0}),o);var su={};ha(su,{ANAMint:()=>Na,Api:()=>It,BNLayout:()=>Ge,BN_100:()=>Eo,BN_1000:()=>_a,BN_10000:()=>Ra,BN_FIVE:()=>La,BN_ONE:()=>ye,BN_TEN:()=>ge,BN_THREE:()=>Sa,BN_TWO:()=>xa,BN_ZERO:()=>ae,BitStructure:()=>Qa,Blob:()=>fn,Currency:()=>Xt,DataElement:()=>Ui,ETHMint:()=>Ho,FARM_LOCK_MINT:()=>_n,FARM_LOCK_VAULT:()=>Rn,FARM_PROGRAMID_TO_VERSION:()=>Sn,FARM_PROGRAM_ID_V3:()=>An,FARM_PROGRAM_ID_V3_PUBKEY:()=>Mi,FARM_PROGRAM_ID_V5:()=>In,FARM_PROGRAM_ID_V5_PUBKEY:()=>Bi,FARM_PROGRAM_ID_V6:()=>xn,FARM_PROGRAM_ID_V6_PUBKEY:()=>Ki,FARM_VERSION_TO_LEDGER_LAYOUT:()=>Bn,FARM_VERSION_TO_PROGRAMID:()=>Ln,FARM_VERSION_TO_STATE_LAYOUT:()=>Mn,Fraction:()=>A,LIQUIDITY_FEES_DENOMINATOR:()=>Yn,LIQUIDITY_FEES_NUMERATOR:()=>jn,LIQUIDITY_PROGRAMID_TO_VERSION:()=>$s,LIQUIDITY_PROGRAM_ID_V4:()=>Ei,LIQUIDITY_PROGRAM_ID_V5:()=>Vi,LIQUIDITY_VERSION_TO_PROGRAM_ID:()=>zn,LIQUIDITY_VERSION_TO_SERUM_VERSION:()=>Zn,LIQUIDITY_VERSION_TO_STATE_LAYOUT:()=>Xn,Layout:()=>ot,LiquidityPoolStatus:()=>$n,MODEL_DATA_PUBKEY:()=>Te,NRVMint:()=>Fa,OptionLayout:()=>so,Owner:()=>de,PAIMint:()=>Go,Percent:()=>ne,Price:()=>$,RAYMint:()=>kt,ROUTE_PROGRAM_ID_V1:()=>ct,Raydium:()=>Vt,Rounding:()=>Yt,SERUM_PROGRAMID_TO_VERSION:()=>tu,SERUM_PROGRAM_ID_V3:()=>Hi,SERUM_VERSION_TO_PROGRAM_ID:()=>zi,SOLMint:()=>U,SPL_MINT_LAYOUT:()=>Oo,SRMMint:()=>qa,StableLayout:()=>Bt,Structure:()=>uo,TOKEN_SOL:()=>Wo,TOKEN_WSOL:()=>j,Token:()=>W,TokenAmount:()=>B,TxBuilder:()=>Tt,UInt:()=>no,USDCMint:()=>Jo,USDHMint:()=>Qo,USDTMint:()=>$o,Union:()=>co,WSOLMint:()=>Le,WideBits:()=>yn,WrappedLayout:()=>he,_100_PERCENT:()=>Xo,_LIQUIDITY_PROGRAM_ID_V4:()=>Qn,_LIQUIDITY_PROGRAM_ID_V5:()=>Hn,_ROUTE_PROGRAM_ID_V1:()=>ra,_SERUM_PROGRAM_ID_V3:()=>dr,accountMeta:()=>s,addLiquidityLayout:()=>xo,array:()=>Ns,associatedLedgerAccountLayout:()=>mo,bits:()=>io,blob:()=>Ue,bool:()=>Bs,calFarmRewardAmount:()=>Po,calculateFarmPoolAprList:()=>Un,chunkArray:()=>rn,closeAccountInstruction:()=>Ne,commonSystemAccountMeta:()=>Ke,createAssociatedLedgerAccountInstruction:()=>Fn,createLogger:()=>M,createPoolV4Layout:()=>To,createWSolAccountInstructions:()=>_e,cstr:()=>Ss,currencyEquals:()=>va,decodeBool:()=>gi,defaultRoutes:()=>hr,div:()=>eo,divCeil:()=>Ht,dwLayout:()=>at,encodeBool:()=>Pi,endlessRetry:()=>Ya,eq:()=>ui,f32:()=>ks,f32be:()=>Ts,f64:()=>As,f64be:()=>Is,farmAddRewardLayout:()=>yo,farmDespotVersionToInstruction:()=>Kn,farmLedgerLayoutV3_1:()=>Cs,farmLedgerLayoutV3_2:()=>hn,farmLedgerLayoutV5_1:()=>Ws,farmLedgerLayoutV5_2:()=>kn,farmLedgerLayoutV6_1:()=>Tn,farmRewardInfoToConfig:()=>En,farmRewardLayout:()=>po,farmRewardRestartLayout:()=>fo,farmRewardTimeInfoLayout:()=>_i,farmStateV3Layout:()=>Pn,farmStateV5Layout:()=>wn,farmStateV6Layout:()=>it,farmWithdrawVersionToInstruction:()=>On,fetchMultipleFarmInfoAndUpdate:()=>Di,findProgramAddress:()=>we,fixedSwapInLayout:()=>ho,fixedSwapOutLayout:()=>ko,forecastTransactionSize:()=>ri,formatLayout:()=>ji,getAmountSide:()=>Mo,getAmountsSide:()=>Pr,getAssociatedAuthority:()=>vn,getAssociatedLedgerAccount:()=>go,getAssociatedLedgerPoolAccount:()=>Rt,getAssociatedMiddleStatusAccount:()=>Ar,getAssociatedPoolKeys:()=>Ko,getDate:()=>dn,getDxByDyBaseIn:()=>or,getDyByDxBaseIn:()=>tr,getFarmLedgerLayout:()=>Fi,getFarmProgramId:()=>Dn,getFarmStateLayout:()=>Ni,getFarmVersion:()=>qi,getLiquidityAssociatedAuthority:()=>ea,getLiquidityAssociatedId:()=>Re,getLiquidityInfo:()=>nu,getLiquidityProgramId:()=>Xi,getLiquidityStateLayout:()=>ou,getMax:()=>mn,getMultipleAccountsInfo:()=>ai,getMultipleAccountsInfoWithCustomFlags:()=>sn,getPoolEnabledFeatures:()=>Bo,getRecentBlockHash:()=>tn,getSPLTokenInfo:()=>iu,getSerumAssociatedAuthority:()=>yr,getSerumProgramId:()=>fr,getSerumVersion:()=>pr,getStablePrice:()=>nr,getTime:()=>ci,getTimestamp:()=>Ea,getTokenSide:()=>br,getTokensSide:()=>ta,greedy:()=>Ha,groupPools:()=>Lr,gt:()=>si,gte:()=>un,i128:()=>Rs,i64:()=>_s,includesToken:()=>Qe,initPoolLayout:()=>Ao,initTokenAccountInstruction:()=>ki,intersection:()=>Wa,isDateAfter:()=>We,isDateBefore:()=>et,isMeaningfulNumber:()=>At,isNumber:()=>ln,isValidFarmVersion:()=>bo,isValidFixedSide:()=>wr,jsonInfo2PoolKeys:()=>le,judgeFarmType:()=>Cn,liquidityStateV4Layout:()=>Io,liquidityStateV5Layout:()=>Ci,lt:()=>$a,lte:()=>ja,mSOLMint:()=>jo,makeAMMSwapInstruction:()=>rr,makeAddLiquidityInstruction:()=>ur,makeCreateFarmInstruction:()=>Nn,makeCreatePoolInstruction:()=>ar,makeInitPoolInstruction:()=>sr,makeRemoveLiquidityInstruction:()=>cr,makeRouteSwapInstruction:()=>Tr,makeSimulatePoolInfoInstruction:()=>ir,makeSimulationPoolInfo:()=>gr,makeSwapFixedInInstruction:()=>Yi,makeSwapFixedOutInstruction:()=>Qi,makeSwapInFixedInInstruction:()=>ia,makeSwapOutFixedInInstruction:()=>aa,makeTransferInstruction:()=>Je,mergeSdkFarmInfo:()=>Vn,modelDataInfoLayout:()=>Gi,mul:()=>Vo,ns64:()=>fs,ns64be:()=>hs,nu64:()=>ts,nu64be:()=>ss,offset:()=>ao,offsetDateTime:()=>to,option:()=>Ms,parseBigNumberish:()=>x,parseNumberInfo:()=>ue,parseSimulateLogToJson:()=>nn,parseSimulateValue:()=>Pe,parseTokenAccountResp:()=>gn,poolTypeV6:()=>Lt,publicKey:()=>k,quantumSOLHydratedTokenJsonInfo:()=>Xe,realFarmStateV3Layout:()=>xi,realFarmStateV5Layout:()=>Si,realFarmV6Layout:()=>Li,removeLiquidityLayout:()=>So,routeSwapInLayout:()=>Ot,routeSwapOutLayout:()=>qt,rustEnum:()=>Fs,s16:()=>cs,s16be:()=>ys,s24:()=>ms,s24be:()=>bs,s32:()=>ls,s32be:()=>gs,s40:()=>ds,s40be:()=>Ps,s48:()=>ps,s48be:()=>ws,s8:()=>us,seq:()=>H,setLoggerLevel:()=>Ia,shakeFractionDecimal:()=>Yr,simulateMultipleInstruction:()=>on,sleep:()=>en,sortTokens:()=>xr,splAccountLayout:()=>ke,splitNumber:()=>Xr,stSOLMint:()=>Yo,str:()=>qs,struct:()=>R,sub:()=>cn,swapRouteMiddleMints:()=>kr,tagged:()=>Os,tenExponential:()=>Qt,toBN:()=>Se,toFraction:()=>Be,toFractionWithDecimals:()=>Ja,toPercent:()=>bt,toTokenPrice:()=>ze,toTotalPrice:()=>Ze,toUsdCurrency:()=>Do,tryParsePublicKey:()=>Uo,u128:()=>Q,u16:()=>za,u16be:()=>os,u24:()=>Za,u24be:()=>ns,u32:()=>qe,u32be:()=>rs,u40:()=>Xa,u40be:()=>is,u48:()=>es,u48be:()=>as,u64:()=>l,u8:()=>D,union:()=>vs,unionArr:()=>au,unionLayoutDiscriminator:()=>xs,uniq:()=>Ga,updateFarmPoolInfo:()=>vi,utf8:()=>Ls,validateAndParsePublicKey:()=>E,validateFarmRewards:()=>qn,vec:()=>Ks,vecU8:()=>wi,whetherIsStakeFarmPool:()=>Wn,withdrawRewardLayout:()=>lo,xor:()=>Ua,zeros:()=>Ds});module.exports=ka(su);var mi=X(require("axios"));var Ce=require("lodash"),Gr=X(require("pino")),Jr=X(require("pino-pretty")),vo={},$r={},Ta=(0,Jr.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Aa=(0,Gr.default)({base:null,level:"silent"},Ta);function M(o){let t=(0,Ce.get)(vo,o);if(!t){let e=(0,Ce.get)($r,o);t=Aa.child({name:o},{level:e}),(0,Ce.set)(vo,o,t)}return t.logWithError=(...e)=>{let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)},t}function Ia(o,t){(0,Ce.set)($r,o,t);let e=(0,Ce.get)(vo,o);e&&(e.level=t)}var oi=require("@solana/web3.js"),ni=X(require("bn.js"));var Zr=X(require("big.js")),ht=X(require("bn.js"));var C=X(require("bn.js"));var jt=M("Raydium_bignumber"),Yt=(n=>(n[n.ROUND_DOWN=0]="ROUND_DOWN",n[n.ROUND_HALF_UP=1]="ROUND_HALF_UP",n[n.ROUND_UP=2]="ROUND_UP",n))(Yt||{}),ae=new C.default(0),ye=new C.default(1),xa=new C.default(2),Sa=new C.default(3),La=new C.default(5),ge=new C.default(10),Eo=new C.default(100),_a=new C.default(1e3),Ra=new C.default(1e4),jr=9007199254740991;function x(o){if(o instanceof C.default)return o;if(typeof o=="string"){if(o.match(/^-?[0-9]+$/))return new C.default(o);jt.logWithError(`invalid BigNumberish string: ${o}`)}return typeof o=="number"?(o%1&&jt.logWithError(`BigNumberish number underflow: ${o}`),(o>=jr||o<=-jr)&&jt.logWithError(`BigNumberish number overflow: ${o}`),new C.default(String(o))):typeof o=="bigint"?new C.default(o.toString()):(jt.logWithError(`invalid BigNumberish value: ${o}`),new C.default(0))}function Qt(o){return ge.pow(x(o))}function ue(o){var u;if(o===void 0)return{denominator:"1",numerator:"0"};if(o instanceof C.default)return{numerator:o.toString(),denominator:"1"};if(o instanceof A)return{denominator:o.denominator.toString(),numerator:o.numerator.toString()};let t=String(o),[,e="",n="",r=""]=(u=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?u:[],i="1"+"0".repeat(r.length),a=e+(n==="0"?"":n)+r||"0";return{denominator:i,numerator:a,sign:e,int:n,dec:r}}function Ht(o,t){let e=o.divmod(t);return e.mod.isZero()?e.div:e.div.negative!==0?e.div.isubn(1):e.div.iaddn(1)}function Yr(o){var n;let[,t="",e=""]=(n=o.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${t}${e}`}function Se(o,t=0){return o instanceof C.default?o:new C.default(Yr(Be(o).mul(ge.pow(new C.default(String(t))))))}function Be(o){if(o instanceof ne)return new A(o.numerator,o.denominator);if(o instanceof $)return o.adjusted;if(o instanceof B)try{return Be(o.toExact())}catch{return new A(ae)}if(o instanceof A)return o;let t=String(o),e=ue(t);return new A(e.numerator,e.denominator)}function bt(o,t){let{numerator:e,denominator:n}=ue(o);return new ne(new C.default(e),new C.default(n).mul(t!=null&&t.alreadyDecimaled?new C.default(100):new C.default(1)))}function ze(o){let{token:t,numberPrice:e,decimalDone:n}=o,r=new W({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:i,denominator:a}=ue(e),u=n?new C.default(i).mul(ge.pow(new C.default(t.decimals))):i,c=new C.default(a).mul(ge.pow(new C.default(r.decimals)));return new $({baseToken:r,denominator:c.toString(),quoteToken:new W(O(S({},t),{skipMint:!0,mint:""})),numerator:u.toString()})}function Vo(o,t){if(o==null||t==null)return;let e=Be(o),n=Be(t);return e.mul(n)}function Do(o){let t=new W({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),e=Se(Vo(o,10**t.decimals));return new B(t,e)}function Ze(o,t){return Do(!t||!o?0:Vo(o,t))}var Qr=X(require("toformat")),Ma=Qr.default,gt=Ma;var Pt=X(require("big.js")),Hr=X(require("decimal.js-light"));var zt=M("module/fraction"),Co=gt(Pt.default),wt=gt(Hr.default),Ba={[0]:wt.ROUND_DOWN,[1]:wt.ROUND_HALF_UP,[2]:wt.ROUND_UP},Ka={[0]:Pt.default.roundDown,[1]:Pt.default.roundHalfUp,[2]:Pt.default.roundUp},A=class{constructor(t,e=ye){this.numerator=x(t),this.denominator=x(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new A(this.denominator,this.numerator)}add(t){let e=t instanceof A?t:new A(x(t));return this.denominator.eq(e.denominator)?new A(this.numerator.add(e.numerator),this.denominator):new A(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof A?t:new A(x(t));return this.denominator.eq(e.denominator)?new A(this.numerator.sub(e.numerator),this.denominator):new A(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof A?t:new A(x(t));return new A(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof A?t:new A(x(t));return new A(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},n=1){Number.isInteger(t)||zt.logWithError(`${t} is not an integer.`),t<=0&&zt.logWithError(`${t} is not positive.`),wt.set({precision:t+1,rounding:Ba[n]});let r=new wt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return r.toFormat(r.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},n=1){return Number.isInteger(t)||zt.logWithError(`${t} is not an integer.`),t<0&&zt.logWithError(`${t} is negative.`),Co.DP=t,Co.RM=Ka[n]||1,new Co(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var Oa=M("Raydium_amount"),zr=gt(Zr.default);function Xr(o,t){let e="0",n="0";if(o.includes(".")){let r=o.split(".");r.length===2?([e,n]=r,n=n.padEnd(t,"0")):Oa.logWithError(`invalid number string, num: ${o}`)}else e=o;return[e,n.slice(0,t)||n]}var B=class extends A{constructor(e,n,r=!0,i){let a=new ht.default(0),u=ge.pow(new ht.default(e.decimals));if(r)a=x(n);else{let c=new ht.default(0),m=new ht.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[d,p]=Xr(n.toString(),e.decimals);c=x(d),m=x(p)}c=c.mul(u),a=c.add(m)}super(a,u);this.logger=M(i||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new B(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new B(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,n,r=0){return super.toSignificant(e,n,r)}toFixed(e=this.token.decimals,n,r=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,n,r)}toExact(e={groupSeparator:""}){return zr.DP=this.token.decimals,new zr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};var ei=require("@solana/web3.js"),Wo={symbol:"SOL",name:"Solana",decimals:9},j={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Xe={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ei.PublicKey(j.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var Zt=require("@solana/web3.js");var ti=require("@solana/spl-token"),Y=require("@solana/web3.js");function s({pubkey:o,isSigner:t=!1,isWritable:e=!0}){return{pubkey:o,isWritable:e,isSigner:t}}var Ke=[s({pubkey:ti.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:Y.SystemProgram.programId,isWritable:!1}),s({pubkey:Y.SYSVAR_RENT_PUBKEY,isWritable:!1})];function E({publicKey:o,transformSol:t}){if(o instanceof Y.PublicKey)return t&&o.equals(U)?Le:o;if(t&&o===U.toBase58())return Le;if(typeof o=="string")try{return new Y.PublicKey(o)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Uo(o){try{return new Y.PublicKey(o)}catch{return o}}var kt=new Y.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Go=new Y.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),qa=new Y.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Jo=new Y.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),$o=new Y.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),jo=new Y.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Yo=new Y.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Qo=new Y.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Fa=new Y.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Na=new Y.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ho=new Y.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Le=new Y.PublicKey("So11111111111111111111111111111111111111112"),U=Y.PublicKey.default;var zo=class{constructor({mint:t,decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN",skipMint:i=!1}){if(t===U.toBase58()||t instanceof Zt.PublicKey&&U.equals(t)){this.decimals=j.decimals,this.symbol=j.symbol,this.name=j.name,this.mint=new Zt.PublicKey(j.mint);return}this.decimals=e,this.symbol=n,this.name=r,this.mint=i?Zt.PublicKey.default:E({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},W=zo;W.WSOL=new zo(j);var Zo=class{constructor({decimals:t,symbol:e="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=n}equals(t){return this===t}},Xt=Zo;Xt.SOL=new Zo(Wo);function va(o,t){return o instanceof W&&t instanceof W?o.equals(t):o instanceof W||t instanceof W?!1:o===t}var Xo=new A(Eo),ne=class extends A{toSignificant(t=5,e,n){return this.mul(Xo).toSignificant(t,e,n)}toFixed(t=2,e,n){return this.mul(Xo).toFixed(t,e,n)}};var Da=M("Raydium_price"),$=class extends A{constructor(e){let{baseToken:n,quoteToken:r,numerator:i,denominator:a}=e;super(i,a);this.baseToken=n,this.quoteToken=r,this.scalar=new A(Qt(n.decimals),Qt(r.decimals))}get raw(){return new A(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new $({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Da.logWithError("mul token not equals");let n=super.mul(e);return new $({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(e=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(e,n,r)}toFixed(e=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(e,n,r)}};async function en(o){new Promise(t=>setTimeout(t,o))}function Ea(){return new Date().getTime()}var Va=[W,B,oi.PublicKey,A,ni.default,$,ne];function Ca(o){return typeof o=="object"&&o!==null&&!Va.some(t=>typeof t=="object"&&o instanceof t)}function le(o){return typeof o=="string"?Uo(o):Array.isArray(o)?o.map(t=>le(t)):Ca(o)?Object.fromEntries(Object.entries(o).map(([t,e])=>[t,le(e)])):o}var me=require("@solana/web3.js");var Oe=M("Raydium_txTool"),Tt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:n=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...n),this}build(t){let e=new me.Transaction;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var r;let n=await tn(this.connection);if(e.recentBlockhash=n,(r=this.owner)!=null&&r.isKeyPair)return(0,me.sendAndConfirmTransaction)(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let i=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(i[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:n}=t,{transaction:r}=this.build(n),i=e.filter(c=>c.transaction.instructions.length>0),a=[...i.map(c=>c.transaction),r],u=[...i.map(c=>c.signers),this.signers];return{transactions:a,signers:u,execute:async()=>{var m;let c=await tn(this.connection);if((m=this.owner)!=null&&m.isKeyPair)return await Promise.all(a.map(async(d,p)=>(d.recentBlockhash=c,await(0,me.sendAndConfirmTransaction)(this.connection,d,u[p]))));if(this.signAllTransactions){let d=a.map((f,b)=>(f.recentBlockhash=c,u[b].length&&f.partialSign(...u[b]),f)),p=await this.signAllTransactions(d),y=[];for(let f=0;f<p.length;f+=1){let b=await this.connection.sendRawTransaction(p[f].serialize(),{skipPreflight:!0});y.push(b)}return y}throw new Error("please connect wallet first")},extInfo:n||{}}}};async function tn(o){var t,e;try{return((e=await((t=o.getLatestBlockhash)==null?void 0:t.call(o)))==null?void 0:e.blockhash)||(await o.getRecentBlockhash()).blockhash}catch{return(await o.getRecentBlockhash()).blockhash}}function ri(o,t){o.length<1&&Oe.logWithError(`no instructions provided: ${o.toString()}`),t.length<1&&Oe.logWithError(`no signers provided:, ${t.toString()}`);let e=new me.Transaction;e.recentBlockhash="11111111111111111111111111111111",e.feePayer=t[0],e.add(...o);let n=e.compileMessage().serialize();return t.length+t.length*64+n.length}async function on(o,t,e){let n=new me.PublicKey("RaydiumSimuLateTransaction11111111111111111"),r=[],i=new me.Transaction;i.feePayer=n;for(let c of t)ri([...i.instructions,c],[n])>me.PACKET_DATA_SIZE&&(r.push(i),i=new me.Transaction,i.feePayer=n),i.add(c);i.instructions.length>0&&r.push(i);let a=[];try{a=await Promise.all(r.map(c=>o.simulateTransaction(c)))}catch(c){c instanceof Error&&Oe.logWithError(`failed to simulate for instructions, RPC_ERROR, ${c.message}`)}let u=[];for(let c of a){let{value:m}=c;if(Oe.debug(`simulate result: ${JSON.stringify(c)}`),m.logs){let d=m.logs.filter(p=>p&&p.includes(e));Oe.debug(`filteredLog: ${JSON.stringify(u)}`),d.length||Oe.logWithError(` "simulate log not match keyword, keyword: ${e}`),u.push(...d)}}return u}function nn(o,t){let e=o.match(/{["\w:,]+}/g);return!e||e.length!==1?Oe.logWithError(`simulate log fail to match json, keyword: ${t}`):e[0]}function Pe(o,t){let n=new RegExp(`"${t}":(\\d+)`,"g").exec(o);return!n||n.length!==2?Oe.logWithError(`simulate log fail to match key", key: ${t}`):n[1]}async function we(o,t){let[e,n]=await me.PublicKey.findProgramAddress(o,t);return{publicKey:e,nonce:n}}var de=class{constructor(t){this._owner=t}get publicKey(){return de.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return de.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return de.isKeyPair(this._owner)}get isPublicKey(){return de.isPublicKey(this._owner)}static isKeyPair(t){return t.secretKey!==void 0}static isPublicKey(t){return!de.isKeyPair(t)}};function rn(o,t=1,e=[]){let n=[...o];if(t<=0)return e;for(;n.length;)e.push(n.splice(0,t));return e}function Wa(o,...t){return o.filter(e=>t.every(n=>n.includes(e)))}function Ua(o,...t){return o.filter(e=>t.every(n=>!n.includes(e)))}function Ga(o){return[...new Set(o)]}var ii=require("@solana/web3.js");var an=M("Raydium_accountInfo_util");async function ai(o,t,e){let{batchRequest:n,commitment:r}=S({batchRequest:!1},e),i=rn(t,100),a=new Array(i.length).fill([]);if(n){let u=i.map(m=>{let d=o._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}});a=(await o._rpcBatchRequest(u)).map(m=>(m.error&&an.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:h}=d;return p.length!==2&&p[1]!=="base64"&&an.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new ii.PublicKey(b),rentEpoch:h}}return null})))}else try{a=await Promise.all(i.map(u=>o.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&an.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function sn(o,t,e){let n=await ai(o,t.map(r=>r.pubkey),e);return t.map((r,i)=>O(S({},r),{accountInfo:n[i]}))}function re(o){if(o instanceof ne)return new A(o.numerator,o.denominator);if(o instanceof $)return o.adjusted;if(o instanceof B)try{return re(o.toExact())}catch{return new A(ae)}if(o instanceof A)return o;let t=String(o),e=ue(t);return new A(e.numerator,e.denominator)}function Ja(o){var n;if(o instanceof ne)return{fr:new A(o.numerator,o.denominator)};if(o instanceof $)return{fr:o.adjusted};if(o instanceof B)return{fr:re(o.toExact()),decimals:o.token.decimals};if(o instanceof A)return{fr:o};let t=String(o),e=ue(t);return{fr:new A(e.numerator,e.denominator),decimals:(n=e.dec)==null?void 0:n.length}}function $a(o,t){if(o==null||t==null)return!1;let e=re(o),n=re(t);return e.sub(n).numerator,e.sub(n).numerator.lt(ae)}function si(o,t){if(o==null||t==null)return!1;let e=re(o),n=re(t);return e.sub(n).numerator.gt(ae)}function ja(o,t){if(o==null||t==null)return!1;let e=re(o),n=re(t);return e.sub(n).numerator.lte(ae)}function un(o,t){if(o==null||t==null)return!1;let e=re(o),n=re(t);return e.sub(n).numerator.gte(ae)}function ui(o,t){if(o==null||t==null)return!1;let e=re(o),n=re(t);return e.sub(n).numerator.eq(ae)}function eo(o,t){if(o==null||t==null)return;let e=re(o),n=re(t);try{return e.div(n)}catch{return e}}function cn(o,t){if(o==null||t==null)return;let e=re(o),n=re(t);return e.sub(n)}function At(o){return o==null?!1:!ui(o,0)}function mn(o,t){return si(t,o)?t:o}var ln=o=>typeof o=="number",dn=o=>o?new Date(o):new Date,ci=o=>dn(o).getTime();function et(o,t,e){let n=ln(t)?t*((e==null?void 0:e.unit)==="s"?1e3:1):t;return new Date(o).getTime()<=n}function We(o,t,e){let n=ln(t)?t*((e==null?void 0:e.unit)==="s"?1e3:1):t;return new Date(o).getTime()>n}function to(o,t){let n=ci(o)+(t.days?t.days*24*60*60*1e3:0)+(t.hours?t.hours*60*60*1e3:0)+(t.minutes?t.minutes*60*1e3:0)+(t.seconds?t.seconds*1e3:0)+(t.milliseconds?t.milliseconds:0);return dn(n)}var tt=M("Raydium_Api");async function Ya(o,t,e=1e3){let n;for(;n==null;)try{tt.debug(`Request ${o} through endlessRetry`),n=await t()}catch(r){tt.error(`Request ${o} failed, retry after ${e} ms`,r),await en(e)}return n}var It=class{constructor({cluster:t,timeout:e}){this.cluster=t,this.api=mi.default.create({baseURL:"https://api.raydium.io/v2",timeout:e}),this.api.interceptors.request.use(n=>{let{method:r,baseURL:i,url:a}=n;return tt.debug(`${r==null?void 0:r.toUpperCase()} ${i}${a}`),n},n=>(tt.error("Request failed"),Promise.reject(n))),this.api.interceptors.response.use(n=>{let{config:r,data:i,status:a}=n,{method:u,baseURL:c,url:m}=r;return tt.debug(`${u==null?void 0:u.toUpperCase()} ${c}${m}  ${a}`),i},n=>{let{config:r,response:i={}}=n,{status:a}=i,{method:u,baseURL:c,url:m}=r;return tt.error(`${u.toUpperCase()} ${c}${m} ${a||n.message}`),Promise.reject(n)})}async getTokens(){return this.api.get("/sdk/token/raydium.mainnet.json")}async getLiquidityPools(){return this.api.get(`/sdk/liquidity/${this.cluster}.json`)}async getPairsInfo(){return this.api.get("https://api.raydium.io/v2/main/pairs")}async getFarmPools(){return this.api.get(`/sdk/farm-v2/${this.cluster}.json`)}async getCoingeckoPrice(t){return this.api.get(`https://api.coingecko.com/api/v3/simple/price?ids=${t.join(",")}&vs_currencies=usd`)}async getRaydiumTokenPrice(){return this.api.get("https://api.raydium.io/v2/main/price")}async getBlockSlotCountForSecond(t){if(!t)return 2;let n=(await this.api.post(t,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(r=>r.numSlots);return n.reduce((r,i)=>r+i,0)/n.length/60}};var ua=require("lodash");var oo="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",li="please provide connection in load() initialization or set it by raydium.setConnection(connection)";var ve=require("@solana/spl-token"),Ii=require("@solana/web3.js");var pn=(...o)=>o.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),se=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=M(e)}createTxBuilder(t){return this.scope.checkOwner(),new Tt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(pn(t))}logInfo(...t){this.logger.info(pn(t))}logAndCreateError(...t){let e=pn(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Fe=require("@solana/spl-token"),rt=require("@solana/web3.js"),hi=X(require("bn.js"));var bi=require("@solana/web3.js"),nt=X(require("bn.js"));var g=require("@solana/buffer-layout"),ot=g.Layout,di=g.Structure,pi=g.Union,Qa=g.BitStructure,no=g.UInt,fn=g.Blob,Ha=g.greedy,ro=g.u8,za=g.u16,Za=g.u24,xt=g.u32,Xa=g.u40,es=g.u48,ts=g.nu64,os=g.u16be,ns=g.u24be,rs=g.u32be,is=g.u40be,as=g.u48be,ss=g.nu64be,us=g.s8,cs=g.s16,ms=g.s24,ls=g.s32,ds=g.s40,ps=g.s48,fs=g.ns64,ys=g.s16be,bs=g.s24be,gs=g.s32be,Ps=g.s40be,ws=g.s48be,hs=g.ns64be,ks=g.f32,Ts=g.f32be,As=g.f64,Is=g.f64be;var fi=g.seq,yi=g.union,xs=g.unionLayoutDiscriminator,Ue=g.blob,Ss=g.cstr,Ls=g.utf8,io=g.bits,ao=g.offset;var Ge=class extends ot{constructor(e,n,r){super(e,r);this.blob=Ue(e),this.signed=n}decode(e,n=0){let r=new nt.default(this.blob.decode(e,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(e,n,r=0){return typeof e=="number"&&(e=new nt.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),n,r)}},yn=class extends ot{constructor(e){super(8,e);this._lower=io(xt(),!1),this._upper=io(xt(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,n=0){let r=this._lower.decode(e,n),i=this._upper.decode(e,n+this._lower.span);return S(S({},r),i)}encode(e,n,r=0){return this._lower.encode(e,n,r)+this._upper.encode(e,n,r+this._lower.span)}};function D(o){return new no(1,o)}function qe(o){return new no(4,o)}function l(o){return new Ge(8,!1,o)}function Q(o){return new Ge(16,!1,o)}function _s(o){return new Ge(8,!0,o)}function Rs(o){return new Ge(16,!0,o)}var he=class extends ot{constructor(e,n,r,i){super(e.span,i);this.layout=e,this.decoder=n,this.encoder=r}decode(e,n){return this.decoder(this.layout.decode(e,n))}encode(e,n,r){return this.layout.encode(this.encoder(e),n,r)}getSpan(e,n){return this.layout.getSpan(e,n)}};function k(o){return new he(Ue(32),t=>new bi.PublicKey(t),t=>t.toBuffer(),o)}var so=class extends ot{constructor(e,n){super(-1,n);this.layout=e,this.discriminator=ro()}encode(e,n,r=0){return e==null?this.discriminator.encode(0,n,r):(this.discriminator.encode(1,n,r),this.layout.encode(e,n,r+1)+1)}decode(e,n=0){let r=this.discriminator.decode(e,n);if(r===0)return null;if(r===1)return this.layout.decode(e,n+1);throw new Error("Invalid option "+this.property)}getSpan(e,n=0){let r=this.discriminator.decode(e,n);if(r===0)return 1;if(r===1)return this.layout.getSpan(e,n+1)+1;throw new Error("Invalid option "+this.property)}};function Ms(o,t){return new so(o,t)}function Bs(o){return new he(ro(),gi,Pi,o)}function gi(o){if(o===0)return!1;if(o===1)return!0;throw new Error("Invalid bool: "+o)}function Pi(o){return o?1:0}function Ks(o,t){let e=xt("length"),n=R([e,H(o,ao(e,-e.span),"values")]);return new he(n,({values:r})=>r,r=>({values:r}),t)}function Os(o,t,e){let n=R([l("tag"),t.replicate("data")]);function r({tag:i,data:a}){if(!i.eq(o))throw new Error("Invalid tag, expected: "+o.toString("hex")+", got: "+i.toString("hex"));return a}return new he(n,r,i=>({tag:o,data:i}),e)}function wi(o){let t=xt("length"),e=R([t,Ue(ao(t,-t.span),"data")]);return new he(e,({data:n})=>n,n=>({data:n}),o)}function qs(o){return new he(wi(),t=>t.toString("utf-8"),t=>Buffer.from(t,"utf-8"),o)}function Fs(o,t){let e=yi(ro(),t);return o.forEach((n,r)=>e.addVariant(r,n,n.property)),e}function Ns(o,t,e){let n=R([H(o,t,"values")]);return new he(n,({values:r})=>r,r=>({values:r}),e)}var uo=class extends di{decode(t,e){return super.decode(t,e)}};function R(o,t,e){return new uo(o,t,e)}var co=class extends pi{encodeInstruction(t){let e=Math.max(...Object.values(this.registry).map(r=>r.span)),n=Buffer.alloc(e);return n.slice(0,this.encode(t,n))}decodeInstruction(t){return this.decode(t)}};function vs(o,t,e){return new co(o,t,e)}var bn=class extends fn{decode(t,e){let n=super.decode(t,e);if(!n.every(r=>r===0))throw new Error("nonzero padding bytes");return n}};function Ds(o){return new bn(o)}function H(o,t,e){let n,r=typeof t=="number"?t:(0,nt.isBN)(t)?t.toNumber():new Proxy(t,{get(i,a){if(!n){let u=Reflect.get(i,"count");n=(0,nt.isBN)(u)?u.toNumber():u,Reflect.set(i,"count",n)}return Reflect.get(i,a)},set(i,a,u){return a==="count"&&(n=u),Reflect.set(i,a,u)}});return fi(o,r,e)}var ke=R([k("mint"),k("owner"),l("amount"),qe("delegateOption"),k("delegate"),D("state"),qe("isNativeOption"),l("isNative"),l("delegatedAmount"),qe("closeAuthorityOption"),k("closeAuthority")]);function ki(o){let{mint:t,tokenAccount:e,owner:n}=o;return(0,Fe.createInitializeAccountInstruction)(e,t,n)}function Ne(o){let{tokenAccount:t,payer:e,multiSigners:n=[],owner:r}=o;return(0,Fe.createCloseAccountInstruction)(t,e,r,n)}async function _e(o){let{connection:t,amount:e,commitment:n,payer:r,owner:i,skipCloseAccount:a}=o,u=await t.getMinimumBalanceForRentExemption(ke.span,n),c=x(e).add(new hi.default(u)),m=rt.Keypair.generate();return{signers:[m],instructions:[rt.SystemProgram.createAccount({fromPubkey:r,newAccountPubkey:m.publicKey,lamports:c.toNumber(),space:ke.span,programId:Fe.TOKEN_PROGRAM_ID}),ki({mint:new rt.PublicKey(j.mint),tokenAccount:m.publicKey,owner:i})],endInstructions:a?[]:[Ne({tokenAccount:m.publicKey,payer:r,owner:i})]}}function Je({source:o,destination:t,owner:e,amount:n,multiSigners:r=[]}){return(0,Fe.createTransferInstruction)(o,t,e,x(n).toNumber(),r)}var Ti=require("@solana/web3.js"),Ai=X(require("bn.js"));var Es=M("Raydium_Util");function gn({solAccountResp:o,tokenAccountResp:t}){let e=[],n=[];for(let{pubkey:r,account:i}of t.value){if(i.data.length!==ke.span)throw Es.error("invalid token account layout length","publicKey",r.toBase58()),new Error("invalid token account layout length");let a=ke.decode(i.data),{mint:u,amount:c}=a;e.push({publicKey:r,mint:u,amount:c,isNative:!1}),n.push({pubkey:r,accountInfo:a})}return o&&e.push({mint:Ti.PublicKey.default,amount:new Ai.default(o.lamports),isNative:!0}),{tokenAccounts:e,tokenAccountRawInfos:n}}var St=class extends se{constructor(e){super(e);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._ataCache=new Map;this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:n,tokenAccountRawInfos:r}=e;this._tokenAccounts=n||[],this._tokenAccountRawInfos=r||[],this._clientOwnedToken=!!(n||r)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:e,tokenAccountRawInfos:n}){return e&&(this._tokenAccounts=e),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(e){return this._accountListener.push(e),this}removeAccountChangeListener(e){return this._accountListener=this._accountListener.filter(n=>n!==e),this}async getAssociatedTokenAccount(e){this.scope.checkOwner();let n=`${this.scope.ownerPubKey.toBase58()}_${e.toBase58()}`;if(this._ataCache.has(n))return this._ataCache.get(n);let r=await(0,ve.getAssociatedTokenAddress)(e,this.scope.ownerPubKey,!0);return this._ataCache.set(n,r),r}async fetchWalletTokenAccounts(e){if(this._clientOwnedToken||!(e!=null&&e.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let r=S(S({},{}),e),i=await this.scope.connection.getAccountInfo(this.scope.ownerPubKey,r.commitment),a=await this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:ve.TOKEN_PROGRAM_ID},r.commitment),{tokenAccounts:u,tokenAccountRawInfos:c}=gn({solAccountResp:i,tokenAccountResp:a});return this._tokenAccounts=u,this._tokenAccountRawInfos=c,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:u,tokenAccountRawInfos:c}}async getCreatedTokenAccount({mint:e,associatedOnly:n=!0}){await this.fetchWalletTokenAccounts();let r=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(e)).sort((a,u)=>a.amount.lt(u.amount)?1:-1),i=await this.getAssociatedTokenAccount(e);for(let a of r){let{publicKey:u}=a;if(u)return n&&i.equals(u),u}}async checkOrCreateAta({mint:e,autoUnwrapWSOLToSOL:n}){var u;await this.fetchWalletTokenAccounts();let r=(u=this.scope.account.tokenAccounts.find(({mint:c})=>(c==null?void 0:c.toBase58())===e.toBase58()))==null?void 0:u.publicKey,i=this.scope.ownerPubKey,a={};if(!r){let c=await this.getAssociatedTokenAccount(e),m=await(0,ve.createAssociatedTokenAccountInstruction)(i,c,i,e);a.instructions=[m],r=c}return n&&j.mint===e.toBase58()&&(a.endInstructions=[Ne({owner:i,payer:i,tokenAccount:r})]),{pubKey:r,newInstructions:a}}async handleTokenAccount(e){let{side:n,amount:r,mint:i,tokenAccount:a,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:c,skipCloseAccount:m}=e,d=this.createTxBuilder(),p=await(0,ve.getAssociatedTokenAddress)(i,this.scope.ownerPubKey,!0);if(new Ii.PublicKey(j.mint).equals(i)){let y=await _e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:r,skipCloseAccount:m});return d.addInstruction(y),S({tokenAccount:y.signers[0].publicKey},y)}else if(!a||n==="out"&&!p.equals(a)&&!c)return{tokenAccount:p,instructions:[(0,ve.createAssociatedTokenAccountInstruction)(this.scope.ownerPubKey,p,this.scope.ownerPubKey,i)]};return{tokenAccount:a}}};var De=require("@solana/spl-token"),q=require("@solana/web3.js"),wo=X(require("bn.js"));var st=require("@solana/web3.js");var mo=R([D("instruction")]),lo=R([D("instruction")]),Vs=R([l("rewardState"),l("rewardOpenTime"),l("rewardEndTime"),l("rewardLastUpdateTime"),l("totalReward"),l("totalRewardEmissioned"),l("rewardClaimed"),l("rewardPerSecond"),Q("accRewardPerShare"),k("rewardVault"),k("rewardMint"),k("rewardSender"),l("rewardType"),H(l(),15,"padding")]),xi=R([l("state"),l("nonce"),k("lpVault"),k("rewardVault"),k(),k(),l(),l(),l("totalReward"),Q("perShareReward"),l("lastSlot"),l("perSlotReward")]),Si=R([l("state"),l("nonce"),k("lpVault"),k("rewardVaultA"),l("totalRewardA"),Q("perShareRewardA"),l("perSlotRewardA"),D("option"),k("rewardVaultB"),Ue(7),l("totalRewardB"),Q("perShareRewardB"),l("perSlotRewardB"),l("lastSlot"),k()]),Li=R([l(),l("state"),l("nonce"),l("validRewardTokenNum"),Q("rewardMultiplier"),l("rewardPeriodMax"),l("rewardPeriodMin"),l("rewardPeriodExtend"),k("lpMint"),k("lpVault"),H(Vs,5,"rewardInfos"),k("creator"),k(),H(l(),32,"padding")]),Pn=new Proxy(xi,{get(o,t,e){return t==="decode"?(...n)=>{let r=o.decode(...n);return O(S({},r),{version:3,rewardInfos:[{rewardVault:r.rewardVault,totalReward:r.totalReward,perSlotReward:r.perSlotReward,perShareReward:r.perShareReward}]})}:Reflect.get(o,t,e)}}),wn=new Proxy(Si,{get(o,t,e){return t==="decode"?(...n)=>{let r=o.decode(...n);return O(S({},r),{version:5,rewardInfos:[{rewardVault:r.rewardVaultA,totalReward:r.totalRewardA,perSlotReward:r.perSlotRewardA,perShareReward:r.perShareRewardA},{rewardVault:r.rewardVaultB,totalReward:r.totalRewardB,perSlotReward:r.perSlotRewardB,perShareReward:r.perShareRewardB}]})}:Reflect.get(o,t,e)}}),it=new Proxy(Li,{get(o,t,e){return t==="decode"?(...n)=>{let r=o.decode(...n);return O(S({},r),{version:6,rewardInfos:r.rewardInfos.map(i=>{var a;return O(S({},i),{rewardType:((a=Object.entries(Lt).find(u=>String(u[1])===i.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(o,t,e)}}),_i=R([l("isSet"),l("rewardPerSecond"),l("rewardOpenTime"),l("rewardEndTime"),l("rewardType")]),po=R([D("instruction"),l("nonce"),H(_i,5,"rewardTimeInfo")]),fo=R([D("instruction"),l("rewardReopenTime"),l("rewardEndTime"),l("rewardPerSecond")]),yo=R([D("instruction"),l("isSet"),l("rewardPerSecond"),l("rewardOpenTime"),l("rewardEndTime")]),Cs=R([l("state"),k("id"),k("owner"),l("deposited"),H(l(),1,"rewardDebts")]),hn=R([l("state"),k("id"),k("owner"),l("deposited"),H(Q(),1,"rewardDebts"),H(l(),17)]),Ws=R([l("state"),k("id"),k("owner"),l("deposited"),H(l(),2,"rewardDebts")]),kn=R([l("state"),k("id"),k("owner"),l("deposited"),H(Q(),2,"rewardDebts"),H(l(),17)]),Tn=R([l(),l("state"),k("id"),k("owner"),l("deposited"),H(Q(),5,"rewardDebts"),H(l(),16)]),at=R([D("instruction"),l("amount")]);var Ri=M("Raydium_farm_config"),An="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",Mi=new st.PublicKey(An),In="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",Bi=new st.PublicKey(In),xn="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",Ki=new st.PublicKey(xn),Sn={[An]:3,[In]:5,[xn]:6},Ln={3:Mi,5:Bi,6:Ki},_n=new st.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Rn=new st.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),Mn={3:Pn,5:wn,6:it},Bn={3:hn,5:kn,6:Tn},bo=o=>[3,5,6].indexOf(o)!==-1,Us={3:10,5:11,6:1},Kn=o=>{let t=Us[o];return t||Ri.logWithError("invalid deposit farm version"),t},Gs={3:11,5:12,6:2},On=o=>{let t=Gs[o];return t||Ri.logWithError("invalid withdraw farm version"),t},qn=o=>{var a;let{version:t,rewardInfos:e,rewardTokenAccountsPublicKeys:n}=o,r=`rewardInfo:${JSON.stringify(e)}, rewardAccount:${JSON.stringify(n)}`,i={3:()=>{if(e.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${r}`},5:()=>{if(e.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${r}`},6:()=>{if(!n.length||e.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${r}`}};return(a=i[t])==null?void 0:a.call(i)},Lt={"Standard SPL":0,"Option tokens":1};var $e=require("@solana/web3.js"),Oi=X(require("bn.js"));var Js=M("Raydium_farm_instruction");async function Fn(o){let{version:t,id:e,ledger:n,programId:r,owner:i}=o,a={3:9,5:10}[t];a||Js.logWithError(`invalid farm pool version: ${t}`);let u=Buffer.alloc(mo.span);mo.encode({instruction:a},u);let c=[s({pubkey:e}),s({pubkey:n}),s({pubkey:i,isWritable:!1}),s({pubkey:$e.SystemProgram.programId,isWritable:!1}),s({pubkey:$e.SYSVAR_RENT_PUBKEY,isWritable:!1})];return new $e.TransactionInstruction({programId:r,keys:c,data:u})}function Nn(o){var n;let t=Buffer.alloc(po.span);po.encode({instruction:0,nonce:new Oi.default(o.nonce),rewardTimeInfo:o.rewardInfoConfig},t);let e=[...Ke,s({pubkey:o.farmKeyPair.publicKey}),s({pubkey:o.farmAuthority,isWritable:!1}),s({pubkey:o.lpVault}),s({pubkey:o.lpMint,isWritable:!1}),s({pubkey:o.lockVault}),s({pubkey:o.lockMint,isWritable:!1}),s({pubkey:(n=o.lockUserAccount)!=null?n:U}),s({pubkey:o.owner,isWritable:!1,isSigner:!0})];for(let r of o.rewardInfo)e.push(s({pubkey:r.rewardMint,isWritable:!1}),s({pubkey:r.rewardVault}),s({pubkey:r.userRewardToken}));return new $e.TransactionInstruction({programId:o.programId,keys:e,data:t})}var ee=X(require("bn.js"));var _t=M("Raydium.farm.util");async function Rt({programId:o,poolId:t,mint:e,type:n}){let{publicKey:r}=await we([t.toBuffer(),e.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],o);return r}function qi(o){let e=E({publicKey:o}).toBase58();return Sn[e]}async function go({programId:o,poolId:t,owner:e}){let{publicKey:n}=await we([t.toBuffer(),e.toBuffer(),Buffer.from(qi(o)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],o);return n}var vn=async({programId:o,poolId:t})=>await we([t.toBuffer()],o);function Dn(o){return Ln[o]}function En(o){return{isSet:new ee.default(1),rewardPerSecond:x(o.rewardPerSecond),rewardOpenTime:x(o.rewardOpenTime),rewardEndTime:x(o.rewardEndTime),rewardType:x(o.rewardType)}}function Po(o){return x(o.rewardEndTime).sub(x(o.rewardOpenTime)).mul(x(o.rewardPerSecond))}function Fi(o){let t=Bn[o];return t||_t.logWithError("invalid version",o),t}function Ni(o){let t=Mn[o];return t||_t.logWithError("invalid version",o),t}function vi(o,t,e,n){if(o.version===3||o.version===5){if(o.lastSlot.gte(new ee.default(e)))return o;let r=new ee.default(e).sub(o.lastSlot);o.lastSlot=new ee.default(e);for(let i of o.rewardInfos){if(t.amount.eq(new ee.default(0)))continue;let a=i.perSlotReward.mul(r);i.perShareReward=i.perShareReward.add(a.mul(new ee.default(10).pow(new ee.default(o.version===3?9:15))).div(t.amount)),i.totalReward=i.totalReward.add(a)}}else if(o.version===6)for(let r of o.rewardInfos){if(r.rewardState.eq(new ee.default(0)))continue;let i=ee.default.min(new ee.default(n),r.rewardEndTime);if(r.rewardOpenTime.gte(i))continue;let u=i.sub(r.rewardLastUpdateTime).mul(r.rewardPerSecond),c=r.totalReward.sub(r.totalRewardEmissioned);c.lt(u)?(u=c,r.rewardLastUpdateTime=r.rewardLastUpdateTime.add(c.div(r.rewardPerSecond))):r.rewardLastUpdateTime=i,!t.amount.eq(new ee.default(0))&&(r.accRewardPerShare=r.accRewardPerShare.add(u.mul(o.rewardMultiplier).div(t.amount)),r.totalRewardEmissioned=r.totalRewardEmissioned.add(u))}return o}async function Di({connection:o,farmPools:t,owner:e,config:n}){var y;let r=!1,i=!1,a=new ee.default(10),u=[];for(let f of t){let b=le(f);b.version===6?i=!0:r=!0,u.push({pubkey:b.id,version:b.version,key:"state",poolId:b.id},{pubkey:b.lpVault,version:b.version,key:"lpVault",poolId:b.id}),e&&u.push({pubkey:await go({programId:b.programId,poolId:b.id,owner:e}),version:b.version,key:"ledger",poolId:b.id})}let c={},m=await sn(o,u,n);for(let{pubkey:f,version:b,key:h,poolId:L,accountInfo:P}of m){let T=L.toBase58();if(c[T]=S({},c[T]),h==="state"){let _=Ni(b);(!P||!P.data||P.data.length!==_.span)&&_t.logWithError(`invalid farm state account info, pools.id, ${f}`),c[T].state=_.decode(P.data)}else if(h==="lpVault")(!P||!P.data||P.data.length!==ke.span)&&_t.logWithError(`invalid farm lp vault account info, pools.lpVault, ${f}`),c[T].lpVault=ke.decode(P.data);else if(h==="ledger"){let _=Fi(b);P&&P.data&&(P.data.length!==_.span&&_t.logWithError(`invalid farm ledger account info, ledger, ${f}`),c[T].ledger=_.decode(P.data))}}let d=i||r?await o.getSlot():0,p=i&&(y=await o.getBlockTime(d))!=null?y:0;for(let f of Object.keys(c))c[f].state=vi(c[f].state,c[f].lpVault,d,p);for(let[f,{state:b,ledger:h}]of Object.entries(c))if(h){let L=b.version===6?b.rewardMultiplier:b.rewardInfos.length===1?a.pow(new ee.default(9)):a.pow(new ee.default(15)),P=b.rewardInfos.map((T,_)=>{let I=h.rewardDebts[_];return h.deposited.mul(b.version===6?T.accRewardPerShare:T.perShareReward).div(L).sub(I)});c[f].wrapped=O(S({},c[f].wrapped),{pendingRewards:P})}return c}async function Vn(o){let{farmPools:t}=o,e=await Di(o);return t.map((r,i)=>O(S(S(S({},t[i]),le(r)),e[r.id]),{jsonInfo:t[i]}))}function Cn(o,t=Date.now()){if(o.version===6){let e=o.state.rewardInfos;if(e.every(({rewardOpenTime:n})=>et(t,n.toNumber(),{unit:"s"})))return"upcoming pool";if(e.every(({rewardEndTime:n})=>We(t,n.toNumber(),{unit:"s"})))return"closed pool"}else{let e=o.state.rewardInfos.map(({perSlotReward:n})=>n);if(e.length===2){if(String(e[0])==="0"&&String(e[1])!=="0")return"normal fusion pool";if(String(e[0])!=="0"&&String(e[1])!=="0")return"dual fusion pool";if(String(e[0])==="0"&&String(e[1])==="0")return"closed pool"}else if(e.length===1&&String(e[0])==="0")return"closed pool"}}function Wn(o){return o.state.rewardInfos.length===1&&String(o.lpMint)===kt.toBase58()}function Un(o,t){return o.version===6?o.state.rewardInfos.map(({rewardPerSecond:e,rewardOpenTime:n,rewardEndTime:r},i)=>{var y;let a=et(t.currentBlockChainDate,n.toNumber(),{unit:"s"}),u=We(t.currentBlockChainDate,r.toNumber(),{unit:"s"});if(a||u)return;let c=t.rewardTokens[i];if(!c)return;let m=t.rewardTokenPrices[i];if(!m)return;let d=Ze(new A(e,ye).div(ge.pow(new ee.default(c.decimals||1))).mul(new ee.default(60*60*24*365)),m);return t.tvl?t.tvl.isZero()?Be(0):d.div((y=t.tvl)!=null?y:ye):void 0}):o.state.rewardInfos.map(({perSlotReward:n},r)=>{var m;let i=t.rewardTokens[r];if(!i)return;let a=t.rewardTokenPrices[r];if(!a)return;let u=Ze(new A(n,ye).div(ge.pow(new ee.default(i.decimals||1))).mul(new ee.default(t.blockSlotCountForSecond*60*60*24*365)),a);return t.tvl?t.tvl.isZero()?Be(0):u.div((m=t.tvl)!=null?m:ye):void 0})}var Mt=class extends se{constructor(){super(...arguments);this._farmPools=[];this._hydratedFarmPools=[];this._hydratedFarmMap=new Map;this._sdkParsedFarmPools=[];this._lpTokenInfoMap=new Map}async load(e){var r;await this.scope.liquidity.load(e),await this.scope.fetchFarms(e==null?void 0:e.forceUpdate);let n=((r=this.scope.apiData.farmPools)==null?void 0:r.data)||{};this._farmPools=Object.keys(n||{}).reduce((i,a)=>{var u,c;return i.concat(((c=(u=n[a]).map)==null?void 0:c.call(u,m=>{let d=this.scope.token.allTokenMap.get(m.baseMint),p=this.scope.token.allTokenMap.get(m.quoteMint);return d&&p&&this._lpTokenInfoMap.set(m.lpMint,new W({mint:m.lpMint,decimals:d.decimals,symbol:`${d.symbol} - ${p.name}`,name:`${d.symbol} - ${p.name} LP`})),O(S({},m),{name:m.symbol,category:a})}))||[])},[]),await this.fetchSdkFarmInfo()}async fetchSdkFarmInfo(){var e;this._sdkParsedFarmPools=await Vn({connection:this.scope.connection,farmPools:this._farmPools,owner:(e=this.scope.owner)==null?void 0:e.publicKey,config:{commitment:"confirmed"}})}async loadHydratedFarmInfo(e){let{forceUpdate:n,skipPrice:r}=e||{};if(this._hydratedFarmPools.length&&!n)return this._hydratedFarmPools;await this.scope.farm.load(),!r&&await this.scope.token.fetchTokenPrices(),await this.scope.liquidity.loadPairs();let i=await this.scope.chainTimeOffset(),a=to(Date.now()+i,{minutes:0}),u=await this.scope.api.getBlockSlotCountForSecond(this.scope.connection.rpcEndpoint),c=Object.fromEntries(this.scope.liquidity.allPairs.map(m=>[m.ammId,{apr30d:m.apr30d,apr7d:m.apr7d,apr24h:m.apr24h}]));return this._hydratedFarmPools=this._sdkParsedFarmPools.map(m=>{let d=this.hydrateFarmInfo({farmInfo:m,blockSlotCountForSecond:u,farmAprs:c,currentBlockChainDate:a,chainTimeOffset:i});return this._hydratedFarmMap.set(m.id.toBase58(),d),d}),this._hydratedFarmPools}get allFarms(){return this._farmPools}get allParsedFarms(){return this._sdkParsedFarmPools}get allHydratedFarms(){return this._hydratedFarmPools}get allHydratedFarmMap(){return this._hydratedFarmMap}getFarm(e){let n=E({publicKey:e}),r=this.allFarms.find(i=>i.id===n.toBase58());return r||this.logAndCreateError("invalid farm id"),r}getParsedFarm(e){let n=E({publicKey:e}),r=this.allParsedFarms.find(i=>n.equals(i.id));return r||this.logAndCreateError("invalid farm id"),r}getLpTokenInfo(e){let n=E({publicKey:e}),r=this._lpTokenInfoMap.get(n.toBase58());return r||this.logAndCreateError("LP Token not found",n.toBase58()),r}lpDecimalAmount({mint:e,amount:n}){let r=ue(n),i=this.getLpTokenInfo(e);return Se(new A(r.numerator,r.denominator).mul(new wo.default(10).pow(new wo.default(i.decimals))))}hydrateFarmInfo(e){var Ct,Wt,lt,dt,pt,Ut,_r,Rr,Mr,Br,Kr,Or;let{farmInfo:n,blockSlotCountForSecond:r,farmAprs:i,currentBlockChainDate:a,chainTimeOffset:u=0}=e,c=Cn(n,a),m=Wn(n),d=c==="dual fusion pool",p=c==="normal fusion pool",y=c==="closed pool"&&!n.upcoming,f=n.version!==6?n.upcoming&&y:n.upcoming,b=n.version!==6&&n.upcoming&&!y,h=((Ct=this.scope.liquidity.allPools.find(K=>K.lpMint===n.lpMint.toBase58()))==null?void 0:Ct.version)===5,L=m?this.scope.mintToToken(n.lpMint):this.getLpTokenInfo(n.lpMint),P=this.scope.mintToToken(m?n.lpMint:n.baseMint),T=this.scope.mintToToken(m?n.lpMint:n.quoteMint);P!=null&&P.symbol;let _=m?`${(Wt=P==null?void 0:P.symbol)!=null?Wt:"unknown"}`:`${(lt=P==null?void 0:P.symbol)!=null?lt:"unknown"}-${(dt=T==null?void 0:T.symbol)!=null?dt:"unknown"}`,I=n.jsonInfo.rewardInfos.map(({rewardMint:K})=>this.scope.mintToToken(K)),F=(pt=n.wrapped)==null?void 0:pt.pendingRewards.map((K,G)=>I[G]?new B(I[G],Se(mn(K,0))):void 0),N=m?this.scope.token.tokenPrices.get(n.lpMint.toBase58()):this.scope.liquidity.lpPriceMap.get(n.lpMint.toBase58()),v=L&&new B(L,n.lpVault.amount),z=N&&L?Ze(new B(L,n.lpVault.amount),N):void 0,V=Un(n,{tvl:z,currentBlockChainDate:a,rewardTokens:I,rewardTokenPrices:(Ut=n.rewardInfos.map(({rewardMint:K})=>this.scope.token.tokenPrices.get(K.toBase58())))!=null?Ut:[],blockSlotCountForSecond:r}),J=(_r=this.scope.liquidity.allPools.find(K=>K.lpMint===n.lpMint.toBase58()))==null?void 0:_r.id,te=J?bt((Rr=i[J])==null?void 0:Rr.apr7d,{alreadyDecimaled:!0}):void 0,Z=J?bt((Mr=i[J])==null?void 0:Mr.apr30d,{alreadyDecimaled:!0}):void 0,ie=J?bt((Br=i[J])==null?void 0:Br.apr24h,{alreadyDecimaled:!0}):void 0,ce=V.reduce((K,G)=>K?G?K.add(G):K:G,te),Me=V.reduce((K,G)=>K?G?K.add(G):K:G,Z),fe=V.reduce((K,G)=>K?G?K.add(G):K:G,ie),Ie=n.version===6?n.state.rewardInfos.map((K,G)=>{var vr,Dr,Er,Vr;let{rewardOpenTime:ft,rewardEndTime:Gt,rewardPerSecond:qo}=K,Ve=ft.toNumber()?new Date(ft.toNumber()*1e3+u):void 0,xe=Gt.toNumber()?new Date(Gt.toNumber()*1e3+u):void 0,Fo=Date.now()+u;if(!Ve&&!xe)return;let He=this.scope.mintToToken((Er=(Dr=K.rewardMint)!=null?Dr:(vr=n.rewardInfos[G])==null?void 0:vr.rewardMint)==null?void 0:Er.toBase58()),qr=Boolean(Ve&&et(Fo,Ve)),Fr=Boolean(xe&&We(Fo,xe)),Nr=!Ve&&!xe||!Fr&&!qr,ca=Nr&&We(Fo,to(xe,{seconds:-((Vr=n.jsonInfo.rewardPeriodExtend)!=null?Vr:72*60*60)})),ma=He&&this.scope.mintToTokenAmount({mint:He.mint,amount:cn(K.totalReward,K.totalRewardEmissioned).toFixed(He.decimals)}),la=F==null?void 0:F[G],da=V[G],pa=Boolean(xe),Jt=n.rewardInfos[G];return O(S(S({},Jt),K),{owner:Jt==null?void 0:Jt.rewardSender,apr:da,token:He,userPendingReward:la,userHavedReward:pa,perSecond:He&&this.scope.mintToTokenAmount({mint:He.mint,amount:qo}).toSignificant(),openTime:Ve,endTime:xe,isOptionToken:K.rewardType==="Option tokens",isRewardBeforeStart:qr,isRewardEnded:Fr,isRewarding:Nr,isRwardingBeforeEnd72h:ca,claimableRewards:ma,version:6})}).filter(K=>!!K):n.state.rewardInfos.map((K,G)=>{let ft=F==null?void 0:F[G],Gt=V[G],qo=I[G],{perSlotReward:Ve}=K,xe=At(ft)||At(Ve);return O(S({},K),{apr:Gt,token:qo,userPendingReward:ft,userHavedReward:xe,version:n.version})}),be=L&&((Kr=n.ledger)==null?void 0:Kr.deposited)?new B(L,(Or=n.ledger)==null?void 0:Or.deposited):void 0;return O(S({},n),{lp:L,lpPrice:N,base:P,quote:T,name:_,isStakePool:m,isDualFusionPool:d,isNormalFusionPool:p,isClosedPool:y,isUpcomingPool:f,isStablePool:h,isNewPool:b,totalApr7d:ce,raydiumFeeApr7d:te,totalApr24h:fe,raydiumFeeApr24h:ie,totalApr30d:Me,raydiumFeeApr30d:Z,ammId:J,tvl:z,userHasStaked:At(be),rewards:Ie,userStakedLpAmount:be,stakedLpAmount:v})}async _getUserRewardInfo({payer:e,rewardInfo:n}){if(n.rewardMint.equals(U)){let r=await _e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:Po(n)});return{rewardPubKey:r.signers[0].publicKey,newInstruction:r}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:n.rewardMint})}}async create({poolId:e,rewardInfos:n,payer:r}){this.checkDisabled(),this.scope.checkOwner();let i=E({publicKey:e}),a=this.scope.liquidity.allPools.find(I=>I.id===i.toBase58());a||this.logAndCreateError("invalid pool id");let c={lpMint:new q.PublicKey(a.lpMint),lockInfo:{lockMint:_n,lockVault:Rn},version:6,rewardInfos:n,programId:Dn(6)},m=this.createTxBuilder(),d=r!=null?r:this.scope.ownerPubKey,p=q.Keypair.generate(),y=await this.scope.connection.getMinimumBalanceForRentExemption(it.span);m.addInstruction({instructions:[q.SystemProgram.createAccount({fromPubkey:d,newAccountPubkey:p.publicKey,lamports:y,space:it.span,programId:c.programId})],signers:[p]});let{publicKey:f,nonce:b}=await vn({programId:c.programId,poolId:p.publicKey}),h=await Rt({programId:c.programId,poolId:p.publicKey,mint:c.lpMint,type:"lpVault"}),L=[],P=[];for(let I of c.rewardInfos){I.rewardOpenTime>=I.rewardEndTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",I.rewardOpenTime.toString()),Lt[I.rewardType]||this.logAndCreateError("rewardType error",I.rewardType),I.rewardPerSecond<=0&&this.logAndCreateError("rewardPerSecond error",I.rewardPerSecond.toString()),L.push(En(I));let{rewardPubKey:F,newInstruction:N}=await this._getUserRewardInfo({rewardInfo:I,payer:d});N&&m.addInstruction(N),F||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let v=I.rewardMint.equals(U)?new q.PublicKey(j.mint):I.rewardMint;P.push({rewardMint:v,rewardVault:await Rt({programId:c.programId,poolId:p.publicKey,mint:v,type:"rewardVault"}),userRewardToken:F})}let T=await this.scope.account.getCreatedTokenAccount({mint:c.lockInfo.lockMint});T||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let _=Nn({farmKeyPair:p,owner:this.scope.ownerPubKey,farmAuthority:f,lpVault:h,lpMint:c.lpMint,lockVault:c.lockInfo.lockVault,lockMint:c.lockInfo.lockMint,lockUserAccount:T,programId:c.programId,rewardInfo:P,rewardInfoConfig:L,nonce:b});return await m.addInstruction({instructions:[_]}).build()}async restartReward({farmId:e,payer:n,newRewardInfo:r}){let i=this.getFarm(e);i.version!==6&&this.logAndCreateError("invalid farm version",i.version);let a={id:new q.PublicKey(i.id),rewardInfos:i.rewardInfos,lpVault:new q.PublicKey(i.lpVault),programId:new q.PublicKey(i.programId)};r.rewardOpenTime>=r.rewardEndTime&&this.logAndCreateError("start time error","newRewardInfo",r);let u=n||this.scope.ownerPubKey,c=r.rewardMint.equals(U)?new q.PublicKey(j.mint):r.rewardMint,m=a.rewardInfos.find(L=>new q.PublicKey(L.rewardMint).equals(c));m||this.logAndCreateError("configuration does not exist","rewardMint",c);let d=m.rewardVault?new q.PublicKey(m.rewardVault):U,p=this.createTxBuilder(),{rewardPubKey:y,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:r,payer:u});f&&p.addInstruction(f),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let b=Buffer.alloc(fo.span);fo.encode({instruction:3,rewardReopenTime:x(r.rewardOpenTime),rewardEndTime:x(r.rewardEndTime),rewardPerSecond:x(r.rewardPerSecond)},b);let h=[s({pubkey:De.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:a.id}),s({pubkey:a.lpVault,isWritable:!1}),s({pubkey:d}),s({pubkey:y}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0})];return await p.addInstruction({instructions:[new q.TransactionInstruction({programId:a.programId,keys:h,data:b})]}).build()}async addNewRewardToken(e){let{farmId:n,newRewardInfo:r,payer:i}=e,a=this.getFarm(n);a.version!==6&&this.logAndCreateError("invalid farm version",a.version);let u=i!=null?i:this.scope.ownerPubKey,c=this.createTxBuilder(),m=await Rt({programId:new q.PublicKey(a.programId),poolId:new q.PublicKey(a.id),mint:r.rewardMint,type:"rewardVault"}),{rewardPubKey:d,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:r,payer:u});p&&c.addInstruction(p),d||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts);let y=r.rewardMint.equals(U)?new q.PublicKey(j.mint):r.rewardMint,f=Buffer.alloc(yo.span);yo.encode({instruction:4,isSet:new wo.default(1),rewardPerSecond:x(r.rewardPerSecond),rewardOpenTime:x(r.rewardOpenTime),rewardEndTime:x(r.rewardEndTime)},f);let b=[...Ke,s({pubkey:new q.PublicKey(a.id)}),s({pubkey:new q.PublicKey(a.authority),isWritable:!1}),s({pubkey:y,isWritable:!1}),s({pubkey:m}),s({pubkey:d}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0})];return await c.addInstruction({instructions:[new q.TransactionInstruction({programId:new q.PublicKey(a.programId),keys:b,data:f})]}).build()}async _prepareFarmAccounts(e){let n=this.createTxBuilder(),{farmInfo:r}=e,{pubKey:i,newInstructions:a}=await this.scope.account.checkOrCreateAta({mint:r.lpMint});n.addInstruction(a);let u=await Promise.all(r.rewardInfos.map(async({rewardMint:d})=>{let{pubKey:p,newInstructions:y}=await this.scope.account.checkOrCreateAta({mint:d,autoUnwrapWSOLToSOL:!0});return n.addInstruction(y),p})),c=await go({programId:new q.PublicKey(r.programId),poolId:new q.PublicKey(r.id),owner:this.scope.ownerPubKey});if(!r.ledger&&r.version<6){let d=await Fn({id:r.id,programId:r.programId,version:r.version,ledger:c,owner:this.scope.ownerPubKey});n.addInstruction({instructions:[d]})}let m=[s({pubkey:r.id}),s({pubkey:r.authority,isWritable:!1}),s({pubkey:c}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0}),s({pubkey:i}),s({pubkey:new q.PublicKey(r.jsonInfo.lpVault)}),s({pubkey:u[0]}),s({pubkey:r.rewardInfos[0].rewardVault}),s({pubkey:q.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),s({pubkey:De.TOKEN_PROGRAM_ID,isWritable:!1})];return{txBuilder:n,lpTokenAccount:i,rewardTokenAccountsPublicKeys:u,ledgerAddress:c,lowVersionKeys:m}}async deposit(e){this.scope.checkOwner();let{farmId:n,amount:r}=e,i=this.getParsedFarm(n),a=i.lpMint,{version:u,rewardInfos:c}=i;bo(u)||this.logAndCreateError("invalid farm version:",u);let{txBuilder:m,ledgerAddress:d,lpTokenAccount:p,lowVersionKeys:y,rewardTokenAccountsPublicKeys:f}=await this._prepareFarmAccounts({mint:a,farmInfo:i}),b=qn({version:u,rewardInfos:c,rewardTokenAccountsPublicKeys:f});b&&this.logAndCreateError(b);let h=Buffer.alloc(at.span);at.encode({instruction:Kn(u),amount:x(r)},h);let L=u===6?[s({pubkey:De.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:q.SystemProgram.programId,isWritable:!1}),s({pubkey:i.id}),s({pubkey:i.authority,isWritable:!1}),s({pubkey:i.lpVault.mint}),s({pubkey:d}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0}),s({pubkey:p})]:y;if(u!==3)for(let T=1;T<c.length;T++)L.push(s({pubkey:f[T]})),L.push(s({pubkey:c[T].rewardVault}));let P=new q.TransactionInstruction({programId:i.programId,keys:L,data:h});return await m.addInstruction({instructions:[P]}).build()}async withdraw(e){this.scope.checkOwner();let{farmId:n,amount:r}=e,i=this.getParsedFarm(n),a=i.lpMint,{version:u,rewardInfos:c}=i;bo(u)||this.logAndCreateError("invalid farm version:",u);let{txBuilder:m,ledgerAddress:d,lpTokenAccount:p,lowVersionKeys:y,rewardTokenAccountsPublicKeys:f}=await this._prepareFarmAccounts({mint:a,farmInfo:i}),b=Buffer.alloc(at.span);at.encode({instruction:On(u),amount:x(r)},b);let h=u===6?[s({pubkey:De.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:i.id}),s({pubkey:i.authority,isWritable:!1}),s({pubkey:i.lpVault.mint}),s({pubkey:d}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0}),s({pubkey:p})]:y;if(u!==3)for(let P=1;P<c.length;P++)h.push(s({pubkey:f[P]})),h.push(s({pubkey:c[P].rewardVault}));let L=new q.TransactionInstruction({programId:i.programId,keys:h,data:b});return await m.addInstruction({instructions:[L]}).build()}async withdrawFarmReward({farmId:e,withdrawMint:n}){var y;this.scope.checkOwner();let r=this.getParsedFarm(e),{version:i}=r;i!==6&&this.logAndCreateError("invalid farm version",r.version);let a=r.rewardInfos.find(f=>f.rewardMint.equals(n.equals(U)?new q.PublicKey(j.mint):n));a||this.logAndCreateError("withdraw mint error","rewardInfos",r);let u=(y=a==null?void 0:a.rewardVault)!=null?y:U,c=this.createTxBuilder(),m;if(this._getUserRewardInfo({payer:this.scope.ownerPubKey,rewardInfo:a}),n.equals(U)){let f=await _e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:Po(a)});m=f.signers[0].publicKey,c.addInstruction(f)}else{let f=await this.scope.account.getCreatedTokenAccount({mint:n});f===null?(m=await this.scope.account.getAssociatedTokenAccount(n),c.addInstruction({instructions:[(0,De.createAssociatedTokenAccountInstruction)(this.scope.ownerPubKey,m,this.scope.ownerPubKey,n)]})):m=f}let d=Buffer.alloc(lo.span);lo.encode({instruction:5},d);let p=[s({pubkey:De.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:r.id}),s({pubkey:r.authority,isWritable:!1}),s({pubkey:r.lpVault.mint,isWritable:!1}),s({pubkey:u}),s({pubkey:m}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0})];return await c.addInstruction({instructions:[new q.TransactionInstruction({programId:r.programId,keys:p,data:d})]}).build()}};var oa=require("@solana/web3.js"),Ae=X(require("bn.js"));var Gn=require("@solana/web3.js"),Jn=X(require("bn.js")),$n=(c=>(c[c.Uninitialized=0]="Uninitialized",c[c.Initialized=1]="Initialized",c[c.Disabled=2]="Disabled",c[c.RemoveLiquidityOnly=3]="RemoveLiquidityOnly",c[c.LiquidityOnly=4]="LiquidityOnly",c[c.OrderBook=5]="OrderBook",c[c.Swap=6]="Swap",c[c.WaitingForStart=7]="WaitingForStart",c))($n||{}),jn=new Jn.default(25),Yn=new Jn.default(1e4),Qn="675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8",Ei=new Gn.PublicKey(Qn),Hn="5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h",Vi=new Gn.PublicKey(Hn),$s={[Qn]:4,[Hn]:5},zn={4:Ei,5:Vi},Zn={4:3,5:3};var _o=require("@solana/spl-token"),pe=require("@solana/web3.js");var ho=R([D("instruction"),l("amountIn"),l("minAmountOut")]),ko=R([D("instruction"),l("maxAmountIn"),l("amountOut")]),To=R([D("instruction"),D("nonce")]),Ao=R([D("instruction"),D("nonce"),l("startTime")]),Io=R([l("status"),l("nonce"),l("maxOrder"),l("depth"),l("baseDecimal"),l("quoteDecimal"),l("state"),l("resetFlag"),l("minSize"),l("volMaxCutRatio"),l("amountWaveRatio"),l("baseLotSize"),l("quoteLotSize"),l("minPriceMultiplier"),l("maxPriceMultiplier"),l("systemDecimalValue"),l("minSeparateNumerator"),l("minSeparateDenominator"),l("tradeFeeNumerator"),l("tradeFeeDenominator"),l("pnlNumerator"),l("pnlDenominator"),l("swapFeeNumerator"),l("swapFeeDenominator"),l("baseNeedTakePnl"),l("quoteNeedTakePnl"),l("quoteTotalPnl"),l("baseTotalPnl"),Q("quoteTotalDeposited"),Q("baseTotalDeposited"),Q("swapBaseInAmount"),Q("swapQuoteOutAmount"),l("swapBase2QuoteFee"),Q("swapQuoteInAmount"),Q("swapBaseOutAmount"),l("swapQuote2BaseFee"),k("baseVault"),k("quoteVault"),k("baseMint"),k("quoteMint"),k("lpMint"),k("openOrders"),k("marketId"),k("marketProgramId"),k("targetOrders"),k("withdrawQueue"),k("lpVault"),k("owner"),l("lpReserve"),H(l(),3,"padding")]),Ci=R([l("accountType"),l("status"),l("nonce"),l("maxOrder"),l("depth"),l("baseDecimal"),l("quoteDecimal"),l("state"),l("resetFlag"),l("minSize"),l("volMaxCutRatio"),l("amountWaveRatio"),l("baseLotSize"),l("quoteLotSize"),l("minPriceMultiplier"),l("maxPriceMultiplier"),l("systemDecimalsValue"),l("abortTradeFactor"),l("priceTickMultiplier"),l("priceTick"),l("minSeparateNumerator"),l("minSeparateDenominator"),l("tradeFeeNumerator"),l("tradeFeeDenominator"),l("pnlNumerator"),l("pnlDenominator"),l("swapFeeNumerator"),l("swapFeeDenominator"),l("baseNeedTakePnl"),l("quoteNeedTakePnl"),l("quoteTotalPnl"),l("baseTotalPnl"),l("poolOpenTime"),l("punishPcAmount"),l("punishCoinAmount"),l("orderbookToInitTime"),Q("swapBaseInAmount"),Q("swapQuoteOutAmount"),Q("swapQuoteInAmount"),Q("swapBaseOutAmount"),l("swapQuote2BaseFee"),l("swapBase2QuoteFee"),k("baseVault"),k("quoteVault"),k("baseMint"),k("quoteMint"),k("lpMint"),k("modelDataAccount"),k("openOrders"),k("marketId"),k("marketProgramId"),k("targetOrders"),k("owner"),H(l(),64,"padding")]),xo=R([D("instruction"),l("baseAmountIn"),l("quoteAmountIn"),l("fixedSide")]),So=R([D("instruction"),l("amountIn")]),Xn={4:Io,5:Ci};var Wi=require("@solana/web3.js");var Te=new Wi.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ye=5e4,Ui=R([l("x"),l("y"),l("price")]),Gi=R([l("accountType"),l("status"),l("multiplier"),l("validDataCount"),H(Ui,Ye,"DataElement")]);function js(o,t){return[0,Ye-2]}function Ys(o){return[0,Ye-2]}function Qs(o){return[0,Ye-2]}function Hs(o,t,e){let[n,r]=js(t,e),i=n,a=r,u=0,c=t*o.multiplier/e;for(;i<=a;){if(u=Math.floor((a+i)/2),u===0||u>=Ye-2)return[u,u,!1];let m=o.DataElement[u].x*o.multiplier/o.DataElement[u].y,d=o.DataElement[u-1].x*o.multiplier/o.DataElement[u-1].y,p=o.DataElement[u+1].x*o.multiplier/o.DataElement[u+1].y;if(c===m)return[u,u,!0];if(c===d)return[u-1,u-1,!0];if(c===p)return[u+1,u+1,!0];if(c<d)a=u-1;else{if(c>d&&c<m)return[u-1,u,!0];if(c>m&&c<p)return[u,u+1,!0];i=u+1}}return[u,u,!1]}function er(o,t,e){let[n,r,i]=Hs(o,t,e);if(!i)return 0;if(n===r){let a=o.DataElement[n].x;return t*o.multiplier/a}else{let a=o.DataElement[n].x,u=o.DataElement[n].y,c=o.DataElement[r].x,m=o.DataElement[r].y,d=e*(c*u-a*m),p=a*d,y=(c-a)*(t*u-a*e)*m,f=p+y;return t*o.multiplier*d/f}}function je(o,t,e){return t*o.multiplier/e}function Ji(o,t,e){return t*e/o.multiplier}function zs(o,t){let[e,n]=Ys(t),r=e,i=n,a=0,u=t;for(;r<i;){if(a=Math.floor((i+r)/2),a<=0||a>Ye-2)return[a,a,!1];let c=o.DataElement[a].x,m=o.DataElement[a-1].x,d=o.DataElement[a+1].x;if(u===c)return[a,a,!0];if(u===m)return[a-1,a-1,!0];if(u===d)return[a+1,a+1,!0];if(u<m)i=a-1;else{if(u>m&&u<c)return[a-1,a,!0];if(u>c&&u<d)return[a,a+1,!0];r=a+1}}return[a,a,!1]}function Zs(o,t){let[e,n]=Qs(t),r=e,i=n,a=0,u=t;for(;r<=i;){if(a=Math.floor((i+r)/2),a<=0||a>=Ye-2)return[a,a,!1];let c=o.DataElement[a].y,m=o.DataElement[a-1].y,d=o.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===m)return[a-1,a-1,!0];if(u===d)return[a+1,a+1,!0];if(u<d)r=a+1;else{if(u<m&&u>c)return[a-1,a,!0];if(u<c&&u>d)return[a,a+1,!0];i=a-1}}return[a,a,!1]}function $i(o,t,e,n){let r=n?t+e:t-e,[i,a,u]=zs(o,r);if(!u)return[0,0,!1,u];if(i===a)return[o.DataElement[a].price,o.DataElement[a].y,!1,u];{let c=o.DataElement[i].x,m=o.DataElement[a].x,d=o.DataElement[i].price,p=o.DataElement[a].price,y=o.DataElement[i].y,f=o.DataElement[a].y;if(t>=c&&t<=m)return n?[p,f,!0,u]:[d,y,!0,u];{let b,h;return n?(b=d+(p-d)*(t-c)/(m-c),h=y-(r-c)*o.multiplier/p):(b=d+(p-d)*(t-c)/(m-c),h=f+(m-r)*o.multiplier/d),[b,h,!1,u]}}}function Xs(o,t,e,n){let r=n?t-e:t+e,[i,a,u]=Zs(o,r);if(!u)return[0,0,!1,u];if(i===a)return[o.DataElement[a].price,o.DataElement[a].x,!1,u];{let c=o.DataElement[i].x,m=o.DataElement[a].x,d=o.DataElement[i].price,p=o.DataElement[a].price,y=o.DataElement[i].y,f=o.DataElement[a].y;if(t>=f&&t<=y)return n?[p,m,!0,u]:[d,c,!0,u];{let b,h;return n?(b=d+(p-d)*(y-t)/(y-f),h=c+p*(y-r)/o.multiplier):(b=d+(p-d)*(y-t)/(y-f),h=m-d*(r-f)/o.multiplier),[b,h,!1,u]}}}function eu(o,t){let e=$i(o,t,0,!1);return e[3]?e[0]:0}function tr(o,t,e,n){let r=er(o,t,e),i=je(o,t,r),a=je(o,e,r),u=je(o,n,r),c=!0,[m,d,p,y]=$i(o,i,u,c);if(!y)return 0;if(p)return n*o.multiplier/m;{let f=a-d;return Ji(o,f,r)}}function or(o,t,e,n){let r=er(o,t,e),i=je(o,t,r),a=je(o,e,r),u=je(o,n,r),c=!1,[m,d,p,y]=Xs(o,a,u,c);if(!y)return 0;if(p)return n*m/o.multiplier;{let f=i-d;return Ji(o,f,r)}}function ji(o){let t=Gi.decode(o);return{accountType:t.accountType.toNumber(),status:t.status.toNumber(),multiplier:t.multiplier.toNumber(),validDataCount:t.validDataCount.toNumber(),DataElement:t.DataElement.map(e=>({x:e.x.toNumber(),y:e.y.toNumber(),price:e.price.toNumber()}))}}function nr(o,t,e,n){let r=eu(o,je(o,t,er(o,t,e)))/o.multiplier;return n?r:1/r}var Bt=class{constructor({connection:t}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=t}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let t=await this.connection.getAccountInfo(Te);t&&(this._layoutData=ji(t==null?void 0:t.data))}}};var Lo=M("Raydium_liquidity_instruction");function rr(o){let{poolKeys:t,userKeys:e,amountIn:n,amountOut:r,fixedSide:i}=o,{version:a}=t;if(a===4||a===5){let u={poolKeys:t,userKeys:e};if(i==="in")return Yi(O(S({},u),{amountIn:n,minAmountOut:r}),a);if(i==="out")return Qi(O(S({},u),{maxAmountIn:n,amountOut:r}),a);Lo.logWithError("invalid params","params",o)}throw Lo.logWithError("invalid version","poolKeys.version",a),new Error("invalid version")}function ir(o){let t=R([D("instruction"),D("simulateType")]),e=Buffer.alloc(t.span);t.encode({instruction:12,simulateType:0},e);let n=[s({pubkey:o.id,isWritable:!1}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders,isWritable:!1}),s({pubkey:o.baseVault,isWritable:!1}),s({pubkey:o.quoteVault,isWritable:!1}),s({pubkey:o.lpMint,isWritable:!1}),s({pubkey:o.marketId,isWritable:!1})];return new pe.TransactionInstruction({programId:o.programId,keys:n,data:e})}function Yi({poolKeys:o,userKeys:t,amountIn:e,minAmountOut:n},r){let i=Buffer.alloc(ho.span);ho.encode({instruction:9,amountIn:x(e),minAmountOut:x(n)},i);let a=[s({pubkey:_o.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:o.id}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders})];return r===4&&a.push(s({pubkey:o.targetOrders})),a.push(s({pubkey:o.baseVault}),s({pubkey:o.quoteVault})),r===5&&a.push(s({pubkey:Te})),a.push(s({pubkey:o.marketProgramId,isWritable:!1}),s({pubkey:o.marketId}),s({pubkey:o.marketBids}),s({pubkey:o.marketAsks}),s({pubkey:o.marketEventQueue}),s({pubkey:o.marketBaseVault}),s({pubkey:o.marketQuoteVault}),s({pubkey:o.marketAuthority,isWritable:!1}),s({pubkey:t.tokenAccountIn}),s({pubkey:t.tokenAccountOut}),s({pubkey:t.owner,isWritable:!1})),new pe.TransactionInstruction({programId:o.programId,keys:a,data:i})}function Qi({poolKeys:o,userKeys:t,maxAmountIn:e,amountOut:n},r){let i=Buffer.alloc(ko.span);ko.encode({instruction:11,maxAmountIn:x(e),amountOut:x(n)},i);let a=[s({pubkey:pe.SystemProgram.programId,isWritable:!1}),s({pubkey:o.id}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders}),s({pubkey:o.targetOrders}),s({pubkey:o.baseVault}),s({pubkey:o.quoteVault})];return r===5&&a.push(s({pubkey:Te})),a.push(s({pubkey:o.marketProgramId,isWritable:!1}),s({pubkey:o.marketId}),s({pubkey:o.marketBids}),s({pubkey:o.marketAsks}),s({pubkey:o.marketEventQueue}),s({pubkey:o.marketBaseVault}),s({pubkey:o.marketQuoteVault}),s({pubkey:o.marketAuthority,isWritable:!1}),s({pubkey:t.tokenAccountIn}),s({pubkey:t.tokenAccountOut}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})),new pe.TransactionInstruction({programId:o.programId,keys:a,data:i})}function ar(o){let i=o,{owner:t}=i,e=oe(i,["owner"]),n=Buffer.alloc(To.span);To.encode({instruction:10,nonce:e.nonce},n);let r=[...Ke,s({pubkey:e.targetOrders}),s({pubkey:e.withdrawQueue}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.lpMint}),s({pubkey:e.baseMint,isWritable:!1}),s({pubkey:e.quoteMint,isWritable:!1}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault}),s({pubkey:e.lpVault}),s({pubkey:e.marketId,isWritable:!1}),s({pubkey:t,isSigner:!0})];return new pe.TransactionInstruction({programId:e.programId,keys:r,data:n})}function sr(o){let{poolKeys:t,userKeys:e,startTime:n}=o,r=Buffer.alloc(Ao.span);Ao.encode({instruction:0,nonce:t.nonce,startTime:x(n)},r);let i=[...Ke,s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.lpMint}),s({pubkey:t.baseMint,isWritable:!1}),s({pubkey:t.quoteMint,isWritable:!1}),s({pubkey:t.baseVault,isWritable:!1}),s({pubkey:t.quoteVault,isWritable:!1}),s({pubkey:t.withdrawQueue}),s({pubkey:t.targetOrders}),s({pubkey:e.lpTokenAccount}),s({pubkey:t.lpVault,isWritable:!1}),s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId,isWritable:!1}),s({pubkey:e.payer,isSigner:!0})];return new pe.TransactionInstruction({programId:t.programId,keys:i,data:r})}function ur(o){let{poolKeys:t,userKeys:e,baseAmountIn:n,quoteAmountIn:r,fixedSide:i}=o,{version:a}=t;if(a===4||a===5){let u=Buffer.alloc(xo.span);xo.encode({instruction:3,baseAmountIn:x(n),quoteAmountIn:x(r),fixedSide:x(i==="base"?0:1)},u);let c=[s({pubkey:_o.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders,isWritable:!1}),s({pubkey:t.targetOrders}),s({pubkey:t.lpMint}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault})];return a===5&&c.push(s({pubkey:Te})),c.push(s({pubkey:t.marketId,isWritable:!1}),s({pubkey:e.baseTokenAccount}),s({pubkey:e.quoteTokenAccount}),s({pubkey:e.lpTokenAccount}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})),new pe.TransactionInstruction({programId:t.programId,keys:c,data:u})}return Lo.logWithError("invalid version","poolKeys.version",a),new pe.TransactionInstruction({programId:t.programId,keys:[]})}function cr(o){let{poolKeys:t,userKeys:e,amountIn:n}=o,{version:r}=t;if(r===4||r===5){let i=Buffer.alloc(So.span);So.encode({instruction:4,amountIn:x(n)},i);let a=[s({pubkey:_o.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.targetOrders}),s({pubkey:t.lpMint}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault})];return r===5?a.push(s({pubkey:Te})):a.push(s({pubkey:t.withdrawQueue}),s({pubkey:t.lpVault})),a.push(s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId}),s({pubkey:t.marketBaseVault}),s({pubkey:t.marketQuoteVault}),s({pubkey:t.marketAuthority,isWritable:!1}),s({pubkey:e.lpTokenAccount}),s({pubkey:e.baseTokenAccount}),s({pubkey:e.quoteTokenAccount}),s({pubkey:e.owner,isWritable:!1,isSigner:!0}),s({pubkey:t.marketEventQueue}),s({pubkey:t.marketBids}),s({pubkey:t.marketAsks})),new pe.TransactionInstruction({programId:t.programId,keys:a,data:i})}return Lo.logWithError("invalid version","poolKeys.version",r),new pe.TransactionInstruction({programId:t.programId,keys:[]})}var Zi=require("@project-serum/serum"),ut=X(require("bn.js"));var mr=require("@solana/web3.js");var lr=M("Raydium_liquidity_serum"),dr="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",Hi=new mr.PublicKey(dr),tu={[dr]:3},zi={3:Hi};function pr(o){let t=Zn[o];return t||lr.logWithError("invalid version","version",o),t}function fr(o){let t=zi[o];return t||lr.logWithError("invalid version","version",o),t}async function yr({programId:o,marketId:t}){let e=[t.toBuffer()],n=0,r;for(;n<100;){try{let i=e.concat(Buffer.from([n]),Buffer.alloc(7));r=await mr.PublicKey.createProgramAddress(i,o)}catch(i){if(i instanceof TypeError)throw i;n++;continue}return{publicKey:r,nonce:n}}throw lr.logWithError("unable to find a viable program address nonce","params",{programId:o,marketId:t}),new Error("unable to find a viable program address nonce")}var Ro=M("Raydium_liquidity_util");function Mo(o,t){let e=o instanceof B?o.token:W.WSOL,{baseMint:n,quoteMint:r}=t;if(e.mint.equals(n))return"base";if(e.mint.equals(r))return"quote";let i=`liquidity getTokenSide - token not match with pool, params: ${JSON.stringify({token:e.mint,baseMint:n,quoteMint:r})}`;throw console.error(i),new Error(i)}function Qe(o,t){let{baseMint:e,quoteMint:n}=t;return o.mint.equals(e)||o.mint.equals(n)}function Bo(o){let{status:t,startTime:e}=o,n=t.toNumber();return{[0]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[1]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[2]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[3]:{swap:!1,addLiquidity:!1,removeLiquidity:!0},[4]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[5]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[6]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[7]:{swap:Date.now()/1e3>=e.toNumber(),addLiquidity:!0,removeLiquidity:!0}}[n]||{swap:!1,addLiquidity:!1,removeLiquidity:!1}}function ou(o){let t=Xn[o];return t||Ro.logWithError("invalid version","version",o),t}function Xi(o){let t=zn[o];return t||Ro.logWithError("invalid version","version",o),t}async function Re({name:o,programId:t,marketId:e}){let{publicKey:n}=await we([t.toBuffer(),e.toBuffer(),Buffer.from(o,"utf-8")],t);return n}async function ea({programId:o}){return we([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],o)}async function Ko({version:o,marketId:t,baseMint:e,quoteMint:n}){let r=Xi(o),[i,a,u]=[E({publicKey:t}),E({publicKey:e,transformSol:!0}),E({publicKey:n,transformSol:!0})],c=await Re({name:"amm_associated_seed",programId:r,marketId:i}),m=await Re({name:"lp_mint_associated_seed",programId:r,marketId:i}),{publicKey:d,nonce:p}=await ea({programId:r}),y=await Re({name:"coin_vault_associated_seed",programId:r,marketId:i}),f=await Re({name:"pc_vault_associated_seed",programId:r,marketId:i}),b=await Re({name:"temp_lp_token_associated_seed",programId:r,marketId:i}),h=await Re({name:"open_order_associated_seed",programId:r,marketId:i}),L=await Re({name:"target_associated_seed",programId:r,marketId:i}),P=await Re({name:"withdraw_associated_seed",programId:r,marketId:i}),T=pr(o),_=fr(T),{publicKey:I}=await yr({programId:_,marketId:i});return{id:c,baseMint:a,quoteMint:u,lpMint:m,version:o,programId:r,authority:d,nonce:p,baseVault:y,quoteVault:f,lpVault:b,openOrders:h,targetOrders:L,withdrawQueue:P,marketVersion:T,marketProgramId:_,marketId:i,marketAuthority:I}}async function gr({connection:o,pools:t}){let e=t.map(r=>ir(r));return(await on(o,e,"GetPoolData")).map(r=>{let i=nn(r,"GetPoolData"),a=new ut.default(Pe(i,"status")),u=Number(Pe(i,"coin_decimals")),c=Number(Pe(i,"pc_decimals")),m=Number(Pe(i,"lp_decimals")),d=new ut.default(Pe(i,"pool_coin_amount")),p=new ut.default(Pe(i,"pool_pc_amount")),y=new ut.default(Pe(i,"pool_lp_supply")),f="0";try{f=Pe(i,"pool_open_time")}catch{f="0"}return{status:a,baseDecimals:u,quoteDecimals:c,lpDecimals:m,baseReserve:d,quoteReserve:p,lpSupply:y,startTime:new ut.default(f)}})}function Pr(o,t,e){return ta(o.token,t.token,e)}function ta(o,t,e){let{baseMint:n,quoteMint:r}=e,i=br(o,e),a=br(t,e);return i===a&&Ro.logWithError("tokens not match with pool","params",{tokenA:o.mint,tokenB:t.mint,baseMint:n,quoteMint:r}),[i,a]}function br(o,t){let{baseMint:e,quoteMint:n}=t;return o.mint.equals(e)?"base":o.mint.equals(n)?"quote":(Ro.logWithError("token not match with pool","params",{token:o.mint,baseMint:e,quoteMint:n}),"base")}var wr=o=>o==="a"||o==="b";async function nu(o,t,e){let n=await o.getAccountInfo(t);if(n===null)return null;let r=Io.decode(n.data),i=await o.getTokenAccountBalance(r.baseVault),a=await o.getTokenAccountBalance(r.quoteVault),u=await Zi.OpenOrders.load(o,r.openOrders,e),c=10**r.baseDecimal.toNumber(),m=10**r.quoteDecimal.toNumber(),d=u.baseTokenTotal.toNumber()/c,p=u.quoteTokenTotal.toNumber()/m,y=r.baseNeedTakePnl.toNumber()/c,f=r.quoteNeedTakePnl.toNumber()/m,b=i.value.uiAmount+d-y,h=a.value.uiAmount+p-f,L=parseFloat(r.lpReserve.toString()),P=b/h;return{baseAmount:b,quoteAmount:h,lpSupply:L,baseVaultKey:r.baseVault,quoteVaultKey:r.quoteVault,baseVaultBalance:i.value.uiAmount,quoteVaultBalance:a.value.uiAmount,openOrdersKey:r.openOrders,openOrdersTotalBase:d,openOrdersTotalQuote:p,basePnl:y,quotePnl:f,priceInQuote:P}}var Kt=class extends se{constructor(e){super(e);this._poolInfos=[];this._poolInfoMap=new Map;this._pairsInfo=[];this._pairsInfoMap=new Map;this._lpTokenMap=new Map;this._lpPriceMap=new Map;this._officialIds=new Set;this._unOfficialIds=new Set;this._sdkParseInfoCache=new Map;this._stableLayout=new Bt({connection:this.scope.connection})}async load(e){if(await this.scope.fetchLiquidity(e==null?void 0:e.forceUpdate),!this.scope.apiData.liquidityPools)return;let{data:n}=this.scope.apiData.liquidityPools,[r,i]=[n.official||[],n.unOfficial||[]];this._poolInfos=[...r,...i],this._officialIds=new Set(r.map(a=>{var c,m;let u=`${(c=this.scope.token.allTokenMap.get(a.baseMint))==null?void 0:c.symbol} - ${(m=this.scope.token.allTokenMap.get(a.quoteMint))==null?void 0:m.symbol}`;return this._poolInfoMap.set(a.id,a),this._lpTokenMap.set(a.lpMint,new W({mint:a.lpMint,decimals:a.lpDecimals,symbol:u,name:`${u} LP`})),a.id})),this._unOfficialIds=new Set(i.map(a=>{var c,m;let u=`${(c=this.scope.token.allTokenMap.get(a.baseMint))==null?void 0:c.symbol} - ${(m=this.scope.token.allTokenMap.get(a.quoteMint))==null?void 0:m.symbol}`;return this._poolInfoMap.set(a.id,a),this._lpTokenMap.set(a.lpMint,new W({mint:a.lpMint,decimals:a.lpDecimals,symbol:u,name:`${u} LP`})),a.id}))}async loadPairs(e){var n;return await this.scope.fetchPairs(e==null?void 0:e.forceUpdate),this._pairsInfo=((n=this.scope.apiData.liquidityPairsInfo)==null?void 0:n.data)||[],this._pairsInfoMap=new Map(this._pairsInfo.map(r=>{let i=this._lpTokenMap.get(r.lpMint),a=i&&r.lpPrice?ze({token:i,numberPrice:r.lpPrice,decimalDone:!0}):null;return a&&this._lpPriceMap.set(r.lpMint,a),[r.ammId,r]})),this._pairsInfo}get allPools(){return this._poolInfos}get allPoolIdSet(){return{official:this._officialIds,unOfficial:this._unOfficialIds}}get allPoolMap(){return this._poolInfoMap}get allPairs(){return this._pairsInfo}get allPairsMap(){return this._pairsInfoMap}get lpTokenMap(){return this._lpTokenMap}get lpPriceMap(){return this._lpPriceMap}async fetchMultipleInfo(e){return await this._stableLayout.initStableModelLayout(),await gr(O(S({},e),{connection:this.scope.connection}))}async sdkParseJsonLiquidityInfo(e){if(!e.length)return[];let n=e.map(r=>r.id).join("-");if(this._sdkParseInfoCache.has(n))return this._sdkParseInfoCache.get(n);try{let i=(await this.fetchMultipleInfo({pools:e.map(le)})).map((a,u)=>S(S({jsonInfo:e[u]},le(e[u])),a));return this._sdkParseInfoCache.set(n,i),i}catch(r){return console.error(r),[]}}computeAmountOut({poolKeys:e,poolInfo:n,amountIn:r,outputToken:i,slippage:a}){this.checkDisabled();let u=M("Raydium_computeAmountOut"),c=r.token,m=i;(!Qe(c,e)||!Qe(m,e))&&u.logWithError("token not match with pool","poolKeys",e);let{baseReserve:d,quoteReserve:p}=n;this.logDebug("baseReserve:",d.toString(),"quoteReserve:",p.toString());let y=r.token;this.logDebug("inputToken:",y),this.logDebug("amountIn:",r.toFixed()),this.logDebug("outputToken:",i),this.logDebug("slippage:",`${a.toSignificant()}%`);let f=[d,p],b=Mo(r,e);b==="quote"&&f.reverse(),this.logDebug("input side:",b);let[h,L]=f,P;if(e.version===4)P=new $({baseToken:y,denominator:h,quoteToken:i,numerator:L});else{let Z=nr(this._stableLayout.stableModelData,d.toNumber(),p.toNumber(),!1);P=new $({baseToken:y,denominator:b==="quote"?new Ae.default(Z*1e6):new Ae.default(1e6),quoteToken:i,numerator:b==="quote"?new Ae.default(1e6):new Ae.default(Z*1e6)})}this.logDebug("currentPrice:",`1 ${y.symbol} \u2248 ${P.toFixed()} ${i.symbol}`),this.logDebug("currentPrice invert:",`1 ${i.symbol} \u2248 ${P.invert().toFixed()} ${y.symbol}`);let T=r.raw,_=ae,I=ae;if(!T.isZero())if(e.version===4){I=T.mul(jn).div(Yn);let Z=T.sub(I),ie=h.add(Z);_=L.mul(Z).div(ie)}else{I=T.mul(new Ae.default(2)).div(new Ae.default(1e4));let Z=T.sub(I),ie=b==="quote"?tr:or;_=new Ae.default(ie(this._stableLayout.stableModelData,p.toNumber(),d.toNumber(),Z.toNumber()))}let N=new ne(ye).add(a).invert().mul(_).quotient,v=new B(i,_),z=new B(i,N);this.logDebug("amountOut:",v.toFixed(),"minAmountOut:",z.toFixed());let V=new $({baseToken:y,denominator:T.sub(I),quoteToken:i,numerator:_});!T.isZero()&&!_.isZero()&&(V=new $({baseToken:y,denominator:T.sub(I),quoteToken:i,numerator:_}),this.logDebug("executionPrice:",`1 ${y.symbol} \u2248 ${V.toFixed()} ${i.symbol}`),this.logDebug("executionPrice invert:",`1 ${i.symbol} \u2248 ${V.invert().toFixed()} ${y.symbol}`));let J=new ne(parseInt(String(Math.abs(parseFloat(V.toFixed())-parseFloat(P.toFixed()))*1e9)),parseInt(String(parseFloat(P.toFixed())*1e9))),te=new B(y,I);return{amountOut:v,minAmountOut:z,currentPrice:P,executionPrice:V,priceImpact:J,fee:te}}async computePairAmount({poolId:e,amount:n,anotherToken:r,slippage:i}){let a=E({publicKey:e}),u=this._poolInfoMap.get(a.toBase58());u||this.logAndCreateError("pool not found",a.toBase58());let c=(await this.sdkParseJsonLiquidityInfo([u]))[0];c||this.logAndCreateError("pool parseInfo not found",a.toBase58());let{baseReserve:m,quoteReserve:d}=c;this.logDebug("baseReserve:",m.toString(),"quoteReserve:",d.toString());let p=n.token;this.logDebug("tokenIn:",p,"amount:",n.toFixed(),"anotherToken:",r,"slippage:",`${i.toSignificant()}%`);let y=Mo(n,le(u));this.logDebug("input side:",y);let f=ae;n.isZero()||(f=y==="base"?Ht(n.raw.mul(d),m):Ht(n.raw.mul(m),d));let h=new ne(ye).add(i).mul(f).quotient,L=new B(r,f),P=new B(r,h);return this.logDebug("anotherAmount:",L.toFixed(),"maxAnotherAmount:",P.toFixed()),{anotherAmount:L,maxAnotherAmount:P}}async swapWithAMM(e){let{poolKeys:n,payer:r,amountIn:i,amountOut:a,fixedSide:u,config:c}=e;this.logDebug("amountIn:",i),this.logDebug("amountOut:",a),(i.isZero()||a.isZero())&&this.logAndCreateError("amounts must greater than zero","amounts",{amountIn:i.toFixed(),amountOut:a.toFixed()});let{account:m}=this.scope,d=this.createTxBuilder(),{bypassAssociatedCheck:p=!1}=c||{},[y,f]=[i.token,a.token],b=await m.getCreatedTokenAccount({mint:y.mint,associatedOnly:!1}),h=await m.getCreatedTokenAccount({mint:f.mint}),[L,P]=[i.raw,a.raw],N=await m.handleTokenAccount({side:"in",amount:L,mint:y.mint,tokenAccount:b,bypassAssociatedCheck:p}),{tokenAccount:T}=N,_=oe(N,["tokenAccount"]);d.addInstruction(_);let v=await m.handleTokenAccount({side:"out",amount:0,mint:f.mint,tokenAccount:h,payer:r,bypassAssociatedCheck:p}),{tokenAccount:I}=v,F=oe(v,["tokenAccount"]);return d.addInstruction(F),d.addInstruction({instructions:[rr({poolKeys:n,userKeys:{tokenAccountIn:T,tokenAccountOut:I,owner:this.scope.ownerPubKey},amountIn:L,amountOut:P,fixedSide:u})]}),d.buildMultiTx({extInfo:{amountOut:a}})}async createPool(e){this.checkDisabled(),this.scope.checkOwner(),e.version!==4&&this.logAndCreateError("invalid version","poolKeys.version",e.version);let n=this.createTxBuilder(),r=await Ko(e);return await n.addInstruction({instructions:[ar(O(S({},r),{owner:this.scope.ownerPubKey}))]}).build()}async initPool(e){e.version!==4&&this.logAndCreateError("invalid version","poolKeys.version",e.version);let{baseAmount:n,quoteAmount:r,startTime:i=0,config:a}=e,u=await Ko(e),{baseMint:c,quoteMint:m,lpMint:d,baseVault:p,quoteVault:y}=u,f=this.createTxBuilder(),{account:b}=this.scope,h=!!(a!=null&&a.bypassAssociatedCheck),L=await b.getCreatedTokenAccount({mint:c,associatedOnly:!1}),P=await b.getCreatedTokenAccount({mint:m,associatedOnly:!1});!L&&!P&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",b.tokenAccounts);let T=await b.getCreatedTokenAccount({mint:d,associatedOnly:!1}),V=await b.handleTokenAccount({side:"in",amount:n.raw,mint:c,tokenAccount:L,bypassAssociatedCheck:h}),{tokenAccount:_}=V,I=oe(V,["tokenAccount"]);f.addInstruction(I);let J=await b.handleTokenAccount({side:"in",amount:r.raw,mint:m,tokenAccount:P,bypassAssociatedCheck:h}),{tokenAccount:F}=J,N=oe(J,["tokenAccount"]);f.addInstruction(N);let te=await b.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:T,bypassAssociatedCheck:h}),{tokenAccount:v}=te,z=oe(te,["tokenAccount"]);return f.addInstruction(z),f.addInstruction({instructions:[Je({source:_,destination:p,owner:this.scope.ownerPubKey,amount:n.raw}),Je({source:F,destination:y,owner:this.scope.ownerPubKey,amount:r.raw}),sr({poolKeys:u,userKeys:{lpTokenAccount:v,payer:this.scope.ownerPubKey},startTime:i})]}),await f.build()}async addLiquidity(e){let{poolId:n,amountInA:r,amountInB:i,fixedSide:a,config:u}=e,c=E({publicKey:n}),m=this.allPools.find(Ut=>Ut.id===c.toBase58());m||this.logAndCreateError("pool not found",n);let p=(await this.sdkParseJsonLiquidityInfo([m]))[0];p||this.logAndCreateError("pool parse error",p),this.logDebug("amountInA:",r,"amountInB:",i),(r.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:r.toFixed(),amountInB:i.toFixed()});let{account:y}=this.scope,f=(u==null?void 0:u.bypassAssociatedCheck)||!1,[b,h]=[r.token,i.token],L=await y.getCreatedTokenAccount({mint:b.mint,associatedOnly:!1}),P=await y.getCreatedTokenAccount({mint:h.mint,associatedOnly:!1});!L&&!P&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",y.tokenAccounts);let T=await y.getCreatedTokenAccount({mint:p.lpMint}),_=[b,h],I=[L,P],F=[r.raw,i.raw],[N]=Pr(r,i,p),v="base";(!["quote","base"].includes(N)||!wr(a))&&this.logAndCreateError("invalid fixedSide","fixedSide",a),N==="quote"?(_.reverse(),I.reverse(),F.reverse(),v=a==="a"?"quote":"base"):N==="base"&&(v=a==="a"?"base":"quote");let[z,V]=_,[J,te]=I,[Z,ie]=F,ce=this.createTxBuilder(),lt=await y.handleTokenAccount({side:"in",amount:Z,mint:z.mint,tokenAccount:J,bypassAssociatedCheck:f}),{tokenAccount:Me}=lt,fe=oe(lt,["tokenAccount"]);ce.addInstruction(fe);let dt=await y.handleTokenAccount({side:"in",amount:ie,mint:V.mint,tokenAccount:te,bypassAssociatedCheck:f}),{tokenAccount:Ie}=dt,be=oe(dt,["tokenAccount"]);ce.addInstruction(be);let pt=await y.handleTokenAccount({side:"out",amount:0,mint:p.lpMint,tokenAccount:T,bypassAssociatedCheck:f}),{tokenAccount:Ct}=pt,Wt=oe(pt,["tokenAccount"]);return ce.addInstruction(Wt),ce.addInstruction({instructions:[ur({poolKeys:p,userKeys:{baseTokenAccount:Me,quoteTokenAccount:Ie,lpTokenAccount:Ct,owner:this.scope.ownerPubKey},baseAmountIn:Z,quoteAmountIn:ie,fixedSide:v})]}),await ce.build()}async removeLiquidity(e){let{poolId:n,amountIn:r,config:i}=e,a=E({publicKey:n}),u=this.allPools.find(V=>V.id===a.toBase58());u||this.logAndCreateError("pool not found",n);let m=(await this.sdkParseJsonLiquidityInfo([u]))[0];m||this.logAndCreateError("pool pass error",m);let{baseMint:d,quoteMint:p,lpMint:y}=m;this.logDebug("amountIn:",r),r.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",r.toFixed()),r.token.mint.equals(y)||this.logAndCreateError("amountIn's token not match lpMint","amountIn",r);let{account:f}=this.scope,b=await f.getCreatedTokenAccount({mint:y,associatedOnly:!1});b||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",f.tokenAccounts);let h=await f.getCreatedTokenAccount({mint:d}),L=await f.getCreatedTokenAccount({mint:p}),P=this.createTxBuilder(),T=(i==null?void 0:i.bypassAssociatedCheck)||!1,v=await f.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:h,bypassAssociatedCheck:T}),{tokenAccount:_}=v,I=oe(v,["tokenAccount"]);P.addInstruction(I);let z=await f.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:L,bypassAssociatedCheck:T}),{tokenAccount:F}=z,N=oe(z,["tokenAccount"]);return P.addInstruction(N),P.addInstruction({instructions:[oa.ComputeBudgetProgram.requestUnits({units:4e5,additionalFee:0}),cr({poolKeys:m,userKeys:{lpTokenAccount:b,baseTokenAccount:_,quoteTokenAccount:F,owner:this.scope.ownerPubKey},amountIn:r.raw})]}),await P.build()}lpMintToTokenAmount({poolId:e,amount:n,decimalDone:r}){let i=E({publicKey:e});i||this.logAndCreateError("pool not found");let a=this._poolInfoMap.get(i.toBase58()),u=ue(n),c=new W({mint:a.lpMint,decimals:a.lpDecimals}),m=r?new A(u.numerator,u.denominator):new A(u.numerator,u.denominator).mul(new Ae.default(10).pow(new Ae.default(c.decimals)));return new B(c,Se(m))}getFixedSide({poolId:e,inputMint:n}){let[r,i]=[E({publicKey:e}),E({publicKey:n})],a=this._poolInfoMap.get(r.toBase58());a||this.logAndCreateError("pool not found",r.toBase58());let u=a.baseMint===i.toBase58();return(i.equals(Le)||i.equals(U))&&(u=!u),u?"a":"b"}};var Ir=require("@solana/web3.js"),Nt=require("lodash");var na=require("@solana/web3.js");var ra="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",ct=new na.PublicKey(ra),hr=["amm","serum","route"],kr=[Jo,kt,Le,jo,Go,Yo,Qo,$o,Ho].map(o=>o.toBase58());var Ft=require("@solana/spl-token"),mt=require("@solana/web3.js");var Ot=R([D("instruction"),l("amountIn"),l("amountOut")]),qt=R([D("instruction")]);var ru=M("Raydium_route_instruction");function Tr(o){let{fixedSide:t}=o;if(t==="in")return[ia(o),aa(o)];throw ru.logWithError("invalid params","params",o),new Error(`invalid params, params: ${o}`)}function ia({fromPoolKeys:o,toPoolKeys:t,userKeys:e,amountIn:n,amountOut:r}){let i=Buffer.alloc(Ot.span),a;return o.version===4?(Ot.encode({instruction:0,amountIn:x(n),amountOut:x(r)},i),a=[s({pubkey:mt.SystemProgram.programId,isWritable:!1}),s({pubkey:Ft.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:o.programId,isWritable:!1}),s({pubkey:o.id}),s({pubkey:t.id,isWritable:!1}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders}),s({pubkey:o.baseVault}),s({pubkey:o.quoteVault}),s({pubkey:o.marketProgramId,isWritable:!1}),s({pubkey:o.marketId}),s({pubkey:o.marketBids}),s({pubkey:o.marketAsks}),s({pubkey:o.marketEventQueue}),s({pubkey:o.marketBaseVault}),s({pubkey:o.marketQuoteVault}),s({pubkey:o.marketAuthority,isWritable:!1}),s({pubkey:e.inTokenAccount}),s({pubkey:e.middleTokenAccount}),s({pubkey:e.middleStatusAccount}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})]):(Ot.encode({instruction:2,amountIn:x(n),amountOut:x(r)},i),a=[s({pubkey:mt.SystemProgram.programId,isWritable:!1}),s({pubkey:Ft.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:o.programId,isWritable:!1}),s({pubkey:o.id}),s({pubkey:t.id,isWritable:!1}),s({pubkey:o.authority,isWritable:!1}),s({pubkey:o.openOrders}),s({pubkey:o.baseVault}),s({pubkey:o.quoteVault}),s({pubkey:Te,isWritable:!1}),s({pubkey:o.marketProgramId,isWritable:!1}),s({pubkey:o.marketId}),s({pubkey:o.marketBids}),s({pubkey:o.marketAsks}),s({pubkey:o.marketEventQueue}),s({pubkey:o.id}),s({pubkey:o.id}),s({pubkey:o.id}),s({pubkey:e.inTokenAccount}),s({pubkey:e.middleTokenAccount}),s({pubkey:e.middleStatusAccount}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})]),new mt.TransactionInstruction({programId:ct,keys:a,data:i})}function aa({fromPoolKeys:o,toPoolKeys:t,userKeys:e}){let n=Buffer.alloc(qt.span),r;return t.version===4?(qt.encode({instruction:1},n),r=[s({pubkey:Ft.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.programId,isWritable:!1}),s({pubkey:o.id,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault}),s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId}),s({pubkey:t.marketBids}),s({pubkey:t.marketAsks}),s({pubkey:t.marketEventQueue}),s({pubkey:t.marketBaseVault}),s({pubkey:t.marketQuoteVault}),s({pubkey:t.marketAuthority,isWritable:!1}),s({pubkey:e.middleTokenAccount}),s({pubkey:e.outTokenAccount}),s({pubkey:e.middleStatusAccount}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})]):(qt.encode({instruction:3},n),r=[s({pubkey:Ft.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.programId,isWritable:!1}),s({pubkey:o.id,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault}),s({pubkey:Te,isWritable:!1}),s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId}),s({pubkey:t.marketBids}),s({pubkey:t.marketAsks}),s({pubkey:t.marketEventQueue}),s({pubkey:t.id}),s({pubkey:t.id}),s({pubkey:t.id}),s({pubkey:e.middleTokenAccount}),s({pubkey:e.outTokenAccount}),s({pubkey:e.middleStatusAccount}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})]),new mt.TransactionInstruction({programId:ct,keys:r,data:n})}async function Ar({programId:o,fromPoolId:t,middleMint:e,owner:n}){let{publicKey:r}=await we([t.toBuffer(),e.toBuffer(),n.toBuffer()],o);return r}var vt=class extends se{constructor(t){super(t)}computeRouteAmountOut({fromPoolKeys:t,toPoolKeys:e,fromPoolInfo:n,toPoolInfo:r,amountIn:i,outputToken:a,slippage:u}){let{swap:c}=Bo(n),{swap:m}=Bo(r);(!c||!m)&&this.logAndCreateError("pools swap not enabled","pools",{fromPoolKeys:t,toPoolKeys:e,fromPoolInfo:n,toPoolInfo:r});let d=i.token,p=a;(!Qe(d,t)||!Qe(p,e))&&this.logAndCreateError("pools cannot be routed","pools",{fromPoolKeys:t,toPoolKeys:e});let y=[t.baseMint.toBase58(),t.quoteMint.toBase58()],f=[e.baseMint.toBase58(),e.quoteMint.toBase58()],b=[...y,...f],h=[n.baseDecimals,n.quoteDecimals,r.baseDecimals,r.quoteDecimals],[L,P]=[d.mint.toBase58(),p.mint.toBase58()],T=(0,Nt.xor)(y,f);(T.length!==2||!T.includes(L)||!T.includes(P))&&this.logAndCreateError("xor tokens not match","pools",{fromPoolKeys:t,toPoolKeys:e});let _=(0,Nt.intersection)(y,f);_.length!==1&&this.logAndCreateError("cannot found middle token of two pools","pools",{fromPoolKeys:t,toPoolKeys:e});let I=_[0],F=b.indexOf(I);F===-1&&this.logAndCreateError("cannot found middle token","pools",{fromPoolKeys:t,toPoolKeys:e});let N=h[F],v=new Ir.PublicKey(I),z=new W({mint:v,decimals:N});this.logInfo("from pool:",t),this.logInfo("to pool:",e),this.logInfo("intersection mints:",_),this.logInfo("xor mints:",T),this.logInfo("middleMint:",I);let{minAmountOut:V,priceImpact:J,fee:te}=this.scope.liquidity.computeAmountOut({poolKeys:t,poolInfo:n,amountIn:i,outputToken:z,slippage:u}),{amountOut:Z,minAmountOut:ie,priceImpact:ce,fee:Me}=this.scope.liquidity.computeAmountOut({poolKeys:e,poolInfo:r,amountIn:V,outputToken:a,slippage:u}),fe=null,[Ie,be]=[i.raw,Z.raw];return!Ie.isZero()&&!be.isZero()&&(fe=new $({baseToken:d,denominator:Ie,quoteToken:a,numerator:be}),this.logDebug("executionPrice:",`1 ${d.symbol} \u2248 ${fe.toFixed()} ${a.symbol}`),this.logDebug("executionPrice invert:",`1 ${a.symbol} \u2248 ${fe.invert().toFixed()} ${d.symbol}`)),{amountOut:Z,minAmountOut:ie,executionPrice:fe,priceImpact:J.add(ce),fee:[te,Me]}}async swapWithRoute(t){let{fromPoolKeys:e,toPoolKeys:n,amountIn:r,amountOut:i,fixedSide:a,config:u}=t;this.logDebug("amountIn:",r,"amountOut:",i),(r.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amounts",{amountIn:r.toFixed(),amountOut:i.toFixed()});let{account:c}=this.scope,{bypassAssociatedCheck:m=!1}=u||{},[d,p]=[r.token,i.token],y=await this.scope.account.getCreatedTokenAccount({mint:d.mint,associatedOnly:!1}),f=await this.scope.account.getCreatedTokenAccount({mint:p.mint}),b=[e.baseMint.toBase58(),e.quoteMint.toBase58()],h=[n.baseMint.toBase58(),n.quoteMint.toBase58()],P=(0,Nt.intersection)(b,h)[0],T=new Ir.PublicKey(P),_=await this.scope.account.getCreatedTokenAccount({mint:T}),[I,F]=[r.raw,i.raw],N=this.createTxBuilder(),v=this.createTxBuilder(),fe=await c.handleTokenAccount({side:"in",amount:I,mint:d.mint,tokenAccount:y,bypassAssociatedCheck:m,skipCloseAccount:!0}),{tokenAccount:z}=fe,V=oe(fe,["tokenAccount"]);N.addInstruction(V);let Ie=await c.handleTokenAccount({side:"out",amount:0,mint:p.mint,tokenAccount:f,bypassAssociatedCheck:m,skipCloseAccount:!0}),{tokenAccount:J}=Ie,te=oe(Ie,["tokenAccount"]);N.addInstruction(te);let be=await c.handleTokenAccount({side:"in",amount:0,mint:T,tokenAccount:_,bypassAssociatedCheck:m,skipCloseAccount:!0}),{tokenAccount:Z}=be,ie=oe(be,["tokenAccount"]);N.addInstruction(ie),v.addInstruction({instructions:Tr({fromPoolKeys:e,toPoolKeys:n,userKeys:{inTokenAccount:z,outTokenAccount:J,middleTokenAccount:Z,middleStatusAccount:await Ar({programId:ct,fromPoolId:e.id,middleMint:T,owner:this.scope.ownerPubKey}),owner:this.scope.ownerPubKey},amountIn:I,amountOut:F,fixedSide:a})});let ce=N.build();return await v.buildMultiTx({extraPreBuildData:[ce],extInfo:{amountOut:F}})}};var sa=require("@solana/web3.js"),Sr=X(require("bn.js"));var Oo=R([qe("mintAuthorityOption"),k("mintAuthority"),l("supply"),D("decimals"),D("isInitialized"),qe("freezeAuthorityOption"),k("freezeAuthority")]);function xr(o,t){return o.sort((e,n)=>{let{official:r,unOfficial:i}=t,a=new Set(r),u=new Set(i),c=p=>a.has(p.mint)?1:u.has(p.mint)?2:3,m=c(e)-c(n),d=p=>!/^[a-zA-Z]/.test(p);if(m===0){let p=d(e.symbol),y=d(n.symbol);return p&&!y?1:!p&&y?-1:e.symbol.localeCompare(n.symbol)}else return m})}async function iu(o,t){try{if(!o)return;let e=await o.getAccountInfo(E({publicKey:t}));return!e||e.data.length!==Oo.span?void 0:Oo.decode(e.data)}catch{return}}var Dt=class extends se{constructor(e){super(e);this._tokens=[];this._tokenMap=new Map;this._tokenPrice=new Map;this._mintList={official:[],unOfficial:[],unNamed:[]}}async load(e){this.checkDisabled(),await this.scope.fetchTokens(e==null?void 0:e.forceUpdate),this._mintList={official:[],unOfficial:[],unNamed:[]},this._tokens=[],this._tokenMap=new Map;let{data:n}=this.scope.apiData.tokens||{data:{official:[],unOfficial:[],unNamed:[],blacklist:[]}},r=new Set(n.blacklist);[n.official,n.unOfficial,n.unNamed].forEach((i,a)=>{i.forEach(u=>{let c=["official","unOfficial","unNamed"][a];!r.has(u.mint)&&u.mint!==U.toBase58()&&(this._tokens.push(O(S({},u),{symbol:u.symbol||"",name:u.name||""})),this._mintList[c].push(u.mint))})}),this._mintList.official.push(Xe.mint.toBase58()),this._tokens=xr(this._tokens,this._mintList),this._tokens.push(O(S({},Xe),{mint:U.toBase58()})),this._tokens.forEach(i=>{this._tokenMap.set(i.mint,O(S({},i),{id:i.mint}))}),this._tokenMap.set(j.mint,O(S({},j),{icon:Xe.icon,id:"wsol"})),this._tokenMap.set(U.toBase58(),O(S({},Xe),{mint:U.toBase58()}))}get allTokens(){return this._tokens}get allTokenMap(){return this._tokenMap}get tokenMints(){return this._mintList}get tokenPrices(){return this._tokenPrice}async fetchTokenPrices(e){let n=this.allTokens.filter(m=>{var d;return!!((d=m.extensions)!=null&&d.coingeckoId)&&m.mint!==sa.PublicKey.default.toBase58()}),r=n.map(m=>m.extensions.coingeckoId),i=await this.scope.api.getCoingeckoPrice(r),a=n.reduce((m,d)=>i[d.extensions.coingeckoId].usd?O(S({},m),{[d.mint]:ze({token:this._tokenMap.get(d.mint),numberPrice:i[d.extensions.coingeckoId].usd,decimalDone:!0})}):m,{}),u=e||await this.scope.api.getRaydiumTokenPrice(),c=Object.keys(u).reduce((m,d)=>this._tokenMap.get(d)?O(S({},m),{[d]:ze({token:this._tokenMap.get(d),numberPrice:u[d],decimalDone:!0})}):m,{});return this._tokenPrice=new Map([...Object.entries(a),...Object.entries(c)]),this._tokenPrice}mintToToken(e){let n=E({publicKey:e,transformSol:!0}),r=this.allTokenMap.get(n.toBase58());r||this.logAndCreateError("token not found, mint:",n.toBase58());let{decimals:i,name:a,symbol:u}=r;return new W({mint:e,decimals:i,name:a,symbol:u})}mintToTokenAmount({mint:e,amount:n,decimalDone:r}){let i=this.mintToToken(e);return r?new B(i,x(n)):new B(i,this.decimalAmount({mint:e,amount:n,decimalDone:r}))}decimalAmount({mint:e,amount:n}){let r=ue(n),i=this.mintToToken(e);return Se(new A(r.numerator,r.denominator).mul(new Sr.default(10**i.decimals)))}uiAmount({mint:e,amount:n}){let r=ue(n),i=this.mintToToken(e);return i?new A(r.numerator,r.denominator).div(new Sr.default(10**i.decimals)).toSignificant(i.decimals):""}};function Lr(o){let t=[];for(let e=0;e<o.length;e++)for(let n=0;n<o.length;n++)e!=n&&t.push([o[e],o[n]]);return t}var Et=class extends se{async load(){this.checkDisabled(),await this.scope.fetchLiquidity()}async _getBestSwapPool({availablePools:t,officialPoolIdSet:e}){if(t.length===0)return;if(t.length===1)return t[0];let n=t.filter(a=>e.has(a.id));return n.length===1?n[0]:(await this.scope.liquidity.sdkParseJsonLiquidityInfo(n.length?n:t)).reduce((a,u)=>{let c=a.version===5,m=u.version===5;return c&&!m?a:!c&&m?u:un(eo(a.lpSupply,10**a.lpDecimals),eo(u.lpSupply,10**u.lpDecimals))?a:u}).jsonInfo}async getAvailablePools(t){this.checkDisabled();let{inputMint:e,outputMint:n}=t,[r,i]=[E({publicKey:e,transformSol:!0}).toBase58(),E({publicKey:n,transformSol:!0}).toBase58()],a=this.scope.liquidity.allPools.filter(p=>p.baseMint===r&&p.quoteMint===i||p.baseMint===i&&p.quoteMint===r),u=new Set([...kr,r,i]),c=new Set(JSON.parse(JSON.stringify([...u])));c.delete(r),c.delete(i);let m=this.scope.liquidity.allPools.filter(p=>{let y=u.has(p.baseMint)&&u.has(p.quoteMint),f=c.has(p.baseMint)&&c.has(p.quoteMint);return y&&!f}),d=await this._getBestSwapPool({availablePools:a,officialPoolIdSet:this.scope.liquidity.allPoolIdSet.official});return{availablePools:a,best:d,routedPools:m}}async getBestAmountOut({pools:t,amountIn:e,inputToken:n,outputToken:r,slippage:i,features:a}){if(this.checkDisabled(),!t){let{routedPools:_}=await this.getAvailablePools({inputMint:n.mint,outputMint:r.mint});t=_}let u=await this.scope.liquidity.sdkParseJsonLiquidityInfo(t||[]),c=(t||[]).map((_,I)=>({poolKeys:le(_),poolInfo:u[I]})),m=a||hr;this.logDebug("features:",m),c.length||this.logAndCreateError("please provide at least one source of trade or (inputMint & outputMint)",c);let d=[],p="amm",y=new B(n,e),f=new B(r,0),b=f,h=null,L=null,P=new ne(ae),T=[];if(m.includes("amm"))for(let{poolKeys:_,poolInfo:I}of c)try{let{amountOut:F,minAmountOut:N,currentPrice:v,executionPrice:z,priceImpact:V,fee:J}=this.scope.liquidity.computeAmountOut({poolKeys:_,poolInfo:I,amountIn:y,outputToken:r,slippage:i});F.gt(f)&&(console.log("amm",I),d=[{source:"amm",keys:_}],p="amm",f=F,b=N,h=v,L=z,P=V,T=[J])}catch{}if(m.includes("route")){let _=Lr(c);for(let I of _){if(I.length!==2)continue;let[F,N]=I,{poolKeys:v,poolInfo:z}=F,{poolKeys:V,poolInfo:J}=N;try{let{amountOut:te,minAmountOut:Z,executionPrice:ie,priceImpact:ce,fee:Me}=this.scope.route.computeRouteAmountOut({fromPoolKeys:v,toPoolKeys:V,fromPoolInfo:z,toPoolInfo:J,amountIn:y,outputToken:r,slippage:i});te.gt(f)&&(d=[{source:"amm",keys:v},{source:"amm",keys:V}],p="route",f=te,b=Z,L=ie,P=ce,T=Me)}catch{}}}return{routes:d,routeType:p,amountOut:f,minAmountOut:b,fixedSide:"in",currentPrice:h,executionPrice:L,priceImpact:P,fee:T}}async directSwap(t){this.checkDisabled();let{amountOut:e,amountIn:n,slippage:r,config:i}=t,a=n.token,u=e.token,{routes:c,routeType:m,minAmountOut:d}=await this.getBestAmountOut({inputToken:a,outputToken:u,amountIn:n.raw,slippage:r});return await this.swap({routes:c,routeType:m,amountIn:n,amountOut:d,fixedSide:"in",config:i})}async swap(t){this.checkDisabled(),this.scope.checkOwner();let{routes:e,routeType:n,amountIn:r,amountOut:i,fixedSide:a,config:u}=t;if(n==="amm"&&e.length===1)return await this.scope.liquidity.swapWithAMM({poolKeys:e[0].keys,amountIn:r,amountOut:i,fixedSide:a,config:u});if(n==="route"&&e.length===2)return await this.scope.route.swapWithRoute({fromPoolKeys:e[0].keys,toPoolKeys:e[1].keys,amountIn:r,amountOut:i,fixedSide:a,config:u});throw this.logAndCreateError("invalid routes with routeType","routes",{routeType:n,routes:e}),new Error("invalid routes with routeType")}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let t=this.scope.account.tokenAccounts.filter(e=>e.mint.equals(Le));return t.sort((e,n)=>e.isAssociated?1:n.isAssociated||e.amount.lt(n.amount)?-1:1),t}async unWrapWSol(t){let e=await this.getWSolAccounts(),n=this.createTxBuilder(),r=await _e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});n.addInstruction(r);let i=x(t);for(let a=0;a<e.length;a++)i.gte(e[a].amount)?(n.addInstruction({instructions:[Ne({tokenAccount:e[a].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),i.sub(e[a].amount)):(n.addInstruction({instructions:[Ne({tokenAccount:e[a].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),Je({destination:r.signers[0].publicKey,source:e[a].publicKey,amount:i,owner:this.scope.ownerPubKey}));return n.build()}async wrapWSol(t){let e=await this.getWSolAccounts(),n=this.createTxBuilder(),r=await _e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:t,skipCloseAccount:!0});return n.addInstruction(r),e.length&&n.addInstruction({instructions:[Je({destination:e[0].publicKey,source:r.signers[0].publicKey,amount:t,owner:this.scope.ownerPubKey})],endInstructions:[Ne({tokenAccount:r.signers[0].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),n.build()}};var Ee={},Vt=class{constructor(t){this.rawBalances=new Map;let{connection:e,cluster:n,owner:r,api:i,defaultApiTokens:a,defaultApiLiquidityPools:u,defaultApiFarmPools:c,defaultApiPairsInfo:m,apiCacheTime:d}=t;this._connection=e,this.cluster=n,this._owner=r?new de(r):void 0,this._signAllTransactions=t.signAllTransactions,this.api=i,this._apiCacheTime=d||5*60*1e3,this.logger=M("Raydium"),this.farm=new Mt({scope:this,moduleName:"Raydium_Farm"}),this.account=new St({scope:this,moduleName:"Raydium_Account",tokenAccounts:t.tokenAccounts,tokenAccountRawInfos:t.tokenAccountRawInfos}),this.liquidity=new Kt({scope:this,moduleName:"Raydium_Liquidity"}),this.token=new Dt({scope:this,moduleName:"Raydium_token"}),this.trade=new Et({scope:this,moduleName:"Raydium_trade"}),this.route=new vt({scope:this,moduleName:"Raydium_route"});let p=new Date().getTime(),[y,f,b,h]=[a?{fetched:p,data:a}:Ee.tokens,u?{fetched:p,data:u}:Ee.liquidityPools,c?{fetched:p,data:c}:Ee.farmPools,m?{fetched:p,data:m}:Ee.liquidityPairsInfo];this.apiData=S(S(S(S({},y?{tokens:y}:{}),f?{liquidityPools:f}:{}),b?{farmPools:b}:{}),h?{liquidityPairsInfo:h}:{})}static async load(t){let e=(0,ua.merge)({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4},t),{cluster:n,apiRequestTimeout:r}=e,i=new It({cluster:n,timeout:r}),a=new Vt(O(S({},e),{api:i}));return await a.token.load(),await a.liquidity.load(),a}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw new Error(oo);return this._owner.publicKey}setOwner(t){return this._owner=t?new de(t):void 0,this}get connection(){if(!this._connection)throw new Error(li);return this._connection}setConnection(t){return this._connection=t,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(t){return this._signAllTransactions=t,this}checkOwner(){if(!this.owner)throw this.logger.error(oo),new Error(oo)}isCacheInvalidate(t){return new Date().getTime()-t>this._apiCacheTime}async fetchTokens(t){if(this.apiData.tokens&&!this.isCacheInvalidate(this.apiData.tokens.fetched)&&!t)return this.apiData.tokens.data;let e={fetched:Date.now(),data:await this.api.getTokens()};return this.apiData.tokens=e,Ee.tokens=e,e.data}async fetchLiquidity(t){if(this.apiData.liquidityPools&&!this.isCacheInvalidate(this.apiData.liquidityPools.fetched)&&!t)return this.apiData.liquidityPools.data;let e={fetched:Date.now(),data:await this.api.getLiquidityPools()};return this.apiData.liquidityPools=e,Ee.liquidityPools=e,e.data}async fetchPairs(t){var n;if(this.apiData.liquidityPairsInfo&&!this.isCacheInvalidate(this.apiData.liquidityPairsInfo.fetched)&&!t)return((n=this.apiData.liquidityPairsInfo)==null?void 0:n.data)||[];let e={fetched:Date.now(),data:await this.api.getPairsInfo()};return this.apiData.liquidityPairsInfo=e,Ee.liquidityPairsInfo=e,e.data}async fetchFarms(t){if(this.apiData.farmPools&&!this.isCacheInvalidate(this.apiData.farmPools.fetched)&&!t)return this.apiData.farmPools.data;let e={fetched:Date.now(),data:await this.api.getFarmPools()};return this.apiData.farmPools=e,Ee.farmPools=e,e.data}async chainTimeOffset(){let t=await this.connection.getBlockTime(await this.connection.getSlot());return t?(t*1e3,Number((t*1e3-Date.now()).toFixed(0))):0}mintToToken(t){return this.token.mintToToken(t)}mintToTokenAmount(t){return this.token.mintToTokenAmount(t)}decimalAmount(t){return this.token.decimalAmount(t)}uiAmount(t){return this.token.uiAmount(t)}};var au=o=>o;0&&(module.exports={ANAMint,Api,BNLayout,BN_100,BN_1000,BN_10000,BN_FIVE,BN_ONE,BN_TEN,BN_THREE,BN_TWO,BN_ZERO,BitStructure,Blob,Currency,DataElement,ETHMint,FARM_LOCK_MINT,FARM_LOCK_VAULT,FARM_PROGRAMID_TO_VERSION,FARM_PROGRAM_ID_V3,FARM_PROGRAM_ID_V3_PUBKEY,FARM_PROGRAM_ID_V5,FARM_PROGRAM_ID_V5_PUBKEY,FARM_PROGRAM_ID_V6,FARM_PROGRAM_ID_V6_PUBKEY,FARM_VERSION_TO_LEDGER_LAYOUT,FARM_VERSION_TO_PROGRAMID,FARM_VERSION_TO_STATE_LAYOUT,Fraction,LIQUIDITY_FEES_DENOMINATOR,LIQUIDITY_FEES_NUMERATOR,LIQUIDITY_PROGRAMID_TO_VERSION,LIQUIDITY_PROGRAM_ID_V4,LIQUIDITY_PROGRAM_ID_V5,LIQUIDITY_VERSION_TO_PROGRAM_ID,LIQUIDITY_VERSION_TO_SERUM_VERSION,LIQUIDITY_VERSION_TO_STATE_LAYOUT,Layout,LiquidityPoolStatus,MODEL_DATA_PUBKEY,NRVMint,OptionLayout,Owner,PAIMint,Percent,Price,RAYMint,ROUTE_PROGRAM_ID_V1,Raydium,Rounding,SERUM_PROGRAMID_TO_VERSION,SERUM_PROGRAM_ID_V3,SERUM_VERSION_TO_PROGRAM_ID,SOLMint,SPL_MINT_LAYOUT,SRMMint,StableLayout,Structure,TOKEN_SOL,TOKEN_WSOL,Token,TokenAmount,TxBuilder,UInt,USDCMint,USDHMint,USDTMint,Union,WSOLMint,WideBits,WrappedLayout,_100_PERCENT,_LIQUIDITY_PROGRAM_ID_V4,_LIQUIDITY_PROGRAM_ID_V5,_ROUTE_PROGRAM_ID_V1,_SERUM_PROGRAM_ID_V3,accountMeta,addLiquidityLayout,array,associatedLedgerAccountLayout,bits,blob,bool,calFarmRewardAmount,calculateFarmPoolAprList,chunkArray,closeAccountInstruction,commonSystemAccountMeta,createAssociatedLedgerAccountInstruction,createLogger,createPoolV4Layout,createWSolAccountInstructions,cstr,currencyEquals,decodeBool,defaultRoutes,div,divCeil,dwLayout,encodeBool,endlessRetry,eq,f32,f32be,f64,f64be,farmAddRewardLayout,farmDespotVersionToInstruction,farmLedgerLayoutV3_1,farmLedgerLayoutV3_2,farmLedgerLayoutV5_1,farmLedgerLayoutV5_2,farmLedgerLayoutV6_1,farmRewardInfoToConfig,farmRewardLayout,farmRewardRestartLayout,farmRewardTimeInfoLayout,farmStateV3Layout,farmStateV5Layout,farmStateV6Layout,farmWithdrawVersionToInstruction,fetchMultipleFarmInfoAndUpdate,findProgramAddress,fixedSwapInLayout,fixedSwapOutLayout,forecastTransactionSize,formatLayout,getAmountSide,getAmountsSide,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getAssociatedMiddleStatusAccount,getAssociatedPoolKeys,getDate,getDxByDyBaseIn,getDyByDxBaseIn,getFarmLedgerLayout,getFarmProgramId,getFarmStateLayout,getFarmVersion,getLiquidityAssociatedAuthority,getLiquidityAssociatedId,getLiquidityInfo,getLiquidityProgramId,getLiquidityStateLayout,getMax,getMultipleAccountsInfo,getMultipleAccountsInfoWithCustomFlags,getPoolEnabledFeatures,getRecentBlockHash,getSPLTokenInfo,getSerumAssociatedAuthority,getSerumProgramId,getSerumVersion,getStablePrice,getTime,getTimestamp,getTokenSide,getTokensSide,greedy,groupPools,gt,gte,i128,i64,includesToken,initPoolLayout,initTokenAccountInstruction,intersection,isDateAfter,isDateBefore,isMeaningfulNumber,isNumber,isValidFarmVersion,isValidFixedSide,jsonInfo2PoolKeys,judgeFarmType,liquidityStateV4Layout,liquidityStateV5Layout,lt,lte,mSOLMint,makeAMMSwapInstruction,makeAddLiquidityInstruction,makeCreateFarmInstruction,makeCreatePoolInstruction,makeInitPoolInstruction,makeRemoveLiquidityInstruction,makeRouteSwapInstruction,makeSimulatePoolInfoInstruction,makeSimulationPoolInfo,makeSwapFixedInInstruction,makeSwapFixedOutInstruction,makeSwapInFixedInInstruction,makeSwapOutFixedInInstruction,makeTransferInstruction,mergeSdkFarmInfo,modelDataInfoLayout,mul,ns64,ns64be,nu64,nu64be,offset,offsetDateTime,option,parseBigNumberish,parseNumberInfo,parseSimulateLogToJson,parseSimulateValue,parseTokenAccountResp,poolTypeV6,publicKey,quantumSOLHydratedTokenJsonInfo,realFarmStateV3Layout,realFarmStateV5Layout,realFarmV6Layout,removeLiquidityLayout,routeSwapInLayout,routeSwapOutLayout,rustEnum,s16,s16be,s24,s24be,s32,s32be,s40,s40be,s48,s48be,s8,seq,setLoggerLevel,shakeFractionDecimal,simulateMultipleInstruction,sleep,sortTokens,splAccountLayout,splitNumber,stSOLMint,str,struct,sub,swapRouteMiddleMints,tagged,tenExponential,toBN,toFraction,toFractionWithDecimals,toPercent,toTokenPrice,toTotalPrice,toUsdCurrency,tryParsePublicKey,u128,u16,u16be,u24,u24be,u32,u32be,u40,u40be,u48,u48be,u64,u8,union,unionArr,unionLayoutDiscriminator,uniq,updateFarmPoolInfo,utf8,validateAndParsePublicKey,validateFarmRewards,vec,vecU8,whetherIsStakeFarmPool,withdrawRewardLayout,xor,zeros});
//# sourceMappingURL=index.js.map