import h from"bn.js";import ft from"big.js";import J from"bn.js";import{get as Le,set as it}from"lodash";import Ne from"dayjs";import st from"dayjs/plugin/utc";Ne.extend(st);var re=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Ne().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},ke={},ut={};function b(n){let t=Le(ke,n);if(!t){let e=Le(ut,n);t=new re({name:n,logLevel:e}),it(ke,n,t)}return t}import at from"toformat";var ct=at,W=ct;import j from"big.js";import mt from"decimal.js-light";var F=b("module/fraction"),oe=W(j),_=W(mt),lt={[0]:_.ROUND_DOWN,[1]:_.ROUND_HALF_UP,[2]:_.ROUND_UP},pt={[0]:j.roundDown,[1]:j.roundHalfUp,[2]:j.roundUp},s=class{constructor(t,e=Ae){this.numerator=f(t),this.denominator=f(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(t){let e=t instanceof s?t:new s(f(t));return this.denominator.eq(e.denominator)?new s(this.numerator.add(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof s?t:new s(f(t));return this.denominator.eq(e.denominator)?new s(this.numerator.sub(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof s?t:new s(f(t));return new s(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof s?t:new s(f(t));return new s(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||F.logWithError(`${t} is not an integer.`),t<=0&&F.logWithError(`${t} is not positive.`),_.set({precision:t+1,rounding:lt[r]});let o=new _(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||F.logWithError(`${t} is not an integer.`),t<0&&F.logWithError(`${t} is negative.`),oe.DP=t,oe.RM=pt[r]||1,new oe(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var gt=b("Raydium_amount"),De=W(ft);function yt(n,t){let e="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([e,r]=o,r=r.padEnd(t,"0")):gt.logWithError(`invalid number string, num: ${n}`)}else e=n;return[e,r.slice(0,t)||r]}var x=class extends s{constructor(e,r,o=!0,u){let i=new J(0),c=ie.pow(new J(e.decimals));if(o)i=f(r);else{let a=new J(0),p=new J(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[P,d]=yt(r.toString(),e.decimals);a=f(P),p=f(d)}a=a.mul(c),i=a.add(p)}super(i,c);this.logger=b(u||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new x(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new x(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,o=0){return super.toSignificant(e,r,o)}toFixed(e=this.token.decimals,r,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,o)}toExact(e={groupSeparator:""}){return De.DP=this.token.decimals,new De(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as bt}from"@solana/web3.js";var Ie={symbol:"SOL",name:"Solana",decimals:9},T={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},bn={isQuantumSOL:!0,isLp:!1,official:!0,mint:new bt(T.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as ue}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ht}from"@solana/spl-token";import{PublicKey as y,SystemProgram as Pt,SYSVAR_RENT_PUBKEY as xt}from"@solana/web3.js";function se({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var Tn=[se({pubkey:ht,isWritable:!1}),se({pubkey:Pt.programId,isWritable:!1}),se({pubkey:xt,isWritable:!1})];function K({publicKey:n,transformSol:t}){if(n instanceof y)return t&&n.equals(R)?D:n;if(t&&n===R.toBase58())return D;if(typeof n=="string")try{return new y(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function We(n){try{return new y(n)}catch{return n}}var _e=new y("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Re=new y("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Sn=new y("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ke=new y("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Oe=new y("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ee=new y("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Me=new y("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ue=new y("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Bn=new y("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ln=new y("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ce=new y("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),D=new y("So11111111111111111111111111111111111111112"),R=y.default;var ae=class{constructor({mint:t,decimals:e,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:u=!1}){if(t===R.toBase58()||t instanceof ue&&R.equals(t)){this.decimals=T.decimals,this.symbol=T.symbol,this.name=T.name,this.mint=new ue(T.mint);return}this.decimals=e,this.symbol=r,this.name=o,this.mint=u?ue.default:K({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},A=ae;A.WSOL=new ae(T);var me=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},ce=me;ce.SOL=new me(Ie);var qe=new s(ve),S=class extends s{toSignificant(t=5,e,r){return this.mul(qe).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(qe).toFixed(t,e,r)}};var wt=b("Raydium_price"),w=class extends s{constructor(e){let{baseToken:r,quoteToken:o,numerator:u,denominator:i}=e;super(u,i);this.baseToken=r,this.quoteToken=o,this.scalar=new s(le(r.decimals),le(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new w({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&wt.logWithError("mul token not equals");let r=super.mul(e);return new w({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(e,r,o)}toFixed(e=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(e,r,o)}};var G=b("Raydium_bignumber");var O=new h(0),Ae=new h(1),nr=new h(2),rr=new h(3),or=new h(5),ie=new h(10),ve=new h(100),ir=new h(1e3),sr=new h(1e4),Fe=9007199254740991;function f(n){if(n instanceof h)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new h(n);G.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&G.logWithError(`BigNumberish number underflow: ${n}`),(n>=Fe||n<=-Fe)&&G.logWithError(`BigNumberish number overflow: ${n}`),new h(String(n))):typeof n=="bigint"?new h(n.toString()):(G.logWithError(`invalid BigNumberish value: ${n}`),new h(0))}function le(n){return ie.pow(f(n))}function Je(n){var c;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof h)return{numerator:n.toString(),denominator:"1"};if(n instanceof s)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let t=String(n),[,e="",r="",o=""]=(c=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?c:[],u="1"+"0".repeat(o.length),i=e+(r==="0"?"":r)+o||"0";return{denominator:u,numerator:i,sign:e,int:r,dec:o}}function I(n){if(n instanceof S)return new s(n.numerator,n.denominator);if(n instanceof w)return n.adjusted;if(n instanceof x)try{return I(n.toExact())}catch{return new s(O)}if(n instanceof s)return n;let t=String(n),e=Je(t);return new s(e.numerator,e.denominator)}function Ge(n,t){if(n==null||t==null)return!1;let e=I(n),r=I(t);return e.sub(r).numerator.gte(O)}function pe(n,t){if(n==null||t==null)return;let e=I(n),r=I(t);try{return e.div(r)}catch{return e}}import{PublicKey as St}from"@solana/web3.js";import Bt from"bn.js";var Lt=[A,x,St,s,Bt,w,S];function kt(n){return typeof n=="object"&&n!==null&&!Lt.some(t=>typeof t=="object"&&n instanceof t)}function H(n){return typeof n=="string"?We(n):Array.isArray(n)?n.map(t=>H(t)):kt(n)?Object.fromEntries(Object.entries(n).map(([t,e])=>[t,H(e)])):n}import{PACKET_DATA_SIZE as Pr,PublicKey as xr,sendAndConfirmTransaction as He,Transaction as Nt}from"@solana/web3.js";var kr=b("Raydium_txTool"),Y=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this}build(t){let e=new Nt;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var o;let r=await Ye(this.connection);if(e.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return He(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let u=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:o}=this.build(r),u=e.filter(a=>a.transaction.instructions.length>0),i=[...u.map(a=>a.transaction),o],c=[...u.map(a=>a.signers),this.signers];return{transactions:i,signers:c,execute:async()=>{var p;let a=await Ye(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return await Promise.all(i.map(async(P,d)=>(P.recentBlockhash=a,await He(this.connection,P,c[d]))));if(this.signAllTransactions){let P=i.map((g,B)=>(g.recentBlockhash=a,c[B].length&&g.partialSign(...c[B]),g)),d=await this.signAllTransactions(P),k=[];for(let g=0;g<d.length;g+=1){let B=await this.connection.sendRawTransaction(d[g].serialize(),{skipPreflight:!0});k.push(B)}return k}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function Ye(n){var t,e;try{return((e=await((t=n.getLatestBlockhash)==null?void 0:t.call(n)))==null?void 0:e.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var de=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),E=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=b(e)}createTxBuilder(t){return this.scope.checkOwner(),new Y({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(de(t))}logInfo(...t){this.logger.info(de(t))}logAndCreateError(...t){let e=de(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as At}from"@solana/web3.js";var Dt="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",Kr=new At(Dt),$e=["amm","serum","route"],Ve=[Ke,_e,D,Ee,Re,Me,Ue,Oe,Ce].map(n=>n.toBase58());function ze(n){let t=[];for(let e=0;e<n.length;e++)for(let r=0;r<n.length;r++)e!=r&&t.push([n[e],n[r]]);return t}import{createInitializeAccountInstruction as Ot,createCloseAccountInstruction as Et,createTransferInstruction as Mt,TOKEN_PROGRAM_ID as Ut}from"@solana/spl-token";import{Keypair as Ct,PublicKey as qt,SystemProgram as vt}from"@solana/web3.js";import Ft from"bn.js";import{PublicKey as Jr}from"@solana/web3.js";var Yr=b("Raydium_accountInfo_util");import{PublicKey as Kt}from"@solana/web3.js";import Ze,{isBN as ai}from"bn.js";import{bits as ao,BitStructure as co,blob as It,Blob as mo,cstr as lo,f32 as po,f32be as fo,f64 as go,f64be as yo,greedy as bo,Layout as Wt,ns64 as ho,ns64be as Po,nu64 as xo,nu64be as wo,offset as To,s16 as So,s16be as Bo,s24 as Lo,s24be as ko,s32 as No,s32be as Ao,s40 as Do,s40be as Io,s48 as Wo,s48be as _o,s8 as Ro,seq as Ko,struct as Oo,Structure as _t,u16 as Eo,u16be as Mo,u24 as Uo,u24be as Co,u32 as qo,u32be as vo,u40 as Fo,u40be as jo,u48 as Jo,u48be as Go,u8 as Ho,UInt as Rt,union as Yo,Union as $o,unionLayoutDiscriminator as Vo,utf8 as zo}from"@solana/buffer-layout";var fe=Wt,Xe=_t;var ge=Rt;var ye=It;var be=class extends fe{constructor(e,r,o){super(e,o);this.blob=ye(e),this.signed=r}decode(e,r=0){let o=new Ze(this.blob.decode(e,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,r,o=0){return typeof e=="number"&&(e=new Ze(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,o)}};function Qe(n){return new ge(1,n)}function $(n){return new ge(4,n)}function V(n){return new be(8,!1,n)}var he=class extends fe{constructor(e,r,o,u){super(e.span,u);this.layout=e,this.decoder=r,this.encoder=o}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,o){return this.layout.encode(this.encoder(e),r,o)}getSpan(e,r){return this.layout.getSpan(e,r)}};function M(n){return new he(ye(32),t=>new Kt(t),t=>t.toBuffer(),n)}var Pe=class extends Xe{decode(t,e){return super.decode(t,e)}};function et(n,t,e){return new Pe(n,t,e)}var xe=et([M("mint"),M("owner"),V("amount"),$("delegateOption"),M("delegate"),Qe("state"),$("isNativeOption"),V("isNative"),V("delegatedAmount"),$("closeAuthorityOption"),M("closeAuthority")]);function jt(n){let{mint:t,tokenAccount:e,owner:r}=n;return Ot(e,t,r)}function U(n){let{tokenAccount:t,payer:e,multiSigners:r=[],owner:o}=n;return Et(t,e,o,r)}async function we(n){let{connection:t,amount:e,commitment:r,payer:o,owner:u,skipCloseAccount:i}=n,c=await t.getMinimumBalanceForRentExemption(xe.span,r),a=f(e).add(new Ft(c)),p=Ct.generate();return{signers:[p],instructions:[vt.createAccount({fromPubkey:o,newAccountPubkey:p.publicKey,lamports:a.toNumber(),space:xe.span,programId:Ut}),jt({mint:new qt(T.mint),tokenAccount:p.publicKey,owner:u})],endInstructions:i?[]:[U({tokenAccount:p.publicKey,payer:o,owner:u})]}}function Te({source:n,destination:t,owner:e,amount:r,multiSigners:o=[]}){return Mt(n,t,e,f(r).toNumber(),o)}var Se=class extends E{async load(){this.checkDisabled(),await this.scope.fetchLiquidity()}async _getBestSwapPool({availablePools:t,officialPoolIdSet:e}){if(t.length===0)return;if(t.length===1)return t[0];let r=t.filter(i=>e.has(i.id));return r.length===1?r[0]:(await this.scope.liquidity.sdkParseJsonLiquidityInfo(r.length?r:t)).reduce((i,c)=>{let a=i.version===5,p=c.version===5;return a&&!p?i:!a&&p?c:Ge(pe(i.lpSupply,10**i.lpDecimals),pe(c.lpSupply,10**c.lpDecimals))?i:c}).jsonInfo}async getAvailablePools(t){this.checkDisabled();let{inputMint:e,outputMint:r}=t,[o,u]=[K({publicKey:e,transformSol:!0}).toBase58(),K({publicKey:r,transformSol:!0}).toBase58()],i=this.scope.liquidity.allPools.filter(d=>d.baseMint===o&&d.quoteMint===u||d.baseMint===u&&d.quoteMint===o),c=new Set([...Ve,o,u]),a=new Set(JSON.parse(JSON.stringify([...c])));a.delete(o),a.delete(u);let p=this.scope.liquidity.allPools.filter(d=>{let k=c.has(d.baseMint)&&c.has(d.quoteMint),g=a.has(d.baseMint)&&a.has(d.quoteMint);return k&&!g}),P=await this._getBestSwapPool({availablePools:i,officialPoolIdSet:this.scope.liquidity.allPoolIdSet.official});return{availablePools:i,best:P,routedPools:p}}async getBestAmountOut({pools:t,amountIn:e,inputToken:r,outputToken:o,slippage:u,features:i}){if(this.checkDisabled(),!t){let{routedPools:L}=await this.getAvailablePools({inputMint:r.mint,outputMint:o.mint});t=L}let c=await this.scope.liquidity.sdkParseJsonLiquidityInfo(t||[]),a=(t||[]).map((L,N)=>({poolKeys:H(L),poolInfo:c[N]})),p=i||$e;this.logDebug("features:",p),a.length||this.logAndCreateError("please provide at least one source of trade or (inputMint & outputMint)",a);let P=[],d="amm",k=new x(r,e),g=new x(o,0),B=g,Be=null,z=null,X=new S(O),Z=[];if(p.includes("amm"))for(let{poolKeys:L,poolInfo:N}of a)try{let{amountOut:C,minAmountOut:Q,currentPrice:q,executionPrice:ee,priceImpact:v,fee:te}=this.scope.liquidity.computeAmountOut({poolKeys:L,poolInfo:N,amountIn:k,outputToken:o,slippage:u});C.gt(g)&&(console.log("amm",N),P=[{source:"amm",keys:L}],d="amm",g=C,B=Q,Be=q,z=ee,X=v,Z=[te])}catch{}if(p.includes("route")){let L=ze(a);for(let N of L){if(N.length!==2)continue;let[C,Q]=N,{poolKeys:q,poolInfo:ee}=C,{poolKeys:v,poolInfo:te}=Q;try{let{amountOut:ne,minAmountOut:tt,executionPrice:nt,priceImpact:rt,fee:ot}=this.scope.route.computeRouteAmountOut({fromPoolKeys:q,toPoolKeys:v,fromPoolInfo:ee,toPoolInfo:te,amountIn:k,outputToken:o,slippage:u});ne.gt(g)&&(P=[{source:"amm",keys:q},{source:"amm",keys:v}],d="route",g=ne,B=tt,z=nt,X=rt,Z=ot)}catch{}}}return{routes:P,routeType:d,amountOut:g,minAmountOut:B,fixedSide:"in",currentPrice:Be,executionPrice:z,priceImpact:X,fee:Z}}async directSwap(t){this.checkDisabled();let{amountOut:e,amountIn:r,slippage:o,config:u}=t,i=r.token,c=e.token,{routes:a,routeType:p,minAmountOut:P}=await this.getBestAmountOut({inputToken:i,outputToken:c,amountIn:r.raw,slippage:o});return await this.swap({routes:a,routeType:p,amountIn:r,amountOut:P,fixedSide:"in",config:u})}async swap(t){this.checkDisabled(),this.scope.checkOwner();let{routes:e,routeType:r,amountIn:o,amountOut:u,fixedSide:i,config:c}=t;if(r==="amm"&&e.length===1)return await this.scope.liquidity.swapWithAMM({poolKeys:e[0].keys,amountIn:o,amountOut:u,fixedSide:i,config:c});if(r==="route"&&e.length===2)return await this.scope.route.swapWithRoute({fromPoolKeys:e[0].keys,toPoolKeys:e[1].keys,amountIn:o,amountOut:u,fixedSide:i,config:c});throw this.logAndCreateError("invalid routes with routeType","routes",{routeType:r,routes:e}),new Error("invalid routes with routeType")}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let t=this.scope.account.tokenAccounts.filter(e=>e.mint.equals(D));return t.sort((e,r)=>e.isAssociated?1:r.isAssociated||e.amount.lt(r.amount)?-1:1),t}async unWrapWSol(t){let e=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await we({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});r.addInstruction(o);let u=f(t);for(let i=0;i<e.length;i++)u.gte(e[i].amount)?(r.addInstruction({instructions:[U({tokenAccount:e[i].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),u.sub(e[i].amount)):(r.addInstruction({instructions:[U({tokenAccount:e[i].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),Te({destination:o.signers[0].publicKey,source:e[i].publicKey,amount:u,owner:this.scope.ownerPubKey}));return r.build()}async wrapWSol(t){let e=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await we({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:t,skipCloseAccount:!0});return r.addInstruction(o),e.length&&r.addInstruction({instructions:[Te({destination:e[0].publicKey,source:o.signers[0].publicKey,amount:t,owner:this.scope.ownerPubKey})],endInstructions:[U({tokenAccount:o.signers[0].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),r.build()}};export{Se as default};
//# sourceMappingURL=trade.mjs.map