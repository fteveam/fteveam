import h from"bn.js";import gt from"big.js";import J from"bn.js";import{get as Be,set as rt}from"lodash";import ot from"pino";import it from"pino-pretty";var ke={},st={},at=it({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),ut=ot({base:null,level:"silent"},at);function b(n){let t=Be(ke,n);if(!t){let e=Be(st,n);t=ut.child({name:n},{level:e}),rt(ke,n,t)}return t.logWithError=(...e)=>{let r=e.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(r)},t}import ct from"toformat";var mt=ct,W=mt;import j from"big.js";import lt from"decimal.js-light";var v=b("module/fraction"),re=W(j),_=W(lt),pt={[0]:_.ROUND_DOWN,[1]:_.ROUND_HALF_UP,[2]:_.ROUND_UP},dt={[0]:j.roundDown,[1]:j.roundHalfUp,[2]:j.roundUp},s=class{constructor(t,e=Ne){this.numerator=f(t),this.denominator=f(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(t){let e=t instanceof s?t:new s(f(t));return this.denominator.eq(e.denominator)?new s(this.numerator.add(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof s?t:new s(f(t));return this.denominator.eq(e.denominator)?new s(this.numerator.sub(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof s?t:new s(f(t));return new s(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof s?t:new s(f(t));return new s(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||v.logWithError(`${t} is not an integer.`),t<=0&&v.logWithError(`${t} is not positive.`),_.set({precision:t+1,rounding:pt[r]});let o=new _(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||v.logWithError(`${t} is not an integer.`),t<0&&v.logWithError(`${t} is negative.`),re.DP=t,re.RM=dt[r]||1,new re(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var yt=b("Raydium_amount"),Le=W(gt);function bt(n,t){let e="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([e,r]=o,r=r.padEnd(t,"0")):yt.logWithError(`invalid number string, num: ${n}`)}else e=n;return[e,r.slice(0,t)||r]}var x=class extends s{constructor(e,r,o=!0,a){let i=new J(0),c=oe.pow(new J(e.decimals));if(o)i=f(r);else{let u=new J(0),p=new J(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[P,d]=bt(r.toString(),e.decimals);u=f(P),p=f(d)}u=u.mul(c),i=u.add(p)}super(i,c);this.logger=b(a||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new x(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new x(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,o=0){return super.toSignificant(e,r,o)}toFixed(e=this.token.decimals,r,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,o)}toExact(e={groupSeparator:""}){return Le.DP=this.token.decimals,new Le(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as ht}from"@solana/web3.js";var Ae={symbol:"SOL",name:"Solana",decimals:9},T={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},xn={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ht(T.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as se}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Pt}from"@solana/spl-token";import{PublicKey as y,SystemProgram as xt,SYSVAR_RENT_PUBKEY as wt}from"@solana/web3.js";function ie({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var kn=[ie({pubkey:Pt,isWritable:!1}),ie({pubkey:xt.programId,isWritable:!1}),ie({pubkey:wt,isWritable:!1})];function K({publicKey:n,transformSol:t}){if(n instanceof y)return t&&n.equals(R)?D:n;if(t&&n===R.toBase58())return D;if(typeof n=="string")try{return new y(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function De(n){try{return new y(n)}catch{return n}}var Ie=new y("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),We=new y("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Nn=new y("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),_e=new y("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Re=new y("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ke=new y("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Oe=new y("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Me=new y("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ln=new y("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),An=new y("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ee=new y("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),D=new y("So11111111111111111111111111111111111111112"),R=y.default;var ae=class{constructor({mint:t,decimals:e,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(t===R.toBase58()||t instanceof se&&R.equals(t)){this.decimals=T.decimals,this.symbol=T.symbol,this.name=T.name,this.mint=new se(T.mint);return}this.decimals=e,this.symbol=r,this.name=o,this.mint=a?se.default:K({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},A=ae;A.WSOL=new ae(T);var ce=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},ue=ce;ue.SOL=new ce(Ae);var Ue=new s(Ce),S=class extends s{toSignificant(t=5,e,r){return this.mul(Ue).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(Ue).toFixed(t,e,r)}};var Tt=b("Raydium_price"),w=class extends s{constructor(e){let{baseToken:r,quoteToken:o,numerator:a,denominator:i}=e;super(a,i);this.baseToken=r,this.quoteToken=o,this.scalar=new s(me(r.decimals),me(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new w({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Tt.logWithError("mul token not equals");let r=super.mul(e);return new w({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(e,r,o)}toFixed(e=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(e,r,o)}};var G=b("Raydium_bignumber");var O=new h(0),Ne=new h(1),ir=new h(2),sr=new h(3),ar=new h(5),oe=new h(10),Ce=new h(100),ur=new h(1e3),cr=new h(1e4),qe=9007199254740991;function f(n){if(n instanceof h)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new h(n);G.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&G.logWithError(`BigNumberish number underflow: ${n}`),(n>=qe||n<=-qe)&&G.logWithError(`BigNumberish number overflow: ${n}`),new h(String(n))):typeof n=="bigint"?new h(n.toString()):(G.logWithError(`invalid BigNumberish value: ${n}`),new h(0))}function me(n){return oe.pow(f(n))}function ve(n){var c;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof h)return{numerator:n.toString(),denominator:"1"};if(n instanceof s)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let t=String(n),[,e="",r="",o=""]=(c=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?c:[],a="1"+"0".repeat(o.length),i=e+(r==="0"?"":r)+o||"0";return{denominator:a,numerator:i,sign:e,int:r,dec:o}}function I(n){if(n instanceof S)return new s(n.numerator,n.denominator);if(n instanceof w)return n.adjusted;if(n instanceof x)try{return I(n.toExact())}catch{return new s(O)}if(n instanceof s)return n;let t=String(n),e=ve(t);return new s(e.numerator,e.denominator)}function je(n,t){if(n==null||t==null)return!1;let e=I(n),r=I(t);return e.sub(r).numerator.gte(O)}function le(n,t){if(n==null||t==null)return;let e=I(n),r=I(t);try{return e.div(r)}catch{return e}}import{PublicKey as Bt}from"@solana/web3.js";import kt from"bn.js";var Nt=[A,x,Bt,s,kt,w,S];function Lt(n){return typeof n=="object"&&n!==null&&!Nt.some(t=>typeof t=="object"&&n instanceof t)}function H(n){return typeof n=="string"?De(n):Array.isArray(n)?n.map(t=>H(t)):Lt(n)?Object.fromEntries(Object.entries(n).map(([t,e])=>[t,H(e)])):n}import{PACKET_DATA_SIZE as Tr,PublicKey as Sr,sendAndConfirmTransaction as Je,Transaction as At}from"@solana/web3.js";var Dr=b("Raydium_txTool"),$=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this}build(t){let e=new At;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var o;let r=await Ge(this.connection);if(e.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return Je(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let a=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(a[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:o}=this.build(r),a=e.filter(u=>u.transaction.instructions.length>0),i=[...a.map(u=>u.transaction),o],c=[...a.map(u=>u.signers),this.signers];return{transactions:i,signers:c,execute:async()=>{var p;let u=await Ge(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return await Promise.all(i.map(async(P,d)=>(P.recentBlockhash=u,await Je(this.connection,P,c[d]))));if(this.signAllTransactions){let P=i.map((g,B)=>(g.recentBlockhash=u,c[B].length&&g.partialSign(...c[B]),g)),d=await this.signAllTransactions(P),N=[];for(let g=0;g<d.length;g+=1){let B=await this.connection.sendRawTransaction(d[g].serialize(),{skipPreflight:!0});N.push(B)}return N}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function Ge(n){var t,e;try{return((e=await((t=n.getLatestBlockhash)==null?void 0:t.call(n)))==null?void 0:e.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var pe=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),M=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=b(e)}createTxBuilder(t){return this.scope.checkOwner(),new $({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(pe(t))}logInfo(...t){this.logger.info(pe(t))}logAndCreateError(...t){let e=pe(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Dt}from"@solana/web3.js";var It="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",Mr=new Dt(It),He=["amm","serum","route"],$e=[_e,Ie,D,Ke,We,Oe,Me,Re,Ee].map(n=>n.toBase58());function Ve(n){let t=[];for(let e=0;e<n.length;e++)for(let r=0;r<n.length;r++)e!=r&&t.push([n[e],n[r]]);return t}import{createInitializeAccountInstruction as Mt,createCloseAccountInstruction as Et,createTransferInstruction as Ut,TOKEN_PROGRAM_ID as Ct}from"@solana/spl-token";import{Keypair as qt,PublicKey as Ft,SystemProgram as vt}from"@solana/web3.js";import jt from"bn.js";import{PublicKey as Hr}from"@solana/web3.js";var zr=b("Raydium_accountInfo_util");import{PublicKey as Ot}from"@solana/web3.js";import Ye,{isBN as mi}from"bn.js";import{bits as mo,BitStructure as lo,blob as Wt,Blob as po,cstr as fo,f32 as go,f32be as yo,f64 as bo,f64be as ho,greedy as Po,Layout as _t,ns64 as xo,ns64be as wo,nu64 as To,nu64be as So,offset as Bo,s16 as ko,s16be as No,s24 as Lo,s24be as Ao,s32 as Do,s32be as Io,s40 as Wo,s40be as _o,s48 as Ro,s48be as Ko,s8 as Oo,seq as Mo,struct as Eo,Structure as Rt,u16 as Uo,u16be as Co,u24 as qo,u24be as Fo,u32 as vo,u32be as jo,u40 as Jo,u40be as Go,u48 as Ho,u48be as $o,u8 as Vo,UInt as Kt,union as zo,Union as Yo,unionLayoutDiscriminator as Xo,utf8 as Zo}from"@solana/buffer-layout";var de=_t,ze=Rt;var fe=Kt;var ge=Wt;var ye=class extends de{constructor(e,r,o){super(e,o);this.blob=ge(e),this.signed=r}decode(e,r=0){let o=new Ye(this.blob.decode(e,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,r,o=0){return typeof e=="number"&&(e=new Ye(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,o)}};function Xe(n){return new fe(1,n)}function V(n){return new fe(4,n)}function z(n){return new ye(8,!1,n)}var be=class extends de{constructor(e,r,o,a){super(e.span,a);this.layout=e,this.decoder=r,this.encoder=o}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,o){return this.layout.encode(this.encoder(e),r,o)}getSpan(e,r){return this.layout.getSpan(e,r)}};function E(n){return new be(ge(32),t=>new Ot(t),t=>t.toBuffer(),n)}var he=class extends ze{decode(t,e){return super.decode(t,e)}};function Ze(n,t,e){return new he(n,t,e)}var Pe=Ze([E("mint"),E("owner"),z("amount"),V("delegateOption"),E("delegate"),Xe("state"),V("isNativeOption"),z("isNative"),z("delegatedAmount"),V("closeAuthorityOption"),E("closeAuthority")]);function Jt(n){let{mint:t,tokenAccount:e,owner:r}=n;return Mt(e,t,r)}function U(n){let{tokenAccount:t,payer:e,multiSigners:r=[],owner:o}=n;return Et(t,e,o,r)}async function xe(n){let{connection:t,amount:e,commitment:r,payer:o,owner:a,skipCloseAccount:i}=n,c=await t.getMinimumBalanceForRentExemption(Pe.span,r),u=f(e).add(new jt(c)),p=qt.generate();return{signers:[p],instructions:[vt.createAccount({fromPubkey:o,newAccountPubkey:p.publicKey,lamports:u.toNumber(),space:Pe.span,programId:Ct}),Jt({mint:new Ft(T.mint),tokenAccount:p.publicKey,owner:a})],endInstructions:i?[]:[U({tokenAccount:p.publicKey,payer:o,owner:a})]}}function we({source:n,destination:t,owner:e,amount:r,multiSigners:o=[]}){return Ut(n,t,e,f(r).toNumber(),o)}var Te=class extends M{async load(){this.checkDisabled(),await this.scope.fetchLiquidity()}async _getBestSwapPool({availablePools:t,officialPoolIdSet:e}){if(t.length===0)return;if(t.length===1)return t[0];let r=t.filter(i=>e.has(i.id));return r.length===1?r[0]:(await this.scope.liquidity.sdkParseJsonLiquidityInfo(r.length?r:t)).reduce((i,c)=>{let u=i.version===5,p=c.version===5;return u&&!p?i:!u&&p?c:je(le(i.lpSupply,10**i.lpDecimals),le(c.lpSupply,10**c.lpDecimals))?i:c}).jsonInfo}async getAvailablePools(t){this.checkDisabled();let{inputMint:e,outputMint:r}=t,[o,a]=[K({publicKey:e,transformSol:!0}).toBase58(),K({publicKey:r,transformSol:!0}).toBase58()],i=this.scope.liquidity.allPools.filter(d=>d.baseMint===o&&d.quoteMint===a||d.baseMint===a&&d.quoteMint===o),c=new Set([...$e,o,a]),u=new Set(JSON.parse(JSON.stringify([...c])));u.delete(o),u.delete(a);let p=this.scope.liquidity.allPools.filter(d=>{let N=c.has(d.baseMint)&&c.has(d.quoteMint),g=u.has(d.baseMint)&&u.has(d.quoteMint);return N&&!g}),P=await this._getBestSwapPool({availablePools:i,officialPoolIdSet:this.scope.liquidity.allPoolIdSet.official});return{availablePools:i,best:P,routedPools:p}}async getBestAmountOut({pools:t,amountIn:e,inputToken:r,outputToken:o,slippage:a,features:i}){if(this.checkDisabled(),!t){let{routedPools:k}=await this.getAvailablePools({inputMint:r.mint,outputMint:o.mint});t=k}let c=await this.scope.liquidity.sdkParseJsonLiquidityInfo(t||[]),u=(t||[]).map((k,L)=>({poolKeys:H(k),poolInfo:c[L]})),p=i||He;this.logDebug("features:",p),u.length||this.logAndCreateError("please provide at least one source of trade or (inputMint & outputMint)",u);let P=[],d="amm",N=new x(r,e),g=new x(o,0),B=g,Se=null,Y=null,X=new S(O),Z=[];if(p.includes("amm"))for(let{poolKeys:k,poolInfo:L}of u)try{let{amountOut:C,minAmountOut:Q,currentPrice:q,executionPrice:ee,priceImpact:F,fee:te}=this.scope.liquidity.computeAmountOut({poolKeys:k,poolInfo:L,amountIn:N,outputToken:o,slippage:a});C.gt(g)&&(console.log("amm",L),P=[{source:"amm",keys:k}],d="amm",g=C,B=Q,Se=q,Y=ee,X=F,Z=[te])}catch{}if(p.includes("route")){let k=Ve(u);for(let L of k){if(L.length!==2)continue;let[C,Q]=L,{poolKeys:q,poolInfo:ee}=C,{poolKeys:F,poolInfo:te}=Q;try{let{amountOut:ne,minAmountOut:Qe,executionPrice:et,priceImpact:tt,fee:nt}=this.scope.route.computeRouteAmountOut({fromPoolKeys:q,toPoolKeys:F,fromPoolInfo:ee,toPoolInfo:te,amountIn:N,outputToken:o,slippage:a});ne.gt(g)&&(P=[{source:"amm",keys:q},{source:"amm",keys:F}],d="route",g=ne,B=Qe,Y=et,X=tt,Z=nt)}catch{}}}return{routes:P,routeType:d,amountOut:g,minAmountOut:B,fixedSide:"in",currentPrice:Se,executionPrice:Y,priceImpact:X,fee:Z}}async directSwap(t){this.checkDisabled();let{amountOut:e,amountIn:r,slippage:o,config:a}=t,i=r.token,c=e.token,{routes:u,routeType:p,minAmountOut:P}=await this.getBestAmountOut({inputToken:i,outputToken:c,amountIn:r.raw,slippage:o});return await this.swap({routes:u,routeType:p,amountIn:r,amountOut:P,fixedSide:"in",config:a})}async swap(t){this.checkDisabled(),this.scope.checkOwner();let{routes:e,routeType:r,amountIn:o,amountOut:a,fixedSide:i,config:c}=t;if(r==="amm"&&e.length===1)return await this.scope.liquidity.swapWithAMM({poolKeys:e[0].keys,amountIn:o,amountOut:a,fixedSide:i,config:c});if(r==="route"&&e.length===2)return await this.scope.route.swapWithRoute({fromPoolKeys:e[0].keys,toPoolKeys:e[1].keys,amountIn:o,amountOut:a,fixedSide:i,config:c});throw this.logAndCreateError("invalid routes with routeType","routes",{routeType:r,routes:e}),new Error("invalid routes with routeType")}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let t=this.scope.account.tokenAccounts.filter(e=>e.mint.equals(D));return t.sort((e,r)=>e.isAssociated?1:r.isAssociated||e.amount.lt(r.amount)?-1:1),t}async unWrapWSol(t){let e=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});r.addInstruction(o);let a=f(t);for(let i=0;i<e.length;i++)a.gte(e[i].amount)?(r.addInstruction({instructions:[U({tokenAccount:e[i].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),a.sub(e[i].amount)):(r.addInstruction({instructions:[U({tokenAccount:e[i].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),we({destination:o.signers[0].publicKey,source:e[i].publicKey,amount:a,owner:this.scope.ownerPubKey}));return r.build()}async wrapWSol(t){let e=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:t,skipCloseAccount:!0});return r.addInstruction(o),e.length&&r.addInstruction({instructions:[we({destination:e[0].publicKey,source:o.signers[0].publicKey,amount:t,owner:this.scope.ownerPubKey})],endInstructions:[U({tokenAccount:o.signers[0].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),r.build()}};export{Te as default};
//# sourceMappingURL=trade.mjs.map