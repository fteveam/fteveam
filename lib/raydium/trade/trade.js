var wt=Object.create;var V=Object.defineProperty;var Tt=Object.getOwnPropertyDescriptor;var St=Object.getOwnPropertyNames;var Bt=Object.getPrototypeOf,Lt=Object.prototype.hasOwnProperty;var kt=(n,e)=>{for(var t in e)V(n,t,{get:e[t],enumerable:!0})},Re=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of St(e))!Lt.call(n,o)&&o!==t&&V(n,o,{get:()=>e[o],enumerable:!(r=Tt(e,o))||r.enumerable});return n};var w=(n,e,t)=>(t=n!=null?wt(Bt(n)):{},Re(e||!n||!n.__esModule?V(t,"default",{value:n,enumerable:!0}):t,n)),Nt=n=>Re(V({},"__esModule",{value:!0}),n);var Ft={};kt(Ft,{default:()=>oe});module.exports=Nt(Ft);var b=w(require("bn.js"));var qe=w(require("big.js")),C=w(require("bn.js"));var O=require("lodash"),de=w(require("dayjs")),Oe=w(require("dayjs/plugin/utc"));de.default.extend(Oe.default);var pe=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,de.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ke={},At={};function h(n){let e=(0,O.get)(Ke,n);if(!e){let t=(0,O.get)(At,n);e=new pe({name:n,logLevel:t}),(0,O.set)(Ke,n,e)}return e}var Ee=w(require("toformat")),Dt=Ee.default,E=Dt;var M=w(require("big.js")),Me=w(require("decimal.js-light"));var z=h("module/fraction"),fe=E(M.default),U=E(Me.default),It={[0]:U.ROUND_DOWN,[1]:U.ROUND_HALF_UP,[2]:U.ROUND_UP},Wt={[0]:M.default.roundDown,[1]:M.default.roundHalfUp,[2]:M.default.roundUp},u=class{constructor(e,t=Ue){this.numerator=g(e),this.denominator=g(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new u(this.denominator,this.numerator)}add(e){let t=e instanceof u?e:new u(g(e));return this.denominator.eq(t.denominator)?new u(this.numerator.add(t.numerator),this.denominator):new u(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof u?e:new u(g(e));return this.denominator.eq(t.denominator)?new u(this.numerator.sub(t.numerator),this.denominator):new u(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof u?e:new u(g(e));return new u(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof u?e:new u(g(e));return new u(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||z.logWithError(`${e} is not an integer.`),e<=0&&z.logWithError(`${e} is not positive.`),U.set({precision:e+1,rounding:It[r]});let o=new U(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||z.logWithError(`${e} is not an integer.`),e<0&&z.logWithError(`${e} is negative.`),fe.DP=e,fe.RM=Wt[r]||1,new fe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Rt=h("Raydium_amount"),Ce=E(qe.default);function Kt(n,e){let t="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([t,r]=o,r=r.padEnd(e,"0")):Rt.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,r.slice(0,e)||r]}var x=class extends u{constructor(t,r,o=!0,a){let s=new C.default(0),m=ge.pow(new C.default(t.decimals));if(o)s=g(r);else{let c=new C.default(0),p=new C.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[P,f]=Kt(r.toString(),t.decimals);c=g(P),p=g(f)}c=c.mul(m),s=c.add(p)}super(s,m);this.logger=h(a||"Amount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new x(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new x(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,r,o=0){return super.toSignificant(t,r,o)}toFixed(t=this.token.decimals,r,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,r,o)}toExact(t={groupSeparator:""}){return Ce.DP=this.token.decimals,new Ce(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var ve=require("@solana/web3.js"),Fe={symbol:"SOL",name:"Solana",decimals:9},S={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},un={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ve.PublicKey(S.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var X=require("@solana/web3.js");var je=require("@solana/spl-token"),d=require("@solana/web3.js");function ye({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var mn=[ye({pubkey:je.TOKEN_PROGRAM_ID,isWritable:!1}),ye({pubkey:d.SystemProgram.programId,isWritable:!1}),ye({pubkey:d.SYSVAR_RENT_PUBKEY,isWritable:!1})];function v({publicKey:n,transformSol:e}){if(n instanceof d.PublicKey)return e&&n.equals(q)?_:n;if(e&&n===q.toBase58())return _;if(typeof n=="string")try{return new d.PublicKey(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Je(n){try{return new d.PublicKey(n)}catch{return n}}var Ge=new d.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),He=new d.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ln=new d.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ye=new d.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),$e=new d.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ve=new d.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ze=new d.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Xe=new d.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),pn=new d.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),dn=new d.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ze=new d.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),_=new d.PublicKey("So11111111111111111111111111111111111111112"),q=d.PublicKey.default;var be=class{constructor({mint:e,decimals:t,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(e===q.toBase58()||e instanceof X.PublicKey&&q.equals(e)){this.decimals=S.decimals,this.symbol=S.symbol,this.name=S.name,this.mint=new X.PublicKey(S.mint);return}this.decimals=t,this.symbol=r,this.name=o,this.mint=a?X.PublicKey.default:v({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},I=be;I.WSOL=new be(S);var Pe=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},he=Pe;he.SOL=new Pe(Fe);var Qe=new u(et),B=class extends u{toSignificant(e=5,t,r){return this.mul(Qe).toSignificant(e,t,r)}toFixed(e=2,t,r){return this.mul(Qe).toFixed(e,t,r)}};var Ot=h("Raydium_price"),T=class extends u{constructor(t){let{baseToken:r,quoteToken:o,numerator:a,denominator:s}=t;super(a,s);this.baseToken=r,this.quoteToken=o,this.scalar=new u(xe(r.decimals),xe(o.decimals))}get raw(){return new u(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new T({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ot.logWithError("mul token not equals");let r=super.mul(t);return new T({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(t=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(t,r,o)}toFixed(t=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(t,r,o)}};var Z=h("Raydium_bignumber");var F=new b.default(0),Ue=new b.default(1),Fn=new b.default(2),jn=new b.default(3),Jn=new b.default(5),ge=new b.default(10),et=new b.default(100),Gn=new b.default(1e3),Hn=new b.default(1e4),tt=9007199254740991;function g(n){if(n instanceof b.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new b.default(n);Z.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&Z.logWithError(`BigNumberish number underflow: ${n}`),(n>=tt||n<=-tt)&&Z.logWithError(`BigNumberish number overflow: ${n}`),new b.default(String(n))):typeof n=="bigint"?new b.default(n.toString()):(Z.logWithError(`invalid BigNumberish value: ${n}`),new b.default(0))}function xe(n){return ge.pow(g(n))}function rt(n){var m;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof b.default)return{numerator:n.toString(),denominator:"1"};if(n instanceof u)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let e=String(n),[,t="",r="",o=""]=(m=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?m:[],a="1"+"0".repeat(o.length),s=t+(r==="0"?"":r)+o||"0";return{denominator:a,numerator:s,sign:t,int:r,dec:o}}function R(n){if(n instanceof B)return new u(n.numerator,n.denominator);if(n instanceof T)return n.adjusted;if(n instanceof x)try{return R(n.toExact())}catch{return new u(F)}if(n instanceof u)return n;let e=String(n),t=rt(e);return new u(t.numerator,t.denominator)}function ot(n,e){if(n==null||e==null)return!1;let t=R(n),r=R(e);return t.sub(r).numerator.gte(F)}function we(n,e){if(n==null||e==null)return;let t=R(n),r=R(e);try{return t.div(r)}catch{return t}}var it=require("@solana/web3.js"),st=w(require("bn.js"));var Mt=[I,x,it.PublicKey,u,st.default,T,B];function Ut(n){return typeof n=="object"&&n!==null&&!Mt.some(e=>typeof e=="object"&&n instanceof e)}function Q(n){return typeof n=="string"?Je(n):Array.isArray(n)?n.map(e=>Q(e)):Ut(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,Q(t)])):n}var W=require("@solana/web3.js");var ur=h("Raydium_txTool"),ee=class{constructor(e){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this}build(e){let t=new W.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{transaction:t,signers:this.signers,execute:async()=>{var o;let r=await ut(this.connection);if(t.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return(0,W.sendAndConfirmTransaction)(this.connection,t,this.signers);if(this.signAllTransactions){this.signers.length&&t.partialSign(...this.signers);let a=await this.signAllTransactions([t]);return await this.connection.sendRawTransaction(a[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:o}=this.build(r),a=t.filter(c=>c.transaction.instructions.length>0),s=[...a.map(c=>c.transaction),o],m=[...a.map(c=>c.signers),this.signers];return{transactions:s,signers:m,execute:async()=>{var p;let c=await ut(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return await Promise.all(s.map(async(P,f)=>(P.recentBlockhash=c,await(0,W.sendAndConfirmTransaction)(this.connection,P,m[f]))));if(this.signAllTransactions){let P=s.map((y,L)=>(y.recentBlockhash=c,m[L].length&&y.partialSign(...m[L]),y)),f=await this.signAllTransactions(P),A=[];for(let y=0;y<f.length;y+=1){let L=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});A.push(L)}return A}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function ut(n){var e,t;try{return((t=await((e=n.getLatestBlockhash)==null?void 0:e.call(n)))==null?void 0:t.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var Te=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),j=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=h(t)}createTxBuilder(e){return this.scope.checkOwner(),new ee({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Te(e))}logInfo(...e){this.logger.info(Te(e))}logAndCreateError(...e){let t=Te(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var at=require("@solana/web3.js");var Ct="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",fr=new at.PublicKey(Ct),ct=["amm","serum","route"],mt=[Ye,Ge,_,Ve,He,ze,Xe,$e,Ze].map(n=>n.toBase58());function lt(n){let e=[];for(let t=0;t<n.length;t++)for(let r=0;r<n.length;r++)t!=r&&e.push([n[t],n[r]]);return e}var N=require("@solana/spl-token"),K=require("@solana/web3.js"),yt=w(require("bn.js"));var qt=require("@solana/web3.js");var Lr=h("Raydium_accountInfo_util");var dt=require("@solana/web3.js"),te=w(require("bn.js"));var i=require("@solana/buffer-layout"),Se=i.Layout,pt=i.Structure;var Be=i.UInt;var Le=i.blob;var ke=class extends Se{constructor(t,r,o){super(t,o);this.blob=Le(t),this.signed=r}decode(t,r=0){let o=new te.default(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new te.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function ft(n){return new Be(1,n)}function ne(n){return new Be(4,n)}function re(n){return new ke(8,!1,n)}var Ne=class extends Se{constructor(t,r,o,a){super(t.span,a);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function J(n){return new Ne(Le(32),e=>new dt.PublicKey(e),e=>e.toBuffer(),n)}var Ae=class extends pt{decode(e,t){return super.decode(e,t)}};function gt(n,e,t){return new Ae(n,e,t)}var De=gt([J("mint"),J("owner"),re("amount"),ne("delegateOption"),J("delegate"),ft("state"),ne("isNativeOption"),re("isNative"),re("delegatedAmount"),ne("closeAuthorityOption"),J("closeAuthority")]);function vt(n){let{mint:e,tokenAccount:t,owner:r}=n;return(0,N.createInitializeAccountInstruction)(t,e,r)}function G(n){let{tokenAccount:e,payer:t,multiSigners:r=[],owner:o}=n;return(0,N.createCloseAccountInstruction)(e,t,o,r)}async function Ie(n){let{connection:e,amount:t,commitment:r,payer:o,owner:a,skipCloseAccount:s}=n,m=await e.getMinimumBalanceForRentExemption(De.span,r),c=g(t).add(new yt.default(m)),p=K.Keypair.generate();return{signers:[p],instructions:[K.SystemProgram.createAccount({fromPubkey:o,newAccountPubkey:p.publicKey,lamports:c.toNumber(),space:De.span,programId:N.TOKEN_PROGRAM_ID}),vt({mint:new K.PublicKey(S.mint),tokenAccount:p.publicKey,owner:a})],endInstructions:s?[]:[G({tokenAccount:p.publicKey,payer:o,owner:a})]}}function We({source:n,destination:e,owner:t,amount:r,multiSigners:o=[]}){return(0,N.createTransferInstruction)(n,e,t,g(r).toNumber(),o)}var oe=class extends j{async load(){this.checkDisabled(),await this.scope.fetchLiquidity()}async _getBestSwapPool({availablePools:e,officialPoolIdSet:t}){if(e.length===0)return;if(e.length===1)return e[0];let r=e.filter(s=>t.has(s.id));return r.length===1?r[0]:(await this.scope.liquidity.sdkParseJsonLiquidityInfo(r.length?r:e)).reduce((s,m)=>{let c=s.version===5,p=m.version===5;return c&&!p?s:!c&&p?m:ot(we(s.lpSupply,10**s.lpDecimals),we(m.lpSupply,10**m.lpDecimals))?s:m}).jsonInfo}async getAvailablePools(e){this.checkDisabled();let{inputMint:t,outputMint:r}=e,[o,a]=[v({publicKey:t,transformSol:!0}).toBase58(),v({publicKey:r,transformSol:!0}).toBase58()],s=this.scope.liquidity.allPools.filter(f=>f.baseMint===o&&f.quoteMint===a||f.baseMint===a&&f.quoteMint===o),m=new Set([...mt,o,a]),c=new Set(JSON.parse(JSON.stringify([...m])));c.delete(o),c.delete(a);let p=this.scope.liquidity.allPools.filter(f=>{let A=m.has(f.baseMint)&&m.has(f.quoteMint),y=c.has(f.baseMint)&&c.has(f.quoteMint);return A&&!y}),P=await this._getBestSwapPool({availablePools:s,officialPoolIdSet:this.scope.liquidity.allPoolIdSet.official});return{availablePools:s,best:P,routedPools:p}}async getBestAmountOut({pools:e,amountIn:t,inputToken:r,outputToken:o,slippage:a,features:s}){if(this.checkDisabled(),!e){let{routedPools:k}=await this.getAvailablePools({inputMint:r.mint,outputMint:o.mint});e=k}let m=await this.scope.liquidity.sdkParseJsonLiquidityInfo(e||[]),c=(e||[]).map((k,D)=>({poolKeys:Q(k),poolInfo:m[D]})),p=s||ct;this.logDebug("features:",p),c.length||this.logAndCreateError("please provide at least one source of trade or (inputMint & outputMint)",c);let P=[],f="amm",A=new x(r,t),y=new x(o,0),L=y,_e=null,ie=null,se=new B(F),ue=[];if(p.includes("amm"))for(let{poolKeys:k,poolInfo:D}of c)try{let{amountOut:H,minAmountOut:ae,currentPrice:Y,executionPrice:ce,priceImpact:$,fee:me}=this.scope.liquidity.computeAmountOut({poolKeys:k,poolInfo:D,amountIn:A,outputToken:o,slippage:a});H.gt(y)&&(console.log("amm",D),P=[{source:"amm",keys:k}],f="amm",y=H,L=ae,_e=Y,ie=ce,se=$,ue=[me])}catch{}if(p.includes("route")){let k=lt(c);for(let D of k){if(D.length!==2)continue;let[H,ae]=D,{poolKeys:Y,poolInfo:ce}=H,{poolKeys:$,poolInfo:me}=ae;try{let{amountOut:le,minAmountOut:bt,executionPrice:ht,priceImpact:Pt,fee:xt}=this.scope.route.computeRouteAmountOut({fromPoolKeys:Y,toPoolKeys:$,fromPoolInfo:ce,toPoolInfo:me,amountIn:A,outputToken:o,slippage:a});le.gt(y)&&(P=[{source:"amm",keys:Y},{source:"amm",keys:$}],f="route",y=le,L=bt,ie=ht,se=Pt,ue=xt)}catch{}}}return{routes:P,routeType:f,amountOut:y,minAmountOut:L,fixedSide:"in",currentPrice:_e,executionPrice:ie,priceImpact:se,fee:ue}}async directSwap(e){this.checkDisabled();let{amountOut:t,amountIn:r,slippage:o,config:a}=e,s=r.token,m=t.token,{routes:c,routeType:p,minAmountOut:P}=await this.getBestAmountOut({inputToken:s,outputToken:m,amountIn:r.raw,slippage:o});return await this.swap({routes:c,routeType:p,amountIn:r,amountOut:P,fixedSide:"in",config:a})}async swap(e){this.checkDisabled(),this.scope.checkOwner();let{routes:t,routeType:r,amountIn:o,amountOut:a,fixedSide:s,config:m}=e;if(r==="amm"&&t.length===1)return await this.scope.liquidity.swapWithAMM({poolKeys:t[0].keys,amountIn:o,amountOut:a,fixedSide:s,config:m});if(r==="route"&&t.length===2)return await this.scope.route.swapWithRoute({fromPoolKeys:t[0].keys,toPoolKeys:t[1].keys,amountIn:o,amountOut:a,fixedSide:s,config:m});throw this.logAndCreateError("invalid routes with routeType","routes",{routeType:r,routes:t}),new Error("invalid routes with routeType")}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(_));return e.sort((t,r)=>t.isAssociated?1:r.isAssociated||t.amount.lt(r.amount)?-1:1),e}async unWrapWSol(e){let t=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await Ie({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});r.addInstruction(o);let a=g(e);for(let s=0;s<t.length;s++)a.gte(t[s].amount)?(r.addInstruction({instructions:[G({tokenAccount:t[s].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),a.sub(t[s].amount)):(r.addInstruction({instructions:[G({tokenAccount:t[s].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),We({destination:o.signers[0].publicKey,source:t[s].publicKey,amount:a,owner:this.scope.ownerPubKey}));return r.build()}async wrapWSol(e){let t=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await Ie({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return r.addInstruction(o),t.length&&r.addInstruction({instructions:[We({destination:t[0].publicKey,source:o.signers[0].publicKey,amount:e,owner:this.scope.ownerPubKey})],endInstructions:[G({tokenAccount:o.signers[0].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),r.build()}};0&&(module.exports={});
//# sourceMappingURL=trade.js.map