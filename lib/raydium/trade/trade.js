var xt=Object.create;var z=Object.defineProperty;var wt=Object.getOwnPropertyDescriptor;var Tt=Object.getOwnPropertyNames;var St=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;var kt=(n,t)=>{for(var e in t)z(n,e,{get:t[e],enumerable:!0})},We=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Tt(t))!Bt.call(n,o)&&o!==e&&z(n,o,{get:()=>t[o],enumerable:!(r=wt(t,o))||r.enumerable});return n};var w=(n,t,e)=>(e=n!=null?xt(St(n)):{},We(t||!n||!n.__esModule?z(e,"default",{value:n,enumerable:!0}):e,n)),Nt=n=>We(z({},"__esModule",{value:!0}),n);var jt={};kt(jt,{default:()=>oe});module.exports=Nt(jt);var b=w(require("bn.js"));var Ce=w(require("big.js")),C=w(require("bn.js"));var O=require("lodash"),Re=w(require("pino")),Ke=w(require("pino-pretty")),_e={},Lt={},At=(0,Ke.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Dt=(0,Re.default)({base:null,level:"silent"},At);function h(n){let t=(0,O.get)(_e,n);if(!t){let e=(0,O.get)(Lt,n);t=Dt.child({name:n},{level:e}),(0,O.set)(_e,n,t)}return t.logWithError=(...e)=>{let r=e.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(r)},t}var Oe=w(require("toformat")),It=Oe.default,M=It;var E=w(require("big.js")),Me=w(require("decimal.js-light"));var Y=h("module/fraction"),pe=M(E.default),U=M(Me.default),Wt={[0]:U.ROUND_DOWN,[1]:U.ROUND_HALF_UP,[2]:U.ROUND_UP},_t={[0]:E.default.roundDown,[1]:E.default.roundHalfUp,[2]:E.default.roundUp},a=class{constructor(t,e=Ee){this.numerator=g(t),this.denominator=g(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new a(this.denominator,this.numerator)}add(t){let e=t instanceof a?t:new a(g(t));return this.denominator.eq(e.denominator)?new a(this.numerator.add(e.numerator),this.denominator):new a(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof a?t:new a(g(t));return this.denominator.eq(e.denominator)?new a(this.numerator.sub(e.numerator),this.denominator):new a(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof a?t:new a(g(t));return new a(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof a?t:new a(g(t));return new a(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||Y.logWithError(`${t} is not an integer.`),t<=0&&Y.logWithError(`${t} is not positive.`),U.set({precision:t+1,rounding:Wt[r]});let o=new U(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||Y.logWithError(`${t} is not an integer.`),t<0&&Y.logWithError(`${t} is negative.`),pe.DP=t,pe.RM=_t[r]||1,new pe(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var Kt=h("Raydium_amount"),Ue=M(Ce.default);function Ot(n,t){let e="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([e,r]=o,r=r.padEnd(t,"0")):Kt.logWithError(`invalid number string, num: ${n}`)}else e=n;return[e,r.slice(0,t)||r]}var x=class extends a{constructor(e,r,o=!0,u){let s=new C.default(0),m=de.pow(new C.default(e.decimals));if(o)s=g(r);else{let c=new C.default(0),p=new C.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[P,f]=Ot(r.toString(),e.decimals);c=g(P),p=g(f)}c=c.mul(m),s=c.add(p)}super(s,m);this.logger=h(u||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new x(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new x(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,o=0){return super.toSignificant(e,r,o)}toFixed(e=this.token.decimals,r,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,o)}toExact(e={groupSeparator:""}){return Ue.DP=this.token.decimals,new Ue(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};var qe=require("@solana/web3.js"),Fe={symbol:"SOL",name:"Solana",decimals:9},S={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},mn={isQuantumSOL:!0,isLp:!1,official:!0,mint:new qe.PublicKey(S.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var X=require("@solana/web3.js");var ve=require("@solana/spl-token"),d=require("@solana/web3.js");function fe({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var dn=[fe({pubkey:ve.TOKEN_PROGRAM_ID,isWritable:!1}),fe({pubkey:d.SystemProgram.programId,isWritable:!1}),fe({pubkey:d.SYSVAR_RENT_PUBKEY,isWritable:!1})];function F({publicKey:n,transformSol:t}){if(n instanceof d.PublicKey)return t&&n.equals(q)?_:n;if(t&&n===q.toBase58())return _;if(typeof n=="string")try{return new d.PublicKey(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function je(n){try{return new d.PublicKey(n)}catch{return n}}var Je=new d.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ge=new d.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),fn=new d.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),He=new d.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),$e=new d.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ve=new d.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ze=new d.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ye=new d.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),gn=new d.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),yn=new d.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Xe=new d.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),_=new d.PublicKey("So11111111111111111111111111111111111111112"),q=d.PublicKey.default;var ge=class{constructor({mint:t,decimals:e,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:u=!1}){if(t===q.toBase58()||t instanceof X.PublicKey&&q.equals(t)){this.decimals=S.decimals,this.symbol=S.symbol,this.name=S.name,this.mint=new X.PublicKey(S.mint);return}this.decimals=e,this.symbol=r,this.name=o,this.mint=u?X.PublicKey.default:F({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},I=ge;I.WSOL=new ge(S);var be=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},ye=be;ye.SOL=new be(Fe);var Ze=new a(Qe),B=class extends a{toSignificant(t=5,e,r){return this.mul(Ze).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(Ze).toFixed(t,e,r)}};var Mt=h("Raydium_price"),T=class extends a{constructor(e){let{baseToken:r,quoteToken:o,numerator:u,denominator:s}=e;super(u,s);this.baseToken=r,this.quoteToken=o,this.scalar=new a(he(r.decimals),he(o.decimals))}get raw(){return new a(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new T({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Mt.logWithError("mul token not equals");let r=super.mul(e);return new T({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(e,r,o)}toFixed(e=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(e,r,o)}};var Z=h("Raydium_bignumber");var v=new b.default(0),Ee=new b.default(1),Gn=new b.default(2),Hn=new b.default(3),$n=new b.default(5),de=new b.default(10),Qe=new b.default(100),Vn=new b.default(1e3),zn=new b.default(1e4),et=9007199254740991;function g(n){if(n instanceof b.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new b.default(n);Z.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&Z.logWithError(`BigNumberish number underflow: ${n}`),(n>=et||n<=-et)&&Z.logWithError(`BigNumberish number overflow: ${n}`),new b.default(String(n))):typeof n=="bigint"?new b.default(n.toString()):(Z.logWithError(`invalid BigNumberish value: ${n}`),new b.default(0))}function he(n){return de.pow(g(n))}function nt(n){var m;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof b.default)return{numerator:n.toString(),denominator:"1"};if(n instanceof a)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let t=String(n),[,e="",r="",o=""]=(m=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?m:[],u="1"+"0".repeat(o.length),s=e+(r==="0"?"":r)+o||"0";return{denominator:u,numerator:s,sign:e,int:r,dec:o}}function R(n){if(n instanceof B)return new a(n.numerator,n.denominator);if(n instanceof T)return n.adjusted;if(n instanceof x)try{return R(n.toExact())}catch{return new a(v)}if(n instanceof a)return n;let t=String(n),e=nt(t);return new a(e.numerator,e.denominator)}function rt(n,t){if(n==null||t==null)return!1;let e=R(n),r=R(t);return e.sub(r).numerator.gte(v)}function Pe(n,t){if(n==null||t==null)return;let e=R(n),r=R(t);try{return e.div(r)}catch{return e}}var ot=require("@solana/web3.js"),it=w(require("bn.js"));var Ut=[I,x,ot.PublicKey,a,it.default,T,B];function Ct(n){return typeof n=="object"&&n!==null&&!Ut.some(t=>typeof t=="object"&&n instanceof t)}function Q(n){return typeof n=="string"?je(n):Array.isArray(n)?n.map(t=>Q(t)):Ct(n)?Object.fromEntries(Object.entries(n).map(([t,e])=>[t,Q(e)])):n}var W=require("@solana/web3.js");var mr=h("Raydium_txTool"),ee=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this}build(t){let e=new W.Transaction;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var o;let r=await st(this.connection);if(e.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return(0,W.sendAndConfirmTransaction)(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let u=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:o}=this.build(r),u=e.filter(c=>c.transaction.instructions.length>0),s=[...u.map(c=>c.transaction),o],m=[...u.map(c=>c.signers),this.signers];return{transactions:s,signers:m,execute:async()=>{var p;let c=await st(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return await Promise.all(s.map(async(P,f)=>(P.recentBlockhash=c,await(0,W.sendAndConfirmTransaction)(this.connection,P,m[f]))));if(this.signAllTransactions){let P=s.map((y,k)=>(y.recentBlockhash=c,m[k].length&&y.partialSign(...m[k]),y)),f=await this.signAllTransactions(P),A=[];for(let y=0;y<f.length;y+=1){let k=await this.connection.sendRawTransaction(f[y].serialize(),{skipPreflight:!0});A.push(k)}return A}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function st(n){var t,e;try{return((e=await((t=n.getLatestBlockhash)==null?void 0:t.call(n)))==null?void 0:e.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var xe=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),j=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=h(e)}createTxBuilder(t){return this.scope.checkOwner(),new ee({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(xe(t))}logInfo(...t){this.logger.info(xe(t))}logAndCreateError(...t){let e=xe(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var at=require("@solana/web3.js");var qt="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",yr=new at.PublicKey(qt),ut=["amm","serum","route"],ct=[He,Je,_,Ve,Ge,ze,Ye,$e,Xe].map(n=>n.toBase58());function mt(n){let t=[];for(let e=0;e<n.length;e++)for(let r=0;r<n.length;r++)e!=r&&t.push([n[e],n[r]]);return t}var L=require("@solana/spl-token"),K=require("@solana/web3.js"),gt=w(require("bn.js"));var Ft=require("@solana/web3.js");var Lr=h("Raydium_accountInfo_util");var pt=require("@solana/web3.js"),te=w(require("bn.js"));var i=require("@solana/buffer-layout"),we=i.Layout,lt=i.Structure;var Te=i.UInt;var Se=i.blob;var Be=class extends we{constructor(e,r,o){super(e,o);this.blob=Se(e),this.signed=r}decode(e,r=0){let o=new te.default(this.blob.decode(e,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,r,o=0){return typeof e=="number"&&(e=new te.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,o)}};function dt(n){return new Te(1,n)}function ne(n){return new Te(4,n)}function re(n){return new Be(8,!1,n)}var ke=class extends we{constructor(e,r,o,u){super(e.span,u);this.layout=e,this.decoder=r,this.encoder=o}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,o){return this.layout.encode(this.encoder(e),r,o)}getSpan(e,r){return this.layout.getSpan(e,r)}};function J(n){return new ke(Se(32),t=>new pt.PublicKey(t),t=>t.toBuffer(),n)}var Ne=class extends lt{decode(t,e){return super.decode(t,e)}};function ft(n,t,e){return new Ne(n,t,e)}var Le=ft([J("mint"),J("owner"),re("amount"),ne("delegateOption"),J("delegate"),dt("state"),ne("isNativeOption"),re("isNative"),re("delegatedAmount"),ne("closeAuthorityOption"),J("closeAuthority")]);function vt(n){let{mint:t,tokenAccount:e,owner:r}=n;return(0,L.createInitializeAccountInstruction)(e,t,r)}function G(n){let{tokenAccount:t,payer:e,multiSigners:r=[],owner:o}=n;return(0,L.createCloseAccountInstruction)(t,e,o,r)}async function Ae(n){let{connection:t,amount:e,commitment:r,payer:o,owner:u,skipCloseAccount:s}=n,m=await t.getMinimumBalanceForRentExemption(Le.span,r),c=g(e).add(new gt.default(m)),p=K.Keypair.generate();return{signers:[p],instructions:[K.SystemProgram.createAccount({fromPubkey:o,newAccountPubkey:p.publicKey,lamports:c.toNumber(),space:Le.span,programId:L.TOKEN_PROGRAM_ID}),vt({mint:new K.PublicKey(S.mint),tokenAccount:p.publicKey,owner:u})],endInstructions:s?[]:[G({tokenAccount:p.publicKey,payer:o,owner:u})]}}function De({source:n,destination:t,owner:e,amount:r,multiSigners:o=[]}){return(0,L.createTransferInstruction)(n,t,e,g(r).toNumber(),o)}var oe=class extends j{async load(){this.checkDisabled(),await this.scope.fetchLiquidity()}async _getBestSwapPool({availablePools:t,officialPoolIdSet:e}){if(t.length===0)return;if(t.length===1)return t[0];let r=t.filter(s=>e.has(s.id));return r.length===1?r[0]:(await this.scope.liquidity.sdkParseJsonLiquidityInfo(r.length?r:t)).reduce((s,m)=>{let c=s.version===5,p=m.version===5;return c&&!p?s:!c&&p?m:rt(Pe(s.lpSupply,10**s.lpDecimals),Pe(m.lpSupply,10**m.lpDecimals))?s:m}).jsonInfo}async getAvailablePools(t){this.checkDisabled();let{inputMint:e,outputMint:r}=t,[o,u]=[F({publicKey:e,transformSol:!0}).toBase58(),F({publicKey:r,transformSol:!0}).toBase58()],s=this.scope.liquidity.allPools.filter(f=>f.baseMint===o&&f.quoteMint===u||f.baseMint===u&&f.quoteMint===o),m=new Set([...ct,o,u]),c=new Set(JSON.parse(JSON.stringify([...m])));c.delete(o),c.delete(u);let p=this.scope.liquidity.allPools.filter(f=>{let A=m.has(f.baseMint)&&m.has(f.quoteMint),y=c.has(f.baseMint)&&c.has(f.quoteMint);return A&&!y}),P=await this._getBestSwapPool({availablePools:s,officialPoolIdSet:this.scope.liquidity.allPoolIdSet.official});return{availablePools:s,best:P,routedPools:p}}async getBestAmountOut({pools:t,amountIn:e,inputToken:r,outputToken:o,slippage:u,features:s}){if(this.checkDisabled(),!t){let{routedPools:N}=await this.getAvailablePools({inputMint:r.mint,outputMint:o.mint});t=N}let m=await this.scope.liquidity.sdkParseJsonLiquidityInfo(t||[]),c=(t||[]).map((N,D)=>({poolKeys:Q(N),poolInfo:m[D]})),p=s||ut;this.logDebug("features:",p),c.length||this.logAndCreateError("please provide at least one source of trade or (inputMint & outputMint)",c);let P=[],f="amm",A=new x(r,e),y=new x(o,0),k=y,Ie=null,ie=null,se=new B(v),ae=[];if(p.includes("amm"))for(let{poolKeys:N,poolInfo:D}of c)try{let{amountOut:H,minAmountOut:ue,currentPrice:$,executionPrice:ce,priceImpact:V,fee:me}=this.scope.liquidity.computeAmountOut({poolKeys:N,poolInfo:D,amountIn:A,outputToken:o,slippage:u});H.gt(y)&&(console.log("amm",D),P=[{source:"amm",keys:N}],f="amm",y=H,k=ue,Ie=$,ie=ce,se=V,ae=[me])}catch{}if(p.includes("route")){let N=mt(c);for(let D of N){if(D.length!==2)continue;let[H,ue]=D,{poolKeys:$,poolInfo:ce}=H,{poolKeys:V,poolInfo:me}=ue;try{let{amountOut:le,minAmountOut:yt,executionPrice:bt,priceImpact:ht,fee:Pt}=this.scope.route.computeRouteAmountOut({fromPoolKeys:$,toPoolKeys:V,fromPoolInfo:ce,toPoolInfo:me,amountIn:A,outputToken:o,slippage:u});le.gt(y)&&(P=[{source:"amm",keys:$},{source:"amm",keys:V}],f="route",y=le,k=yt,ie=bt,se=ht,ae=Pt)}catch{}}}return{routes:P,routeType:f,amountOut:y,minAmountOut:k,fixedSide:"in",currentPrice:Ie,executionPrice:ie,priceImpact:se,fee:ae}}async directSwap(t){this.checkDisabled();let{amountOut:e,amountIn:r,slippage:o,config:u}=t,s=r.token,m=e.token,{routes:c,routeType:p,minAmountOut:P}=await this.getBestAmountOut({inputToken:s,outputToken:m,amountIn:r.raw,slippage:o});return await this.swap({routes:c,routeType:p,amountIn:r,amountOut:P,fixedSide:"in",config:u})}async swap(t){this.checkDisabled(),this.scope.checkOwner();let{routes:e,routeType:r,amountIn:o,amountOut:u,fixedSide:s,config:m}=t;if(r==="amm"&&e.length===1)return await this.scope.liquidity.swapWithAMM({poolKeys:e[0].keys,amountIn:o,amountOut:u,fixedSide:s,config:m});if(r==="route"&&e.length===2)return await this.scope.route.swapWithRoute({fromPoolKeys:e[0].keys,toPoolKeys:e[1].keys,amountIn:o,amountOut:u,fixedSide:s,config:m});throw this.logAndCreateError("invalid routes with routeType","routes",{routeType:r,routes:e}),new Error("invalid routes with routeType")}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let t=this.scope.account.tokenAccounts.filter(e=>e.mint.equals(_));return t.sort((e,r)=>e.isAssociated?1:r.isAssociated||e.amount.lt(r.amount)?-1:1),t}async unWrapWSol(t){let e=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await Ae({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});r.addInstruction(o);let u=g(t);for(let s=0;s<e.length;s++)u.gte(e[s].amount)?(r.addInstruction({instructions:[G({tokenAccount:e[s].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),u.sub(e[s].amount)):(r.addInstruction({instructions:[G({tokenAccount:e[s].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),De({destination:o.signers[0].publicKey,source:e[s].publicKey,amount:u,owner:this.scope.ownerPubKey}));return r.build()}async wrapWSol(t){let e=await this.getWSolAccounts(),r=this.createTxBuilder(),o=await Ae({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:t,skipCloseAccount:!0});return r.addInstruction(o),e.length&&r.addInstruction({instructions:[De({destination:e[0].publicKey,source:o.signers[0].publicKey,amount:t,owner:this.scope.ownerPubKey})],endInstructions:[G({tokenAccount:o.signers[0].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),r.build()}};0&&(module.exports={});
//# sourceMappingURL=trade.js.map