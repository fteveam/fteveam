var Ji=Object.create;var at=Object.defineProperty,$i=Object.defineProperties,ji=Object.getOwnPropertyDescriptor,Yi=Object.getOwnPropertyDescriptors,Qi=Object.getOwnPropertyNames,Nt=Object.getOwnPropertySymbols,Hi=Object.getPrototypeOf,wn=Object.prototype.hasOwnProperty,mr=Object.prototype.propertyIsEnumerable;var cr=(n,e,t)=>e in n?at(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,L=(n,e)=>{for(var t in e||(e={}))wn.call(e,t)&&cr(n,t,e[t]);if(Nt)for(var t of Nt(e))mr.call(e,t)&&cr(n,t,e[t]);return n},K=(n,e)=>$i(n,Yi(e));var ne=(n,e)=>{var t={};for(var o in n)wn.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&Nt)for(var o of Nt(n))e.indexOf(o)<0&&mr.call(n,o)&&(t[o]=n[o]);return t};var zi=(n,e)=>{for(var t in e)at(n,t,{get:e[t],enumerable:!0})},lr=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Qi(e))!wn.call(n,r)&&r!==t&&at(n,r,{get:()=>e[r],enumerable:!(o=ji(e,r))||o.enumerable});return n};var H=(n,e,t)=>(t=n!=null?Ji(Hi(n)):{},lr(e||!n||!n.__esModule?at(t,"default",{value:n,enumerable:!0}):t,n)),Zi=n=>lr(at({},"__esModule",{value:!0}),n);var va={};zi(va,{DataElement:()=>wi,FARM_LOCK_MINT:()=>Qn,FARM_LOCK_VAULT:()=>Hn,FARM_PROGRAMID_TO_VERSION:()=>jn,FARM_PROGRAM_ID_V3:()=>Gn,FARM_PROGRAM_ID_V3_PUBKEY:()=>si,FARM_PROGRAM_ID_V5:()=>Jn,FARM_PROGRAM_ID_V5_PUBKEY:()=>ui,FARM_PROGRAM_ID_V6:()=>$n,FARM_PROGRAM_ID_V6_PUBKEY:()=>ci,FARM_VERSION_TO_LEDGER_LAYOUT:()=>Zn,FARM_VERSION_TO_PROGRAMID:()=>Yn,FARM_VERSION_TO_STATE_LAYOUT:()=>zn,LIQUIDITY_FEES_DENOMINATOR:()=>bo,LIQUIDITY_FEES_NUMERATOR:()=>yo,LIQUIDITY_PROGRAMID_TO_VERSION:()=>Ta,LIQUIDITY_PROGRAM_ID_V4:()=>bi,LIQUIDITY_PROGRAM_ID_V5:()=>gi,LIQUIDITY_VERSION_TO_PROGRAM_ID:()=>ho,LIQUIDITY_VERSION_TO_SERUM_VERSION:()=>wo,LIQUIDITY_VERSION_TO_STATE_LAYOUT:()=>ko,LiquidityPoolStatus:()=>fo,MODEL_DATA_PUBKEY:()=>Pe,ROUTE_PROGRAM_ID_V1:()=>et,Raydium:()=>Mt,SERUM_PROGRAMID_TO_VERSION:()=>Ba,SERUM_PROGRAM_ID_V3:()=>Li,SERUM_VERSION_TO_PROGRAM_ID:()=>_i,SPL_MINT_LAYOUT:()=>gn,StableLayout:()=>kt,TOKEN_SOL:()=>Sn,TOKEN_WSOL:()=>$,_LIQUIDITY_PROGRAM_ID_V4:()=>go,_LIQUIDITY_PROGRAM_ID_V5:()=>Po,_ROUTE_PROGRAM_ID_V1:()=>Fi,_SERUM_PROGRAM_ID_V3:()=>qo,addLiquidityLayout:()=>cn,associatedLedgerAccountLayout:()=>Yt,calFarmRewardAmount:()=>tn,calculateFarmPoolAprList:()=>mo,closeAccountInstruction:()=>Ke,createAssociatedLedgerAccountInstruction:()=>no,createPoolV4Layout:()=>an,createWSolAccountInstructions:()=>xe,defaultRoutes:()=>Wo,dwLayout:()=>ze,farmAddRewardLayout:()=>Zt,farmDespotVersionToInstruction:()=>Xn,farmLedgerLayoutV3_1:()=>ga,farmLedgerLayoutV3_2:()=>Cn,farmLedgerLayoutV5_1:()=>Pa,farmLedgerLayoutV5_2:()=>Wn,farmLedgerLayoutV6_1:()=>Un,farmRewardInfoToConfig:()=>ao,farmRewardLayout:()=>Ht,farmRewardRestartLayout:()=>zt,farmRewardTimeInfoLayout:()=>ii,farmStateV3Layout:()=>En,farmStateV5Layout:()=>Vn,farmStateV6Layout:()=>He,farmWithdrawVersionToInstruction:()=>eo,fetchMultipleFarmInfoAndUpdate:()=>yi,fixedSwapInLayout:()=>on,fixedSwapOutLayout:()=>rn,formatLayout:()=>Ii,getAmountSide:()=>fn,getAmountsSide:()=>Vo,getAssociatedAuthority:()=>ro,getAssociatedLedgerAccount:()=>en,getAssociatedLedgerPoolAccount:()=>ht,getAssociatedMiddleStatusAccount:()=>Jo,getAssociatedPoolKeys:()=>bn,getDxByDyBaseIn:()=>Io,getDyByDxBaseIn:()=>Ao,getFarmLedgerLayout:()=>di,getFarmProgramId:()=>io,getFarmStateLayout:()=>pi,getFarmVersion:()=>li,getLiquidityAssociatedAuthority:()=>Bi,getLiquidityAssociatedId:()=>Se,getLiquidityInfo:()=>Oa,getLiquidityProgramId:()=>Mi,getLiquidityStateLayout:()=>Ka,getPoolEnabledFeatures:()=>yn,getSPLTokenInfo:()=>Fa,getSerumAssociatedAuthority:()=>vo,getSerumProgramId:()=>No,getSerumVersion:()=>Fo,getStablePrice:()=>xo,getTokenSide:()=>Do,getTokensSide:()=>Ki,groupPools:()=>Qo,includesToken:()=>Ge,initPoolLayout:()=>sn,initTokenAccountInstruction:()=>Zr,isValidFarmVersion:()=>Xt,isValidFixedSide:()=>Co,judgeFarmType:()=>uo,liquidityStateV4Layout:()=>un,liquidityStateV5Layout:()=>Pi,makeAMMSwapInstruction:()=>So,makeAddLiquidityInstruction:()=>Mo,makeCreateFarmInstruction:()=>oo,makeCreatePoolInstruction:()=>_o,makeInitPoolInstruction:()=>Ro,makeRemoveLiquidityInstruction:()=>Bo,makeRouteSwapInstruction:()=>Go,makeSimulatePoolInfoInstruction:()=>Lo,makeSimulationPoolInfo:()=>Eo,makeSwapFixedInInstruction:()=>xi,makeSwapFixedOutInstruction:()=>Si,makeSwapInFixedInInstruction:()=>Ni,makeSwapOutFixedInInstruction:()=>vi,makeTransferInstruction:()=>Ve,mergeSdkFarmInfo:()=>so,modelDataInfoLayout:()=>ki,parseTokenAccountResp:()=>Dn,poolTypeV6:()=>gt,quantumSOLHydratedTokenJsonInfo:()=>$e,realFarmStateV3Layout:()=>ni,realFarmStateV5Layout:()=>oi,realFarmV6Layout:()=>ri,removeLiquidityLayout:()=>mn,routeSwapInLayout:()=>At,routeSwapOutLayout:()=>It,sortTokens:()=>jo,splAccountLayout:()=>ge,swapRouteMiddleMints:()=>Uo,unionArr:()=>Na,updateFarmPoolInfo:()=>fi,validateFarmRewards:()=>to,whetherIsStakeFarmPool:()=>co,withdrawRewardLayout:()=>Qt});module.exports=Zi(va);var Ei=require("lodash");var $r=H(require("axios"));var st=require("lodash"),Tn=H(require("dayjs")),pr=H(require("dayjs/plugin/utc"));Tn.default.extend(pr.default);var kn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,Tn.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},dr={},Xi={};function M(n){let e=(0,st.get)(dr,n);if(!e){let t=(0,st.get)(Xi,n);e=new kn({name:n,logLevel:t}),(0,st.set)(dr,n,e)}return e}var Or=require("@solana/web3.js"),qr=H(require("bn.js"));var kr=H(require("big.js")),pt=H(require("bn.js"));var V=H(require("bn.js"));var vt=M("Raydium_bignumber");var ue=new V.default(0),be=new V.default(1),Wa=new V.default(2),Ua=new V.default(3),Ga=new V.default(5),Te=new V.default(10),br=new V.default(100),Ja=new V.default(1e3),$a=new V.default(1e4),fr=9007199254740991;function I(n){if(n instanceof V.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new V.default(n);vt.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&vt.logWithError(`BigNumberish number underflow: ${n}`),(n>=fr||n<=-fr)&&vt.logWithError(`BigNumberish number overflow: ${n}`),new V.default(String(n))):typeof n=="bigint"?new V.default(n.toString()):(vt.logWithError(`invalid BigNumberish value: ${n}`),new V.default(0))}function An(n){return Te.pow(I(n))}function ce(n){var u;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof V.default)return{numerator:n.toString(),denominator:"1"};if(n instanceof A)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let e=String(n),[,t="",o="",r=""]=(u=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?u:[],i="1"+"0".repeat(r.length),a=t+(o==="0"?"":o)+r||"0";return{denominator:i,numerator:a,sign:t,int:o,dec:r}}function In(n,e){let t=n.divmod(e);return t.mod.isZero()?t.div:t.div.negative!==0?t.div.isubn(1):t.div.iaddn(1)}function ea(n){var o;let[,e="",t=""]=(o=n.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?o:[];return`${e}${t}`}function _e(n,e=0){return n instanceof V.default?n:new V.default(ea(ve(n).mul(Te.pow(new V.default(String(e))))))}function ve(n){if(n instanceof re)return new A(n.numerator,n.denominator);if(n instanceof Z)return n.adjusted;if(n instanceof O)try{return ve(n.toExact())}catch{return new A(ue)}if(n instanceof A)return n;let e=String(n),t=ce(e);return new A(t.numerator,t.denominator)}function Dt(n,e){let{numerator:t,denominator:o}=ce(n);return new re(new V.default(t),new V.default(o).mul(e!=null&&e.alreadyDecimaled?new V.default(100):new V.default(1)))}function ut(n){let{token:e,numberPrice:t,decimalDone:o}=n,r=new J({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:i,denominator:a}=ce(t),u=o?new V.default(i).mul(Te.pow(new V.default(e.decimals))):i,c=new V.default(a).mul(Te.pow(new V.default(r.decimals)));return new Z({baseToken:r,denominator:c.toString(),quoteToken:new J(K(L({},e),{skipMint:!0,mint:""})),numerator:u.toString()})}function gr(n,e){if(n==null||e==null)return;let t=ve(n),o=ve(e);return t.mul(o)}function yr(n){let e=new J({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),t=_e(gr(n,10**e.decimals));return new O(e,t)}function ct(n,e){return yr(!e||!n?0:gr(n,e))}var Pr=H(require("toformat")),ta=Pr.default,mt=ta;var lt=H(require("big.js")),hr=H(require("decimal.js-light"));var Et=M("module/fraction"),xn=mt(lt.default),dt=mt(hr.default),oa={[0]:dt.ROUND_DOWN,[1]:dt.ROUND_HALF_UP,[2]:dt.ROUND_UP},ra={[0]:lt.default.roundDown,[1]:lt.default.roundHalfUp,[2]:lt.default.roundUp},A=class{constructor(e,t=be){this.numerator=I(e),this.denominator=I(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new A(this.denominator,this.numerator)}add(e){let t=e instanceof A?e:new A(I(e));return this.denominator.eq(t.denominator)?new A(this.numerator.add(t.numerator),this.denominator):new A(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof A?e:new A(I(e));return this.denominator.eq(t.denominator)?new A(this.numerator.sub(t.numerator),this.denominator):new A(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof A?e:new A(I(e));return new A(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof A?e:new A(I(e));return new A(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},o=1){Number.isInteger(e)||Et.logWithError(`${e} is not an integer.`),e<=0&&Et.logWithError(`${e} is not positive.`),dt.set({precision:e+1,rounding:oa[o]});let r=new dt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},o=1){return Number.isInteger(e)||Et.logWithError(`${e} is not an integer.`),e<0&&Et.logWithError(`${e} is negative.`),xn.DP=e,xn.RM=ra[o]||1,new xn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ia=M("Raydium_amount"),wr=mt(kr.default);function aa(n,e){let t="0",o="0";if(n.includes(".")){let r=n.split(".");r.length===2?([t,o]=r,o=o.padEnd(e,"0")):ia.logWithError(`invalid number string, num: ${n}`)}else t=n;return[t,o.slice(0,e)||o]}var O=class extends A{constructor(t,o,r=!0,i){let a=new pt.default(0),u=Te.pow(new pt.default(t.decimals));if(r)a=I(o);else{let c=new pt.default(0),m=new pt.default(0);if(typeof o=="string"||typeof o=="number"||typeof o=="bigint"){let[d,p]=aa(o.toString(),t.decimals);c=I(d),m=I(p)}c=c.mul(u),a=c.add(m)}super(a,u);this.logger=M(i||"Amount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new O(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new O(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,o,r=0){return super.toSignificant(t,o,r)}toFixed(t=this.token.decimals,o,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,o,r)}toExact(t={groupSeparator:""}){return wr.DP=this.token.decimals,new wr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var Tr=require("@solana/web3.js"),Sn={symbol:"SOL",name:"Solana",decimals:9},$={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},$e={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Tr.PublicKey($.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var Ct=require("@solana/web3.js");var Ar=require("@solana/spl-token"),j=require("@solana/web3.js");function s({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var De=[s({pubkey:Ar.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:j.SystemProgram.programId,isWritable:!1}),s({pubkey:j.SYSVAR_RENT_PUBKEY,isWritable:!1})];function C({publicKey:n,transformSol:e}){if(n instanceof j.PublicKey)return e&&n.equals(U)?Re:n;if(e&&n===U.toBase58())return Re;if(typeof n=="string")try{return new j.PublicKey(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Ir(n){try{return new j.PublicKey(n)}catch{return n}}var Vt=new j.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),xr=new j.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ls=new j.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Sr=new j.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Lr=new j.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),_r=new j.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Rr=new j.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Mr=new j.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ds=new j.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ps=new j.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Br=new j.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Re=new j.PublicKey("So11111111111111111111111111111111111111112"),U=j.PublicKey.default;var Ln=class{constructor({mint:e,decimals:t,symbol:o="UNKNOWN",name:r="UNKNOWN",skipMint:i=!1}){if(e===U.toBase58()||e instanceof Ct.PublicKey&&U.equals(e)){this.decimals=$.decimals,this.symbol=$.symbol,this.name=$.name,this.mint=new Ct.PublicKey($.mint);return}this.decimals=t,this.symbol=o,this.name=r,this.mint=i?Ct.PublicKey.default:C({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},J=Ln;J.WSOL=new Ln($);var Rn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:o="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=o}equals(e){return this===e}},_n=Rn;_n.SOL=new Rn(Sn);var Kr=new A(br),re=class extends A{toSignificant(e=5,t,o){return this.mul(Kr).toSignificant(e,t,o)}toFixed(e=2,t,o){return this.mul(Kr).toFixed(e,t,o)}};var sa=M("Raydium_price"),Z=class extends A{constructor(t){let{baseToken:o,quoteToken:r,numerator:i,denominator:a}=t;super(i,a);this.baseToken=o,this.quoteToken=r,this.scalar=new A(An(o.decimals),An(r.decimals))}get raw(){return new A(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Z({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&sa.logWithError("mul token not equals");let o=super.mul(t);return new Z({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:o.denominator,numerator:o.numerator})}toSignificant(t=this.quoteToken.decimals,o,r){return this.adjusted.toSignificant(t,o,r)}toFixed(t=this.quoteToken.decimals,o,r){return this.adjusted.toFixed(t,o,r)}};var ua=[J,O,Or.PublicKey,A,qr.default,Z,re];function ca(n){return typeof n=="object"&&n!==null&&!ua.some(e=>typeof e=="object"&&n instanceof e)}function pe(n){return typeof n=="string"?Ir(n):Array.isArray(n)?n.map(e=>pe(e)):ca(n)?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,pe(t)])):n}var se=require("@solana/web3.js");var Me=M("Raydium_txTool"),Wt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:e=[],endInstructions:t=[],signers:o=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...o),this}build(e){let t=new se.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{transaction:t,signers:this.signers,execute:async()=>{var r;let o=await Fr(this.connection);if(t.recentBlockhash=o,(r=this.owner)!=null&&r.isKeyPair)return(0,se.sendAndConfirmTransaction)(this.connection,t,this.signers);if(this.signAllTransactions){this.signers.length&&t.partialSign(...this.signers);let i=await this.signAllTransactions([t]);return await this.connection.sendRawTransaction(i[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:o}=e,{transaction:r}=this.build(o),i=t.filter(c=>c.transaction.instructions.length>0),a=[...i.map(c=>c.transaction),r],u=[...i.map(c=>c.signers),this.signers];return{transactions:a,signers:u,execute:async()=>{var m;let c=await Fr(this.connection);if((m=this.owner)!=null&&m.isKeyPair)return await Promise.all(a.map(async(d,p)=>(d.recentBlockhash=c,await(0,se.sendAndConfirmTransaction)(this.connection,d,u[p]))));if(this.signAllTransactions){let d=a.map((f,b)=>(f.recentBlockhash=c,u[b].length&&f.partialSign(...u[b]),f)),p=await this.signAllTransactions(d),y=[];for(let f=0;f<p.length;f+=1){let b=await this.connection.sendRawTransaction(p[f].serialize(),{skipPreflight:!0});y.push(b)}return y}throw new Error("please connect wallet first")},extInfo:o||{}}}};async function Fr(n){var e,t;try{return((t=await((e=n.getLatestBlockhash)==null?void 0:e.call(n)))==null?void 0:t.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}function ma(n,e){n.length<1&&Me.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Me.logWithError(`no signers provided:, ${e.toString()}`);let t=new se.Transaction;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);let o=t.compileMessage().serialize();return e.length+e.length*64+o.length}async function Nr(n,e,t){let o=new se.PublicKey("RaydiumSimuLateTransaction11111111111111111"),r=[],i=new se.Transaction;i.feePayer=o;for(let c of e)ma([...i.instructions,c],[o])>se.PACKET_DATA_SIZE&&(r.push(i),i=new se.Transaction,i.feePayer=o),i.add(c);i.instructions.length>0&&r.push(i);let a=[];try{a=await Promise.all(r.map(c=>n.simulateTransaction(c)))}catch(c){c instanceof Error&&Me.logWithError(`failed to simulate for instructions, RPC_ERROR, ${c.message}`)}let u=[];for(let c of a){let{value:m}=c;if(Me.debug(`simulate result: ${JSON.stringify(c)}`),m.logs){let d=m.logs.filter(p=>p&&p.includes(t));Me.debug(`filteredLog: ${JSON.stringify(u)}`),d.length||Me.logWithError(` "simulate log not match keyword, keyword: ${t}`),u.push(...d)}}return u}function vr(n,e){let t=n.match(/{["\w:,]+}/g);return!t||t.length!==1?Me.logWithError(`simulate log fail to match json, keyword: ${e}`):t[0]}function Ae(n,e){let o=new RegExp(`"${e}":(\\d+)`,"g").exec(n);return!o||o.length!==2?Me.logWithError(`simulate log fail to match key", key: ${e}`):o[1]}async function Ie(n,e){let[t,o]=await se.PublicKey.findProgramAddress(n,e);return{publicKey:t,nonce:o}}var fe=class{constructor(e){this._owner=e}get publicKey(){return fe.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return fe.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return fe.isKeyPair(this._owner)}get isPublicKey(){return fe.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!fe.isKeyPair(e)}};function Dr(n,e=1,t=[]){let o=[...n];if(e<=0)return t;for(;o.length;)t.push(o.splice(0,e));return t}var Er=require("@solana/web3.js");var Mn=M("Raydium_accountInfo_util");async function la(n,e,t){let{batchRequest:o,commitment:r}=L({batchRequest:!1},t),i=Dr(e,100),a=new Array(i.length).fill([]);if(o){let u=i.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}});a=(await n._rpcBatchRequest(u)).map(m=>(m.error&&Mn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:h}=d;return p.length!==2&&p[1]!=="base64"&&Mn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new Er.PublicKey(b),rentEpoch:h}}return null})))}else try{a=await Promise.all(i.map(u=>n.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&Mn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Vr(n,e,t){let o=await la(n,e.map(r=>r.pubkey),t);return e.map((r,i)=>K(L({},r),{accountInfo:o[i]}))}function me(n){if(n instanceof re)return new A(n.numerator,n.denominator);if(n instanceof Z)return n.adjusted;if(n instanceof O)try{return me(n.toExact())}catch{return new A(ue)}if(n instanceof A)return n;let e=String(n),t=ce(e);return new A(t.numerator,t.denominator)}function da(n,e){if(n==null||e==null)return!1;let t=me(n),o=me(e);return t.sub(o).numerator.gt(ue)}function Cr(n,e){if(n==null||e==null)return!1;let t=me(n),o=me(e);return t.sub(o).numerator.gte(ue)}function pa(n,e){if(n==null||e==null)return!1;let t=me(n),o=me(e);return t.sub(o).numerator.eq(ue)}function Bn(n,e){if(n==null||e==null)return;let t=me(n),o=me(e);try{return t.div(o)}catch{return t}}function Wr(n,e){if(n==null||e==null)return;let t=me(n),o=me(e);return t.sub(o)}function Ut(n){return n==null?!1:!pa(n,0)}function Ur(n,e){return da(e,n)?e:n}var Gr=n=>typeof n=="number",Jr=n=>n?new Date(n):new Date,fa=n=>Jr(n).getTime();function ft(n,e,t){let o=Gr(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(n).getTime()<=o}function je(n,e,t){let o=Gr(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(n).getTime()>o}function Kn(n,e){let o=fa(n)+(e.days?e.days*24*60*60*1e3:0)+(e.hours?e.hours*60*60*1e3:0)+(e.minutes?e.minutes*60*1e3:0)+(e.seconds?e.seconds*1e3:0)+(e.milliseconds?e.milliseconds:0);return Jr(o)}var Gt=M("Raydium_Api");var Jt=class{constructor({cluster:e,timeout:t}){this.cluster=e,this.api=$r.default.create({baseURL:"https://api.raydium.io/v2",timeout:t}),this.api.interceptors.request.use(o=>{let{method:r,baseURL:i,url:a}=o;return Gt.debug(`${r==null?void 0:r.toUpperCase()} ${i}${a}`),o},o=>(Gt.error("Request failed"),Promise.reject(o))),this.api.interceptors.response.use(o=>{let{config:r,data:i,status:a}=o,{method:u,baseURL:c,url:m}=r;return Gt.debug(`${u==null?void 0:u.toUpperCase()} ${c}${m}  ${a}`),i},o=>{let{config:r,response:i={}}=o,{status:a}=i,{method:u,baseURL:c,url:m}=r;return Gt.error(`${u.toUpperCase()} ${c}${m} ${a||o.message}`),Promise.reject(o)})}async getTokens(){return this.api.get("/sdk/token/raydium.mainnet.json")}async getLiquidityPools(){return this.api.get(`/sdk/liquidity/${this.cluster}.json`)}async getPairsInfo(){return this.api.get("https://api.raydium.io/v2/main/pairs")}async getFarmPools(){return this.api.get(`/sdk/farm-v2/${this.cluster}.json`)}async getCoingeckoPrice(e){return this.api.get(`https://api.coingecko.com/api/v3/simple/price?ids=${e.join(",")}&vs_currencies=usd`)}async getRaydiumTokenPrice(){return this.api.get("https://api.raydium.io/v2/main/price")}async getBlockSlotCountForSecond(e){if(!e)return 2;let o=(await this.api.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(r=>r.numSlots);return o.reduce((r,i)=>r+i,0)/o.length/60}};var $t="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",jr="please provide connection in load() initialization or set it by raydium.setConnection(connection)";var Oe=require("@solana/spl-token"),ti=require("@solana/web3.js");var On=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),ie=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=M(t)}createTxBuilder(e){return this.scope.checkOwner(),new Wt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(On(e))}logInfo(...e){this.logger.info(On(e))}logAndCreateError(...e){let t=On(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Be=require("@solana/spl-token"),Qe=require("@solana/web3.js"),zr=H(require("bn.js"));var Hr=require("@solana/web3.js"),Ye=H(require("bn.js"));var x=require("@solana/buffer-layout"),qn=x.Layout,Yr=x.Structure;var Fn=x.UInt;var Qr=x.seq;var yt=x.blob;var jt=class extends qn{constructor(t,o,r){super(t,r);this.blob=yt(t),this.signed=o}decode(t,o=0){let r=new Ye.default(this.blob.decode(t,o),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,o,r=0){return typeof t=="number"&&(t=new Ye.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),o,r)}};function D(n){return new Fn(1,n)}function Ee(n){return new Fn(4,n)}function l(n){return new jt(8,!1,n)}function z(n){return new jt(16,!1,n)}var Nn=class extends qn{constructor(t,o,r,i){super(t.span,i);this.layout=t,this.decoder=o,this.encoder=r}decode(t,o){return this.decoder(this.layout.decode(t,o))}encode(t,o,r){return this.layout.encode(this.encoder(t),o,r)}getSpan(t,o){return this.layout.getSpan(t,o)}};function w(n){return new Nn(yt(32),e=>new Hr.PublicKey(e),e=>e.toBuffer(),n)}var vn=class extends Yr{decode(e,t){return super.decode(e,t)}};function R(n,e,t){return new vn(n,e,t)}function ee(n,e,t){let o,r=typeof e=="number"?e:(0,Ye.isBN)(e)?e.toNumber():new Proxy(e,{get(i,a){if(!o){let u=Reflect.get(i,"count");o=(0,Ye.isBN)(u)?u.toNumber():u,Reflect.set(i,"count",o)}return Reflect.get(i,a)},set(i,a,u){return a==="count"&&(o=u),Reflect.set(i,a,u)}});return Qr(n,r,t)}var ge=R([w("mint"),w("owner"),l("amount"),Ee("delegateOption"),w("delegate"),D("state"),Ee("isNativeOption"),l("isNative"),l("delegatedAmount"),Ee("closeAuthorityOption"),w("closeAuthority")]);function Zr(n){let{mint:e,tokenAccount:t,owner:o}=n;return(0,Be.createInitializeAccountInstruction)(t,e,o)}function Ke(n){let{tokenAccount:e,payer:t,multiSigners:o=[],owner:r}=n;return(0,Be.createCloseAccountInstruction)(e,t,r,o)}async function xe(n){let{connection:e,amount:t,commitment:o,payer:r,owner:i,skipCloseAccount:a}=n,u=await e.getMinimumBalanceForRentExemption(ge.span,o),c=I(t).add(new zr.default(u)),m=Qe.Keypair.generate();return{signers:[m],instructions:[Qe.SystemProgram.createAccount({fromPubkey:r,newAccountPubkey:m.publicKey,lamports:c.toNumber(),space:ge.span,programId:Be.TOKEN_PROGRAM_ID}),Zr({mint:new Qe.PublicKey($.mint),tokenAccount:m.publicKey,owner:i})],endInstructions:a?[]:[Ke({tokenAccount:m.publicKey,payer:r,owner:i})]}}function Ve({source:n,destination:e,owner:t,amount:o,multiSigners:r=[]}){return(0,Be.createTransferInstruction)(n,e,t,I(o).toNumber(),r)}var Xr=require("@solana/web3.js"),ei=H(require("bn.js"));var ya=M("Raydium_Util");function Dn({solAccountResp:n,tokenAccountResp:e}){let t=[],o=[];for(let{pubkey:r,account:i}of e.value){if(i.data.length!==ge.span)throw ya.error("invalid token account layout length","publicKey",r.toBase58()),new Error("invalid token account layout length");let a=ge.decode(i.data),{mint:u,amount:c}=a;t.push({publicKey:r,mint:u,amount:c,isNative:!1}),o.push({pubkey:r,accountInfo:a})}return n&&t.push({mint:Xr.PublicKey.default,amount:new ei.default(n.lamports),isNative:!0}),{tokenAccounts:t,tokenAccountRawInfos:o}}var bt=class extends ie{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._ataCache=new Map;this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:o,tokenAccountRawInfos:r}=t;this._tokenAccounts=o||[],this._tokenAccountRawInfos=r||[],this._clientOwnedToken=!!(o||r)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:o}){return t&&(this._tokenAccounts=t),o&&(this._tokenAccountRawInfos=o),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(o=>o!==t),this}async getAssociatedTokenAccount(t){this.scope.checkOwner();let o=`${this.scope.ownerPubKey.toBase58()}_${t.toBase58()}`;if(this._ataCache.has(o))return this._ataCache.get(o);let r=await(0,Oe.getAssociatedTokenAddress)(t,this.scope.ownerPubKey,!0);return this._ataCache.set(o,r),r}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let r=L(L({},{}),t),i=await this.scope.connection.getAccountInfo(this.scope.ownerPubKey,r.commitment),a=await this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:Oe.TOKEN_PROGRAM_ID},r.commitment),{tokenAccounts:u,tokenAccountRawInfos:c}=Dn({solAccountResp:i,tokenAccountResp:a});return this._tokenAccounts=u,this._tokenAccountRawInfos=c,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:u,tokenAccountRawInfos:c}}async getCreatedTokenAccount({mint:t,associatedOnly:o=!0}){await this.fetchWalletTokenAccounts();let r=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(t)).sort((a,u)=>a.amount.lt(u.amount)?1:-1),i=await this.getAssociatedTokenAccount(t);for(let a of r){let{publicKey:u}=a;if(u)return o&&i.equals(u),u}}async checkOrCreateAta({mint:t,autoUnwrapWSOLToSOL:o}){var u;await this.fetchWalletTokenAccounts();let r=(u=this.scope.account.tokenAccounts.find(({mint:c})=>(c==null?void 0:c.toBase58())===t.toBase58()))==null?void 0:u.publicKey,i=this.scope.ownerPubKey,a={};if(!r){let c=await this.getAssociatedTokenAccount(t),m=await(0,Oe.createAssociatedTokenAccountInstruction)(i,c,i,t);a.instructions=[m],r=c}return o&&$.mint===t.toBase58()&&(a.endInstructions=[Ke({owner:i,payer:i,tokenAccount:r})]),{pubKey:r,newInstructions:a}}async handleTokenAccount(t){let{side:o,amount:r,mint:i,tokenAccount:a,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:c,skipCloseAccount:m}=t,d=this.createTxBuilder(),p=await(0,Oe.getAssociatedTokenAddress)(i,this.scope.ownerPubKey,!0);if(new ti.PublicKey($.mint).equals(i)){let y=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:r,skipCloseAccount:m});return d.addInstruction(y),L({tokenAccount:y.signers[0].publicKey},y)}else if(!a||o==="out"&&!p.equals(a)&&!c)return{tokenAccount:p,instructions:[(0,Oe.createAssociatedTokenAccountInstruction)(this.scope.ownerPubKey,p,this.scope.ownerPubKey,i)]};return{tokenAccount:a}}};var qe=require("@solana/spl-token"),q=require("@solana/web3.js"),nn=H(require("bn.js"));var Ze=require("@solana/web3.js");var Yt=R([D("instruction")]),Qt=R([D("instruction")]),ba=R([l("rewardState"),l("rewardOpenTime"),l("rewardEndTime"),l("rewardLastUpdateTime"),l("totalReward"),l("totalRewardEmissioned"),l("rewardClaimed"),l("rewardPerSecond"),z("accRewardPerShare"),w("rewardVault"),w("rewardMint"),w("rewardSender"),l("rewardType"),ee(l(),15,"padding")]),ni=R([l("state"),l("nonce"),w("lpVault"),w("rewardVault"),w(),w(),l(),l(),l("totalReward"),z("perShareReward"),l("lastSlot"),l("perSlotReward")]),oi=R([l("state"),l("nonce"),w("lpVault"),w("rewardVaultA"),l("totalRewardA"),z("perShareRewardA"),l("perSlotRewardA"),D("option"),w("rewardVaultB"),yt(7),l("totalRewardB"),z("perShareRewardB"),l("perSlotRewardB"),l("lastSlot"),w()]),ri=R([l(),l("state"),l("nonce"),l("validRewardTokenNum"),z("rewardMultiplier"),l("rewardPeriodMax"),l("rewardPeriodMin"),l("rewardPeriodExtend"),w("lpMint"),w("lpVault"),ee(ba,5,"rewardInfos"),w("creator"),w(),ee(l(),32,"padding")]),En=new Proxy(ni,{get(n,e,t){return e==="decode"?(...o)=>{let r=n.decode(...o);return K(L({},r),{version:3,rewardInfos:[{rewardVault:r.rewardVault,totalReward:r.totalReward,perSlotReward:r.perSlotReward,perShareReward:r.perShareReward}]})}:Reflect.get(n,e,t)}}),Vn=new Proxy(oi,{get(n,e,t){return e==="decode"?(...o)=>{let r=n.decode(...o);return K(L({},r),{version:5,rewardInfos:[{rewardVault:r.rewardVaultA,totalReward:r.totalRewardA,perSlotReward:r.perSlotRewardA,perShareReward:r.perShareRewardA},{rewardVault:r.rewardVaultB,totalReward:r.totalRewardB,perSlotReward:r.perSlotRewardB,perShareReward:r.perShareRewardB}]})}:Reflect.get(n,e,t)}}),He=new Proxy(ri,{get(n,e,t){return e==="decode"?(...o)=>{let r=n.decode(...o);return K(L({},r),{version:6,rewardInfos:r.rewardInfos.map(i=>{var a;return K(L({},i),{rewardType:((a=Object.entries(gt).find(u=>String(u[1])===i.rewardType.toString()))!=null?a:["Standard SPL"])[0]})})})}:Reflect.get(n,e,t)}}),ii=R([l("isSet"),l("rewardPerSecond"),l("rewardOpenTime"),l("rewardEndTime"),l("rewardType")]),Ht=R([D("instruction"),l("nonce"),ee(ii,5,"rewardTimeInfo")]),zt=R([D("instruction"),l("rewardReopenTime"),l("rewardEndTime"),l("rewardPerSecond")]),Zt=R([D("instruction"),l("isSet"),l("rewardPerSecond"),l("rewardOpenTime"),l("rewardEndTime")]),ga=R([l("state"),w("id"),w("owner"),l("deposited"),ee(l(),1,"rewardDebts")]),Cn=R([l("state"),w("id"),w("owner"),l("deposited"),ee(z(),1,"rewardDebts"),ee(l(),17)]),Pa=R([l("state"),w("id"),w("owner"),l("deposited"),ee(l(),2,"rewardDebts")]),Wn=R([l("state"),w("id"),w("owner"),l("deposited"),ee(z(),2,"rewardDebts"),ee(l(),17)]),Un=R([l(),l("state"),w("id"),w("owner"),l("deposited"),ee(z(),5,"rewardDebts"),ee(l(),16)]),ze=R([D("instruction"),l("amount")]);var ai=M("Raydium_farm_config"),Gn="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",si=new Ze.PublicKey(Gn),Jn="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",ui=new Ze.PublicKey(Jn),$n="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",ci=new Ze.PublicKey($n),jn={[Gn]:3,[Jn]:5,[$n]:6},Yn={3:si,5:ui,6:ci},Qn=new Ze.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Hn=new Ze.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),zn={3:En,5:Vn,6:He},Zn={3:Cn,5:Wn,6:Un},Xt=n=>[3,5,6].indexOf(n)!==-1,ha={3:10,5:11,6:1},Xn=n=>{let e=ha[n];return e||ai.logWithError("invalid deposit farm version"),e},wa={3:11,5:12,6:2},eo=n=>{let e=wa[n];return e||ai.logWithError("invalid withdraw farm version"),e},to=n=>{var a;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:o}=n,r=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(o)}`,i={3:()=>{if(t.length!==1||o.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${r}`},5:()=>{if(t.length!==o.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${r}`},6:()=>{if(!o.length||t.length!==o.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${r}`}};return(a=i[e])==null?void 0:a.call(i)},gt={"Standard SPL":0,"Option tokens":1};var Ce=require("@solana/web3.js"),mi=H(require("bn.js"));var ka=M("Raydium_farm_instruction");async function no(n){let{version:e,id:t,ledger:o,programId:r,owner:i}=n,a={3:9,5:10}[e];a||ka.logWithError(`invalid farm pool version: ${e}`);let u=Buffer.alloc(Yt.span);Yt.encode({instruction:a},u);let c=[s({pubkey:t}),s({pubkey:o}),s({pubkey:i,isWritable:!1}),s({pubkey:Ce.SystemProgram.programId,isWritable:!1}),s({pubkey:Ce.SYSVAR_RENT_PUBKEY,isWritable:!1})];return new Ce.TransactionInstruction({programId:r,keys:c,data:u})}function oo(n){var o;let e=Buffer.alloc(Ht.span);Ht.encode({instruction:0,nonce:new mi.default(n.nonce),rewardTimeInfo:n.rewardInfoConfig},e);let t=[...De,s({pubkey:n.farmKeyPair.publicKey}),s({pubkey:n.farmAuthority,isWritable:!1}),s({pubkey:n.lpVault}),s({pubkey:n.lpMint,isWritable:!1}),s({pubkey:n.lockVault}),s({pubkey:n.lockMint,isWritable:!1}),s({pubkey:(o=n.lockUserAccount)!=null?o:U}),s({pubkey:n.owner,isWritable:!1,isSigner:!0})];for(let r of n.rewardInfo)t.push(s({pubkey:r.rewardMint,isWritable:!1}),s({pubkey:r.rewardVault}),s({pubkey:r.userRewardToken}));return new Ce.TransactionInstruction({programId:n.programId,keys:t,data:e})}var X=H(require("bn.js"));var Pt=M("Raydium.farm.util");async function ht({programId:n,poolId:e,mint:t,type:o}){let{publicKey:r}=await Ie([e.toBuffer(),t.toBuffer(),Buffer.from(o==="lpVault"?"lp_vault_associated_seed":o==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],n);return r}function li(n){let t=C({publicKey:n}).toBase58();return jn[t]}async function en({programId:n,poolId:e,owner:t}){let{publicKey:o}=await Ie([e.toBuffer(),t.toBuffer(),Buffer.from(li(n)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],n);return o}var ro=async({programId:n,poolId:e})=>await Ie([e.toBuffer()],n);function io(n){return Yn[n]}function ao(n){return{isSet:new X.default(1),rewardPerSecond:I(n.rewardPerSecond),rewardOpenTime:I(n.rewardOpenTime),rewardEndTime:I(n.rewardEndTime),rewardType:I(n.rewardType)}}function tn(n){return I(n.rewardEndTime).sub(I(n.rewardOpenTime)).mul(I(n.rewardPerSecond))}function di(n){let e=Zn[n];return e||Pt.logWithError("invalid version",n),e}function pi(n){let e=zn[n];return e||Pt.logWithError("invalid version",n),e}function fi(n,e,t,o){if(n.version===3||n.version===5){if(n.lastSlot.gte(new X.default(t)))return n;let r=new X.default(t).sub(n.lastSlot);n.lastSlot=new X.default(t);for(let i of n.rewardInfos){if(e.amount.eq(new X.default(0)))continue;let a=i.perSlotReward.mul(r);i.perShareReward=i.perShareReward.add(a.mul(new X.default(10).pow(new X.default(n.version===3?9:15))).div(e.amount)),i.totalReward=i.totalReward.add(a)}}else if(n.version===6)for(let r of n.rewardInfos){if(r.rewardState.eq(new X.default(0)))continue;let i=X.default.min(new X.default(o),r.rewardEndTime);if(r.rewardOpenTime.gte(i))continue;let u=i.sub(r.rewardLastUpdateTime).mul(r.rewardPerSecond),c=r.totalReward.sub(r.totalRewardEmissioned);c.lt(u)?(u=c,r.rewardLastUpdateTime=r.rewardLastUpdateTime.add(c.div(r.rewardPerSecond))):r.rewardLastUpdateTime=i,!e.amount.eq(new X.default(0))&&(r.accRewardPerShare=r.accRewardPerShare.add(u.mul(n.rewardMultiplier).div(e.amount)),r.totalRewardEmissioned=r.totalRewardEmissioned.add(u))}return n}async function yi({connection:n,farmPools:e,owner:t,config:o}){var y;let r=!1,i=!1,a=new X.default(10),u=[];for(let f of e){let b=pe(f);b.version===6?i=!0:r=!0,u.push({pubkey:b.id,version:b.version,key:"state",poolId:b.id},{pubkey:b.lpVault,version:b.version,key:"lpVault",poolId:b.id}),t&&u.push({pubkey:await en({programId:b.programId,poolId:b.id,owner:t}),version:b.version,key:"ledger",poolId:b.id})}let c={},m=await Vr(n,u,o);for(let{pubkey:f,version:b,key:h,poolId:S,accountInfo:g}of m){let k=S.toBase58();if(c[k]=L({},c[k]),h==="state"){let _=pi(b);(!g||!g.data||g.data.length!==_.span)&&Pt.logWithError(`invalid farm state account info, pools.id, ${f}`),c[k].state=_.decode(g.data)}else if(h==="lpVault")(!g||!g.data||g.data.length!==ge.span)&&Pt.logWithError(`invalid farm lp vault account info, pools.lpVault, ${f}`),c[k].lpVault=ge.decode(g.data);else if(h==="ledger"){let _=di(b);g&&g.data&&(g.data.length!==_.span&&Pt.logWithError(`invalid farm ledger account info, ledger, ${f}`),c[k].ledger=_.decode(g.data))}}let d=i||r?await n.getSlot():0,p=i&&(y=await n.getBlockTime(d))!=null?y:0;for(let f of Object.keys(c))c[f].state=fi(c[f].state,c[f].lpVault,d,p);for(let[f,{state:b,ledger:h}]of Object.entries(c))if(h){let S=b.version===6?b.rewardMultiplier:b.rewardInfos.length===1?a.pow(new X.default(9)):a.pow(new X.default(15)),g=b.rewardInfos.map((k,_)=>{let T=h.rewardDebts[_];return h.deposited.mul(b.version===6?k.accRewardPerShare:k.perShareReward).div(S).sub(T)});c[f].wrapped=K(L({},c[f].wrapped),{pendingRewards:g})}return c}async function so(n){let{farmPools:e}=n,t=await yi(n);return e.map((r,i)=>K(L(L(L({},e[i]),pe(r)),t[r.id]),{jsonInfo:e[i]}))}function uo(n,e=Date.now()){if(n.version===6){let t=n.state.rewardInfos;if(t.every(({rewardOpenTime:o})=>ft(e,o.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:o})=>je(e,o.toNumber(),{unit:"s"})))return"closed pool"}else{let t=n.state.rewardInfos.map(({perSlotReward:o})=>o);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}function co(n){return n.state.rewardInfos.length===1&&String(n.lpMint)===Vt.toBase58()}function mo(n,e){return n.version===6?n.state.rewardInfos.map(({rewardPerSecond:t,rewardOpenTime:o,rewardEndTime:r},i)=>{var y;let a=ft(e.currentBlockChainDate,o.toNumber(),{unit:"s"}),u=je(e.currentBlockChainDate,r.toNumber(),{unit:"s"});if(a||u)return;let c=e.rewardTokens[i];if(!c)return;let m=e.rewardTokenPrices[i];if(!m)return;let d=ct(new A(t,be).div(Te.pow(new X.default(c.decimals||1))).mul(new X.default(60*60*24*365)),m);return e.tvl?e.tvl.isZero()?ve(0):d.div((y=e.tvl)!=null?y:be):void 0}):n.state.rewardInfos.map(({perSlotReward:o},r)=>{var m;let i=e.rewardTokens[r];if(!i)return;let a=e.rewardTokenPrices[r];if(!a)return;let u=ct(new A(o,be).div(Te.pow(new X.default(i.decimals||1))).mul(new X.default(e.blockSlotCountForSecond*60*60*24*365)),a);return e.tvl?e.tvl.isZero()?ve(0):u.div((m=e.tvl)!=null?m:be):void 0})}var wt=class extends ie{constructor(){super(...arguments);this._farmPools=[];this._hydratedFarmPools=[];this._hydratedFarmMap=new Map;this._sdkParsedFarmPools=[];this._lpTokenInfoMap=new Map}async load(t){var r;await this.scope.liquidity.load(t),await this.scope.fetchFarms(t==null?void 0:t.forceUpdate);let o=((r=this.scope.apiData.farmPools)==null?void 0:r.data)||{};this._farmPools=Object.keys(o||{}).reduce((i,a)=>{var u,c;return i.concat(((c=(u=o[a]).map)==null?void 0:c.call(u,m=>{let d=this.scope.token.allTokenMap.get(m.baseMint),p=this.scope.token.allTokenMap.get(m.quoteMint);return d&&p&&this._lpTokenInfoMap.set(m.lpMint,new J({mint:m.lpMint,decimals:d.decimals,symbol:`${d.symbol} - ${p.name}`,name:`${d.symbol} - ${p.name} LP`})),K(L({},m),{name:m.symbol,category:a})}))||[])},[]),await this.fetchSdkFarmInfo()}async fetchSdkFarmInfo(){var t;this._sdkParsedFarmPools=await so({connection:this.scope.connection,farmPools:this._farmPools,owner:(t=this.scope.owner)==null?void 0:t.publicKey,config:{commitment:"confirmed"}})}async loadHydratedFarmInfo(t){let{forceUpdate:o,skipPrice:r}=t||{};if(this._hydratedFarmPools.length&&!o)return this._hydratedFarmPools;await this.scope.farm.load();try{await this.scope.account.fetchWalletTokenAccounts()}catch{}!r&&await this.scope.token.fetchTokenPrices(),await this.scope.liquidity.loadPairs();let i=await this.scope.chainTimeOffset(),a=Kn(Date.now()+i,{minutes:0}),u=await this.scope.api.getBlockSlotCountForSecond(this.scope.connection.rpcEndpoint),c=Object.fromEntries(this.scope.liquidity.allPairs.map(m=>[m.ammId,{apr30d:m.apr30d,apr7d:m.apr7d,apr24h:m.apr24h}]));return this._hydratedFarmPools=this._sdkParsedFarmPools.map(m=>{let d=this.hydrateFarmInfo({farmInfo:m,blockSlotCountForSecond:u,farmAprs:c,currentBlockChainDate:a,chainTimeOffset:i});return this._hydratedFarmMap.set(m.id.toBase58(),d),d}),this._hydratedFarmPools}get allFarms(){return this._farmPools}get allParsedFarms(){return this._sdkParsedFarmPools}get allHydratedFarms(){return this._hydratedFarmPools}get allHydratedFarmMap(){return this._hydratedFarmMap}getFarm(t){let o=C({publicKey:t}),r=this.allFarms.find(i=>i.id===o.toBase58());return r||this.logAndCreateError("invalid farm id"),r}getParsedFarm(t){let o=C({publicKey:t}),r=this.allParsedFarms.find(i=>o.equals(i.id));return r||this.logAndCreateError("invalid farm id"),r}getLpTokenInfo(t){let o=C({publicKey:t}),r=this._lpTokenInfoMap.get(o.toBase58());return r||this.logAndCreateError("LP Token not found",o.toBase58()),r}lpDecimalAmount({mint:t,amount:o}){let r=ce(o),i=this.getLpTokenInfo(t);return _e(new A(r.numerator,r.denominator).mul(new nn.default(10).pow(new nn.default(i.decimals))))}hydrateFarmInfo(t){var Bt,Kt,nt,ot,rt,Ot,Ho,zo,Zo,Xo,er,tr;let{farmInfo:o,blockSlotCountForSecond:r,farmAprs:i,currentBlockChainDate:a,chainTimeOffset:u=0}=t,c=uo(o,a),m=co(o),d=c==="dual fusion pool",p=c==="normal fusion pool",y=c==="closed pool"&&!o.upcoming,f=o.version!==6?o.upcoming&&y:o.upcoming,b=o.version!==6&&o.upcoming&&!y,h=((Bt=this.scope.liquidity.allPools.find(B=>B.lpMint===o.lpMint.toBase58()))==null?void 0:Bt.version)===5,S=m?this.scope.mintToToken(o.lpMint):this.getLpTokenInfo(o.lpMint),g=this.scope.mintToToken(m?o.lpMint:o.baseMint),k=this.scope.mintToToken(m?o.lpMint:o.quoteMint);g!=null&&g.symbol;let _=m?`${(Kt=g==null?void 0:g.symbol)!=null?Kt:"unknown"}`:`${(nt=g==null?void 0:g.symbol)!=null?nt:"unknown"}-${(ot=k==null?void 0:k.symbol)!=null?ot:"unknown"}`,T=o.jsonInfo.rewardInfos.map(({rewardMint:B})=>this.scope.mintToToken(B)),F=(rt=o.wrapped)==null?void 0:rt.pendingRewards.map((B,W)=>T[W]?new O(T[W],_e(Ur(B,0))):void 0),N=m?this.scope.token.tokenPrices.get(o.lpMint.toBase58()):this.scope.liquidity.lpPriceMap.get(o.lpMint.toBase58()),v=S&&new O(S,o.lpVault.amount),Y=N&&S?ct(new O(S,o.lpVault.amount),N):void 0,E=mo(o,{tvl:Y,currentBlockChainDate:a,rewardTokens:T,rewardTokenPrices:(Ot=o.rewardInfos.map(({rewardMint:B})=>this.scope.token.tokenPrices.get(B.toBase58())))!=null?Ot:[],blockSlotCountForSecond:r}),G=(Ho=this.scope.liquidity.allPools.find(B=>B.lpMint===o.lpMint.toBase58()))==null?void 0:Ho.id,te=G?Dt((zo=i[G])==null?void 0:zo.apr7d,{alreadyDecimaled:!0}):void 0,Q=G?Dt((Zo=i[G])==null?void 0:Zo.apr30d,{alreadyDecimaled:!0}):void 0,oe=G?Dt((Xo=i[G])==null?void 0:Xo.apr24h,{alreadyDecimaled:!0}):void 0,ae=E.reduce((B,W)=>B?W?B.add(W):B:W,te),Le=E.reduce((B,W)=>B?W?B.add(W):B:W,Q),de=E.reduce((B,W)=>B?W?B.add(W):B:W,oe),we=o.version===6?o.state.rewardInfos.map((B,W)=>{var ir,ar,sr,ur;let{rewardOpenTime:it,rewardEndTime:qt,rewardPerSecond:Pn}=B,Ne=it.toNumber()?new Date(it.toNumber()*1e3+u):void 0,ke=qt.toNumber()?new Date(qt.toNumber()*1e3+u):void 0,hn=Date.now()+u;if(!Ne&&!ke)return;let Je=this.scope.mintToToken((sr=(ar=B.rewardMint)!=null?ar:(ir=o.rewardInfos[W])==null?void 0:ir.rewardMint)==null?void 0:sr.toBase58()),nr=Boolean(Ne&&ft(hn,Ne)),or=Boolean(ke&&je(hn,ke)),rr=!Ne&&!ke||!or&&!nr,Vi=rr&&je(hn,Kn(ke,{seconds:-((ur=o.jsonInfo.rewardPeriodExtend)!=null?ur:72*60*60)})),Ci=Je&&this.scope.mintToTokenAmount({mint:Je.mint,amount:Wr(B.totalReward,B.totalRewardEmissioned).toFixed(Je.decimals)}),Wi=F==null?void 0:F[W],Ui=E[W],Gi=Boolean(ke),Ft=o.rewardInfos[W];return K(L(L({},Ft),B),{owner:Ft==null?void 0:Ft.rewardSender,apr:Ui,token:Je,userPendingReward:Wi,userHavedReward:Gi,perSecond:Je&&this.scope.mintToTokenAmount({mint:Je.mint,amount:Pn}).toSignificant(),openTime:Ne,endTime:ke,isOptionToken:B.rewardType==="Option tokens",isRewardBeforeStart:nr,isRewardEnded:or,isRewarding:rr,isRwardingBeforeEnd72h:Vi,claimableRewards:Ci,version:6})}).filter(B=>!!B):o.state.rewardInfos.map((B,W)=>{let it=F==null?void 0:F[W],qt=E[W],Pn=T[W],{perSlotReward:Ne}=B,ke=Ut(it)||Ut(Ne);return K(L({},B),{apr:qt,token:Pn,userPendingReward:it,userHavedReward:ke,version:o.version})}),ye=S&&((er=o.ledger)==null?void 0:er.deposited)?new O(S,(tr=o.ledger)==null?void 0:tr.deposited):void 0;return K(L({},o),{lp:S,lpPrice:N,base:g,quote:k,name:_,isStakePool:m,isDualFusionPool:d,isNormalFusionPool:p,isClosedPool:y,isUpcomingPool:f,isStablePool:h,isNewPool:b,totalApr7d:ae,raydiumFeeApr7d:te,totalApr24h:de,raydiumFeeApr24h:oe,totalApr30d:Le,raydiumFeeApr30d:Q,ammId:G,tvl:Y,userHasStaked:Ut(ye),rewards:we,userStakedLpAmount:ye,stakedLpAmount:v})}async _getUserRewardInfo({payer:t,rewardInfo:o}){if(o.rewardMint.equals(U)){let r=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:t,amount:tn(o)});return{rewardPubKey:r.signers[0].publicKey,newInstruction:r}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:o.rewardMint})}}async create({poolId:t,rewardInfos:o,payer:r}){this.checkDisabled(),this.scope.checkOwner();let i=C({publicKey:t}),a=this.scope.liquidity.allPools.find(T=>T.id===i.toBase58());a||this.logAndCreateError("invalid pool id");let c={lpMint:new q.PublicKey(a.lpMint),lockInfo:{lockMint:Qn,lockVault:Hn},version:6,rewardInfos:o,programId:io(6)},m=this.createTxBuilder(),d=r!=null?r:this.scope.ownerPubKey,p=q.Keypair.generate(),y=await this.scope.connection.getMinimumBalanceForRentExemption(He.span);m.addInstruction({instructions:[q.SystemProgram.createAccount({fromPubkey:d,newAccountPubkey:p.publicKey,lamports:y,space:He.span,programId:c.programId})],signers:[p]});let{publicKey:f,nonce:b}=await ro({programId:c.programId,poolId:p.publicKey}),h=await ht({programId:c.programId,poolId:p.publicKey,mint:c.lpMint,type:"lpVault"}),S=[],g=[];for(let T of c.rewardInfos){T.rewardOpenTime>=T.rewardEndTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",T.rewardOpenTime.toString()),gt[T.rewardType]||this.logAndCreateError("rewardType error",T.rewardType),T.rewardPerSecond<=0&&this.logAndCreateError("rewardPerSecond error",T.rewardPerSecond.toString()),S.push(ao(T));let{rewardPubKey:F,newInstruction:N}=await this._getUserRewardInfo({rewardInfo:T,payer:d});N&&m.addInstruction(N),F||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let v=T.rewardMint.equals(U)?new q.PublicKey($.mint):T.rewardMint;g.push({rewardMint:v,rewardVault:await ht({programId:c.programId,poolId:p.publicKey,mint:v,type:"rewardVault"}),userRewardToken:F})}let k=await this.scope.account.getCreatedTokenAccount({mint:c.lockInfo.lockMint});k||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let _=oo({farmKeyPair:p,owner:this.scope.ownerPubKey,farmAuthority:f,lpVault:h,lpMint:c.lpMint,lockVault:c.lockInfo.lockVault,lockMint:c.lockInfo.lockMint,lockUserAccount:k,programId:c.programId,rewardInfo:g,rewardInfoConfig:S,nonce:b});return await m.addInstruction({instructions:[_]}).build()}async restartReward({farmId:t,payer:o,newRewardInfo:r}){let i=this.getFarm(t);i.version!==6&&this.logAndCreateError("invalid farm version",i.version);let a={id:new q.PublicKey(i.id),rewardInfos:i.rewardInfos,lpVault:new q.PublicKey(i.lpVault),programId:new q.PublicKey(i.programId)};r.rewardOpenTime>=r.rewardEndTime&&this.logAndCreateError("start time error","newRewardInfo",r);let u=o||this.scope.ownerPubKey,c=r.rewardMint.equals(U)?new q.PublicKey($.mint):r.rewardMint,m=a.rewardInfos.find(S=>new q.PublicKey(S.rewardMint).equals(c));m||this.logAndCreateError("configuration does not exist","rewardMint",c);let d=m.rewardVault?new q.PublicKey(m.rewardVault):U,p=this.createTxBuilder(),{rewardPubKey:y,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:r,payer:u});f&&p.addInstruction(f),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let b=Buffer.alloc(zt.span);zt.encode({instruction:3,rewardReopenTime:I(r.rewardOpenTime),rewardEndTime:I(r.rewardEndTime),rewardPerSecond:I(r.rewardPerSecond)},b);let h=[s({pubkey:qe.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:a.id}),s({pubkey:a.lpVault,isWritable:!1}),s({pubkey:d}),s({pubkey:y}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0})];return await p.addInstruction({instructions:[new q.TransactionInstruction({programId:a.programId,keys:h,data:b})]}).build()}async addNewRewardToken(t){let{farmId:o,newRewardInfo:r,payer:i}=t,a=this.getFarm(o);a.version!==6&&this.logAndCreateError("invalid farm version",a.version);let u=i!=null?i:this.scope.ownerPubKey,c=this.createTxBuilder(),m=await ht({programId:new q.PublicKey(a.programId),poolId:new q.PublicKey(a.id),mint:r.rewardMint,type:"rewardVault"}),{rewardPubKey:d,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:r,payer:u});p&&c.addInstruction(p),d||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts);let y=r.rewardMint.equals(U)?new q.PublicKey($.mint):r.rewardMint,f=Buffer.alloc(Zt.span);Zt.encode({instruction:4,isSet:new nn.default(1),rewardPerSecond:I(r.rewardPerSecond),rewardOpenTime:I(r.rewardOpenTime),rewardEndTime:I(r.rewardEndTime)},f);let b=[...De,s({pubkey:new q.PublicKey(a.id)}),s({pubkey:new q.PublicKey(a.authority),isWritable:!1}),s({pubkey:y,isWritable:!1}),s({pubkey:m}),s({pubkey:d}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0})];return await c.addInstruction({instructions:[new q.TransactionInstruction({programId:new q.PublicKey(a.programId),keys:b,data:f})]}).build()}async _prepareFarmAccounts(t){let o=this.createTxBuilder(),{farmInfo:r}=t,{pubKey:i,newInstructions:a}=await this.scope.account.checkOrCreateAta({mint:r.lpMint});o.addInstruction(a);let u=await Promise.all(r.rewardInfos.map(async({rewardMint:d})=>{let{pubKey:p,newInstructions:y}=await this.scope.account.checkOrCreateAta({mint:d,autoUnwrapWSOLToSOL:!0});return o.addInstruction(y),p})),c=await en({programId:new q.PublicKey(r.programId),poolId:new q.PublicKey(r.id),owner:this.scope.ownerPubKey});if(!r.ledger&&r.version<6){let d=await no({id:r.id,programId:r.programId,version:r.version,ledger:c,owner:this.scope.ownerPubKey});o.addInstruction({instructions:[d]})}let m=[s({pubkey:r.id}),s({pubkey:r.authority,isWritable:!1}),s({pubkey:c}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0}),s({pubkey:i}),s({pubkey:new q.PublicKey(r.jsonInfo.lpVault)}),s({pubkey:u[0]}),s({pubkey:r.rewardInfos[0].rewardVault}),s({pubkey:q.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),s({pubkey:qe.TOKEN_PROGRAM_ID,isWritable:!1})];return{txBuilder:o,lpTokenAccount:i,rewardTokenAccountsPublicKeys:u,ledgerAddress:c,lowVersionKeys:m}}async deposit(t){this.scope.checkOwner();let{farmId:o,amount:r}=t,i=this.getParsedFarm(o),a=i.lpMint,{version:u,rewardInfos:c}=i;Xt(u)||this.logAndCreateError("invalid farm version:",u);let{txBuilder:m,ledgerAddress:d,lpTokenAccount:p,lowVersionKeys:y,rewardTokenAccountsPublicKeys:f}=await this._prepareFarmAccounts({mint:a,farmInfo:i}),b=to({version:u,rewardInfos:c,rewardTokenAccountsPublicKeys:f});b&&this.logAndCreateError(b);let h=Buffer.alloc(ze.span);ze.encode({instruction:Xn(u),amount:I(r)},h);let S=u===6?[s({pubkey:qe.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:q.SystemProgram.programId,isWritable:!1}),s({pubkey:i.id}),s({pubkey:i.authority,isWritable:!1}),s({pubkey:i.lpVault.mint}),s({pubkey:d}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0}),s({pubkey:p})]:y;if(u!==3)for(let k=1;k<c.length;k++)S.push(s({pubkey:f[k]})),S.push(s({pubkey:c[k].rewardVault}));let g=new q.TransactionInstruction({programId:i.programId,keys:S,data:h});return await m.addInstruction({instructions:[g]}).build()}async withdraw(t){this.scope.checkOwner();let{farmId:o,amount:r}=t,i=this.getParsedFarm(o),a=i.lpMint,{version:u,rewardInfos:c}=i;Xt(u)||this.logAndCreateError("invalid farm version:",u);let{txBuilder:m,ledgerAddress:d,lpTokenAccount:p,lowVersionKeys:y,rewardTokenAccountsPublicKeys:f}=await this._prepareFarmAccounts({mint:a,farmInfo:i}),b=Buffer.alloc(ze.span);ze.encode({instruction:eo(u),amount:I(r)},b);let h=u===6?[s({pubkey:qe.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:i.id}),s({pubkey:i.authority,isWritable:!1}),s({pubkey:i.lpVault.mint}),s({pubkey:d}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0}),s({pubkey:p})]:y;if(u!==3)for(let g=1;g<c.length;g++)h.push(s({pubkey:f[g]})),h.push(s({pubkey:c[g].rewardVault}));let S=new q.TransactionInstruction({programId:i.programId,keys:h,data:b});return await m.addInstruction({instructions:[S]}).build()}async withdrawFarmReward({farmId:t,withdrawMint:o}){var y;this.scope.checkOwner();let r=this.getParsedFarm(t),{version:i}=r;i!==6&&this.logAndCreateError("invalid farm version",r.version);let a=r.rewardInfos.find(f=>f.rewardMint.equals(o.equals(U)?new q.PublicKey($.mint):o));a||this.logAndCreateError("withdraw mint error","rewardInfos",r);let u=(y=a==null?void 0:a.rewardVault)!=null?y:U,c=this.createTxBuilder(),m;if(this._getUserRewardInfo({payer:this.scope.ownerPubKey,rewardInfo:a}),o.equals(U)){let f=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:tn(a)});m=f.signers[0].publicKey,c.addInstruction(f)}else{let f=await this.scope.account.getCreatedTokenAccount({mint:o});f===null?(m=await this.scope.account.getAssociatedTokenAccount(o),c.addInstruction({instructions:[(0,qe.createAssociatedTokenAccountInstruction)(this.scope.ownerPubKey,m,this.scope.ownerPubKey,o)]})):m=f}let d=Buffer.alloc(Qt.span);Qt.encode({instruction:5},d);let p=[s({pubkey:qe.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:r.id}),s({pubkey:r.authority,isWritable:!1}),s({pubkey:r.lpVault.mint,isWritable:!1}),s({pubkey:u}),s({pubkey:m}),s({pubkey:this.scope.ownerPubKey,isWritable:!1,isSigner:!0})];return await c.addInstruction({instructions:[new q.TransactionInstruction({programId:r.programId,keys:p,data:d})]}).build()}};var Oi=require("@solana/web3.js"),he=H(require("bn.js"));var lo=require("@solana/web3.js"),po=H(require("bn.js")),fo=(c=>(c[c.Uninitialized=0]="Uninitialized",c[c.Initialized=1]="Initialized",c[c.Disabled=2]="Disabled",c[c.RemoveLiquidityOnly=3]="RemoveLiquidityOnly",c[c.LiquidityOnly=4]="LiquidityOnly",c[c.OrderBook=5]="OrderBook",c[c.Swap=6]="Swap",c[c.WaitingForStart=7]="WaitingForStart",c))(fo||{}),yo=new po.default(25),bo=new po.default(1e4),go="675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8",bi=new lo.PublicKey(go),Po="5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h",gi=new lo.PublicKey(Po),Ta={[go]:4,[Po]:5},ho={4:bi,5:gi},wo={4:3,5:3};var dn=require("@solana/spl-token"),le=require("@solana/web3.js");var on=R([D("instruction"),l("amountIn"),l("minAmountOut")]),rn=R([D("instruction"),l("maxAmountIn"),l("amountOut")]),an=R([D("instruction"),D("nonce")]),sn=R([D("instruction"),D("nonce"),l("startTime")]),un=R([l("status"),l("nonce"),l("maxOrder"),l("depth"),l("baseDecimal"),l("quoteDecimal"),l("state"),l("resetFlag"),l("minSize"),l("volMaxCutRatio"),l("amountWaveRatio"),l("baseLotSize"),l("quoteLotSize"),l("minPriceMultiplier"),l("maxPriceMultiplier"),l("systemDecimalValue"),l("minSeparateNumerator"),l("minSeparateDenominator"),l("tradeFeeNumerator"),l("tradeFeeDenominator"),l("pnlNumerator"),l("pnlDenominator"),l("swapFeeNumerator"),l("swapFeeDenominator"),l("baseNeedTakePnl"),l("quoteNeedTakePnl"),l("quoteTotalPnl"),l("baseTotalPnl"),z("quoteTotalDeposited"),z("baseTotalDeposited"),z("swapBaseInAmount"),z("swapQuoteOutAmount"),l("swapBase2QuoteFee"),z("swapQuoteInAmount"),z("swapBaseOutAmount"),l("swapQuote2BaseFee"),w("baseVault"),w("quoteVault"),w("baseMint"),w("quoteMint"),w("lpMint"),w("openOrders"),w("marketId"),w("marketProgramId"),w("targetOrders"),w("withdrawQueue"),w("lpVault"),w("owner"),l("lpReserve"),ee(l(),3,"padding")]),Pi=R([l("accountType"),l("status"),l("nonce"),l("maxOrder"),l("depth"),l("baseDecimal"),l("quoteDecimal"),l("state"),l("resetFlag"),l("minSize"),l("volMaxCutRatio"),l("amountWaveRatio"),l("baseLotSize"),l("quoteLotSize"),l("minPriceMultiplier"),l("maxPriceMultiplier"),l("systemDecimalsValue"),l("abortTradeFactor"),l("priceTickMultiplier"),l("priceTick"),l("minSeparateNumerator"),l("minSeparateDenominator"),l("tradeFeeNumerator"),l("tradeFeeDenominator"),l("pnlNumerator"),l("pnlDenominator"),l("swapFeeNumerator"),l("swapFeeDenominator"),l("baseNeedTakePnl"),l("quoteNeedTakePnl"),l("quoteTotalPnl"),l("baseTotalPnl"),l("poolOpenTime"),l("punishPcAmount"),l("punishCoinAmount"),l("orderbookToInitTime"),z("swapBaseInAmount"),z("swapQuoteOutAmount"),z("swapQuoteInAmount"),z("swapBaseOutAmount"),l("swapQuote2BaseFee"),l("swapBase2QuoteFee"),w("baseVault"),w("quoteVault"),w("baseMint"),w("quoteMint"),w("lpMint"),w("modelDataAccount"),w("openOrders"),w("marketId"),w("marketProgramId"),w("targetOrders"),w("owner"),ee(l(),64,"padding")]),cn=R([D("instruction"),l("baseAmountIn"),l("quoteAmountIn"),l("fixedSide")]),mn=R([D("instruction"),l("amountIn")]),ko={4:un,5:Pi};var hi=require("@solana/web3.js");var Pe=new hi.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ue=5e4,wi=R([l("x"),l("y"),l("price")]),ki=R([l("accountType"),l("status"),l("multiplier"),l("validDataCount"),ee(wi,Ue,"DataElement")]);function Aa(n,e){return[0,Ue-2]}function Ia(n){return[0,Ue-2]}function xa(n){return[0,Ue-2]}function Sa(n,e,t){let[o,r]=Aa(e,t),i=o,a=r,u=0,c=e*n.multiplier/t;for(;i<=a;){if(u=Math.floor((a+i)/2),u===0||u>=Ue-2)return[u,u,!1];let m=n.DataElement[u].x*n.multiplier/n.DataElement[u].y,d=n.DataElement[u-1].x*n.multiplier/n.DataElement[u-1].y,p=n.DataElement[u+1].x*n.multiplier/n.DataElement[u+1].y;if(c===m)return[u,u,!0];if(c===d)return[u-1,u-1,!0];if(c===p)return[u+1,u+1,!0];if(c<d)a=u-1;else{if(c>d&&c<m)return[u-1,u,!0];if(c>m&&c<p)return[u,u+1,!0];i=u+1}}return[u,u,!1]}function To(n,e,t){let[o,r,i]=Sa(n,e,t);if(!i)return 0;if(o===r){let a=n.DataElement[o].x;return e*n.multiplier/a}else{let a=n.DataElement[o].x,u=n.DataElement[o].y,c=n.DataElement[r].x,m=n.DataElement[r].y,d=t*(c*u-a*m),p=a*d,y=(c-a)*(e*u-a*t)*m,f=p+y;return e*n.multiplier*d/f}}function We(n,e,t){return e*n.multiplier/t}function Ti(n,e,t){return e*t/n.multiplier}function La(n,e){let[t,o]=Ia(e),r=t,i=o,a=0,u=e;for(;r<i;){if(a=Math.floor((i+r)/2),a<=0||a>Ue-2)return[a,a,!1];let c=n.DataElement[a].x,m=n.DataElement[a-1].x,d=n.DataElement[a+1].x;if(u===c)return[a,a,!0];if(u===m)return[a-1,a-1,!0];if(u===d)return[a+1,a+1,!0];if(u<m)i=a-1;else{if(u>m&&u<c)return[a-1,a,!0];if(u>c&&u<d)return[a,a+1,!0];r=a+1}}return[a,a,!1]}function _a(n,e){let[t,o]=xa(e),r=t,i=o,a=0,u=e;for(;r<=i;){if(a=Math.floor((i+r)/2),a<=0||a>=Ue-2)return[a,a,!1];let c=n.DataElement[a].y,m=n.DataElement[a-1].y,d=n.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===m)return[a-1,a-1,!0];if(u===d)return[a+1,a+1,!0];if(u<d)r=a+1;else{if(u<m&&u>c)return[a-1,a,!0];if(u<c&&u>d)return[a,a+1,!0];i=a-1}}return[a,a,!1]}function Ai(n,e,t,o){let r=o?e+t:e-t,[i,a,u]=La(n,r);if(!u)return[0,0,!1,u];if(i===a)return[n.DataElement[a].price,n.DataElement[a].y,!1,u];{let c=n.DataElement[i].x,m=n.DataElement[a].x,d=n.DataElement[i].price,p=n.DataElement[a].price,y=n.DataElement[i].y,f=n.DataElement[a].y;if(e>=c&&e<=m)return o?[p,f,!0,u]:[d,y,!0,u];{let b,h;return o?(b=d+(p-d)*(e-c)/(m-c),h=y-(r-c)*n.multiplier/p):(b=d+(p-d)*(e-c)/(m-c),h=f+(m-r)*n.multiplier/d),[b,h,!1,u]}}}function Ra(n,e,t,o){let r=o?e-t:e+t,[i,a,u]=_a(n,r);if(!u)return[0,0,!1,u];if(i===a)return[n.DataElement[a].price,n.DataElement[a].x,!1,u];{let c=n.DataElement[i].x,m=n.DataElement[a].x,d=n.DataElement[i].price,p=n.DataElement[a].price,y=n.DataElement[i].y,f=n.DataElement[a].y;if(e>=f&&e<=y)return o?[p,m,!0,u]:[d,c,!0,u];{let b,h;return o?(b=d+(p-d)*(y-e)/(y-f),h=c+p*(y-r)/n.multiplier):(b=d+(p-d)*(y-e)/(y-f),h=m-d*(r-f)/n.multiplier),[b,h,!1,u]}}}function Ma(n,e){let t=Ai(n,e,0,!1);return t[3]?t[0]:0}function Ao(n,e,t,o){let r=To(n,e,t),i=We(n,e,r),a=We(n,t,r),u=We(n,o,r),c=!0,[m,d,p,y]=Ai(n,i,u,c);if(!y)return 0;if(p)return o*n.multiplier/m;{let f=a-d;return Ti(n,f,r)}}function Io(n,e,t,o){let r=To(n,e,t),i=We(n,e,r),a=We(n,t,r),u=We(n,o,r),c=!1,[m,d,p,y]=Ra(n,a,u,c);if(!y)return 0;if(p)return o*m/n.multiplier;{let f=i-d;return Ti(n,f,r)}}function Ii(n){let e=ki.decode(n);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function xo(n,e,t,o){let r=Ma(n,We(n,e,To(n,e,t)))/n.multiplier;return o?r:1/r}var kt=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(Pe);e&&(this._layoutData=Ii(e==null?void 0:e.data))}}};var ln=M("Raydium_liquidity_instruction");function So(n){let{poolKeys:e,userKeys:t,amountIn:o,amountOut:r,fixedSide:i}=n,{version:a}=e;if(a===4||a===5){let u={poolKeys:e,userKeys:t};if(i==="in")return xi(K(L({},u),{amountIn:o,minAmountOut:r}),a);if(i==="out")return Si(K(L({},u),{maxAmountIn:o,amountOut:r}),a);ln.logWithError("invalid params","params",n)}throw ln.logWithError("invalid version","poolKeys.version",a),new Error("invalid version")}function Lo(n){let e=R([D("instruction"),D("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let o=[s({pubkey:n.id,isWritable:!1}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.openOrders,isWritable:!1}),s({pubkey:n.baseVault,isWritable:!1}),s({pubkey:n.quoteVault,isWritable:!1}),s({pubkey:n.lpMint,isWritable:!1}),s({pubkey:n.marketId,isWritable:!1})];return new le.TransactionInstruction({programId:n.programId,keys:o,data:t})}function xi({poolKeys:n,userKeys:e,amountIn:t,minAmountOut:o},r){let i=Buffer.alloc(on.span);on.encode({instruction:9,amountIn:I(t),minAmountOut:I(o)},i);let a=[s({pubkey:dn.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:n.id}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.openOrders})];return r===4&&a.push(s({pubkey:n.targetOrders})),a.push(s({pubkey:n.baseVault}),s({pubkey:n.quoteVault})),r===5&&a.push(s({pubkey:Pe})),a.push(s({pubkey:n.marketProgramId,isWritable:!1}),s({pubkey:n.marketId}),s({pubkey:n.marketBids}),s({pubkey:n.marketAsks}),s({pubkey:n.marketEventQueue}),s({pubkey:n.marketBaseVault}),s({pubkey:n.marketQuoteVault}),s({pubkey:n.marketAuthority,isWritable:!1}),s({pubkey:e.tokenAccountIn}),s({pubkey:e.tokenAccountOut}),s({pubkey:e.owner,isWritable:!1})),new le.TransactionInstruction({programId:n.programId,keys:a,data:i})}function Si({poolKeys:n,userKeys:e,maxAmountIn:t,amountOut:o},r){let i=Buffer.alloc(rn.span);rn.encode({instruction:11,maxAmountIn:I(t),amountOut:I(o)},i);let a=[s({pubkey:le.SystemProgram.programId,isWritable:!1}),s({pubkey:n.id}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.openOrders}),s({pubkey:n.targetOrders}),s({pubkey:n.baseVault}),s({pubkey:n.quoteVault})];return r===5&&a.push(s({pubkey:Pe})),a.push(s({pubkey:n.marketProgramId,isWritable:!1}),s({pubkey:n.marketId}),s({pubkey:n.marketBids}),s({pubkey:n.marketAsks}),s({pubkey:n.marketEventQueue}),s({pubkey:n.marketBaseVault}),s({pubkey:n.marketQuoteVault}),s({pubkey:n.marketAuthority,isWritable:!1}),s({pubkey:e.tokenAccountIn}),s({pubkey:e.tokenAccountOut}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})),new le.TransactionInstruction({programId:n.programId,keys:a,data:i})}function _o(n){let i=n,{owner:e}=i,t=ne(i,["owner"]),o=Buffer.alloc(an.span);an.encode({instruction:10,nonce:t.nonce},o);let r=[...De,s({pubkey:t.targetOrders}),s({pubkey:t.withdrawQueue}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.lpMint}),s({pubkey:t.baseMint,isWritable:!1}),s({pubkey:t.quoteMint,isWritable:!1}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault}),s({pubkey:t.lpVault}),s({pubkey:t.marketId,isWritable:!1}),s({pubkey:e,isSigner:!0})];return new le.TransactionInstruction({programId:t.programId,keys:r,data:o})}function Ro(n){let{poolKeys:e,userKeys:t,startTime:o}=n,r=Buffer.alloc(sn.span);sn.encode({instruction:0,nonce:e.nonce,startTime:I(o)},r);let i=[...De,s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.lpMint}),s({pubkey:e.baseMint,isWritable:!1}),s({pubkey:e.quoteMint,isWritable:!1}),s({pubkey:e.baseVault,isWritable:!1}),s({pubkey:e.quoteVault,isWritable:!1}),s({pubkey:e.withdrawQueue}),s({pubkey:e.targetOrders}),s({pubkey:t.lpTokenAccount}),s({pubkey:e.lpVault,isWritable:!1}),s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId,isWritable:!1}),s({pubkey:t.payer,isSigner:!0})];return new le.TransactionInstruction({programId:e.programId,keys:i,data:r})}function Mo(n){let{poolKeys:e,userKeys:t,baseAmountIn:o,quoteAmountIn:r,fixedSide:i}=n,{version:a}=e;if(a===4||a===5){let u=Buffer.alloc(cn.span);cn.encode({instruction:3,baseAmountIn:I(o),quoteAmountIn:I(r),fixedSide:I(i==="base"?0:1)},u);let c=[s({pubkey:dn.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders,isWritable:!1}),s({pubkey:e.targetOrders}),s({pubkey:e.lpMint}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault})];return a===5&&c.push(s({pubkey:Pe})),c.push(s({pubkey:e.marketId,isWritable:!1}),s({pubkey:t.baseTokenAccount}),s({pubkey:t.quoteTokenAccount}),s({pubkey:t.lpTokenAccount}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})),new le.TransactionInstruction({programId:e.programId,keys:c,data:u})}return ln.logWithError("invalid version","poolKeys.version",a),new le.TransactionInstruction({programId:e.programId,keys:[]})}function Bo(n){let{poolKeys:e,userKeys:t,amountIn:o}=n,{version:r}=e;if(r===4||r===5){let i=Buffer.alloc(mn.span);mn.encode({instruction:4,amountIn:I(o)},i);let a=[s({pubkey:dn.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.targetOrders}),s({pubkey:e.lpMint}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault})];return r===5?a.push(s({pubkey:Pe})):a.push(s({pubkey:e.withdrawQueue}),s({pubkey:e.lpVault})),a.push(s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId}),s({pubkey:e.marketBaseVault}),s({pubkey:e.marketQuoteVault}),s({pubkey:e.marketAuthority,isWritable:!1}),s({pubkey:t.lpTokenAccount}),s({pubkey:t.baseTokenAccount}),s({pubkey:t.quoteTokenAccount}),s({pubkey:t.owner,isWritable:!1,isSigner:!0}),s({pubkey:e.marketEventQueue}),s({pubkey:e.marketBids}),s({pubkey:e.marketAsks})),new le.TransactionInstruction({programId:e.programId,keys:a,data:i})}return ln.logWithError("invalid version","poolKeys.version",r),new le.TransactionInstruction({programId:e.programId,keys:[]})}var Ri=require("@project-serum/serum"),Xe=H(require("bn.js"));var Ko=require("@solana/web3.js");var Oo=M("Raydium_liquidity_serum"),qo="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",Li=new Ko.PublicKey(qo),Ba={[qo]:3},_i={3:Li};function Fo(n){let e=wo[n];return e||Oo.logWithError("invalid version","version",n),e}function No(n){let e=_i[n];return e||Oo.logWithError("invalid version","version",n),e}async function vo({programId:n,marketId:e}){let t=[e.toBuffer()],o=0,r;for(;o<100;){try{let i=t.concat(Buffer.from([o]),Buffer.alloc(7));r=await Ko.PublicKey.createProgramAddress(i,n)}catch(i){if(i instanceof TypeError)throw i;o++;continue}return{publicKey:r,nonce:o}}throw Oo.logWithError("unable to find a viable program address nonce","params",{programId:n,marketId:e}),new Error("unable to find a viable program address nonce")}var pn=M("Raydium_liquidity_util");function fn(n,e){let t=n instanceof O?n.token:J.WSOL,{baseMint:o,quoteMint:r}=e;if(t.mint.equals(o))return"base";if(t.mint.equals(r))return"quote";let i=`liquidity getTokenSide - token not match with pool, params: ${JSON.stringify({token:t.mint,baseMint:o,quoteMint:r})}`;throw console.error(i),new Error(i)}function Ge(n,e){let{baseMint:t,quoteMint:o}=e;return n.mint.equals(t)||n.mint.equals(o)}function yn(n){let{status:e,startTime:t}=n,o=e.toNumber();return{[0]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[1]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[2]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[3]:{swap:!1,addLiquidity:!1,removeLiquidity:!0},[4]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[5]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[6]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[7]:{swap:Date.now()/1e3>=t.toNumber(),addLiquidity:!0,removeLiquidity:!0}}[o]||{swap:!1,addLiquidity:!1,removeLiquidity:!1}}function Ka(n){let e=ko[n];return e||pn.logWithError("invalid version","version",n),e}function Mi(n){let e=ho[n];return e||pn.logWithError("invalid version","version",n),e}async function Se({name:n,programId:e,marketId:t}){let{publicKey:o}=await Ie([e.toBuffer(),t.toBuffer(),Buffer.from(n,"utf-8")],e);return o}async function Bi({programId:n}){return Ie([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],n)}async function bn({version:n,marketId:e,baseMint:t,quoteMint:o}){let r=Mi(n),[i,a,u]=[C({publicKey:e}),C({publicKey:t,transformSol:!0}),C({publicKey:o,transformSol:!0})],c=await Se({name:"amm_associated_seed",programId:r,marketId:i}),m=await Se({name:"lp_mint_associated_seed",programId:r,marketId:i}),{publicKey:d,nonce:p}=await Bi({programId:r}),y=await Se({name:"coin_vault_associated_seed",programId:r,marketId:i}),f=await Se({name:"pc_vault_associated_seed",programId:r,marketId:i}),b=await Se({name:"temp_lp_token_associated_seed",programId:r,marketId:i}),h=await Se({name:"open_order_associated_seed",programId:r,marketId:i}),S=await Se({name:"target_associated_seed",programId:r,marketId:i}),g=await Se({name:"withdraw_associated_seed",programId:r,marketId:i}),k=Fo(n),_=No(k),{publicKey:T}=await vo({programId:_,marketId:i});return{id:c,baseMint:a,quoteMint:u,lpMint:m,version:n,programId:r,authority:d,nonce:p,baseVault:y,quoteVault:f,lpVault:b,openOrders:h,targetOrders:S,withdrawQueue:g,marketVersion:k,marketProgramId:_,marketId:i,marketAuthority:T}}async function Eo({connection:n,pools:e}){let t=e.map(r=>Lo(r));return(await Nr(n,t,"GetPoolData")).map(r=>{let i=vr(r,"GetPoolData"),a=new Xe.default(Ae(i,"status")),u=Number(Ae(i,"coin_decimals")),c=Number(Ae(i,"pc_decimals")),m=Number(Ae(i,"lp_decimals")),d=new Xe.default(Ae(i,"pool_coin_amount")),p=new Xe.default(Ae(i,"pool_pc_amount")),y=new Xe.default(Ae(i,"pool_lp_supply")),f="0";try{f=Ae(i,"pool_open_time")}catch{f="0"}return{status:a,baseDecimals:u,quoteDecimals:c,lpDecimals:m,baseReserve:d,quoteReserve:p,lpSupply:y,startTime:new Xe.default(f)}})}function Vo(n,e,t){return Ki(n.token,e.token,t)}function Ki(n,e,t){let{baseMint:o,quoteMint:r}=t,i=Do(n,t),a=Do(e,t);return i===a&&pn.logWithError("tokens not match with pool","params",{tokenA:n.mint,tokenB:e.mint,baseMint:o,quoteMint:r}),[i,a]}function Do(n,e){let{baseMint:t,quoteMint:o}=e;return n.mint.equals(t)?"base":n.mint.equals(o)?"quote":(pn.logWithError("token not match with pool","params",{token:n.mint,baseMint:t,quoteMint:o}),"base")}var Co=n=>n==="a"||n==="b";async function Oa(n,e,t){let o=await n.getAccountInfo(e);if(o===null)return null;let r=un.decode(o.data),i=await n.getTokenAccountBalance(r.baseVault),a=await n.getTokenAccountBalance(r.quoteVault),u=await Ri.OpenOrders.load(n,r.openOrders,t),c=10**r.baseDecimal.toNumber(),m=10**r.quoteDecimal.toNumber(),d=u.baseTokenTotal.toNumber()/c,p=u.quoteTokenTotal.toNumber()/m,y=r.baseNeedTakePnl.toNumber()/c,f=r.quoteNeedTakePnl.toNumber()/m,b=i.value.uiAmount+d-y,h=a.value.uiAmount+p-f,S=parseFloat(r.lpReserve.toString()),g=b/h;return{baseAmount:b,quoteAmount:h,lpSupply:S,baseVaultKey:r.baseVault,quoteVaultKey:r.quoteVault,baseVaultBalance:i.value.uiAmount,quoteVaultBalance:a.value.uiAmount,openOrdersKey:r.openOrders,openOrdersTotalBase:d,openOrdersTotalQuote:p,basePnl:y,quotePnl:f,priceInQuote:g}}var Tt=class extends ie{constructor(t){super(t);this._poolInfos=[];this._poolInfoMap=new Map;this._pairsInfo=[];this._pairsInfoMap=new Map;this._lpTokenMap=new Map;this._lpPriceMap=new Map;this._officialIds=new Set;this._unOfficialIds=new Set;this._sdkParseInfoCache=new Map;this._stableLayout=new kt({connection:this.scope.connection})}async load(t){if(await this.scope.fetchLiquidity(t==null?void 0:t.forceUpdate),!this.scope.apiData.liquidityPools)return;let{data:o}=this.scope.apiData.liquidityPools,[r,i]=[o.official||[],o.unOfficial||[]];this._poolInfos=[...r,...i],this._officialIds=new Set(r.map(a=>{var c,m;let u=`${(c=this.scope.token.allTokenMap.get(a.baseMint))==null?void 0:c.symbol} - ${(m=this.scope.token.allTokenMap.get(a.quoteMint))==null?void 0:m.symbol}`;return this._poolInfoMap.set(a.id,a),this._lpTokenMap.set(a.lpMint,new J({mint:a.lpMint,decimals:a.lpDecimals,symbol:u,name:`${u} LP`})),a.id})),this._unOfficialIds=new Set(i.map(a=>{var c,m;let u=`${(c=this.scope.token.allTokenMap.get(a.baseMint))==null?void 0:c.symbol} - ${(m=this.scope.token.allTokenMap.get(a.quoteMint))==null?void 0:m.symbol}`;return this._poolInfoMap.set(a.id,a),this._lpTokenMap.set(a.lpMint,new J({mint:a.lpMint,decimals:a.lpDecimals,symbol:u,name:`${u} LP`})),a.id}))}async loadPairs(t){var o;return await this.scope.fetchPairs(t==null?void 0:t.forceUpdate),this._pairsInfo=((o=this.scope.apiData.liquidityPairsInfo)==null?void 0:o.data)||[],this._pairsInfoMap=new Map(this._pairsInfo.map(r=>{let i=this._lpTokenMap.get(r.lpMint),a=i&&r.lpPrice?ut({token:i,numberPrice:r.lpPrice,decimalDone:!0}):null;return a&&this._lpPriceMap.set(r.lpMint,a),[r.ammId,r]})),this._pairsInfo}get allPools(){return this._poolInfos}get allPoolIdSet(){return{official:this._officialIds,unOfficial:this._unOfficialIds}}get allPoolMap(){return this._poolInfoMap}get allPairs(){return this._pairsInfo}get allPairsMap(){return this._pairsInfoMap}get lpTokenMap(){return this._lpTokenMap}get lpPriceMap(){return this._lpPriceMap}async fetchMultipleInfo(t){return await this._stableLayout.initStableModelLayout(),await Eo(K(L({},t),{connection:this.scope.connection}))}async sdkParseJsonLiquidityInfo(t){if(!t.length)return[];let o=t.map(r=>r.id).join("-");if(this._sdkParseInfoCache.has(o))return this._sdkParseInfoCache.get(o);try{let i=(await this.fetchMultipleInfo({pools:t.map(pe)})).map((a,u)=>L(L({jsonInfo:t[u]},pe(t[u])),a));return this._sdkParseInfoCache.set(o,i),i}catch(r){return console.error(r),[]}}computeAmountOut({poolKeys:t,poolInfo:o,amountIn:r,outputToken:i,slippage:a}){this.checkDisabled();let u=M("Raydium_computeAmountOut"),c=r.token,m=i;(!Ge(c,t)||!Ge(m,t))&&u.logWithError("token not match with pool","poolKeys",t);let{baseReserve:d,quoteReserve:p}=o;this.logDebug("baseReserve:",d.toString(),"quoteReserve:",p.toString());let y=r.token;this.logDebug("inputToken:",y),this.logDebug("amountIn:",r.toFixed()),this.logDebug("outputToken:",i),this.logDebug("slippage:",`${a.toSignificant()}%`);let f=[d,p],b=fn(r,t);b==="quote"&&f.reverse(),this.logDebug("input side:",b);let[h,S]=f,g;if(t.version===4)g=new Z({baseToken:y,denominator:h,quoteToken:i,numerator:S});else{let Q=xo(this._stableLayout.stableModelData,d.toNumber(),p.toNumber(),!1);g=new Z({baseToken:y,denominator:b==="quote"?new he.default(Q*1e6):new he.default(1e6),quoteToken:i,numerator:b==="quote"?new he.default(1e6):new he.default(Q*1e6)})}this.logDebug("currentPrice:",`1 ${y.symbol} \u2248 ${g.toFixed()} ${i.symbol}`),this.logDebug("currentPrice invert:",`1 ${i.symbol} \u2248 ${g.invert().toFixed()} ${y.symbol}`);let k=r.raw,_=ue,T=ue;if(!k.isZero())if(t.version===4){T=k.mul(yo).div(bo);let Q=k.sub(T),oe=h.add(Q);_=S.mul(Q).div(oe)}else{T=k.mul(new he.default(2)).div(new he.default(1e4));let Q=k.sub(T),oe=b==="quote"?Ao:Io;_=new he.default(oe(this._stableLayout.stableModelData,p.toNumber(),d.toNumber(),Q.toNumber()))}let N=new re(be).add(a).invert().mul(_).quotient,v=new O(i,_),Y=new O(i,N);this.logDebug("amountOut:",v.toFixed(),"minAmountOut:",Y.toFixed());let E=new Z({baseToken:y,denominator:k.sub(T),quoteToken:i,numerator:_});!k.isZero()&&!_.isZero()&&(E=new Z({baseToken:y,denominator:k.sub(T),quoteToken:i,numerator:_}),this.logDebug("executionPrice:",`1 ${y.symbol} \u2248 ${E.toFixed()} ${i.symbol}`),this.logDebug("executionPrice invert:",`1 ${i.symbol} \u2248 ${E.invert().toFixed()} ${y.symbol}`));let G=new re(parseInt(String(Math.abs(parseFloat(E.toFixed())-parseFloat(g.toFixed()))*1e9)),parseInt(String(parseFloat(g.toFixed())*1e9))),te=new O(y,T);return{amountOut:v,minAmountOut:Y,currentPrice:g,executionPrice:E,priceImpact:G,fee:te}}async computePairAmount({poolId:t,amount:o,anotherToken:r,slippage:i}){let a=C({publicKey:t}),u=this._poolInfoMap.get(a.toBase58());u||this.logAndCreateError("pool not found",a.toBase58());let c=(await this.sdkParseJsonLiquidityInfo([u]))[0];c||this.logAndCreateError("pool parseInfo not found",a.toBase58());let{baseReserve:m,quoteReserve:d}=c;this.logDebug("baseReserve:",m.toString(),"quoteReserve:",d.toString());let p=o.token;this.logDebug("tokenIn:",p,"amount:",o.toFixed(),"anotherToken:",r,"slippage:",`${i.toSignificant()}%`);let y=fn(o,pe(u));this.logDebug("input side:",y);let f=ue;o.isZero()||(f=y==="base"?In(o.raw.mul(d),m):In(o.raw.mul(m),d));let h=new re(be).add(i).mul(f).quotient,S=new O(r,f),g=new O(r,h);return this.logDebug("anotherAmount:",S.toFixed(),"maxAnotherAmount:",g.toFixed()),{anotherAmount:S,maxAnotherAmount:g}}async swapWithAMM(t){let{poolKeys:o,payer:r,amountIn:i,amountOut:a,fixedSide:u,config:c}=t;this.logDebug("amountIn:",i),this.logDebug("amountOut:",a),(i.isZero()||a.isZero())&&this.logAndCreateError("amounts must greater than zero","amounts",{amountIn:i.toFixed(),amountOut:a.toFixed()});let{account:m}=this.scope,d=this.createTxBuilder(),{bypassAssociatedCheck:p=!1}=c||{},[y,f]=[i.token,a.token],b=await m.getCreatedTokenAccount({mint:y.mint,associatedOnly:!1}),h=await m.getCreatedTokenAccount({mint:f.mint}),[S,g]=[i.raw,a.raw],N=await m.handleTokenAccount({side:"in",amount:S,mint:y.mint,tokenAccount:b,bypassAssociatedCheck:p}),{tokenAccount:k}=N,_=ne(N,["tokenAccount"]);d.addInstruction(_);let v=await m.handleTokenAccount({side:"out",amount:0,mint:f.mint,tokenAccount:h,payer:r,bypassAssociatedCheck:p}),{tokenAccount:T}=v,F=ne(v,["tokenAccount"]);return d.addInstruction(F),d.addInstruction({instructions:[So({poolKeys:o,userKeys:{tokenAccountIn:k,tokenAccountOut:T,owner:this.scope.ownerPubKey},amountIn:S,amountOut:g,fixedSide:u})]}),d.buildMultiTx({extInfo:{amountOut:a}})}async createPool(t){this.checkDisabled(),this.scope.checkOwner(),t.version!==4&&this.logAndCreateError("invalid version","poolKeys.version",t.version);let o=this.createTxBuilder(),r=await bn(t);return await o.addInstruction({instructions:[_o(K(L({},r),{owner:this.scope.ownerPubKey}))]}).build()}async initPool(t){t.version!==4&&this.logAndCreateError("invalid version","poolKeys.version",t.version);let{baseAmount:o,quoteAmount:r,startTime:i=0,config:a}=t,u=await bn(t),{baseMint:c,quoteMint:m,lpMint:d,baseVault:p,quoteVault:y}=u,f=this.createTxBuilder(),{account:b}=this.scope,h=!!(a!=null&&a.bypassAssociatedCheck),S=await b.getCreatedTokenAccount({mint:c,associatedOnly:!1}),g=await b.getCreatedTokenAccount({mint:m,associatedOnly:!1});!S&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",b.tokenAccounts);let k=await b.getCreatedTokenAccount({mint:d,associatedOnly:!1}),E=await b.handleTokenAccount({side:"in",amount:o.raw,mint:c,tokenAccount:S,bypassAssociatedCheck:h}),{tokenAccount:_}=E,T=ne(E,["tokenAccount"]);f.addInstruction(T);let G=await b.handleTokenAccount({side:"in",amount:r.raw,mint:m,tokenAccount:g,bypassAssociatedCheck:h}),{tokenAccount:F}=G,N=ne(G,["tokenAccount"]);f.addInstruction(N);let te=await b.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:k,bypassAssociatedCheck:h}),{tokenAccount:v}=te,Y=ne(te,["tokenAccount"]);return f.addInstruction(Y),f.addInstruction({instructions:[Ve({source:_,destination:p,owner:this.scope.ownerPubKey,amount:o.raw}),Ve({source:F,destination:y,owner:this.scope.ownerPubKey,amount:r.raw}),Ro({poolKeys:u,userKeys:{lpTokenAccount:v,payer:this.scope.ownerPubKey},startTime:i})]}),await f.build()}async addLiquidity(t){let{poolId:o,amountInA:r,amountInB:i,fixedSide:a,config:u}=t,c=C({publicKey:o}),m=this.allPools.find(Ot=>Ot.id===c.toBase58());m||this.logAndCreateError("pool not found",o);let p=(await this.sdkParseJsonLiquidityInfo([m]))[0];p||this.logAndCreateError("pool parse error",p),this.logDebug("amountInA:",r,"amountInB:",i),(r.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:r.toFixed(),amountInB:i.toFixed()});let{account:y}=this.scope,f=(u==null?void 0:u.bypassAssociatedCheck)||!1,[b,h]=[r.token,i.token],S=await y.getCreatedTokenAccount({mint:b.mint,associatedOnly:!1}),g=await y.getCreatedTokenAccount({mint:h.mint,associatedOnly:!1});!S&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",y.tokenAccounts);let k=await y.getCreatedTokenAccount({mint:p.lpMint}),_=[b,h],T=[S,g],F=[r.raw,i.raw],[N]=Vo(r,i,p),v="base";(!["quote","base"].includes(N)||!Co(a))&&this.logAndCreateError("invalid fixedSide","fixedSide",a),N==="quote"?(_.reverse(),T.reverse(),F.reverse(),v=a==="a"?"quote":"base"):N==="base"&&(v=a==="a"?"base":"quote");let[Y,E]=_,[G,te]=T,[Q,oe]=F,ae=this.createTxBuilder(),nt=await y.handleTokenAccount({side:"in",amount:Q,mint:Y.mint,tokenAccount:G,bypassAssociatedCheck:f}),{tokenAccount:Le}=nt,de=ne(nt,["tokenAccount"]);ae.addInstruction(de);let ot=await y.handleTokenAccount({side:"in",amount:oe,mint:E.mint,tokenAccount:te,bypassAssociatedCheck:f}),{tokenAccount:we}=ot,ye=ne(ot,["tokenAccount"]);ae.addInstruction(ye);let rt=await y.handleTokenAccount({side:"out",amount:0,mint:p.lpMint,tokenAccount:k,bypassAssociatedCheck:f}),{tokenAccount:Bt}=rt,Kt=ne(rt,["tokenAccount"]);return ae.addInstruction(Kt),ae.addInstruction({instructions:[Mo({poolKeys:p,userKeys:{baseTokenAccount:Le,quoteTokenAccount:we,lpTokenAccount:Bt,owner:this.scope.ownerPubKey},baseAmountIn:Q,quoteAmountIn:oe,fixedSide:v})]}),await ae.build()}async removeLiquidity(t){let{poolId:o,amountIn:r,config:i}=t,a=C({publicKey:o}),u=this.allPools.find(E=>E.id===a.toBase58());u||this.logAndCreateError("pool not found",o);let m=(await this.sdkParseJsonLiquidityInfo([u]))[0];m||this.logAndCreateError("pool pass error",m);let{baseMint:d,quoteMint:p,lpMint:y}=m;this.logDebug("amountIn:",r),r.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",r.toFixed()),r.token.mint.equals(y)||this.logAndCreateError("amountIn's token not match lpMint","amountIn",r);let{account:f}=this.scope,b=await f.getCreatedTokenAccount({mint:y,associatedOnly:!1});b||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",f.tokenAccounts);let h=await f.getCreatedTokenAccount({mint:d}),S=await f.getCreatedTokenAccount({mint:p}),g=this.createTxBuilder(),k=(i==null?void 0:i.bypassAssociatedCheck)||!1,v=await f.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:h,bypassAssociatedCheck:k}),{tokenAccount:_}=v,T=ne(v,["tokenAccount"]);g.addInstruction(T);let Y=await f.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:S,bypassAssociatedCheck:k}),{tokenAccount:F}=Y,N=ne(Y,["tokenAccount"]);return g.addInstruction(N),g.addInstruction({instructions:[Oi.ComputeBudgetProgram.requestUnits({units:4e5,additionalFee:0}),Bo({poolKeys:m,userKeys:{lpTokenAccount:b,baseTokenAccount:_,quoteTokenAccount:F,owner:this.scope.ownerPubKey},amountIn:r.raw})]}),await g.build()}lpMintToTokenAmount({poolId:t,amount:o,decimalDone:r}){let i=C({publicKey:t});i||this.logAndCreateError("pool not found");let a=this._poolInfoMap.get(i.toBase58()),u=ce(o),c=new J({mint:a.lpMint,decimals:a.lpDecimals}),m=r?new A(u.numerator,u.denominator):new A(u.numerator,u.denominator).mul(new he.default(10).pow(new he.default(c.decimals)));return new O(c,_e(m))}getFixedSide({poolId:t,inputMint:o}){let[r,i]=[C({publicKey:t}),C({publicKey:o})],a=this._poolInfoMap.get(r.toBase58());a||this.logAndCreateError("pool not found",r.toBase58());let u=a.baseMint===i.toBase58();return(i.equals(Re)||i.equals(U))&&(u=!u),u?"a":"b"}};var $o=require("@solana/web3.js"),St=require("lodash");var qi=require("@solana/web3.js");var Fi="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",et=new qi.PublicKey(Fi),Wo=["amm","serum","route"],Uo=[Sr,Vt,Re,_r,xr,Rr,Mr,Lr,Br].map(n=>n.toBase58());var xt=require("@solana/spl-token"),tt=require("@solana/web3.js");var At=R([D("instruction"),l("amountIn"),l("amountOut")]),It=R([D("instruction")]);var qa=M("Raydium_route_instruction");function Go(n){let{fixedSide:e}=n;if(e==="in")return[Ni(n),vi(n)];throw qa.logWithError("invalid params","params",n),new Error(`invalid params, params: ${n}`)}function Ni({fromPoolKeys:n,toPoolKeys:e,userKeys:t,amountIn:o,amountOut:r}){let i=Buffer.alloc(At.span),a;return n.version===4?(At.encode({instruction:0,amountIn:I(o),amountOut:I(r)},i),a=[s({pubkey:tt.SystemProgram.programId,isWritable:!1}),s({pubkey:xt.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:n.programId,isWritable:!1}),s({pubkey:n.id}),s({pubkey:e.id,isWritable:!1}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.openOrders}),s({pubkey:n.baseVault}),s({pubkey:n.quoteVault}),s({pubkey:n.marketProgramId,isWritable:!1}),s({pubkey:n.marketId}),s({pubkey:n.marketBids}),s({pubkey:n.marketAsks}),s({pubkey:n.marketEventQueue}),s({pubkey:n.marketBaseVault}),s({pubkey:n.marketQuoteVault}),s({pubkey:n.marketAuthority,isWritable:!1}),s({pubkey:t.inTokenAccount}),s({pubkey:t.middleTokenAccount}),s({pubkey:t.middleStatusAccount}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})]):(At.encode({instruction:2,amountIn:I(o),amountOut:I(r)},i),a=[s({pubkey:tt.SystemProgram.programId,isWritable:!1}),s({pubkey:xt.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:n.programId,isWritable:!1}),s({pubkey:n.id}),s({pubkey:e.id,isWritable:!1}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.openOrders}),s({pubkey:n.baseVault}),s({pubkey:n.quoteVault}),s({pubkey:Pe,isWritable:!1}),s({pubkey:n.marketProgramId,isWritable:!1}),s({pubkey:n.marketId}),s({pubkey:n.marketBids}),s({pubkey:n.marketAsks}),s({pubkey:n.marketEventQueue}),s({pubkey:n.id}),s({pubkey:n.id}),s({pubkey:n.id}),s({pubkey:t.inTokenAccount}),s({pubkey:t.middleTokenAccount}),s({pubkey:t.middleStatusAccount}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})]),new tt.TransactionInstruction({programId:et,keys:a,data:i})}function vi({fromPoolKeys:n,toPoolKeys:e,userKeys:t}){let o=Buffer.alloc(It.span),r;return e.version===4?(It.encode({instruction:1},o),r=[s({pubkey:xt.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.programId,isWritable:!1}),s({pubkey:n.id,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault}),s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId}),s({pubkey:e.marketBids}),s({pubkey:e.marketAsks}),s({pubkey:e.marketEventQueue}),s({pubkey:e.marketBaseVault}),s({pubkey:e.marketQuoteVault}),s({pubkey:e.marketAuthority,isWritable:!1}),s({pubkey:t.middleTokenAccount}),s({pubkey:t.outTokenAccount}),s({pubkey:t.middleStatusAccount}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})]):(It.encode({instruction:3},o),r=[s({pubkey:xt.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.programId,isWritable:!1}),s({pubkey:n.id,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault}),s({pubkey:Pe,isWritable:!1}),s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId}),s({pubkey:e.marketBids}),s({pubkey:e.marketAsks}),s({pubkey:e.marketEventQueue}),s({pubkey:e.id}),s({pubkey:e.id}),s({pubkey:e.id}),s({pubkey:t.middleTokenAccount}),s({pubkey:t.outTokenAccount}),s({pubkey:t.middleStatusAccount}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})]),new tt.TransactionInstruction({programId:et,keys:r,data:o})}async function Jo({programId:n,fromPoolId:e,middleMint:t,owner:o}){let{publicKey:r}=await Ie([e.toBuffer(),t.toBuffer(),o.toBuffer()],n);return r}var Lt=class extends ie{constructor(e){super(e)}computeRouteAmountOut({fromPoolKeys:e,toPoolKeys:t,fromPoolInfo:o,toPoolInfo:r,amountIn:i,outputToken:a,slippage:u}){let{swap:c}=yn(o),{swap:m}=yn(r);(!c||!m)&&this.logAndCreateError("pools swap not enabled","pools",{fromPoolKeys:e,toPoolKeys:t,fromPoolInfo:o,toPoolInfo:r});let d=i.token,p=a;(!Ge(d,e)||!Ge(p,t))&&this.logAndCreateError("pools cannot be routed","pools",{fromPoolKeys:e,toPoolKeys:t});let y=[e.baseMint.toBase58(),e.quoteMint.toBase58()],f=[t.baseMint.toBase58(),t.quoteMint.toBase58()],b=[...y,...f],h=[o.baseDecimals,o.quoteDecimals,r.baseDecimals,r.quoteDecimals],[S,g]=[d.mint.toBase58(),p.mint.toBase58()],k=(0,St.xor)(y,f);(k.length!==2||!k.includes(S)||!k.includes(g))&&this.logAndCreateError("xor tokens not match","pools",{fromPoolKeys:e,toPoolKeys:t});let _=(0,St.intersection)(y,f);_.length!==1&&this.logAndCreateError("cannot found middle token of two pools","pools",{fromPoolKeys:e,toPoolKeys:t});let T=_[0],F=b.indexOf(T);F===-1&&this.logAndCreateError("cannot found middle token","pools",{fromPoolKeys:e,toPoolKeys:t});let N=h[F],v=new $o.PublicKey(T),Y=new J({mint:v,decimals:N});this.logInfo("from pool:",e),this.logInfo("to pool:",t),this.logInfo("intersection mints:",_),this.logInfo("xor mints:",k),this.logInfo("middleMint:",T);let{minAmountOut:E,priceImpact:G,fee:te}=this.scope.liquidity.computeAmountOut({poolKeys:e,poolInfo:o,amountIn:i,outputToken:Y,slippage:u}),{amountOut:Q,minAmountOut:oe,priceImpact:ae,fee:Le}=this.scope.liquidity.computeAmountOut({poolKeys:t,poolInfo:r,amountIn:E,outputToken:a,slippage:u}),de=null,[we,ye]=[i.raw,Q.raw];return!we.isZero()&&!ye.isZero()&&(de=new Z({baseToken:d,denominator:we,quoteToken:a,numerator:ye}),this.logDebug("executionPrice:",`1 ${d.symbol} \u2248 ${de.toFixed()} ${a.symbol}`),this.logDebug("executionPrice invert:",`1 ${a.symbol} \u2248 ${de.invert().toFixed()} ${d.symbol}`)),{amountOut:Q,minAmountOut:oe,executionPrice:de,priceImpact:G.add(ae),fee:[te,Le]}}async swapWithRoute(e){let{fromPoolKeys:t,toPoolKeys:o,amountIn:r,amountOut:i,fixedSide:a,config:u}=e;this.logDebug("amountIn:",r,"amountOut:",i),(r.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amounts",{amountIn:r.toFixed(),amountOut:i.toFixed()});let{account:c}=this.scope,{bypassAssociatedCheck:m=!1}=u||{},[d,p]=[r.token,i.token],y=await this.scope.account.getCreatedTokenAccount({mint:d.mint,associatedOnly:!1}),f=await this.scope.account.getCreatedTokenAccount({mint:p.mint}),b=[t.baseMint.toBase58(),t.quoteMint.toBase58()],h=[o.baseMint.toBase58(),o.quoteMint.toBase58()],g=(0,St.intersection)(b,h)[0],k=new $o.PublicKey(g),_=await this.scope.account.getCreatedTokenAccount({mint:k}),[T,F]=[r.raw,i.raw],N=this.createTxBuilder(),v=this.createTxBuilder(),de=await c.handleTokenAccount({side:"in",amount:T,mint:d.mint,tokenAccount:y,bypassAssociatedCheck:m,skipCloseAccount:!0}),{tokenAccount:Y}=de,E=ne(de,["tokenAccount"]);N.addInstruction(E);let we=await c.handleTokenAccount({side:"out",amount:0,mint:p.mint,tokenAccount:f,bypassAssociatedCheck:m,skipCloseAccount:!0}),{tokenAccount:G}=we,te=ne(we,["tokenAccount"]);N.addInstruction(te);let ye=await c.handleTokenAccount({side:"in",amount:0,mint:k,tokenAccount:_,bypassAssociatedCheck:m,skipCloseAccount:!0}),{tokenAccount:Q}=ye,oe=ne(ye,["tokenAccount"]);N.addInstruction(oe),v.addInstruction({instructions:Go({fromPoolKeys:t,toPoolKeys:o,userKeys:{inTokenAccount:Y,outTokenAccount:G,middleTokenAccount:Q,middleStatusAccount:await Jo({programId:et,fromPoolId:t.id,middleMint:k,owner:this.scope.ownerPubKey}),owner:this.scope.ownerPubKey},amountIn:T,amountOut:F,fixedSide:a})});let ae=N.build();return await v.buildMultiTx({extraPreBuildData:[ae],extInfo:{amountOut:F}})}};var Di=require("@solana/web3.js"),Yo=H(require("bn.js"));var gn=R([Ee("mintAuthorityOption"),w("mintAuthority"),l("supply"),D("decimals"),D("isInitialized"),Ee("freezeAuthorityOption"),w("freezeAuthority")]);function jo(n,e){return n.sort((t,o)=>{let{official:r,unOfficial:i}=e,a=new Set(r),u=new Set(i),c=p=>a.has(p.mint)?1:u.has(p.mint)?2:3,m=c(t)-c(o),d=p=>!/^[a-zA-Z]/.test(p);if(m===0){let p=d(t.symbol),y=d(o.symbol);return p&&!y?1:!p&&y?-1:t.symbol.localeCompare(o.symbol)}else return m})}async function Fa(n,e){try{if(!n)return;let t=await n.getAccountInfo(C({publicKey:e}));return!t||t.data.length!==gn.span?void 0:gn.decode(t.data)}catch{return}}var _t=class extends ie{constructor(t){super(t);this._tokens=[];this._tokenMap=new Map;this._tokenPrice=new Map;this._mintList={official:[],unOfficial:[],unNamed:[]}}async load(t){this.checkDisabled(),await this.scope.fetchTokens(t==null?void 0:t.forceUpdate),this._mintList={official:[],unOfficial:[],unNamed:[]},this._tokens=[],this._tokenMap=new Map;let{data:o}=this.scope.apiData.tokens||{data:{official:[],unOfficial:[],unNamed:[],blacklist:[]}},r=new Set(o.blacklist);[o.official,o.unOfficial,o.unNamed].forEach((i,a)=>{i.forEach(u=>{let c=["official","unOfficial","unNamed"][a];!r.has(u.mint)&&u.mint!==U.toBase58()&&(this._tokens.push(K(L({},u),{symbol:u.symbol||"",name:u.name||""})),this._mintList[c].push(u.mint))})}),this._mintList.official.push($e.mint.toBase58()),this._tokens=jo(this._tokens,this._mintList),this._tokens.push(K(L({},$e),{mint:U.toBase58()})),this._tokens.forEach(i=>{this._tokenMap.set(i.mint,K(L({},i),{id:i.mint}))}),this._tokenMap.set($.mint,K(L({},$),{icon:$e.icon,id:"wsol"})),this._tokenMap.set(U.toBase58(),K(L({},$e),{mint:U.toBase58()}))}get allTokens(){return this._tokens}get allTokenMap(){return this._tokenMap}get tokenMints(){return this._mintList}get tokenPrices(){return this._tokenPrice}async fetchTokenPrices(t){let o=this.allTokens.filter(m=>{var d;return!!((d=m.extensions)!=null&&d.coingeckoId)&&m.mint!==Di.PublicKey.default.toBase58()}),r=o.map(m=>m.extensions.coingeckoId),i=await this.scope.api.getCoingeckoPrice(r),a=o.reduce((m,d)=>i[d.extensions.coingeckoId].usd?K(L({},m),{[d.mint]:ut({token:this._tokenMap.get(d.mint),numberPrice:i[d.extensions.coingeckoId].usd,decimalDone:!0})}):m,{}),u=t||await this.scope.api.getRaydiumTokenPrice(),c=Object.keys(u).reduce((m,d)=>this._tokenMap.get(d)?K(L({},m),{[d]:ut({token:this._tokenMap.get(d),numberPrice:u[d],decimalDone:!0})}):m,{});return this._tokenPrice=new Map([...Object.entries(a),...Object.entries(c)]),this._tokenPrice}mintToToken(t){let o=C({publicKey:t,transformSol:!0}),r=this.allTokenMap.get(o.toBase58());r||this.logAndCreateError("token not found, mint:",o.toBase58());let{decimals:i,name:a,symbol:u}=r;return new J({mint:t,decimals:i,name:a,symbol:u})}mintToTokenAmount({mint:t,amount:o,decimalDone:r}){let i=this.mintToToken(t);return r?new O(i,I(o)):new O(i,this.decimalAmount({mint:t,amount:o,decimalDone:r}))}decimalAmount({mint:t,amount:o}){let r=ce(o),i=this.mintToToken(t);return _e(new A(r.numerator,r.denominator).mul(new Yo.default(10**i.decimals)))}uiAmount({mint:t,amount:o}){let r=ce(o),i=this.mintToToken(t);return i?new A(r.numerator,r.denominator).div(new Yo.default(10**i.decimals)).toSignificant(i.decimals):""}};function Qo(n){let e=[];for(let t=0;t<n.length;t++)for(let o=0;o<n.length;o++)t!=o&&e.push([n[t],n[o]]);return e}var Rt=class extends ie{async load(){this.checkDisabled(),await this.scope.fetchLiquidity()}async _getBestSwapPool({availablePools:e,officialPoolIdSet:t}){if(e.length===0)return;if(e.length===1)return e[0];let o=e.filter(a=>t.has(a.id));return o.length===1?o[0]:(await this.scope.liquidity.sdkParseJsonLiquidityInfo(o.length?o:e)).reduce((a,u)=>{let c=a.version===5,m=u.version===5;return c&&!m?a:!c&&m?u:Cr(Bn(a.lpSupply,10**a.lpDecimals),Bn(u.lpSupply,10**u.lpDecimals))?a:u}).jsonInfo}async getAvailablePools(e){this.checkDisabled();let{inputMint:t,outputMint:o}=e,[r,i]=[C({publicKey:t,transformSol:!0}).toBase58(),C({publicKey:o,transformSol:!0}).toBase58()],a=this.scope.liquidity.allPools.filter(p=>p.baseMint===r&&p.quoteMint===i||p.baseMint===i&&p.quoteMint===r),u=new Set([...Uo,r,i]),c=new Set(JSON.parse(JSON.stringify([...u])));c.delete(r),c.delete(i);let m=this.scope.liquidity.allPools.filter(p=>{let y=u.has(p.baseMint)&&u.has(p.quoteMint),f=c.has(p.baseMint)&&c.has(p.quoteMint);return y&&!f}),d=await this._getBestSwapPool({availablePools:a,officialPoolIdSet:this.scope.liquidity.allPoolIdSet.official});return{availablePools:a,best:d,routedPools:m}}async getBestAmountOut({pools:e,amountIn:t,inputToken:o,outputToken:r,slippage:i,features:a}){if(this.checkDisabled(),!e){let{routedPools:_}=await this.getAvailablePools({inputMint:o.mint,outputMint:r.mint});e=_}let u=await this.scope.liquidity.sdkParseJsonLiquidityInfo(e||[]),c=(e||[]).map((_,T)=>({poolKeys:pe(_),poolInfo:u[T]})),m=a||Wo;this.logDebug("features:",m),c.length||this.logAndCreateError("please provide at least one source of trade or (inputMint & outputMint)",c);let d=[],p="amm",y=new O(o,t),f=new O(r,0),b=f,h=null,S=null,g=new re(ue),k=[];if(m.includes("amm"))for(let{poolKeys:_,poolInfo:T}of c)try{let{amountOut:F,minAmountOut:N,currentPrice:v,executionPrice:Y,priceImpact:E,fee:G}=this.scope.liquidity.computeAmountOut({poolKeys:_,poolInfo:T,amountIn:y,outputToken:r,slippage:i});F.gt(f)&&(console.log("amm",T),d=[{source:"amm",keys:_}],p="amm",f=F,b=N,h=v,S=Y,g=E,k=[G])}catch{}if(m.includes("route")){let _=Qo(c);for(let T of _){if(T.length!==2)continue;let[F,N]=T,{poolKeys:v,poolInfo:Y}=F,{poolKeys:E,poolInfo:G}=N;try{let{amountOut:te,minAmountOut:Q,executionPrice:oe,priceImpact:ae,fee:Le}=this.scope.route.computeRouteAmountOut({fromPoolKeys:v,toPoolKeys:E,fromPoolInfo:Y,toPoolInfo:G,amountIn:y,outputToken:r,slippage:i});te.gt(f)&&(d=[{source:"amm",keys:v},{source:"amm",keys:E}],p="route",f=te,b=Q,S=oe,g=ae,k=Le)}catch{}}}return{routes:d,routeType:p,amountOut:f,minAmountOut:b,fixedSide:"in",currentPrice:h,executionPrice:S,priceImpact:g,fee:k}}async directSwap(e){this.checkDisabled();let{amountOut:t,amountIn:o,slippage:r,config:i}=e,a=o.token,u=t.token,{routes:c,routeType:m,minAmountOut:d}=await this.getBestAmountOut({inputToken:a,outputToken:u,amountIn:o.raw,slippage:r});return await this.swap({routes:c,routeType:m,amountIn:o,amountOut:d,fixedSide:"in",config:i})}async swap(e){this.checkDisabled(),this.scope.checkOwner();let{routes:t,routeType:o,amountIn:r,amountOut:i,fixedSide:a,config:u}=e;if(o==="amm"&&t.length===1)return await this.scope.liquidity.swapWithAMM({poolKeys:t[0].keys,amountIn:r,amountOut:i,fixedSide:a,config:u});if(o==="route"&&t.length===2)return await this.scope.route.swapWithRoute({fromPoolKeys:t[0].keys,toPoolKeys:t[1].keys,amountIn:r,amountOut:i,fixedSide:a,config:u});throw this.logAndCreateError("invalid routes with routeType","routes",{routeType:o,routes:t}),new Error("invalid routes with routeType")}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(Re));return e.sort((t,o)=>t.isAssociated?1:o.isAssociated||t.amount.lt(o.amount)?-1:1),e}async unWrapWSol(e){let t=await this.getWSolAccounts(),o=this.createTxBuilder(),r=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});o.addInstruction(r);let i=I(e);for(let a=0;a<t.length;a++)i.gte(t[a].amount)?(o.addInstruction({instructions:[Ke({tokenAccount:t[a].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),i.sub(t[a].amount)):(o.addInstruction({instructions:[Ke({tokenAccount:t[a].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),Ve({destination:r.signers[0].publicKey,source:t[a].publicKey,amount:i,owner:this.scope.ownerPubKey}));return o.build()}async wrapWSol(e){let t=await this.getWSolAccounts(),o=this.createTxBuilder(),r=await xe({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return o.addInstruction(r),t.length&&o.addInstruction({instructions:[Ve({destination:t[0].publicKey,source:r.signers[0].publicKey,amount:e,owner:this.scope.ownerPubKey})],endInstructions:[Ke({tokenAccount:r.signers[0].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey})]}),o.build()}};var Fe={},Mt=class{constructor(e){this.rawBalances=new Map;let{connection:t,cluster:o,owner:r,api:i,defaultApiTokens:a,defaultApiLiquidityPools:u,defaultApiFarmPools:c,defaultApiPairsInfo:m,apiCacheTime:d}=e;this._connection=t,this.cluster=o,this._owner=r?new fe(r):void 0,this._signAllTransactions=e.signAllTransactions,this.api=i,this._apiCacheTime=d||5*60*1e3,this.logger=M("Raydium"),this.farm=new wt({scope:this,moduleName:"Raydium_Farm"}),this.account=new bt({scope:this,moduleName:"Raydium_Account",tokenAccounts:e.tokenAccounts,tokenAccountRawInfos:e.tokenAccountRawInfos}),this.liquidity=new Tt({scope:this,moduleName:"Raydium_Liquidity"}),this.token=new _t({scope:this,moduleName:"Raydium_token"}),this.trade=new Rt({scope:this,moduleName:"Raydium_trade"}),this.route=new Lt({scope:this,moduleName:"Raydium_route"});let p=new Date().getTime(),[y,f,b,h]=[a?{fetched:p,data:a}:Fe.tokens,u?{fetched:p,data:u}:Fe.liquidityPools,c?{fetched:p,data:c}:Fe.farmPools,m?{fetched:p,data:m}:Fe.liquidityPairsInfo];this.apiData=L(L(L(L({},y?{tokens:y}:{}),f?{liquidityPools:f}:{}),b?{farmPools:b}:{}),h?{liquidityPairsInfo:h}:{})}static async load(e){let t=(0,Ei.merge)({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4},e),{cluster:o,apiRequestTimeout:r}=t,i=new Jt({cluster:o,timeout:r}),a=new Mt(K(L({},t),{api:i}));return await a.token.load(),await a.liquidity.load(),a}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw new Error($t);return this._owner.publicKey}setOwner(e){return this._owner=e?new fe(e):void 0,this}get connection(){if(!this._connection)throw new Error(jr);return this._connection}setConnection(e){return this._connection=e,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(e){return this._signAllTransactions=e,this}checkOwner(){if(!this.owner)throw this.logger.error($t),new Error($t)}isCacheInvalidate(e){return new Date().getTime()-e>this._apiCacheTime}async fetchTokens(e){if(this.apiData.tokens&&!this.isCacheInvalidate(this.apiData.tokens.fetched)&&!e)return this.apiData.tokens.data;let t={fetched:Date.now(),data:await this.api.getTokens()};return this.apiData.tokens=t,Fe.tokens=t,t.data}async fetchLiquidity(e){if(this.apiData.liquidityPools&&!this.isCacheInvalidate(this.apiData.liquidityPools.fetched)&&!e)return this.apiData.liquidityPools.data;let t={fetched:Date.now(),data:await this.api.getLiquidityPools()};return this.apiData.liquidityPools=t,Fe.liquidityPools=t,t.data}async fetchPairs(e){var o;if(this.apiData.liquidityPairsInfo&&!this.isCacheInvalidate(this.apiData.liquidityPairsInfo.fetched)&&!e)return((o=this.apiData.liquidityPairsInfo)==null?void 0:o.data)||[];let t={fetched:Date.now(),data:await this.api.getPairsInfo()};return this.apiData.liquidityPairsInfo=t,Fe.liquidityPairsInfo=t,t.data}async fetchFarms(e){if(this.apiData.farmPools&&!this.isCacheInvalidate(this.apiData.farmPools.fetched)&&!e)return this.apiData.farmPools.data;let t={fetched:Date.now(),data:await this.api.getFarmPools()};return this.apiData.farmPools=t,Fe.farmPools=t,t.data}async chainTimeOffset(){let e=await this.connection.getBlockTime(await this.connection.getSlot());return e?(e*1e3,Number((e*1e3-Date.now()).toFixed(0))):0}mintToToken(e){return this.token.mintToToken(e)}mintToTokenAmount(e){return this.token.mintToTokenAmount(e)}decimalAmount(e){return this.token.decimalAmount(e)}uiAmount(e){return this.token.uiAmount(e)}};var Na=n=>n;0&&(module.exports={DataElement,FARM_LOCK_MINT,FARM_LOCK_VAULT,FARM_PROGRAMID_TO_VERSION,FARM_PROGRAM_ID_V3,FARM_PROGRAM_ID_V3_PUBKEY,FARM_PROGRAM_ID_V5,FARM_PROGRAM_ID_V5_PUBKEY,FARM_PROGRAM_ID_V6,FARM_PROGRAM_ID_V6_PUBKEY,FARM_VERSION_TO_LEDGER_LAYOUT,FARM_VERSION_TO_PROGRAMID,FARM_VERSION_TO_STATE_LAYOUT,LIQUIDITY_FEES_DENOMINATOR,LIQUIDITY_FEES_NUMERATOR,LIQUIDITY_PROGRAMID_TO_VERSION,LIQUIDITY_PROGRAM_ID_V4,LIQUIDITY_PROGRAM_ID_V5,LIQUIDITY_VERSION_TO_PROGRAM_ID,LIQUIDITY_VERSION_TO_SERUM_VERSION,LIQUIDITY_VERSION_TO_STATE_LAYOUT,LiquidityPoolStatus,MODEL_DATA_PUBKEY,ROUTE_PROGRAM_ID_V1,Raydium,SERUM_PROGRAMID_TO_VERSION,SERUM_PROGRAM_ID_V3,SERUM_VERSION_TO_PROGRAM_ID,SPL_MINT_LAYOUT,StableLayout,TOKEN_SOL,TOKEN_WSOL,_LIQUIDITY_PROGRAM_ID_V4,_LIQUIDITY_PROGRAM_ID_V5,_ROUTE_PROGRAM_ID_V1,_SERUM_PROGRAM_ID_V3,addLiquidityLayout,associatedLedgerAccountLayout,calFarmRewardAmount,calculateFarmPoolAprList,closeAccountInstruction,createAssociatedLedgerAccountInstruction,createPoolV4Layout,createWSolAccountInstructions,defaultRoutes,dwLayout,farmAddRewardLayout,farmDespotVersionToInstruction,farmLedgerLayoutV3_1,farmLedgerLayoutV3_2,farmLedgerLayoutV5_1,farmLedgerLayoutV5_2,farmLedgerLayoutV6_1,farmRewardInfoToConfig,farmRewardLayout,farmRewardRestartLayout,farmRewardTimeInfoLayout,farmStateV3Layout,farmStateV5Layout,farmStateV6Layout,farmWithdrawVersionToInstruction,fetchMultipleFarmInfoAndUpdate,fixedSwapInLayout,fixedSwapOutLayout,formatLayout,getAmountSide,getAmountsSide,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getAssociatedMiddleStatusAccount,getAssociatedPoolKeys,getDxByDyBaseIn,getDyByDxBaseIn,getFarmLedgerLayout,getFarmProgramId,getFarmStateLayout,getFarmVersion,getLiquidityAssociatedAuthority,getLiquidityAssociatedId,getLiquidityInfo,getLiquidityProgramId,getLiquidityStateLayout,getPoolEnabledFeatures,getSPLTokenInfo,getSerumAssociatedAuthority,getSerumProgramId,getSerumVersion,getStablePrice,getTokenSide,getTokensSide,groupPools,includesToken,initPoolLayout,initTokenAccountInstruction,isValidFarmVersion,isValidFixedSide,judgeFarmType,liquidityStateV4Layout,liquidityStateV5Layout,makeAMMSwapInstruction,makeAddLiquidityInstruction,makeCreateFarmInstruction,makeCreatePoolInstruction,makeInitPoolInstruction,makeRemoveLiquidityInstruction,makeRouteSwapInstruction,makeSimulatePoolInfoInstruction,makeSimulationPoolInfo,makeSwapFixedInInstruction,makeSwapFixedOutInstruction,makeSwapInFixedInInstruction,makeSwapOutFixedInInstruction,makeTransferInstruction,mergeSdkFarmInfo,modelDataInfoLayout,parseTokenAccountResp,poolTypeV6,quantumSOLHydratedTokenJsonInfo,realFarmStateV3Layout,realFarmStateV5Layout,realFarmV6Layout,removeLiquidityLayout,routeSwapInLayout,routeSwapOutLayout,sortTokens,splAccountLayout,swapRouteMiddleMints,unionArr,updateFarmPoolInfo,validateFarmRewards,whetherIsStakeFarmPool,withdrawRewardLayout});
//# sourceMappingURL=index.js.map