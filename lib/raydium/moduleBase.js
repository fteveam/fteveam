var L=Object.create;var f=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var M=(e,t)=>{for(var n in t)f(e,n,{get:t[n],enumerable:!0})},b=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of E(t))!C.call(e,r)&&r!==n&&f(e,r,{get:()=>t[r],enumerable:!(i=k(t,r))||i.enumerable});return e};var I=(e,t,n)=>(n=e!=null?L(K(e)):{},b(t||!e||!e.__esModule?f(n,"default",{value:e,enumerable:!0}):n,e)),D=e=>b(f({},"__esModule",{value:!0}),e);var j={};M(j,{default:()=>y});module.exports=D(j);var c=require("lodash"),R=I(require("pino")),v=I(require("pino-pretty")),S={},W={},O=(0,v.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),$=(0,R.default)({base:null,level:"silent"},O);function p(e){let t=(0,c.get)(S,e);if(!t){let n=(0,c.get)(W,e);t=$.child({name:e},{level:n}),(0,c.set)(S,e,t)}return t.logWithError=(...n)=>{let i=n.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(i)},t}var a=require("@solana/web3.js");var q=p("Raydium_txTool"),m=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:n=[],signers:i=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...i),this}build(t){let n=new a.Transaction;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{transaction:n,signers:this.signers,execute:async()=>{var r;let i=await B(this.connection);if(n.recentBlockhash=i,(r=this.owner)!=null&&r.isKeyPair)return(0,a.sendAndConfirmTransaction)(this.connection,n,this.signers);if(this.signAllTransactions){this.signers.length&&n.partialSign(...this.signers);let l=await this.signAllTransactions([n]);return await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:n=[],extInfo:i}=t,{transaction:r}=this.build(i),l=n.filter(s=>s.transaction.instructions.length>0),T=[...l.map(s=>s.transaction),r],g=[...l.map(s=>s.signers),this.signers];return{transactions:T,signers:g,execute:async()=>{var x;let s=await B(this.connection);if((x=this.owner)!=null&&x.isKeyPair)return await Promise.all(T.map(async(u,h)=>(u.recentBlockhash=s,await(0,a.sendAndConfirmTransaction)(this.connection,u,g[h]))));if(this.signAllTransactions){let u=T.map((o,d)=>(o.recentBlockhash=s,g[d].length&&o.partialSign(...g[d]),o)),h=await this.signAllTransactions(u),P=[];for(let o=0;o<h.length;o+=1){let d=await this.connection.sendRawTransaction(h[o].serialize(),{skipPreflight:!0});P.push(d)}return P}throw new Error("please connect wallet first")},extInfo:i||{}}}};async function B(e){var t,n;try{return((n=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:n.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}var w=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),y=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=p(n)}createTxBuilder(t){return this.scope.checkOwner(),new m({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(w(t))}logInfo(...t){this.logger.info(w(t))}logAndCreateError(...t){let n=w(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};0&&(module.exports={});
//# sourceMappingURL=moduleBase.js.map