var B=Object.create;var f=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var M=(e,t)=>{for(var n in t)f(e,n,{get:t[n],enumerable:!0})},v=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of D(t))!K.call(e,i)&&i!==n&&f(e,i,{get:()=>t[i],enumerable:!(r=E(t,i))||r.enumerable});return e};var I=(e,t,n)=>(n=e!=null?B(C(e)):{},v(t||!e||!e.__esModule?f(n,"default",{value:e,enumerable:!0}):n,e)),O=e=>v(f({},"__esModule",{value:!0}),e);var $={};M($,{default:()=>y});module.exports=O($);var c=require("lodash"),b=I(require("dayjs")),k=I(require("dayjs/plugin/utc"));b.default.extend(k.default);var w=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:3,this.name=t.name}set level(t){this.logLevel=t}get time(){return(0,b.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},A={},W={};function p(e){let t=(0,c.get)(A,e);if(!t){let n=(0,c.get)(W,e);t=new w({name:e,logLevel:n}),(0,c.set)(A,e,t)}return t}var a=require("@solana/web3.js");var V=p("Raydium_txTool"),m=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this}build(t){let n=new a.Transaction;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{transaction:n,signers:this.signers,execute:async()=>{var i;let r=await S(this.connection);if(n.recentBlockhash=r,(i=this.owner)!=null&&i.isKeyPair)return(0,a.sendAndConfirmTransaction)(this.connection,n,this.signers);if(this.signAllTransactions){this.signers.length&&n.partialSign(...this.signers);let l=await this.signAllTransactions([n]);return await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),l=n.filter(s=>s.transaction.instructions.length>0),T=[...l.map(s=>s.transaction),i],g=[...l.map(s=>s.signers),this.signers];return{transactions:T,signers:g,execute:async()=>{var L;let s=await S(this.connection);if((L=this.owner)!=null&&L.isKeyPair)return await Promise.all(T.map(async(u,h)=>(u.recentBlockhash=s,await(0,a.sendAndConfirmTransaction)(this.connection,u,g[h]))));if(this.signAllTransactions){let u=T.map((o,d)=>(o.recentBlockhash=s,g[d].length&&o.partialSign(...g[d]),o)),h=await this.signAllTransactions(u),P=[];for(let o=0;o<h.length;o+=1){let d=await this.connection.sendRawTransaction(h[o].serialize(),{skipPreflight:!0});P.push(d)}return P}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function S(e){var t,n;try{return((n=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:n.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}var x=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),y=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=p(n)}createTxBuilder(t){return this.scope.checkOwner(),new m({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(x(t))}logInfo(...t){this.logger.info(x(t))}logAndCreateError(...t){let n=x(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};0&&(module.exports={});
//# sourceMappingURL=moduleBase.js.map