var we=Object.create;var E=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty;var Ee=(t,e)=>{for(var r in e)E(t,r,{get:e[r],enumerable:!0})},G=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of Te(e))!We.call(t,u)&&u!==r&&E(t,u,{get:()=>e[u],enumerable:!(i=Be(e,u))||i.enumerable});return t};var f=(t,e,r)=>(r=t!=null?we(Ne(t)):{},G(e||!t||!t.__esModule?E(r,"default",{value:t,enumerable:!0}):r,t)),De=t=>G(E({},"__esModule",{value:!0}),t);var He={};Ee(He,{makeRouteSwapInstruction:()=>Ye,makeSwapInFixedInInstruction:()=>Le,makeSwapOutFixedInInstruction:()=>Se});module.exports=De(He);var W=require("@solana/spl-token"),P=require("@solana/web3.js");var m=f(require("bn.js"));var K=f(require("big.js")),Oe=f(require("bn.js"));var L=require("lodash"),A=f(require("dayjs")),Z=f(require("dayjs/plugin/utc"));A.default.extend(Z.default);var O=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,A.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let r=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(r)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},z={},_e={};function b(t){let e=(0,L.get)(z,t);if(!e){let r=(0,L.get)(_e,t);e=new O({name:t,logLevel:r}),(0,L.set)(z,t,e)}return e}var J=f(require("toformat")),Ue=J.default,S=Ue;var w=f(require("big.js")),$=f(require("decimal.js-light"));var D=b("module/fraction"),v=S(w.default),B=S($.default),Ie={[0]:B.ROUND_DOWN,[1]:B.ROUND_HALF_UP,[2]:B.ROUND_UP},Re={[0]:w.default.roundDown,[1]:w.default.roundHalfUp,[2]:w.default.roundUp},s=class{constructor(e,r=Q){this.numerator=p(e),this.denominator=p(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(e){let r=e instanceof s?e:new s(p(e));return this.denominator.eq(r.denominator)?new s(this.numerator.add(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(e){let r=e instanceof s?e:new s(p(e));return this.denominator.eq(r.denominator)?new s(this.numerator.sub(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(e){let r=e instanceof s?e:new s(p(e));return new s(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(e){let r=e instanceof s?e:new s(p(e));return new s(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(e,r={groupSeparator:""},i=1){Number.isInteger(e)||D.logWithError(`${e} is not an integer.`),e<=0&&D.logWithError(`${e} is not positive.`),B.set({precision:e+1,rounding:Ie[i]});let u=new B(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return u.toFormat(u.decimalPlaces(),r)}toFixed(e,r={groupSeparator:""},i=1){return Number.isInteger(e)||D.logWithError(`${e} is not an integer.`),e<0&&D.logWithError(`${e} is negative.`),v.DP=e,v.RM=Re[i]||1,new v(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,r)}isZero(){return this.numerator.isZero()}};var at=b("Raydium_amount"),ct=S(K.default);var ee=require("@solana/web3.js"),te={symbol:"SOL",name:"Solana",decimals:9},y={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},pt={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ee.PublicKey(y.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var U=require("@solana/web3.js");var ne=require("@solana/spl-token"),a=require("@solana/web3.js");function n({pubkey:t,isSigner:e=!1,isWritable:r=!0}){return{pubkey:t,isWritable:r,isSigner:e}}var bt=[n({pubkey:ne.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:a.SystemProgram.programId,isWritable:!1}),n({pubkey:a.SYSVAR_RENT_PUBKEY,isWritable:!1})];function re({publicKey:t,transformSol:e}){if(t instanceof a.PublicKey)return e&&t.equals(T)?_:t;if(e&&t===T.toBase58())return _;if(typeof t=="string")try{return new a.PublicKey(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var oe=new a.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ie=new a.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ft=new a.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ue=new a.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),se=new a.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ae=new a.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ce=new a.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),me=new a.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),gt=new a.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),yt=new a.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),pe=new a.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),_=new a.PublicKey("So11111111111111111111111111111111111111112"),T=a.PublicKey.default;var F=class{constructor({mint:e,decimals:r,symbol:i="UNKNOWN",name:u="UNKNOWN",skipMint:d=!1}){if(e===T.toBase58()||e instanceof U.PublicKey&&T.equals(e)){this.decimals=y.decimals,this.symbol=y.symbol,this.name=y.name,this.mint=new U.PublicKey(y.mint);return}this.decimals=r,this.symbol=i,this.name=u,this.mint=d?U.PublicKey.default:re({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},N=F;N.WSOL=new F(y);var q=class{constructor({decimals:e,symbol:r="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=r,this.name=i}equals(e){return this===e}},C=q;C.SOL=new q(te);var Et=new s(de);var Ot=b("Raydium_price");var I=b("Raydium_bignumber");var Kt=new m.default(0),Q=new m.default(1),en=new m.default(2),tn=new m.default(3),nn=new m.default(5),Ae=new m.default(10),de=new m.default(100),rn=new m.default(1e3),on=new m.default(1e4),le=9007199254740991;function p(t){if(t instanceof m.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new m.default(t);I.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&I.logWithError(`BigNumberish number underflow: ${t}`),(t>=le||t<=-le)&&I.logWithError(`BigNumberish number overflow: ${t}`),new m.default(String(t))):typeof t=="bigint"?new m.default(t.toString()):(I.logWithError(`invalid BigNumberish value: ${t}`),new m.default(0))}var ke=require("@solana/web3.js");var Fe=require("@solana/web3.js"),h=f(require("bn.js"));var o=require("@solana/buffer-layout"),be=o.Layout,fe=o.Structure;var ge=o.UInt;var ye=o.seq;var xe=o.blob;var V=class extends be{constructor(r,i,u){super(r,u);this.blob=xe(r),this.signed=i}decode(r,i=0){let u=new h.default(this.blob.decode(r,i),10,"le");return this.signed?u.fromTwos(this.span*8).clone():u}encode(r,i,u=0){return typeof r=="number"&&(r=new h.default(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),i,u)}};function Y(t){return new ge(1,t)}function l(t){return new V(8,!1,t)}var j=class extends fe{decode(e,r){return super.decode(e,r)}};function k(t,e,r){return new j(t,e,r)}function he(t,e,r){let i,u=typeof e=="number"?e:(0,h.isBN)(e)?e.toNumber():new Proxy(e,{get(d,g){if(!i){let x=Reflect.get(d,"count");i=(0,h.isBN)(x)?x.toNumber():x,Reflect.set(d,"count",i)}return Reflect.get(d,g)},set(d,g,x){return g==="count"&&(i=x),Reflect.set(d,g,x)}});return ye(t,u,r)}var H=new ke.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ce=5e4,qe=k([l("x"),l("y"),l("price")]),kn=k([l("accountType"),l("status"),l("multiplier"),l("validDataCount"),he(qe,Ce,"DataElement")]);var Pe=require("@solana/web3.js");var Ve="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",X=new Pe.PublicKey(Ve);var Sn=[ue,oe,_,ae,ie,ce,me,se,pe].map(t=>t.toBase58());var R=k([Y("instruction"),l("amountIn"),l("amountOut")]),M=k([Y("instruction")]);var je=b("Raydium_route_instruction");function Ye(t){let{fixedSide:e}=t;if(e==="in")return[Le(t),Se(t)];throw je.logWithError("invalid params","params",t),new Error(`invalid params, params: ${t}`)}function Le({fromPoolKeys:t,toPoolKeys:e,userKeys:r,amountIn:i,amountOut:u}){let d=Buffer.alloc(R.span),g;return t.version===4?(R.encode({instruction:0,amountIn:p(i),amountOut:p(u)},d),g=[n({pubkey:P.SystemProgram.programId,isWritable:!1}),n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:t.programId,isWritable:!1}),n({pubkey:t.id}),n({pubkey:e.id,isWritable:!1}),n({pubkey:t.authority,isWritable:!1}),n({pubkey:t.openOrders}),n({pubkey:t.baseVault}),n({pubkey:t.quoteVault}),n({pubkey:t.marketProgramId,isWritable:!1}),n({pubkey:t.marketId}),n({pubkey:t.marketBids}),n({pubkey:t.marketAsks}),n({pubkey:t.marketEventQueue}),n({pubkey:t.marketBaseVault}),n({pubkey:t.marketQuoteVault}),n({pubkey:t.marketAuthority,isWritable:!1}),n({pubkey:r.inTokenAccount}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]):(R.encode({instruction:2,amountIn:p(i),amountOut:p(u)},d),g=[n({pubkey:P.SystemProgram.programId,isWritable:!1}),n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:t.programId,isWritable:!1}),n({pubkey:t.id}),n({pubkey:e.id,isWritable:!1}),n({pubkey:t.authority,isWritable:!1}),n({pubkey:t.openOrders}),n({pubkey:t.baseVault}),n({pubkey:t.quoteVault}),n({pubkey:H,isWritable:!1}),n({pubkey:t.marketProgramId,isWritable:!1}),n({pubkey:t.marketId}),n({pubkey:t.marketBids}),n({pubkey:t.marketAsks}),n({pubkey:t.marketEventQueue}),n({pubkey:t.id}),n({pubkey:t.id}),n({pubkey:t.id}),n({pubkey:r.inTokenAccount}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]),new P.TransactionInstruction({programId:X,keys:g,data:d})}function Se({fromPoolKeys:t,toPoolKeys:e,userKeys:r}){let i=Buffer.alloc(M.span),u;return e.version===4?(M.encode({instruction:1},i),u=[n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:e.programId,isWritable:!1}),n({pubkey:t.id,isWritable:!1}),n({pubkey:e.id}),n({pubkey:e.authority,isWritable:!1}),n({pubkey:e.openOrders}),n({pubkey:e.baseVault}),n({pubkey:e.quoteVault}),n({pubkey:e.marketProgramId,isWritable:!1}),n({pubkey:e.marketId}),n({pubkey:e.marketBids}),n({pubkey:e.marketAsks}),n({pubkey:e.marketEventQueue}),n({pubkey:e.marketBaseVault}),n({pubkey:e.marketQuoteVault}),n({pubkey:e.marketAuthority,isWritable:!1}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.outTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]):(M.encode({instruction:3},i),u=[n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:e.programId,isWritable:!1}),n({pubkey:t.id,isWritable:!1}),n({pubkey:e.id}),n({pubkey:e.authority,isWritable:!1}),n({pubkey:e.openOrders}),n({pubkey:e.baseVault}),n({pubkey:e.quoteVault}),n({pubkey:H,isWritable:!1}),n({pubkey:e.marketProgramId,isWritable:!1}),n({pubkey:e.marketId}),n({pubkey:e.marketBids}),n({pubkey:e.marketAsks}),n({pubkey:e.marketEventQueue}),n({pubkey:e.id}),n({pubkey:e.id}),n({pubkey:e.id}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.outTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]),new P.TransactionInstruction({programId:X,keys:u,data:i})}0&&(module.exports={makeRouteSwapInstruction,makeSwapInFixedInInstruction,makeSwapOutFixedInInstruction});
//# sourceMappingURL=instruction.js.map