var we=Object.create;var E=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var Be=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var We=(t,e)=>{for(var r in e)E(t,r,{get:e[r],enumerable:!0})},H=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of Be(e))!Ne.call(t,u)&&u!==r&&E(t,u,{get:()=>e[u],enumerable:!(i=Le(e,u))||i.enumerable});return t};var f=(t,e,r)=>(r=t!=null?we(Te(t)):{},H(e||!t||!t.__esModule?E(r,"default",{value:t,enumerable:!0}):r,t)),Ee=t=>H(E({},"__esModule",{value:!0}),t);var Xe={};We(Xe,{makeRouteSwapInstruction:()=>He,makeSwapInFixedInInstruction:()=>ke,makeSwapOutFixedInInstruction:()=>Se});module.exports=Ee(Xe);var W=require("@solana/spl-token"),k=require("@solana/web3.js");var m=f(require("bn.js"));var Q=f(require("big.js")),Ae=f(require("bn.js"));var S=require("lodash"),G=f(require("pino")),z=f(require("pino-pretty")),X={},_e={},De=(0,z.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Ue=(0,G.default)({base:null,level:"silent"},De);function b(t){let e=(0,S.get)(X,t);if(!e){let r=(0,S.get)(_e,t);e=Ue.child({name:t},{level:r}),(0,S.set)(X,t,e)}return e.logWithError=(...r)=>{let i=r.map(u=>typeof u=="object"?JSON.stringify(u):u).join(", ");throw new Error(i)},e}var Z=f(require("toformat")),Ie=Z.default,w=Ie;var L=f(require("big.js")),J=f(require("decimal.js-light"));var _=b("module/fraction"),O=w(L.default),B=w(J.default),Re={[0]:B.ROUND_DOWN,[1]:B.ROUND_HALF_UP,[2]:B.ROUND_UP},Me={[0]:L.default.roundDown,[1]:L.default.roundHalfUp,[2]:L.default.roundUp},s=class{constructor(e,r=$){this.numerator=p(e),this.denominator=p(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(e){let r=e instanceof s?e:new s(p(e));return this.denominator.eq(r.denominator)?new s(this.numerator.add(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(e){let r=e instanceof s?e:new s(p(e));return this.denominator.eq(r.denominator)?new s(this.numerator.sub(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(e){let r=e instanceof s?e:new s(p(e));return new s(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(e){let r=e instanceof s?e:new s(p(e));return new s(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(e,r={groupSeparator:""},i=1){Number.isInteger(e)||_.logWithError(`${e} is not an integer.`),e<=0&&_.logWithError(`${e} is not positive.`),B.set({precision:e+1,rounding:Re[i]});let u=new B(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return u.toFormat(u.decimalPlaces(),r)}toFixed(e,r={groupSeparator:""},i=1){return Number.isInteger(e)||_.logWithError(`${e} is not an integer.`),e<0&&_.logWithError(`${e} is negative.`),O.DP=e,O.RM=Me[i]||1,new O(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,r)}isZero(){return this.numerator.isZero()}};var pt=b("Raydium_amount"),dt=w(Q.default);var K=require("@solana/web3.js"),ee={symbol:"SOL",name:"Solana",decimals:9},y={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},bt={isQuantumSOL:!0,isLp:!1,official:!0,mint:new K.PublicKey(y.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var U=require("@solana/web3.js");var te=require("@solana/spl-token"),a=require("@solana/web3.js");function n({pubkey:t,isSigner:e=!1,isWritable:r=!0}){return{pubkey:t,isWritable:r,isSigner:e}}var yt=[n({pubkey:te.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:a.SystemProgram.programId,isWritable:!1}),n({pubkey:a.SYSVAR_RENT_PUBKEY,isWritable:!1})];function ne({publicKey:t,transformSol:e}){if(t instanceof a.PublicKey)return e&&t.equals(T)?D:t;if(e&&t===T.toBase58())return D;if(typeof t=="string")try{return new a.PublicKey(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var re=new a.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),oe=new a.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xt=new a.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ie=new a.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ue=new a.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),se=new a.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ae=new a.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ce=new a.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ht=new a.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Pt=new a.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),me=new a.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),D=new a.PublicKey("So11111111111111111111111111111111111111112"),T=a.PublicKey.default;var A=class{constructor({mint:e,decimals:r,symbol:i="UNKNOWN",name:u="UNKNOWN",skipMint:d=!1}){if(e===T.toBase58()||e instanceof U.PublicKey&&T.equals(e)){this.decimals=y.decimals,this.symbol=y.symbol,this.name=y.name,this.mint=new U.PublicKey(y.mint);return}this.decimals=r,this.symbol=i,this.name=u,this.mint=d?U.PublicKey.default:ne({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},N=A;N.WSOL=new A(y);var C=class{constructor({decimals:e,symbol:r="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=r,this.name=i}equals(e){return this===e}},F=C;F.SOL=new C(ee);var Ut=new s(pe);var Ct=b("Raydium_price");var I=b("Raydium_bignumber");var nn=new m.default(0),$=new m.default(1),rn=new m.default(2),on=new m.default(3),un=new m.default(5),Fe=new m.default(10),pe=new m.default(100),sn=new m.default(1e3),an=new m.default(1e4),de=9007199254740991;function p(t){if(t instanceof m.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new m.default(t);I.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&I.logWithError(`BigNumberish number underflow: ${t}`),(t>=de||t<=-de)&&I.logWithError(`BigNumberish number overflow: ${t}`),new m.default(String(t))):typeof t=="bigint"?new m.default(t.toString()):(I.logWithError(`invalid BigNumberish value: ${t}`),new m.default(0))}var he=require("@solana/web3.js");var ve=require("@solana/web3.js"),h=f(require("bn.js"));var o=require("@solana/buffer-layout"),le=o.Layout,be=o.Structure;var fe=o.UInt;var ge=o.seq;var ye=o.blob;var v=class extends le{constructor(r,i,u){super(r,u);this.blob=ye(r),this.signed=i}decode(r,i=0){let u=new h.default(this.blob.decode(r,i),10,"le");return this.signed?u.fromTwos(this.span*8).clone():u}encode(r,i,u=0){return typeof r=="number"&&(r=new h.default(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),i,u)}};function V(t){return new fe(1,t)}function l(t){return new v(8,!1,t)}var q=class extends be{decode(e,r){return super.decode(e,r)}};function P(t,e,r){return new q(t,e,r)}function xe(t,e,r){let i,u=typeof e=="number"?e:(0,h.isBN)(e)?e.toNumber():new Proxy(e,{get(d,g){if(!i){let x=Reflect.get(d,"count");i=(0,h.isBN)(x)?x.toNumber():x,Reflect.set(d,"count",i)}return Reflect.get(d,g)},set(d,g,x){return g==="count"&&(i=x),Reflect.set(d,g,x)}});return ge(t,u,r)}var j=new he.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),qe=5e4,Ve=P([l("x"),l("y"),l("price")]),wn=P([l("accountType"),l("status"),l("multiplier"),l("validDataCount"),xe(Ve,qe,"DataElement")]);var Pe=require("@solana/web3.js");var je="routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",Y=new Pe.PublicKey(je);var Tn=[ie,re,D,se,oe,ae,ce,ue,me].map(t=>t.toBase58());var R=P([V("instruction"),l("amountIn"),l("amountOut")]),M=P([V("instruction")]);var Ye=b("Raydium_route_instruction");function He(t){let{fixedSide:e}=t;if(e==="in")return[ke(t),Se(t)];throw Ye.logWithError("invalid params","params",t),new Error(`invalid params, params: ${t}`)}function ke({fromPoolKeys:t,toPoolKeys:e,userKeys:r,amountIn:i,amountOut:u}){let d=Buffer.alloc(R.span),g;return t.version===4?(R.encode({instruction:0,amountIn:p(i),amountOut:p(u)},d),g=[n({pubkey:k.SystemProgram.programId,isWritable:!1}),n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:t.programId,isWritable:!1}),n({pubkey:t.id}),n({pubkey:e.id,isWritable:!1}),n({pubkey:t.authority,isWritable:!1}),n({pubkey:t.openOrders}),n({pubkey:t.baseVault}),n({pubkey:t.quoteVault}),n({pubkey:t.marketProgramId,isWritable:!1}),n({pubkey:t.marketId}),n({pubkey:t.marketBids}),n({pubkey:t.marketAsks}),n({pubkey:t.marketEventQueue}),n({pubkey:t.marketBaseVault}),n({pubkey:t.marketQuoteVault}),n({pubkey:t.marketAuthority,isWritable:!1}),n({pubkey:r.inTokenAccount}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]):(R.encode({instruction:2,amountIn:p(i),amountOut:p(u)},d),g=[n({pubkey:k.SystemProgram.programId,isWritable:!1}),n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:t.programId,isWritable:!1}),n({pubkey:t.id}),n({pubkey:e.id,isWritable:!1}),n({pubkey:t.authority,isWritable:!1}),n({pubkey:t.openOrders}),n({pubkey:t.baseVault}),n({pubkey:t.quoteVault}),n({pubkey:j,isWritable:!1}),n({pubkey:t.marketProgramId,isWritable:!1}),n({pubkey:t.marketId}),n({pubkey:t.marketBids}),n({pubkey:t.marketAsks}),n({pubkey:t.marketEventQueue}),n({pubkey:t.id}),n({pubkey:t.id}),n({pubkey:t.id}),n({pubkey:r.inTokenAccount}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]),new k.TransactionInstruction({programId:Y,keys:g,data:d})}function Se({fromPoolKeys:t,toPoolKeys:e,userKeys:r}){let i=Buffer.alloc(M.span),u;return e.version===4?(M.encode({instruction:1},i),u=[n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:e.programId,isWritable:!1}),n({pubkey:t.id,isWritable:!1}),n({pubkey:e.id}),n({pubkey:e.authority,isWritable:!1}),n({pubkey:e.openOrders}),n({pubkey:e.baseVault}),n({pubkey:e.quoteVault}),n({pubkey:e.marketProgramId,isWritable:!1}),n({pubkey:e.marketId}),n({pubkey:e.marketBids}),n({pubkey:e.marketAsks}),n({pubkey:e.marketEventQueue}),n({pubkey:e.marketBaseVault}),n({pubkey:e.marketQuoteVault}),n({pubkey:e.marketAuthority,isWritable:!1}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.outTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]):(M.encode({instruction:3},i),u=[n({pubkey:W.TOKEN_PROGRAM_ID,isWritable:!1}),n({pubkey:e.programId,isWritable:!1}),n({pubkey:t.id,isWritable:!1}),n({pubkey:e.id}),n({pubkey:e.authority,isWritable:!1}),n({pubkey:e.openOrders}),n({pubkey:e.baseVault}),n({pubkey:e.quoteVault}),n({pubkey:j,isWritable:!1}),n({pubkey:e.marketProgramId,isWritable:!1}),n({pubkey:e.marketId}),n({pubkey:e.marketBids}),n({pubkey:e.marketAsks}),n({pubkey:e.marketEventQueue}),n({pubkey:e.id}),n({pubkey:e.id}),n({pubkey:e.id}),n({pubkey:r.middleTokenAccount}),n({pubkey:r.outTokenAccount}),n({pubkey:r.middleStatusAccount}),n({pubkey:r.owner,isWritable:!1,isSigner:!0})]),new k.TransactionInstruction({programId:Y,keys:u,data:i})}0&&(module.exports={makeRouteSwapInstruction,makeSwapInFixedInInstruction,makeSwapOutFixedInInstruction});
//# sourceMappingURL=instruction.js.map