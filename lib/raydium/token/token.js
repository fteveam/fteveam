var Ke=Object.create;var A=Object.defineProperty,qe=Object.defineProperties,je=Object.getOwnPropertyDescriptor,ze=Object.getOwnPropertyDescriptors,He=Object.getOwnPropertyNames,de=Object.getOwnPropertySymbols,Ye=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var ge=(n,t,e)=>t in n?A(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,P=(n,t)=>{for(var e in t||(t={}))fe.call(t,e)&&ge(n,e,t[e]);if(de)for(var e of de(t))Je.call(t,e)&&ge(n,e,t[e]);return n},x=(n,t)=>qe(n,ze(t));var $e=(n,t)=>{for(var e in t)A(n,e,{get:t[e],enumerable:!0})},ye=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of He(t))!fe.call(n,o)&&o!==e&&A(n,o,{get:()=>t[o],enumerable:!(r=je(t,o))||r.enumerable});return n};var T=(n,t,e)=>(e=n!=null?Ke(Ye(n)):{},ye(t||!n||!n.__esModule?A(e,"default",{value:n,enumerable:!0}):e,n)),Ve=n=>ye(A({},"__esModule",{value:!0}),n);var ct={};$e(ct,{default:()=>$});module.exports=Ve(ct);var Fe=require("@solana/web3.js"),le=T(require("bn.js"));var c=T(require("bn.js"));var ke=T(require("big.js")),R=T(require("bn.js"));var U=require("lodash"),he=T(require("pino")),Pe=T(require("pino-pretty")),be={},Ge={},Xe=(0,Pe.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Ze=(0,he.default)({base:null,level:"silent"},Xe);function h(n){let t=(0,U.get)(be,n);if(!t){let e=(0,U.get)(Ge,n);t=Ze.child({name:n},{level:e}),(0,U.set)(be,n,t)}return t.logWithError=(...e)=>{let r=e.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(r)},t}var xe=T(require("toformat")),Qe=xe.default,O=Qe;var E=T(require("big.js")),Te=T(require("decimal.js-light"));var q=h("module/fraction"),V=O(E.default),M=O(Te.default),et={[0]:M.ROUND_DOWN,[1]:M.ROUND_HALF_UP,[2]:M.ROUND_UP},tt={[0]:E.default.roundDown,[1]:E.default.roundHalfUp,[2]:E.default.roundUp},a=class{constructor(t,e=we){this.numerator=b(t),this.denominator=b(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new a(this.denominator,this.numerator)}add(t){let e=t instanceof a?t:new a(b(t));return this.denominator.eq(e.denominator)?new a(this.numerator.add(e.numerator),this.denominator):new a(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof a?t:new a(b(t));return this.denominator.eq(e.denominator)?new a(this.numerator.sub(e.numerator),this.denominator):new a(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof a?t:new a(b(t));return new a(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof a?t:new a(b(t));return new a(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||q.logWithError(`${t} is not an integer.`),t<=0&&q.logWithError(`${t} is not positive.`),M.set({precision:t+1,rounding:et[r]});let o=new M(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||q.logWithError(`${t} is not an integer.`),t<0&&q.logWithError(`${t} is negative.`),V.DP=t,V.RM=tt[r]||1,new V(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var rt=h("Raydium_amount"),Se=O(ke.default);function ot(n,t){let e="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([e,r]=o,r=r.padEnd(t,"0")):rt.logWithError(`invalid number string, num: ${n}`)}else e=n;return[e,r.slice(0,t)||r]}var w=class extends a{constructor(e,r,o=!0,s){let l=new R.default(0),u=D.pow(new R.default(e.decimals));if(o)l=b(r);else{let m=new R.default(0),g=new R.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[p,y]=ot(r.toString(),e.decimals);m=b(p),g=b(y)}m=m.mul(u),l=m.add(g)}super(l,u);this.logger=h(s||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new w(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new w(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,o=0){return super.toSignificant(e,r,o)}toFixed(e=this.token.decimals,r,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,o)}toExact(e={groupSeparator:""}){return Se.DP=this.token.decimals,new Se(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};var Be=require("@solana/web3.js"),Le={symbol:"SOL",name:"Solana",decimals:9},S={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},I={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Be.PublicKey(S.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var j=require("@solana/web3.js");var _e=require("@solana/spl-token"),d=require("@solana/web3.js");function G({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var At=[G({pubkey:_e.TOKEN_PROGRAM_ID,isWritable:!1}),G({pubkey:d.SystemProgram.programId,isWritable:!1}),G({pubkey:d.SYSVAR_RENT_PUBKEY,isWritable:!1})];function C({publicKey:n,transformSol:t}){if(n instanceof d.PublicKey)return t&&n.equals(k)?Ne:n;if(t&&n===k.toBase58())return Ne;if(typeof n=="string")try{return new d.PublicKey(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var Ut=new d.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ot=new d.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Et=new d.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Mt=new d.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Rt=new d.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),It=new d.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ct=new d.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),vt=new d.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ft=new d.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Kt=new d.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),qt=new d.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ne=new d.PublicKey("So11111111111111111111111111111111111111112"),k=d.PublicKey.default;var X=class{constructor({mint:t,decimals:e,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:s=!1}){if(t===k.toBase58()||t instanceof j.PublicKey&&k.equals(t)){this.decimals=S.decimals,this.symbol=S.symbol,this.name=S.name,this.mint=new j.PublicKey(S.mint);return}this.decimals=e,this.symbol=r,this.name=o,this.mint=s?j.PublicKey.default:C({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},B=X;B.WSOL=new X(S);var Q=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},Z=Q;Z.SOL=new Q(Le);var De=new a(We),z=class extends a{toSignificant(t=5,e,r){return this.mul(De).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(De).toFixed(t,e,r)}};var it=h("Raydium_price"),L=class extends a{constructor(e){let{baseToken:r,quoteToken:o,numerator:s,denominator:l}=e;super(s,l);this.baseToken=r,this.quoteToken=o,this.scalar=new a(ee(r.decimals),ee(o.decimals))}get raw(){return new a(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new L({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&it.logWithError("mul token not equals");let r=super.mul(e);return new L({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(e,r,o)}toFixed(e=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(e,r,o)}};var H=h("Raydium_bignumber");var st=new c.default(0),we=new c.default(1),hn=new c.default(2),Pn=new c.default(3),xn=new c.default(5),D=new c.default(10),We=new c.default(100),Tn=new c.default(1e3),wn=new c.default(1e4),Ae=9007199254740991;function b(n){if(n instanceof c.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new c.default(n);H.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&H.logWithError(`BigNumberish number underflow: ${n}`),(n>=Ae||n<=-Ae)&&H.logWithError(`BigNumberish number overflow: ${n}`),new c.default(String(n))):typeof n=="bigint"?new c.default(n.toString()):(H.logWithError(`invalid BigNumberish value: ${n}`),new c.default(0))}function ee(n){return D.pow(b(n))}function v(n){var u;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof c.default)return{numerator:n.toString(),denominator:"1"};if(n instanceof a)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let t=String(n),[,e="",r="",o=""]=(u=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?u:[],s="1"+"0".repeat(o.length),l=e+(r==="0"?"":r)+o||"0";return{denominator:s,numerator:l,sign:e,int:r,dec:o}}function at(n){var r;let[,t="",e=""]=(r=n.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?r:[];return`${t}${e}`}function Ue(n,t=0){return n instanceof c.default?n:new c.default(at(Oe(n).mul(D.pow(new c.default(String(t))))))}function Oe(n){if(n instanceof z)return new a(n.numerator,n.denominator);if(n instanceof L)return n.adjusted;if(n instanceof w)try{return Oe(n.toExact())}catch{return new a(st)}if(n instanceof a)return n;let t=String(n),e=v(t);return new a(e.numerator,e.denominator)}function te(n){let{token:t,numberPrice:e,decimalDone:r}=n,o=new B({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:s,denominator:l}=v(e),u=r?new c.default(s).mul(D.pow(new c.default(t.decimals))):s,m=new c.default(l).mul(D.pow(new c.default(o.decimals)));return new L({baseToken:o,denominator:m.toString(),quoteToken:new B(x(P({},t),{skipMint:!0,mint:""})),numerator:u.toString()})}var _=require("@solana/web3.js");var Wn=h("Raydium_txTool"),Y=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this}build(t){let e=new _.Transaction;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var o;let r=await Ee(this.connection);if(e.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return(0,_.sendAndConfirmTransaction)(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let s=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(s[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:o}=this.build(r),s=e.filter(m=>m.transaction.instructions.length>0),l=[...s.map(m=>m.transaction),o],u=[...s.map(m=>m.signers),this.signers];return{transactions:l,signers:u,execute:async()=>{var g;let m=await Ee(this.connection);if((g=this.owner)!=null&&g.isKeyPair)return await Promise.all(l.map(async(p,y)=>(p.recentBlockhash=m,await(0,_.sendAndConfirmTransaction)(this.connection,p,u[y]))));if(this.signAllTransactions){let p=l.map((N,K)=>(N.recentBlockhash=m,u[K].length&&N.partialSign(...u[K]),N)),y=await this.signAllTransactions(p),W=[];for(let N=0;N<y.length;N+=1){let K=await this.connection.sendRawTransaction(y[N].serialize(),{skipPreflight:!0});W.push(K)}return W}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function Ee(n){var t,e;try{return((e=await((t=n.getLatestBlockhash)==null?void 0:t.call(n)))==null?void 0:e.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var ne=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),F=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=h(e)}createTxBuilder(t){return this.scope.checkOwner(),new Y({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(ne(t))}logInfo(...t){this.logger.info(ne(t))}logAndCreateError(...t){let e=ne(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Re=require("@solana/web3.js"),J=T(require("bn.js"));var i=require("@solana/buffer-layout"),re=i.Layout,Me=i.Structure;var oe=i.UInt;var ie=i.blob;var se=class extends re{constructor(e,r,o){super(e,o);this.blob=ie(e),this.signed=r}decode(e,r=0){let o=new J.default(this.blob.decode(e,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,r,o=0){return typeof e=="number"&&(e=new J.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,o)}};function ce(n){return new oe(1,n)}function me(n){return new oe(4,n)}function Ie(n){return new se(8,!1,n)}var ae=class extends re{constructor(e,r,o,s){super(e.span,s);this.layout=e,this.decoder=r,this.encoder=o}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,o){return this.layout.encode(this.encoder(e),r,o)}getSpan(e,r){return this.layout.getSpan(e,r)}};function pe(n){return new ae(ie(32),t=>new Re.PublicKey(t),t=>t.toBuffer(),n)}var ue=class extends Me{decode(t,e){return super.decode(t,e)}};function Ce(n,t,e){return new ue(n,t,e)}var ut=Ce([me("mintAuthorityOption"),pe("mintAuthority"),Ie("supply"),ce("decimals"),ce("isInitialized"),me("freezeAuthorityOption"),pe("freezeAuthority")]);function ve(n,t){return n.sort((e,r)=>{let{official:o,unOfficial:s}=t,l=new Set(o),u=new Set(s),m=y=>l.has(y.mint)?1:u.has(y.mint)?2:3,g=m(e)-m(r),p=y=>!/^[a-zA-Z]/.test(y);if(g===0){let y=p(e.symbol),W=p(r.symbol);return y&&!W?1:!y&&W?-1:e.symbol.localeCompare(r.symbol)}else return g})}var $=class extends F{constructor(e){super(e);this._tokens=[];this._tokenMap=new Map;this._tokenPrice=new Map;this._mintList={official:[],unOfficial:[],unNamed:[]}}async load(e){this.checkDisabled(),await this.scope.fetchTokens(e==null?void 0:e.forceUpdate),this._mintList={official:[],unOfficial:[],unNamed:[]},this._tokens=[],this._tokenMap=new Map;let{data:r}=this.scope.apiData.tokens||{data:{official:[],unOfficial:[],unNamed:[],blacklist:[]}},o=new Set(r.blacklist);[r.official,r.unOfficial,r.unNamed].forEach((s,l)=>{s.forEach(u=>{let m=["official","unOfficial","unNamed"][l];!o.has(u.mint)&&u.mint!==k.toBase58()&&(this._tokens.push(x(P({},u),{symbol:u.symbol||"",name:u.name||""})),this._mintList[m].push(u.mint))})}),this._mintList.official.push(I.mint.toBase58()),this._tokens=ve(this._tokens,this._mintList),this._tokens.push(x(P({},I),{mint:k.toBase58()})),this._tokens.forEach(s=>{this._tokenMap.set(s.mint,x(P({},s),{id:s.mint}))}),this._tokenMap.set(S.mint,x(P({},S),{icon:I.icon,id:"wsol"})),this._tokenMap.set(k.toBase58(),x(P({},I),{mint:k.toBase58()}))}get allTokens(){return this._tokens}get allTokenMap(){return this._tokenMap}get tokenMints(){return this._mintList}get tokenPrices(){return this._tokenPrice}async fetchTokenPrices(e){let r=this.allTokens.filter(g=>{var p;return!!((p=g.extensions)!=null&&p.coingeckoId)&&g.mint!==Fe.PublicKey.default.toBase58()}),o=r.map(g=>g.extensions.coingeckoId),s=await this.scope.api.getCoingeckoPrice(o),l=r.reduce((g,p)=>s[p.extensions.coingeckoId].usd?x(P({},g),{[p.mint]:te({token:this._tokenMap.get(p.mint),numberPrice:s[p.extensions.coingeckoId].usd,decimalDone:!0})}):g,{}),u=e||await this.scope.api.getRaydiumTokenPrice(),m=Object.keys(u).reduce((g,p)=>this._tokenMap.get(p)?x(P({},g),{[p]:te({token:this._tokenMap.get(p),numberPrice:u[p],decimalDone:!0})}):g,{});return this._tokenPrice=new Map([...Object.entries(l),...Object.entries(m)]),this._tokenPrice}mintToToken(e){let r=C({publicKey:e,transformSol:!0}),o=this.allTokenMap.get(r.toBase58());o||this.logAndCreateError("token not found, mint:",r.toBase58());let{decimals:s,name:l,symbol:u}=o;return new B({mint:e,decimals:s,name:l,symbol:u})}mintToTokenAmount({mint:e,amount:r,decimalDone:o}){let s=this.mintToToken(e);return o?new w(s,b(r)):new w(s,this.decimalAmount({mint:e,amount:r,decimalDone:o}))}decimalAmount({mint:e,amount:r}){let o=v(r),s=this.mintToToken(e);return Ue(new a(o.numerator,o.denominator).mul(new le.default(10**s.decimals)))}uiAmount({mint:e,amount:r}){let o=v(r),s=this.mintToToken(e);return s?new a(o.numerator,o.denominator).div(new le.default(10**s.decimals)).toSignificant(s.decimals):""}};0&&(module.exports={});
//# sourceMappingURL=token.js.map