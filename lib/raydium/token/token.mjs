var _e=Object.defineProperty,De=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var ue=(n,t,e)=>t in n?_e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,P=(n,t)=>{for(var e in t||(t={}))Ae.call(t,e)&&ue(n,e,t[e]);if(ae)for(var e of ae(t))Ue.call(t,e)&&ue(n,e,t[e]);return n},x=(n,t)=>De(n,We(t));import{PublicKey as ut}from"@solana/web3.js";import Ne from"bn.js";import m from"bn.js";import He from"big.js";import C from"bn.js";import{get as ce,set as Oe}from"lodash";import Ee from"pino";import Me from"pino-pretty";var me={},Re={},Ie=Me({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Ce=Ee({base:null,level:"silent"},Ie);function h(n){let t=ce(me,n);if(!t){let e=ce(Re,n);t=Ce.child({name:n},{level:e}),Oe(me,n,t)}return t.logWithError=(...e)=>{let r=e.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(r)},t}import ve from"toformat";var Fe=ve,D=Fe;import I from"big.js";import Ke from"decimal.js-light";var R=h("module/fraction"),q=D(I),W=D(Ke),qe={[0]:W.ROUND_DOWN,[1]:W.ROUND_HALF_UP,[2]:W.ROUND_UP},je={[0]:I.roundDown,[1]:I.roundHalfUp,[2]:I.roundUp},s=class{constructor(t,e=pe){this.numerator=b(t),this.denominator=b(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(t){let e=t instanceof s?t:new s(b(t));return this.denominator.eq(e.denominator)?new s(this.numerator.add(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof s?t:new s(b(t));return this.denominator.eq(e.denominator)?new s(this.numerator.sub(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof s?t:new s(b(t));return new s(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof s?t:new s(b(t));return new s(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||R.logWithError(`${t} is not an integer.`),t<=0&&R.logWithError(`${t} is not positive.`),W.set({precision:t+1,rounding:qe[r]});let o=new W(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||R.logWithError(`${t} is not an integer.`),t<0&&R.logWithError(`${t} is negative.`),q.DP=t,q.RM=je[r]||1,new q(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var Ye=h("Raydium_amount"),le=D(He);function Je(n,t){let e="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([e,r]=o,r=r.padEnd(t,"0")):Ye.logWithError(`invalid number string, num: ${n}`)}else e=n;return[e,r.slice(0,t)||r]}var T=class extends s{constructor(e,r,o=!0,i){let p=new C(0),a=N.pow(new C(e.decimals));if(o)p=b(r);else{let u=new C(0),l=new C(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[c,y]=Je(r.toString(),e.decimals);u=b(c),l=b(y)}u=u.mul(a),p=u.add(l)}super(p,a);this.logger=h(i||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new T(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new T(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,o=0){return super.toSignificant(e,r,o)}toFixed(e=this.token.decimals,r,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,o)}toExact(e={groupSeparator:""}){return le.DP=this.token.decimals,new le(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as $e}from"@solana/web3.js";var de={symbol:"SOL",name:"Solana",decimals:9},w={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},A={isQuantumSOL:!0,isLp:!1,official:!0,mint:new $e(w.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as z}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ve}from"@solana/spl-token";import{PublicKey as f,SystemProgram as Ge,SYSVAR_RENT_PUBKEY as Xe}from"@solana/web3.js";function j({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var Kt=[j({pubkey:Ve,isWritable:!1}),j({pubkey:Ge.programId,isWritable:!1}),j({pubkey:Xe,isWritable:!1})];function U({publicKey:n,transformSol:t}){if(n instanceof f)return t&&n.equals(S)?ge:n;if(t&&n===S.toBase58())return ge;if(typeof n=="string")try{return new f(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var qt=new f("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),jt=new f("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),zt=new f("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ht=new f("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Yt=new f("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Jt=new f("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),$t=new f("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Vt=new f("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Gt=new f("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Xt=new f("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Zt=new f("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ge=new f("So11111111111111111111111111111111111111112"),S=f.default;var H=class{constructor({mint:t,decimals:e,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:i=!1}){if(t===S.toBase58()||t instanceof z&&S.equals(t)){this.decimals=w.decimals,this.symbol=w.symbol,this.name=w.name,this.mint=new z(w.mint);return}this.decimals=e,this.symbol=r,this.name=o,this.mint=i?z.default:U({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},k=H;k.WSOL=new H(w);var J=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},Y=J;Y.SOL=new J(de);var fe=new s(ye),v=class extends s{toSignificant(t=5,e,r){return this.mul(fe).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(fe).toFixed(t,e,r)}};var Ze=h("Raydium_price"),B=class extends s{constructor(e){let{baseToken:r,quoteToken:o,numerator:i,denominator:p}=e;super(i,p);this.baseToken=r,this.quoteToken=o,this.scalar=new s($(r.decimals),$(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new B({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Ze.logWithError("mul token not equals");let r=super.mul(e);return new B({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(e,r,o)}toFixed(e=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(e,r,o)}};var F=h("Raydium_bignumber");var Qe=new m(0),pe=new m(1),Wn=new m(2),An=new m(3),Un=new m(5),N=new m(10),ye=new m(100),On=new m(1e3),En=new m(1e4),be=9007199254740991;function b(n){if(n instanceof m)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new m(n);F.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&F.logWithError(`BigNumberish number underflow: ${n}`),(n>=be||n<=-be)&&F.logWithError(`BigNumberish number overflow: ${n}`),new m(String(n))):typeof n=="bigint"?new m(n.toString()):(F.logWithError(`invalid BigNumberish value: ${n}`),new m(0))}function $(n){return N.pow(b(n))}function O(n){var a;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof m)return{numerator:n.toString(),denominator:"1"};if(n instanceof s)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let t=String(n),[,e="",r="",o=""]=(a=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],i="1"+"0".repeat(o.length),p=e+(r==="0"?"":r)+o||"0";return{denominator:i,numerator:p,sign:e,int:r,dec:o}}function et(n){var r;let[,t="",e=""]=(r=n.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?r:[];return`${t}${e}`}function he(n,t=0){return n instanceof m?n:new m(et(Pe(n).mul(N.pow(new m(String(t))))))}function Pe(n){if(n instanceof v)return new s(n.numerator,n.denominator);if(n instanceof B)return n.adjusted;if(n instanceof T)try{return Pe(n.toExact())}catch{return new s(Qe)}if(n instanceof s)return n;let t=String(n),e=O(t);return new s(e.numerator,e.denominator)}function V(n){let{token:t,numberPrice:e,decimalDone:r}=n,o=new k({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:i,denominator:p}=O(e),a=r?new m(i).mul(N.pow(new m(t.decimals))):i,u=new m(p).mul(N.pow(new m(o.decimals)));return new B({baseToken:o,denominator:u.toString(),quoteToken:new k(x(P({},t),{skipMint:!0,mint:""})),numerator:a.toString()})}import{PACKET_DATA_SIZE as Cn,PublicKey as vn,sendAndConfirmTransaction as xe,Transaction as tt}from"@solana/web3.js";var Hn=h("Raydium_txTool"),K=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this}build(t){let e=new tt;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var o;let r=await Te(this.connection);if(e.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return xe(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let i=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(i[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:o}=this.build(r),i=e.filter(u=>u.transaction.instructions.length>0),p=[...i.map(u=>u.transaction),o],a=[...i.map(u=>u.signers),this.signers];return{transactions:p,signers:a,execute:async()=>{var l;let u=await Te(this.connection);if((l=this.owner)!=null&&l.isKeyPair)return await Promise.all(p.map(async(c,y)=>(c.recentBlockhash=u,await xe(this.connection,c,a[y]))));if(this.signAllTransactions){let c=p.map((L,M)=>(L.recentBlockhash=u,a[M].length&&L.partialSign(...a[M]),L)),y=await this.signAllTransactions(c),_=[];for(let L=0;L<y.length;L+=1){let M=await this.connection.sendRawTransaction(y[L].serialize(),{skipPreflight:!0});_.push(M)}return _}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function Te(n){var t,e;try{return((e=await((t=n.getLatestBlockhash)==null?void 0:t.call(n)))==null?void 0:e.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var G=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),E=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=h(e)}createTxBuilder(t){return this.scope.checkOwner(),new K({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(G(t))}logInfo(...t){this.logger.info(G(t))}logAndCreateError(...t){let e=G(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as st}from"@solana/web3.js";import Se,{isBN as Gr}from"bn.js";import{bits as Xn,BitStructure as Zn,blob as nt,Blob as Qn,cstr as er,f32 as tr,f32be as nr,f64 as rr,f64be as or,greedy as ir,Layout as rt,ns64 as sr,ns64be as ar,nu64 as ur,nu64be as cr,offset as mr,s16 as pr,s16be as lr,s24 as dr,s24be as gr,s32 as fr,s32be as yr,s40 as br,s40be as hr,s48 as Pr,s48be as xr,s8 as Tr,seq as wr,struct as Sr,Structure as ot,u16 as kr,u16be as Br,u24 as Lr,u24be as Nr,u32 as _r,u32be as Dr,u40 as Wr,u40be as Ar,u48 as Ur,u48be as Or,u8 as Er,UInt as it,union as Mr,Union as Rr,unionLayoutDiscriminator as Ir,utf8 as Cr}from"@solana/buffer-layout";var X=rt,we=ot;var Z=it;var Q=nt;var ee=class extends X{constructor(e,r,o){super(e,o);this.blob=Q(e),this.signed=r}decode(e,r=0){let o=new Se(this.blob.decode(e,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,r,o=0){return typeof e=="number"&&(e=new Se(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,o)}};function re(n){return new Z(1,n)}function oe(n){return new Z(4,n)}function ke(n){return new ee(8,!1,n)}var te=class extends X{constructor(e,r,o,i){super(e.span,i);this.layout=e,this.decoder=r,this.encoder=o}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,o){return this.layout.encode(this.encoder(e),r,o)}getSpan(e,r){return this.layout.getSpan(e,r)}};function ie(n){return new te(Q(32),t=>new st(t),t=>t.toBuffer(),n)}var ne=class extends we{decode(t,e){return super.decode(t,e)}};function Be(n,t,e){return new ne(n,t,e)}var at=Be([oe("mintAuthorityOption"),ie("mintAuthority"),ke("supply"),re("decimals"),re("isInitialized"),oe("freezeAuthorityOption"),ie("freezeAuthority")]);function Le(n,t){return n.sort((e,r)=>{let{official:o,unOfficial:i}=t,p=new Set(o),a=new Set(i),u=y=>p.has(y.mint)?1:a.has(y.mint)?2:3,l=u(e)-u(r),c=y=>!/^[a-zA-Z]/.test(y);if(l===0){let y=c(e.symbol),_=c(r.symbol);return y&&!_?1:!y&&_?-1:e.symbol.localeCompare(r.symbol)}else return l})}var se=class extends E{constructor(e){super(e);this._tokens=[];this._tokenMap=new Map;this._tokenPrice=new Map;this._mintList={official:[],unOfficial:[],unNamed:[]}}async load(e){this.checkDisabled(),await this.scope.fetchTokens(e==null?void 0:e.forceUpdate),this._mintList={official:[],unOfficial:[],unNamed:[]},this._tokens=[],this._tokenMap=new Map;let{data:r}=this.scope.apiData.tokens||{data:{official:[],unOfficial:[],unNamed:[],blacklist:[]}},o=new Set(r.blacklist);[r.official,r.unOfficial,r.unNamed].forEach((i,p)=>{i.forEach(a=>{let u=["official","unOfficial","unNamed"][p];!o.has(a.mint)&&a.mint!==S.toBase58()&&(this._tokens.push(x(P({},a),{symbol:a.symbol||"",name:a.name||""})),this._mintList[u].push(a.mint))})}),this._mintList.official.push(A.mint.toBase58()),this._tokens=Le(this._tokens,this._mintList),this._tokens.push(x(P({},A),{mint:S.toBase58()})),this._tokens.forEach(i=>{this._tokenMap.set(i.mint,x(P({},i),{id:i.mint}))}),this._tokenMap.set(w.mint,x(P({},w),{icon:A.icon,id:"wsol"})),this._tokenMap.set(S.toBase58(),x(P({},A),{mint:S.toBase58()}))}get allTokens(){return this._tokens}get allTokenMap(){return this._tokenMap}get tokenMints(){return this._mintList}get tokenPrices(){return this._tokenPrice}async fetchTokenPrices(e){let r=this.allTokens.filter(l=>{var c;return!!((c=l.extensions)!=null&&c.coingeckoId)&&l.mint!==ut.default.toBase58()}),o=r.map(l=>l.extensions.coingeckoId),i=await this.scope.api.getCoingeckoPrice(o),p=r.reduce((l,c)=>i[c.extensions.coingeckoId].usd?x(P({},l),{[c.mint]:V({token:this._tokenMap.get(c.mint),numberPrice:i[c.extensions.coingeckoId].usd,decimalDone:!0})}):l,{}),a=e||await this.scope.api.getRaydiumTokenPrice(),u=Object.keys(a).reduce((l,c)=>this._tokenMap.get(c)?x(P({},l),{[c]:V({token:this._tokenMap.get(c),numberPrice:a[c],decimalDone:!0})}):l,{});return this._tokenPrice=new Map([...Object.entries(p),...Object.entries(u)]),this._tokenPrice}mintToToken(e){let r=U({publicKey:e,transformSol:!0}),o=this.allTokenMap.get(r.toBase58());o||this.logAndCreateError("token not found, mint:",r.toBase58());let{decimals:i,name:p,symbol:a}=o;return new k({mint:e,decimals:i,name:p,symbol:a})}mintToTokenAmount({mint:e,amount:r,decimalDone:o}){let i=this.mintToToken(e);return o?new T(i,b(r)):new T(i,this.decimalAmount({mint:e,amount:r,decimalDone:o}))}decimalAmount({mint:e,amount:r}){let o=O(r),i=this.mintToToken(e);return he(new s(o.numerator,o.denominator).mul(new Ne(10**i.decimals)))}uiAmount({mint:e,amount:r}){let o=O(r),i=this.mintToToken(e);return i?new s(o.numerator,o.denominator).div(new Ne(10**i.decimals)).toSignificant(i.decimals):""}};export{se as default};
//# sourceMappingURL=token.mjs.map