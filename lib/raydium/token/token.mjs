var We=Object.defineProperty,Ae=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ce=(n,t,e)=>t in n?We(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,P=(n,t)=>{for(var e in t||(t={}))Oe.call(t,e)&&ce(n,e,t[e]);if(ue)for(var e of ue(t))Ee.call(t,e)&&ce(n,e,t[e]);return n},x=(n,t)=>Ae(n,Ue(t));import{PublicKey as at}from"@solana/web3.js";import De from"bn.js";import m from"bn.js";import Ye from"big.js";import v from"bn.js";import{get as me,set as Re}from"lodash";import le from"dayjs";import Me from"dayjs/plugin/utc";le.extend(Me);var q=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return le().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},pe={},Ie={};function h(n){let t=me(pe,n);if(!t){let e=me(Ie,n);t=new q({name:n,logLevel:e}),Re(pe,n,t)}return t}import ve from"toformat";var Ce=ve,D=Ce;import I from"big.js";import Fe from"decimal.js-light";var M=h("module/fraction"),j=D(I),W=D(Fe),Ke={[0]:W.ROUND_DOWN,[1]:W.ROUND_HALF_UP,[2]:W.ROUND_UP},qe={[0]:I.roundDown,[1]:I.roundHalfUp,[2]:I.roundUp},s=class{constructor(t,e=de){this.numerator=b(t),this.denominator=b(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(t){let e=t instanceof s?t:new s(b(t));return this.denominator.eq(e.denominator)?new s(this.numerator.add(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof s?t:new s(b(t));return this.denominator.eq(e.denominator)?new s(this.numerator.sub(e.numerator),this.denominator):new s(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof s?t:new s(b(t));return new s(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof s?t:new s(b(t));return new s(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||M.logWithError(`${t} is not an integer.`),t<=0&&M.logWithError(`${t} is not positive.`),W.set({precision:t+1,rounding:Ke[r]});let o=new W(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||M.logWithError(`${t} is not an integer.`),t<0&&M.logWithError(`${t} is negative.`),j.DP=t,j.RM=qe[r]||1,new j(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var He=h("Raydium_amount"),ge=D(Ye);function ze(n,t){let e="0",r="0";if(n.includes(".")){let o=n.split(".");o.length===2?([e,r]=o,r=r.padEnd(t,"0")):He.logWithError(`invalid number string, num: ${n}`)}else e=n;return[e,r.slice(0,t)||r]}var T=class extends s{constructor(e,r,o=!0,i){let p=new v(0),a=N.pow(new v(e.decimals));if(o)p=b(r);else{let u=new v(0),l=new v(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[c,y]=ze(r.toString(),e.decimals);u=b(c),l=b(y)}u=u.mul(a),p=u.add(l)}super(p,a);this.logger=h(i||"Amount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new T(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new T(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,r,o=0){return super.toSignificant(e,r,o)}toFixed(e=this.token.decimals,r,o=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,r,o)}toExact(e={groupSeparator:""}){return ge.DP=this.token.decimals,new ge(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};import{PublicKey as Je}from"@solana/web3.js";var fe={symbol:"SOL",name:"Solana",decimals:9},w={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},A={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Je(w.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as H}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as $e}from"@solana/spl-token";import{PublicKey as f,SystemProgram as Ve,SYSVAR_RENT_PUBKEY as Ge}from"@solana/web3.js";function Y({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var vt=[Y({pubkey:$e,isWritable:!1}),Y({pubkey:Ve.programId,isWritable:!1}),Y({pubkey:Ge,isWritable:!1})];function U({publicKey:n,transformSol:t}){if(n instanceof f)return t&&n.equals(L)?ye:n;if(t&&n===L.toBase58())return ye;if(typeof n=="string")try{return new f(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var Ct=new f("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ft=new f("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Kt=new f("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),qt=new f("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),jt=new f("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Yt=new f("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ht=new f("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),zt=new f("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Jt=new f("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),$t=new f("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Vt=new f("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ye=new f("So11111111111111111111111111111111111111112"),L=f.default;var z=class{constructor({mint:t,decimals:e,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:i=!1}){if(t===L.toBase58()||t instanceof H&&L.equals(t)){this.decimals=w.decimals,this.symbol=w.symbol,this.name=w.name,this.mint=new H(w.mint);return}this.decimals=e,this.symbol=r,this.name=o,this.mint=i?H.default:U({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},k=z;k.WSOL=new z(w);var $=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},J=$;J.SOL=new $(fe);var be=new s(he),C=class extends s{toSignificant(t=5,e,r){return this.mul(be).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(be).toFixed(t,e,r)}};var Xe=h("Raydium_price"),S=class extends s{constructor(e){let{baseToken:r,quoteToken:o,numerator:i,denominator:p}=e;super(i,p);this.baseToken=r,this.quoteToken=o,this.scalar=new s(V(r.decimals),V(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new S({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&Xe.logWithError("mul token not equals");let r=super.mul(e);return new S({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(e=this.quoteToken.decimals,r,o){return this.adjusted.toSignificant(e,r,o)}toFixed(e=this.quoteToken.decimals,r,o){return this.adjusted.toFixed(e,r,o)}};var F=h("Raydium_bignumber");var Ze=new m(0),de=new m(1),Nn=new m(2),_n=new m(3),Dn=new m(5),N=new m(10),he=new m(100),Wn=new m(1e3),An=new m(1e4),Pe=9007199254740991;function b(n){if(n instanceof m)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new m(n);F.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&F.logWithError(`BigNumberish number underflow: ${n}`),(n>=Pe||n<=-Pe)&&F.logWithError(`BigNumberish number overflow: ${n}`),new m(String(n))):typeof n=="bigint"?new m(n.toString()):(F.logWithError(`invalid BigNumberish value: ${n}`),new m(0))}function V(n){return N.pow(b(n))}function O(n){var a;if(n===void 0)return{denominator:"1",numerator:"0"};if(n instanceof m)return{numerator:n.toString(),denominator:"1"};if(n instanceof s)return{denominator:n.denominator.toString(),numerator:n.numerator.toString()};let t=String(n),[,e="",r="",o=""]=(a=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],i="1"+"0".repeat(o.length),p=e+(r==="0"?"":r)+o||"0";return{denominator:i,numerator:p,sign:e,int:r,dec:o}}function Qe(n){var r;let[,t="",e=""]=(r=n.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?r:[];return`${t}${e}`}function xe(n,t=0){return n instanceof m?n:new m(Qe(Te(n).mul(N.pow(new m(String(t))))))}function Te(n){if(n instanceof C)return new s(n.numerator,n.denominator);if(n instanceof S)return n.adjusted;if(n instanceof T)try{return Te(n.toExact())}catch{return new s(Ze)}if(n instanceof s)return n;let t=String(n),e=O(t);return new s(e.numerator,e.denominator)}function G(n){let{token:t,numberPrice:e,decimalDone:r}=n,o=new k({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:i,denominator:p}=O(e),a=r?new m(i).mul(N.pow(new m(t.decimals))):i,u=new m(p).mul(N.pow(new m(o.decimals)));return new S({baseToken:o,denominator:u.toString(),quoteToken:new k(x(P({},t),{skipMint:!0,mint:""})),numerator:a.toString()})}import{PACKET_DATA_SIZE as Rn,PublicKey as Mn,sendAndConfirmTransaction as we,Transaction as et}from"@solana/web3.js";var qn=h("Raydium_txTool"),K=class{constructor(t){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this}build(t){let e=new et;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,{transaction:e,signers:this.signers,execute:async()=>{var o;let r=await Le(this.connection);if(e.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return we(this.connection,e,this.signers);if(this.signAllTransactions){this.signers.length&&e.partialSign(...this.signers);let i=await this.signAllTransactions([e]);return await this.connection.sendRawTransaction(i[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:o}=this.build(r),i=e.filter(u=>u.transaction.instructions.length>0),p=[...i.map(u=>u.transaction),o],a=[...i.map(u=>u.signers),this.signers];return{transactions:p,signers:a,execute:async()=>{var l;let u=await Le(this.connection);if((l=this.owner)!=null&&l.isKeyPair)return await Promise.all(p.map(async(c,y)=>(c.recentBlockhash=u,await we(this.connection,c,a[y]))));if(this.signAllTransactions){let c=p.map((B,R)=>(B.recentBlockhash=u,a[R].length&&B.partialSign(...a[R]),B)),y=await this.signAllTransactions(c),_=[];for(let B=0;B<y.length;B+=1){let R=await this.connection.sendRawTransaction(y[B].serialize(),{skipPreflight:!0});_.push(R)}return _}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function Le(n){var t,e;try{return((e=await((t=n.getLatestBlockhash)==null?void 0:t.call(n)))==null?void 0:e.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var X=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),E=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=h(e)}createTxBuilder(t){return this.scope.checkOwner(),new K({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(X(t))}logInfo(...t){this.logger.info(X(t))}logAndCreateError(...t){let e=X(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as it}from"@solana/web3.js";import Se,{isBN as $r}from"bn.js";import{bits as Vn,BitStructure as Gn,blob as tt,Blob as Xn,cstr as Zn,f32 as Qn,f32be as er,f64 as tr,f64be as nr,greedy as rr,Layout as nt,ns64 as or,ns64be as ir,nu64 as sr,nu64be as ar,offset as ur,s16 as cr,s16be as mr,s24 as pr,s24be as lr,s32 as dr,s32be as gr,s40 as fr,s40be as yr,s48 as br,s48be as hr,s8 as Pr,seq as xr,struct as Tr,Structure as rt,u16 as wr,u16be as Lr,u24 as kr,u24be as Sr,u32 as Br,u32be as Nr,u40 as _r,u40be as Dr,u48 as Wr,u48be as Ar,u8 as Ur,UInt as ot,union as Or,Union as Er,unionLayoutDiscriminator as Rr,utf8 as Mr}from"@solana/buffer-layout";var Z=nt,ke=rt;var Q=ot;var ee=tt;var te=class extends Z{constructor(e,r,o){super(e,o);this.blob=ee(e),this.signed=r}decode(e,r=0){let o=new Se(this.blob.decode(e,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(e,r,o=0){return typeof e=="number"&&(e=new Se(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,o)}};function oe(n){return new Q(1,n)}function ie(n){return new Q(4,n)}function Be(n){return new te(8,!1,n)}var ne=class extends Z{constructor(e,r,o,i){super(e.span,i);this.layout=e,this.decoder=r,this.encoder=o}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,o){return this.layout.encode(this.encoder(e),r,o)}getSpan(e,r){return this.layout.getSpan(e,r)}};function se(n){return new ne(ee(32),t=>new it(t),t=>t.toBuffer(),n)}var re=class extends ke{decode(t,e){return super.decode(t,e)}};function Ne(n,t,e){return new re(n,t,e)}var st=Ne([ie("mintAuthorityOption"),se("mintAuthority"),Be("supply"),oe("decimals"),oe("isInitialized"),ie("freezeAuthorityOption"),se("freezeAuthority")]);function _e(n,t){return n.sort((e,r)=>{let{official:o,unOfficial:i}=t,p=new Set(o),a=new Set(i),u=y=>p.has(y.mint)?1:a.has(y.mint)?2:3,l=u(e)-u(r),c=y=>!/^[a-zA-Z]/.test(y);if(l===0){let y=c(e.symbol),_=c(r.symbol);return y&&!_?1:!y&&_?-1:e.symbol.localeCompare(r.symbol)}else return l})}var ae=class extends E{constructor(e){super(e);this._tokens=[];this._tokenMap=new Map;this._tokenPrice=new Map;this._mintList={official:[],unOfficial:[],unNamed:[]}}async load(e){this.checkDisabled(),await this.scope.fetchTokens(e==null?void 0:e.forceUpdate),this._mintList={official:[],unOfficial:[],unNamed:[]},this._tokens=[],this._tokenMap=new Map;let{data:r}=this.scope.apiData.tokens||{data:{official:[],unOfficial:[],unNamed:[],blacklist:[]}},o=new Set(r.blacklist);[r.official,r.unOfficial,r.unNamed].forEach((i,p)=>{i.forEach(a=>{let u=["official","unOfficial","unNamed"][p];!o.has(a.mint)&&a.mint!==L.toBase58()&&(this._tokens.push(x(P({},a),{symbol:a.symbol||"",name:a.name||""})),this._mintList[u].push(a.mint))})}),this._mintList.official.push(A.mint.toBase58()),this._tokens=_e(this._tokens,this._mintList),this._tokens.push(x(P({},A),{mint:L.toBase58()})),this._tokens.forEach(i=>{this._tokenMap.set(i.mint,x(P({},i),{id:i.mint}))}),this._tokenMap.set(w.mint,x(P({},w),{icon:A.icon,id:"wsol"})),this._tokenMap.set(L.toBase58(),x(P({},A),{mint:L.toBase58()}))}get allTokens(){return this._tokens}get allTokenMap(){return this._tokenMap}get tokenMints(){return this._mintList}get tokenPrices(){return this._tokenPrice}async fetchTokenPrices(e){let r=this.allTokens.filter(l=>{var c;return!!((c=l.extensions)!=null&&c.coingeckoId)&&l.mint!==at.default.toBase58()}),o=r.map(l=>l.extensions.coingeckoId),i=await this.scope.api.getCoingeckoPrice(o),p=r.reduce((l,c)=>i[c.extensions.coingeckoId].usd?x(P({},l),{[c.mint]:G({token:this._tokenMap.get(c.mint),numberPrice:i[c.extensions.coingeckoId].usd,decimalDone:!0})}):l,{}),a=e||await this.scope.api.getRaydiumTokenPrice(),u=Object.keys(a).reduce((l,c)=>this._tokenMap.get(c)?x(P({},l),{[c]:G({token:this._tokenMap.get(c),numberPrice:a[c],decimalDone:!0})}):l,{});return this._tokenPrice=new Map([...Object.entries(p),...Object.entries(u)]),this._tokenPrice}mintToToken(e){let r=U({publicKey:e,transformSol:!0}),o=this.allTokenMap.get(r.toBase58());o||this.logAndCreateError("token not found, mint:",r.toBase58());let{decimals:i,name:p,symbol:a}=o;return new k({mint:e,decimals:i,name:p,symbol:a})}mintToTokenAmount({mint:e,amount:r,decimalDone:o}){let i=this.mintToToken(e);return o?new T(i,b(r)):new T(i,this.decimalAmount({mint:e,amount:r,decimalDone:o}))}decimalAmount({mint:e,amount:r}){let o=O(r),i=this.mintToToken(e);return xe(new s(o.numerator,o.denominator).mul(new De(10**i.decimals)))}uiAmount({mint:e,amount:r}){let o=O(r),i=this.mintToToken(e);return i?new s(o.numerator,o.denominator).div(new De(10**i.decimals)).toSignificant(i.decimals):""}};export{ae as default};
//# sourceMappingURL=token.mjs.map