var Kt=Object.create;var Y=Object.defineProperty,vt=Object.defineProperties,Vt=Object.getOwnPropertyDescriptor,Ut=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertyNames,Z=Object.getOwnPropertySymbols,Ct=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var Je=(t,e,n)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Q=(t,e)=>{for(var n in e||(e={}))ge.call(e,n)&&Je(t,n,e[n]);if(Z)for(var n of Z(e))Xe.call(e,n)&&Je(t,n,e[n]);return t},ee=(t,e)=>vt(t,Ut(e));var $e=(t,e)=>{var n={};for(var r in t)ge.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Z)for(var r of Z(t))e.indexOf(r)<0&&Xe.call(t,r)&&(n[r]=t[r]);return n};var Yt=(t,e)=>{for(var n in e)Y(t,n,{get:e[n],enumerable:!0})},Ze=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ft(e))!ge.call(t,o)&&o!==n&&Y(t,o,{get:()=>e[o],enumerable:!(r=Vt(e,o))||r.enumerable});return t};var A=(t,e,n)=>(n=t!=null?Kt(Ct(t)):{},Ze(e||!t||!t.__esModule?Y(n,"default",{value:t,enumerable:!0}):n,t)),Qt=t=>Ze(Y({},"__esModule",{value:!0}),t);var Nn={};Yt(Nn,{DataElement:()=>at,LIQUIDITY_FEES_DENOMINATOR:()=>Gt,LIQUIDITY_FEES_NUMERATOR:()=>jt,LIQUIDITY_PROGRAMID_TO_VERSION:()=>zt,LIQUIDITY_PROGRAM_ID_V4:()=>et,LIQUIDITY_PROGRAM_ID_V5:()=>tt,LIQUIDITY_VERSION_TO_PROGRAM_ID:()=>Te,LIQUIDITY_VERSION_TO_SERUM_VERSION:()=>we,LIQUIDITY_VERSION_TO_STATE_LAYOUT:()=>ve,LiquidityPoolStatus:()=>he,MODEL_DATA_PUBKEY:()=>M,SERUM_PROGRAMID_TO_VERSION:()=>hn,SERUM_PROGRAM_ID_V3:()=>_t,SERUM_VERSION_TO_PROGRAM_ID:()=>Dt,StableLayout:()=>Ae,_LIQUIDITY_PROGRAM_ID_V4:()=>ke,_LIQUIDITY_PROGRAM_ID_V5:()=>Le,_SERUM_PROGRAM_ID_V3:()=>Ce,addLiquidityLayout:()=>me,createPoolV4Layout:()=>ae,fixedSwapInLayout:()=>ie,fixedSwapOutLayout:()=>se,formatLayout:()=>lt,getAmountSide:()=>kn,getAmountsSide:()=>Bn,getAssociatedPoolKeys:()=>Sn,getDxByDyBaseIn:()=>on,getDyByDxBaseIn:()=>rn,getLiquidityAssociatedAuthority:()=>Wt,getLiquidityAssociatedId:()=>E,getLiquidityInfo:()=>An,getLiquidityProgramId:()=>Ot,getLiquidityStateLayout:()=>wn,getPoolEnabledFeatures:()=>Tn,getSerumAssociatedAuthority:()=>je,getSerumProgramId:()=>Qe,getSerumVersion:()=>Ye,getStablePrice:()=>sn,getTokenSide:()=>Ge,getTokensSide:()=>Rt,includesToken:()=>Ln,initPoolLayout:()=>ue,isValidFixedSide:()=>qn,liquidityStateV4Layout:()=>ce,liquidityStateV5Layout:()=>qt,makeAMMSwapInstruction:()=>bn,makeAddLiquidityInstruction:()=>Pn,makeCreatePoolInstruction:()=>fn,makeInitPoolInstruction:()=>gn,makeRemoveLiquidityInstruction:()=>xn,makeSimulatePoolInfoInstruction:()=>Ve,makeSimulationPoolInfo:()=>In,makeSwapFixedInInstruction:()=>At,makeSwapFixedOutInstruction:()=>Nt,modelDataInfoLayout:()=>ut,removeLiquidityLayout:()=>le});module.exports=Qt(Nn);var Pe=require("@solana/web3.js"),xe=A(require("bn.js")),he=(m=>(m[m.Uninitialized=0]="Uninitialized",m[m.Initialized=1]="Initialized",m[m.Disabled=2]="Disabled",m[m.RemoveLiquidityOnly=3]="RemoveLiquidityOnly",m[m.LiquidityOnly=4]="LiquidityOnly",m[m.OrderBook=5]="OrderBook",m[m.Swap=6]="Swap",m[m.WaitingForStart=7]="WaitingForStart",m))(he||{}),jt=new xe.default(25),Gt=new xe.default(1e4),ke="675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8",et=new Pe.PublicKey(ke),Le="5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h",tt=new Pe.PublicKey(Le),zt={[ke]:4,[Le]:5},Te={4:et,5:tt},we={4:3,5:3};var st=require("@solana/web3.js");var it=require("@solana/web3.js"),U=A(require("bn.js"));var l=require("@solana/buffer-layout"),Se=l.Layout,nt=l.Structure;var rt=l.UInt;var ot=l.seq;var Ie=l.blob;var te=class extends Se{constructor(n,r,o){super(n,o);this.blob=Ie(n),this.signed=r}decode(n,r=0){let o=new U.default(this.blob.decode(n,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(n,r,o=0){return typeof n=="number"&&(n=new U.default(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,o)}};function B(t){return new rt(1,t)}function c(t){return new te(8,!1,t)}function N(t){return new te(16,!1,t)}var Be=class extends Se{constructor(n,r,o,a){super(n.span,a);this.layout=n,this.decoder=r,this.encoder=o}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,o){return this.layout.encode(this.encoder(n),r,o)}getSpan(n,r){return this.layout.getSpan(n,r)}};function f(t){return new Be(Ie(32),e=>new it.PublicKey(e),e=>e.toBuffer(),t)}var qe=class extends nt{decode(e,n){return super.decode(e,n)}};function S(t,e,n){return new qe(t,e,n)}function j(t,e,n){let r,o=typeof e=="number"?e:(0,U.isBN)(e)?e.toNumber():new Proxy(e,{get(a,i){if(!r){let u=Reflect.get(a,"count");r=(0,U.isBN)(u)?u.toNumber():u,Reflect.set(a,"count",r)}return Reflect.get(a,i)},set(a,i,u){return i==="count"&&(r=u),Reflect.set(a,i,u)}});return ot(t,o,n)}var M=new st.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),K=5e4,at=S([c("x"),c("y"),c("price")]),ut=S([c("accountType"),c("status"),c("multiplier"),c("validDataCount"),j(at,K,"DataElement")]);function Ht(t,e){return[0,K-2]}function Jt(t){return[0,K-2]}function Xt(t){return[0,K-2]}function $t(t,e,n){let[r,o]=Ht(e,n),a=r,i=o,u=0,m=e*t.multiplier/n;for(;a<=i;){if(u=Math.floor((i+a)/2),u===0||u>=K-2)return[u,u,!1];let d=t.DataElement[u].x*t.multiplier/t.DataElement[u].y,p=t.DataElement[u-1].x*t.multiplier/t.DataElement[u-1].y,y=t.DataElement[u+1].x*t.multiplier/t.DataElement[u+1].y;if(m===d)return[u,u,!0];if(m===p)return[u-1,u-1,!0];if(m===y)return[u+1,u+1,!0];if(m<p)i=u-1;else{if(m>p&&m<d)return[u-1,u,!0];if(m>d&&m<y)return[u,u+1,!0];a=u+1}}return[u,u,!1]}function Ne(t,e,n){let[r,o,a]=$t(t,e,n);if(!a)return 0;if(r===o){let i=t.DataElement[r].x;return e*t.multiplier/i}else{let i=t.DataElement[r].x,u=t.DataElement[r].y,m=t.DataElement[o].x,d=t.DataElement[o].y,p=n*(m*u-i*d),y=i*p,P=(m-i)*(e*u-i*n)*d,b=y+P;return e*t.multiplier*p/b}}function R(t,e,n){return e*t.multiplier/n}function ct(t,e,n){return e*n/t.multiplier}function Zt(t,e){let[n,r]=Jt(e),o=n,a=r,i=0,u=e;for(;o<a;){if(i=Math.floor((a+o)/2),i<=0||i>K-2)return[i,i,!1];let m=t.DataElement[i].x,d=t.DataElement[i-1].x,p=t.DataElement[i+1].x;if(u===m)return[i,i,!0];if(u===d)return[i-1,i-1,!0];if(u===p)return[i+1,i+1,!0];if(u<d)a=i-1;else{if(u>d&&u<m)return[i-1,i,!0];if(u>m&&u<p)return[i,i+1,!0];o=i+1}}return[i,i,!1]}function en(t,e){let[n,r]=Xt(e),o=n,a=r,i=0,u=e;for(;o<=a;){if(i=Math.floor((a+o)/2),i<=0||i>=K-2)return[i,i,!1];let m=t.DataElement[i].y,d=t.DataElement[i-1].y,p=t.DataElement[i+1].y;if(u===m)return[i,i,!0];if(u===d)return[i-1,i-1,!0];if(u===p)return[i+1,i+1,!0];if(u<p)o=i+1;else{if(u<d&&u>m)return[i-1,i,!0];if(u<m&&u>p)return[i,i+1,!0];a=i-1}}return[i,i,!1]}function mt(t,e,n,r){let o=r?e+n:e-n,[a,i,u]=Zt(t,o);if(!u)return[0,0,!1,u];if(a===i)return[t.DataElement[i].price,t.DataElement[i].y,!1,u];{let m=t.DataElement[a].x,d=t.DataElement[i].x,p=t.DataElement[a].price,y=t.DataElement[i].price,P=t.DataElement[a].y,b=t.DataElement[i].y;if(e>=m&&e<=d)return r?[y,b,!0,u]:[p,P,!0,u];{let T,I;return r?(T=p+(y-p)*(e-m)/(d-m),I=P-(o-m)*t.multiplier/y):(T=p+(y-p)*(e-m)/(d-m),I=b+(d-o)*t.multiplier/p),[T,I,!1,u]}}}function tn(t,e,n,r){let o=r?e-n:e+n,[a,i,u]=en(t,o);if(!u)return[0,0,!1,u];if(a===i)return[t.DataElement[i].price,t.DataElement[i].x,!1,u];{let m=t.DataElement[a].x,d=t.DataElement[i].x,p=t.DataElement[a].price,y=t.DataElement[i].price,P=t.DataElement[a].y,b=t.DataElement[i].y;if(e>=b&&e<=P)return r?[y,d,!0,u]:[p,m,!0,u];{let T,I;return r?(T=p+(y-p)*(P-e)/(P-b),I=m+y*(P-o)/t.multiplier):(T=p+(y-p)*(P-e)/(P-b),I=d-p*(o-b)/t.multiplier),[T,I,!1,u]}}}function nn(t,e){let n=mt(t,e,0,!1);return n[3]?n[0]:0}function rn(t,e,n,r){let o=Ne(t,e,n),a=R(t,e,o),i=R(t,n,o),u=R(t,r,o),m=!0,[d,p,y,P]=mt(t,a,u,m);if(!P)return 0;if(y)return r*t.multiplier/d;{let b=i-p;return ct(t,b,o)}}function on(t,e,n,r){let o=Ne(t,e,n),a=R(t,e,o),i=R(t,n,o),u=R(t,r,o),m=!1,[d,p,y,P]=tn(t,i,u,m);if(!P)return 0;if(y)return r*d/t.multiplier;{let b=a-p;return ct(t,b,o)}}function lt(t){let e=ut.decode(t);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(n=>({x:n.x.toNumber(),y:n.y.toNumber(),price:n.price.toNumber()}))}}function sn(t,e,n,r){let o=nn(t,R(t,e,Ne(t,e,n)))/t.multiplier;return r?o:1/o}var Ae=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(M);e&&(this._layoutData=lt(e==null?void 0:e.data))}}};var Et=require("@project-serum/serum"),C=A(require("bn.js"));var G=require("lodash"),De=A(require("dayjs")),dt=A(require("dayjs/plugin/utc"));De.default.extend(dt.default);var _e=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:3,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,De.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},pt={},an={};function L(t){let e=(0,G.get)(pt,t);if(!e){let n=(0,G.get)(an,t);e=new _e({name:t,logLevel:n}),(0,G.set)(pt,t,e)}return e}var bt=require("@solana/spl-token"),k=require("@solana/web3.js");function s({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var Ee=[s({pubkey:bt.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:k.SystemProgram.programId,isWritable:!1}),s({pubkey:k.SYSVAR_RENT_PUBKEY,isWritable:!1})];function F({publicKey:t,transformSol:e}){if(t instanceof k.PublicKey)return e&&t.equals(z)?yt:t;if(e&&t===z.toBase58())return yt;if(typeof t=="string")try{return new k.PublicKey(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var Hn=new k.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Jn=new k.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Xn=new k.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),$n=new k.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Zn=new k.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),er=new k.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),tr=new k.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),nr=new k.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),rr=new k.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),or=new k.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ir=new k.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),yt=new k.PublicKey("So11111111111111111111111111111111111111112"),z=k.PublicKey.default;var _=require("@solana/web3.js");var O=L("Raydium_txTool");function un(t,e){t.length<1&&O.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&O.logWithError(`no signers provided:, ${e.toString()}`);let n=new _.Transaction;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=e[0],n.add(...t);let r=n.compileMessage().serialize();return e.length+e.length*64+r.length}async function ft(t,e,n){let r=new _.PublicKey("RaydiumSimuLateTransaction11111111111111111"),o=[],a=new _.Transaction;a.feePayer=r;for(let m of e)un([...a.instructions,m],[r])>_.PACKET_DATA_SIZE&&(o.push(a),a=new _.Transaction,a.feePayer=r),a.add(m);a.instructions.length>0&&o.push(a);let i=[];try{i=await Promise.all(o.map(m=>t.simulateTransaction(m)))}catch(m){m instanceof Error&&O.logWithError(`failed to simulate for instructions, RPC_ERROR, ${m.message}`)}let u=[];for(let m of i){let{value:d}=m;if(O.debug(`simulate result: ${JSON.stringify(m)}`),d.logs){let p=d.logs.filter(y=>y&&y.includes(n));O.debug(`filteredLog: ${JSON.stringify(u)}`),p.length||O.logWithError(` "simulate log not match keyword, keyword: ${n}`),u.push(...p)}}return u}function gt(t,e){let n=t.match(/{["\w:,]+}/g);return!n||n.length!==1?O.logWithError(`simulate log fail to match json, keyword: ${e}`):n[0]}function D(t,e){let r=new RegExp(`"${e}":(\\d+)`,"g").exec(t);return!r||r.length!==2?O.logWithError(`simulate log fail to match key", key: ${e}`):r[1]}async function Oe(t,e){let[n,r]=await _.PublicKey.findProgramAddress(t,e);return{publicKey:n,nonce:r}}var St=A(require("big.js")),$=A(require("bn.js"));var w=A(require("bn.js"));var ne=L("Raydium_bignumber");var fr=new w.default(0),xt=new w.default(1),gr=new w.default(2),Pr=new w.default(3),xr=new w.default(5),ht=new w.default(10),kt=new w.default(100),hr=new w.default(1e3),kr=new w.default(1e4),Pt=9007199254740991;function h(t){if(t instanceof w.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new w.default(t);ne.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&ne.logWithError(`BigNumberish number underflow: ${t}`),(t>=Pt||t<=-Pt)&&ne.logWithError(`BigNumberish number overflow: ${t}`),new w.default(String(t))):typeof t=="bigint"?new w.default(t.toString()):(ne.logWithError(`invalid BigNumberish value: ${t}`),new w.default(0))}var Lt=A(require("toformat")),cn=Lt.default,H=cn;var J=A(require("big.js")),Tt=A(require("decimal.js-light"));var re=L("module/fraction"),We=H(J.default),X=H(Tt.default),ln={[0]:X.ROUND_DOWN,[1]:X.ROUND_HALF_UP,[2]:X.ROUND_UP},pn={[0]:J.default.roundDown,[1]:J.default.roundHalfUp,[2]:J.default.roundUp},g=class{constructor(e,n=xt){this.numerator=h(e),this.denominator=h(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new g(this.denominator,this.numerator)}add(e){let n=e instanceof g?e:new g(h(e));return this.denominator.eq(n.denominator)?new g(this.numerator.add(n.numerator),this.denominator):new g(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof g?e:new g(h(e));return this.denominator.eq(n.denominator)?new g(this.numerator.sub(n.numerator),this.denominator):new g(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof g?e:new g(h(e));return new g(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof g?e:new g(h(e));return new g(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||re.logWithError(`${e} is not an integer.`),e<=0&&re.logWithError(`${e} is not positive.`),X.set({precision:e+1,rounding:ln[r]});let o=new X(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||re.logWithError(`${e} is not an integer.`),e<0&&re.logWithError(`${e} is negative.`),We.DP=e,We.RM=pn[r]||1,new We(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var dn=L("Raydium_amount"),wt=H(St.default);function yn(t,e){let n="0",r="0";if(t.includes(".")){let o=t.split(".");o.length===2?([n,r]=o,r=r.padEnd(e,"0")):dn.logWithError(`invalid number string, num: ${t}`)}else n=t;return[n,r.slice(0,e)||r]}var W=class extends g{constructor(n,r,o=!0,a){let i=new $.default(0),u=ht.pow(new $.default(n.decimals));if(o)i=h(r);else{let m=new $.default(0),d=new $.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[p,y]=yn(r.toString(),n.decimals);m=h(p),d=h(y)}m=m.mul(u),i=m.add(d)}super(i,u);this.logger=L(a||"Amount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new W(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new W(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,o=0){return super.toSignificant(n,r,o)}toFixed(n=this.token.decimals,r,o=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,o)}toExact(n={groupSeparator:""}){return wt.DP=this.token.decimals,new wt(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};var It=require("@solana/web3.js"),Bt={symbol:"SOL",name:"Solana",decimals:9},V={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Vr={isQuantumSOL:!0,isLp:!1,official:!0,mint:new It.PublicKey(V.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var oe=require("@solana/web3.js");var Re=class{constructor({mint:e,decimals:n,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(e===z.toBase58()||e instanceof oe.PublicKey&&z.equals(e)){this.decimals=V.decimals,this.symbol=V.symbol,this.name=V.name,this.mint=new oe.PublicKey(V.mint);return}this.decimals=n,this.symbol=r,this.name=o,this.mint=a?oe.PublicKey.default:F({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},v=Re;v.WSOL=new Re(V);var Ke=class{constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},Me=Ke;Me.SOL=new Ke(Bt);var $r=new g(kt);var so=L("Raydium_price");var de=require("@solana/spl-token"),q=require("@solana/web3.js");var ie=S([B("instruction"),c("amountIn"),c("minAmountOut")]),se=S([B("instruction"),c("maxAmountIn"),c("amountOut")]),ae=S([B("instruction"),B("nonce")]),ue=S([B("instruction"),B("nonce"),c("startTime")]),ce=S([c("status"),c("nonce"),c("maxOrder"),c("depth"),c("baseDecimal"),c("quoteDecimal"),c("state"),c("resetFlag"),c("minSize"),c("volMaxCutRatio"),c("amountWaveRatio"),c("baseLotSize"),c("quoteLotSize"),c("minPriceMultiplier"),c("maxPriceMultiplier"),c("systemDecimalValue"),c("minSeparateNumerator"),c("minSeparateDenominator"),c("tradeFeeNumerator"),c("tradeFeeDenominator"),c("pnlNumerator"),c("pnlDenominator"),c("swapFeeNumerator"),c("swapFeeDenominator"),c("baseNeedTakePnl"),c("quoteNeedTakePnl"),c("quoteTotalPnl"),c("baseTotalPnl"),N("quoteTotalDeposited"),N("baseTotalDeposited"),N("swapBaseInAmount"),N("swapQuoteOutAmount"),c("swapBase2QuoteFee"),N("swapQuoteInAmount"),N("swapBaseOutAmount"),c("swapQuote2BaseFee"),f("baseVault"),f("quoteVault"),f("baseMint"),f("quoteMint"),f("lpMint"),f("openOrders"),f("marketId"),f("marketProgramId"),f("targetOrders"),f("withdrawQueue"),f("lpVault"),f("owner"),c("lpReserve"),j(c(),3,"padding")]),qt=S([c("accountType"),c("status"),c("nonce"),c("maxOrder"),c("depth"),c("baseDecimal"),c("quoteDecimal"),c("state"),c("resetFlag"),c("minSize"),c("volMaxCutRatio"),c("amountWaveRatio"),c("baseLotSize"),c("quoteLotSize"),c("minPriceMultiplier"),c("maxPriceMultiplier"),c("systemDecimalsValue"),c("abortTradeFactor"),c("priceTickMultiplier"),c("priceTick"),c("minSeparateNumerator"),c("minSeparateDenominator"),c("tradeFeeNumerator"),c("tradeFeeDenominator"),c("pnlNumerator"),c("pnlDenominator"),c("swapFeeNumerator"),c("swapFeeDenominator"),c("baseNeedTakePnl"),c("quoteNeedTakePnl"),c("quoteTotalPnl"),c("baseTotalPnl"),c("poolOpenTime"),c("punishPcAmount"),c("punishCoinAmount"),c("orderbookToInitTime"),N("swapBaseInAmount"),N("swapQuoteOutAmount"),N("swapQuoteInAmount"),N("swapBaseOutAmount"),c("swapQuote2BaseFee"),c("swapBase2QuoteFee"),f("baseVault"),f("quoteVault"),f("baseMint"),f("quoteMint"),f("lpMint"),f("modelDataAccount"),f("openOrders"),f("marketId"),f("marketProgramId"),f("targetOrders"),f("owner"),j(c(),64,"padding")]),me=S([B("instruction"),c("baseAmountIn"),c("quoteAmountIn"),c("fixedSide")]),le=S([B("instruction"),c("amountIn")]),ve={4:ce,5:qt};var pe=L("Raydium_liquidity_instruction");function bn(t){let{poolKeys:e,userKeys:n,amountIn:r,amountOut:o,fixedSide:a}=t,{version:i}=e;if(i===4||i===5){let u={poolKeys:e,userKeys:n};if(a==="in")return At(ee(Q({},u),{amountIn:r,minAmountOut:o}),i);if(a==="out")return Nt(ee(Q({},u),{maxAmountIn:r,amountOut:o}),i);pe.logWithError("invalid params","params",t)}throw pe.logWithError("invalid version","poolKeys.version",i),new Error("invalid version")}function Ve(t){let e=S([B("instruction"),B("simulateType")]),n=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},n);let r=[s({pubkey:t.id,isWritable:!1}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders,isWritable:!1}),s({pubkey:t.baseVault,isWritable:!1}),s({pubkey:t.quoteVault,isWritable:!1}),s({pubkey:t.lpMint,isWritable:!1}),s({pubkey:t.marketId,isWritable:!1})];return new q.TransactionInstruction({programId:t.programId,keys:r,data:n})}function At({poolKeys:t,userKeys:e,amountIn:n,minAmountOut:r},o){let a=Buffer.alloc(ie.span);ie.encode({instruction:9,amountIn:h(n),minAmountOut:h(r)},a);let i=[s({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders})];return o===4&&i.push(s({pubkey:t.targetOrders})),i.push(s({pubkey:t.baseVault}),s({pubkey:t.quoteVault})),o===5&&i.push(s({pubkey:M})),i.push(s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId}),s({pubkey:t.marketBids}),s({pubkey:t.marketAsks}),s({pubkey:t.marketEventQueue}),s({pubkey:t.marketBaseVault}),s({pubkey:t.marketQuoteVault}),s({pubkey:t.marketAuthority,isWritable:!1}),s({pubkey:e.tokenAccountIn}),s({pubkey:e.tokenAccountOut}),s({pubkey:e.owner,isWritable:!1})),new q.TransactionInstruction({programId:t.programId,keys:i,data:a})}function Nt({poolKeys:t,userKeys:e,maxAmountIn:n,amountOut:r},o){let a=Buffer.alloc(se.span);se.encode({instruction:11,maxAmountIn:h(n),amountOut:h(r)},a);let i=[s({pubkey:q.SystemProgram.programId,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.targetOrders}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault})];return o===5&&i.push(s({pubkey:M})),i.push(s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId}),s({pubkey:t.marketBids}),s({pubkey:t.marketAsks}),s({pubkey:t.marketEventQueue}),s({pubkey:t.marketBaseVault}),s({pubkey:t.marketQuoteVault}),s({pubkey:t.marketAuthority,isWritable:!1}),s({pubkey:e.tokenAccountIn}),s({pubkey:e.tokenAccountOut}),s({pubkey:e.owner,isWritable:!1,isSigner:!0})),new q.TransactionInstruction({programId:t.programId,keys:i,data:a})}function fn(t){let a=t,{owner:e}=a,n=$e(a,["owner"]),r=Buffer.alloc(ae.span);ae.encode({instruction:10,nonce:n.nonce},r);let o=[...Ee,s({pubkey:n.targetOrders}),s({pubkey:n.withdrawQueue}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.lpMint}),s({pubkey:n.baseMint,isWritable:!1}),s({pubkey:n.quoteMint,isWritable:!1}),s({pubkey:n.baseVault}),s({pubkey:n.quoteVault}),s({pubkey:n.lpVault}),s({pubkey:n.marketId,isWritable:!1}),s({pubkey:e,isSigner:!0})];return new q.TransactionInstruction({programId:n.programId,keys:o,data:r})}function gn(t){let{poolKeys:e,userKeys:n,startTime:r}=t,o=Buffer.alloc(ue.span);ue.encode({instruction:0,nonce:e.nonce,startTime:h(r)},o);let a=[...Ee,s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.lpMint}),s({pubkey:e.baseMint,isWritable:!1}),s({pubkey:e.quoteMint,isWritable:!1}),s({pubkey:e.baseVault,isWritable:!1}),s({pubkey:e.quoteVault,isWritable:!1}),s({pubkey:e.withdrawQueue}),s({pubkey:e.targetOrders}),s({pubkey:n.lpTokenAccount}),s({pubkey:e.lpVault,isWritable:!1}),s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId,isWritable:!1}),s({pubkey:n.payer,isSigner:!0})];return new q.TransactionInstruction({programId:e.programId,keys:a,data:o})}function Pn(t){let{poolKeys:e,userKeys:n,baseAmountIn:r,quoteAmountIn:o,fixedSide:a}=t,{version:i}=e;if(i===4||i===5){let u=Buffer.alloc(me.span);me.encode({instruction:3,baseAmountIn:h(r),quoteAmountIn:h(o),fixedSide:h(a==="base"?0:1)},u);let m=[s({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders,isWritable:!1}),s({pubkey:e.targetOrders}),s({pubkey:e.lpMint}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault})];return i===5&&m.push(s({pubkey:M})),m.push(s({pubkey:e.marketId,isWritable:!1}),s({pubkey:n.baseTokenAccount}),s({pubkey:n.quoteTokenAccount}),s({pubkey:n.lpTokenAccount}),s({pubkey:n.owner,isWritable:!1,isSigner:!0})),new q.TransactionInstruction({programId:e.programId,keys:m,data:u})}return pe.logWithError("invalid version","poolKeys.version",i),new q.TransactionInstruction({programId:e.programId,keys:[]})}function xn(t){let{poolKeys:e,userKeys:n,amountIn:r}=t,{version:o}=e;if(o===4||o===5){let a=Buffer.alloc(le.span);le.encode({instruction:4,amountIn:h(r)},a);let i=[s({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.targetOrders}),s({pubkey:e.lpMint}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault})];return o===5?i.push(s({pubkey:M})):i.push(s({pubkey:e.withdrawQueue}),s({pubkey:e.lpVault})),i.push(s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId}),s({pubkey:e.marketBaseVault}),s({pubkey:e.marketQuoteVault}),s({pubkey:e.marketAuthority,isWritable:!1}),s({pubkey:n.lpTokenAccount}),s({pubkey:n.baseTokenAccount}),s({pubkey:n.quoteTokenAccount}),s({pubkey:n.owner,isWritable:!1,isSigner:!0}),s({pubkey:e.marketEventQueue}),s({pubkey:e.marketBids}),s({pubkey:e.marketAsks})),new q.TransactionInstruction({programId:e.programId,keys:i,data:a})}return pe.logWithError("invalid version","poolKeys.version",o),new q.TransactionInstruction({programId:e.programId,keys:[]})}var Ue=require("@solana/web3.js");var Fe=L("Raydium_liquidity_serum"),Ce="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",_t=new Ue.PublicKey(Ce),hn={[Ce]:3},Dt={3:_t};function Ye(t){let e=we[t];return e||Fe.logWithError("invalid version","version",t),e}function Qe(t){let e=Dt[t];return e||Fe.logWithError("invalid version","version",t),e}async function je({programId:t,marketId:e}){let n=[e.toBuffer()],r=0,o;for(;r<100;){try{let a=n.concat(Buffer.from([r]),Buffer.alloc(7));o=await Ue.PublicKey.createProgramAddress(a,t)}catch(a){if(a instanceof TypeError)throw a;r++;continue}return{publicKey:o,nonce:r}}throw Fe.logWithError("unable to find a viable program address nonce","params",{programId:t,marketId:e}),new Error("unable to find a viable program address nonce")}var ye=L("Raydium_liquidity_util");function kn(t,e){let n=t instanceof W?t.token:v.WSOL,{baseMint:r,quoteMint:o}=e;if(n.mint.equals(r))return"base";if(n.mint.equals(o))return"quote";let a=`liquidity getTokenSide - token not match with pool, params: ${JSON.stringify({token:n.mint,baseMint:r,quoteMint:o})}`;throw console.error(a),new Error(a)}function Ln(t,e){let{baseMint:n,quoteMint:r}=e;return t.mint.equals(n)||t.mint.equals(r)}function Tn(t){let{status:e,startTime:n}=t,r=e.toNumber();return{[0]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[1]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[2]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[3]:{swap:!1,addLiquidity:!1,removeLiquidity:!0},[4]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[5]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[6]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[7]:{swap:Date.now()/1e3>=n.toNumber(),addLiquidity:!0,removeLiquidity:!0}}[r]||{swap:!1,addLiquidity:!1,removeLiquidity:!1}}function wn(t){let e=ve[t];return e||ye.logWithError("invalid version","version",t),e}function Ot(t){let e=Te[t];return e||ye.logWithError("invalid version","version",t),e}async function E({name:t,programId:e,marketId:n}){let{publicKey:r}=await Oe([e.toBuffer(),n.toBuffer(),Buffer.from(t,"utf-8")],e);return r}async function Wt({programId:t}){return Oe([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],t)}async function Sn({version:t,marketId:e,baseMint:n,quoteMint:r}){let o=Ot(t),[a,i,u]=[F({publicKey:e}),F({publicKey:n,transformSol:!0}),F({publicKey:r,transformSol:!0})],m=await E({name:"amm_associated_seed",programId:o,marketId:a}),d=await E({name:"lp_mint_associated_seed",programId:o,marketId:a}),{publicKey:p,nonce:y}=await Wt({programId:o}),P=await E({name:"coin_vault_associated_seed",programId:o,marketId:a}),b=await E({name:"pc_vault_associated_seed",programId:o,marketId:a}),T=await E({name:"temp_lp_token_associated_seed",programId:o,marketId:a}),I=await E({name:"open_order_associated_seed",programId:o,marketId:a}),be=await E({name:"target_associated_seed",programId:o,marketId:a}),fe=await E({name:"withdraw_associated_seed",programId:o,marketId:a}),ze=Ye(t),He=Qe(ze),{publicKey:Mt}=await je({programId:He,marketId:a});return{id:m,baseMint:i,quoteMint:u,lpMint:d,version:t,programId:o,authority:p,nonce:y,baseVault:P,quoteVault:b,lpVault:T,openOrders:I,targetOrders:be,withdrawQueue:fe,marketVersion:ze,marketProgramId:He,marketId:a,marketAuthority:Mt}}async function In({connection:t,pools:e}){let n=e.map(o=>Ve(o));return(await ft(t,n,"GetPoolData")).map(o=>{let a=gt(o,"GetPoolData"),i=new C.default(D(a,"status")),u=Number(D(a,"coin_decimals")),m=Number(D(a,"pc_decimals")),d=Number(D(a,"lp_decimals")),p=new C.default(D(a,"pool_coin_amount")),y=new C.default(D(a,"pool_pc_amount")),P=new C.default(D(a,"pool_lp_supply")),b="0";try{b=D(a,"pool_open_time")}catch{b="0"}return{status:i,baseDecimals:u,quoteDecimals:m,lpDecimals:d,baseReserve:p,quoteReserve:y,lpSupply:P,startTime:new C.default(b)}})}function Bn(t,e,n){return Rt(t.token,e.token,n)}function Rt(t,e,n){let{baseMint:r,quoteMint:o}=n,a=Ge(t,n),i=Ge(e,n);return a===i&&ye.logWithError("tokens not match with pool","params",{tokenA:t.mint,tokenB:e.mint,baseMint:r,quoteMint:o}),[a,i]}function Ge(t,e){let{baseMint:n,quoteMint:r}=e;return t.mint.equals(n)?"base":t.mint.equals(r)?"quote":(ye.logWithError("token not match with pool","params",{token:t.mint,baseMint:n,quoteMint:r}),"base")}var qn=t=>t==="a"||t==="b";async function An(t,e,n){let r=await t.getAccountInfo(e);if(r===null)return null;let o=ce.decode(r.data),a=await t.getTokenAccountBalance(o.baseVault),i=await t.getTokenAccountBalance(o.quoteVault),u=await Et.OpenOrders.load(t,o.openOrders,n),m=10**o.baseDecimal.toNumber(),d=10**o.quoteDecimal.toNumber(),p=u.baseTokenTotal.toNumber()/m,y=u.quoteTokenTotal.toNumber()/d,P=o.baseNeedTakePnl.toNumber()/m,b=o.quoteNeedTakePnl.toNumber()/d,T=a.value.uiAmount+p-P,I=i.value.uiAmount+y-b,be=parseFloat(o.lpReserve.toString()),fe=T/I;return{baseAmount:T,quoteAmount:I,lpSupply:be,baseVaultKey:o.baseVault,quoteVaultKey:o.quoteVault,baseVaultBalance:a.value.uiAmount,quoteVaultBalance:i.value.uiAmount,openOrdersKey:o.openOrders,openOrdersTotalBase:p,openOrdersTotalQuote:y,basePnl:P,quotePnl:b,priceInQuote:fe}}0&&(module.exports={DataElement,LIQUIDITY_FEES_DENOMINATOR,LIQUIDITY_FEES_NUMERATOR,LIQUIDITY_PROGRAMID_TO_VERSION,LIQUIDITY_PROGRAM_ID_V4,LIQUIDITY_PROGRAM_ID_V5,LIQUIDITY_VERSION_TO_PROGRAM_ID,LIQUIDITY_VERSION_TO_SERUM_VERSION,LIQUIDITY_VERSION_TO_STATE_LAYOUT,LiquidityPoolStatus,MODEL_DATA_PUBKEY,SERUM_PROGRAMID_TO_VERSION,SERUM_PROGRAM_ID_V3,SERUM_VERSION_TO_PROGRAM_ID,StableLayout,_LIQUIDITY_PROGRAM_ID_V4,_LIQUIDITY_PROGRAM_ID_V5,_SERUM_PROGRAM_ID_V3,addLiquidityLayout,createPoolV4Layout,fixedSwapInLayout,fixedSwapOutLayout,formatLayout,getAmountSide,getAmountsSide,getAssociatedPoolKeys,getDxByDyBaseIn,getDyByDxBaseIn,getLiquidityAssociatedAuthority,getLiquidityAssociatedId,getLiquidityInfo,getLiquidityProgramId,getLiquidityStateLayout,getPoolEnabledFeatures,getSerumAssociatedAuthority,getSerumProgramId,getSerumVersion,getStablePrice,getTokenSide,getTokensSide,includesToken,initPoolLayout,isValidFixedSide,liquidityStateV4Layout,liquidityStateV5Layout,makeAMMSwapInstruction,makeAddLiquidityInstruction,makeCreatePoolInstruction,makeInitPoolInstruction,makeRemoveLiquidityInstruction,makeSimulatePoolInfoInstruction,makeSimulationPoolInfo,makeSwapFixedInInstruction,makeSwapFixedOutInstruction,modelDataInfoLayout,removeLiquidityLayout});
//# sourceMappingURL=index.js.map