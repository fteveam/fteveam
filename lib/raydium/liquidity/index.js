var Mt=Object.create;var Q=Object.defineProperty,Kt=Object.defineProperties,Vt=Object.getOwnPropertyDescriptor,vt=Object.getOwnPropertyDescriptors,Ut=Object.getOwnPropertyNames,Z=Object.getOwnPropertySymbols,Ft=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var ze=(e,t,n)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Y=(e,t)=>{for(var n in t||(t={}))ge.call(t,n)&&ze(e,n,t[n]);if(Z)for(var n of Z(t))He.call(t,n)&&ze(e,n,t[n]);return e},ee=(e,t)=>Kt(e,vt(t));var Je=(e,t)=>{var n={};for(var r in e)ge.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Z)for(var r of Z(e))t.indexOf(r)<0&&He.call(e,r)&&(n[r]=e[r]);return n};var Ct=(e,t)=>{for(var n in t)Q(e,n,{get:t[n],enumerable:!0})},Xe=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ut(t))!ge.call(e,o)&&o!==n&&Q(e,o,{get:()=>t[o],enumerable:!(r=Vt(t,o))||r.enumerable});return e};var A=(e,t,n)=>(n=e!=null?Mt(Ft(e)):{},Xe(t||!e||!e.__esModule?Q(n,"default",{value:e,enumerable:!0}):n,e)),Qt=e=>Xe(Q({},"__esModule",{value:!0}),e);var _n={};Ct(_n,{DataElement:()=>it,LIQUIDITY_FEES_DENOMINATOR:()=>jt,LIQUIDITY_FEES_NUMERATOR:()=>Yt,LIQUIDITY_PROGRAMID_TO_VERSION:()=>Gt,LIQUIDITY_PROGRAM_ID_V4:()=>$e,LIQUIDITY_PROGRAM_ID_V5:()=>Ze,LIQUIDITY_VERSION_TO_PROGRAM_ID:()=>Te,LIQUIDITY_VERSION_TO_SERUM_VERSION:()=>Se,LIQUIDITY_VERSION_TO_STATE_LAYOUT:()=>Me,LiquidityPoolStatus:()=>he,MODEL_DATA_PUBKEY:()=>M,SERUM_PROGRAMID_TO_VERSION:()=>kn,SERUM_PROGRAM_ID_V3:()=>Nt,SERUM_VERSION_TO_PROGRAM_ID:()=>_t,StableLayout:()=>Ae,_LIQUIDITY_PROGRAM_ID_V4:()=>ke,_LIQUIDITY_PROGRAM_ID_V5:()=>Le,_SERUM_PROGRAM_ID_V3:()=>Ue,addLiquidityLayout:()=>me,createPoolV4Layout:()=>ae,fixedSwapInLayout:()=>ie,fixedSwapOutLayout:()=>se,formatLayout:()=>ct,getAmountSide:()=>Ln,getAmountsSide:()=>qn,getAssociatedPoolKeys:()=>In,getDxByDyBaseIn:()=>rn,getDyByDxBaseIn:()=>nn,getLiquidityAssociatedAuthority:()=>Et,getLiquidityAssociatedId:()=>O,getLiquidityInfo:()=>Nn,getLiquidityProgramId:()=>Ot,getLiquidityStateLayout:()=>wn,getPoolEnabledFeatures:()=>Sn,getSerumAssociatedAuthority:()=>Qe,getSerumProgramId:()=>Ce,getSerumVersion:()=>Fe,getStablePrice:()=>on,getTokenSide:()=>Ye,getTokensSide:()=>Wt,includesToken:()=>Tn,initPoolLayout:()=>ue,isValidFixedSide:()=>An,liquidityStateV4Layout:()=>ce,liquidityStateV5Layout:()=>Bt,makeAMMSwapInstruction:()=>fn,makeAddLiquidityInstruction:()=>xn,makeCreatePoolInstruction:()=>gn,makeInitPoolInstruction:()=>Pn,makeRemoveLiquidityInstruction:()=>hn,makeSimulatePoolInfoInstruction:()=>Ke,makeSimulationPoolInfo:()=>Bn,makeSwapFixedInInstruction:()=>qt,makeSwapFixedOutInstruction:()=>At,modelDataInfoLayout:()=>st,removeLiquidityLayout:()=>le});module.exports=Qt(_n);var Pe=require("@solana/web3.js"),xe=A(require("bn.js")),he=(m=>(m[m.Uninitialized=0]="Uninitialized",m[m.Initialized=1]="Initialized",m[m.Disabled=2]="Disabled",m[m.RemoveLiquidityOnly=3]="RemoveLiquidityOnly",m[m.LiquidityOnly=4]="LiquidityOnly",m[m.OrderBook=5]="OrderBook",m[m.Swap=6]="Swap",m[m.WaitingForStart=7]="WaitingForStart",m))(he||{}),Yt=new xe.default(25),jt=new xe.default(1e4),ke="675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8",$e=new Pe.PublicKey(ke),Le="5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h",Ze=new Pe.PublicKey(Le),Gt={[ke]:4,[Le]:5},Te={4:$e,5:Ze},Se={4:3,5:3};var ot=require("@solana/web3.js");var rt=require("@solana/web3.js"),U=A(require("bn.js"));var l=require("@solana/buffer-layout"),we=l.Layout,et=l.Structure;var tt=l.UInt;var nt=l.seq;var Ie=l.blob;var te=class extends we{constructor(n,r,o){super(n,o);this.blob=Ie(n),this.signed=r}decode(n,r=0){let o=new U.default(this.blob.decode(n,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(n,r,o=0){return typeof n=="number"&&(n=new U.default(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,o)}};function B(e){return new tt(1,e)}function c(e){return new te(8,!1,e)}function N(e){return new te(16,!1,e)}var Be=class extends we{constructor(n,r,o,a){super(n.span,a);this.layout=n,this.decoder=r,this.encoder=o}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,o){return this.layout.encode(this.encoder(n),r,o)}getSpan(n,r){return this.layout.getSpan(n,r)}};function f(e){return new Be(Ie(32),t=>new rt.PublicKey(t),t=>t.toBuffer(),e)}var qe=class extends et{decode(t,n){return super.decode(t,n)}};function w(e,t,n){return new qe(e,t,n)}function j(e,t,n){let r,o=typeof t=="number"?t:(0,U.isBN)(t)?t.toNumber():new Proxy(t,{get(a,i){if(!r){let u=Reflect.get(a,"count");r=(0,U.isBN)(u)?u.toNumber():u,Reflect.set(a,"count",r)}return Reflect.get(a,i)},set(a,i,u){return i==="count"&&(r=u),Reflect.set(a,i,u)}});return nt(e,o,n)}var M=new ot.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),K=5e4,it=w([c("x"),c("y"),c("price")]),st=w([c("accountType"),c("status"),c("multiplier"),c("validDataCount"),j(it,K,"DataElement")]);function zt(e,t){return[0,K-2]}function Ht(e){return[0,K-2]}function Jt(e){return[0,K-2]}function Xt(e,t,n){let[r,o]=zt(t,n),a=r,i=o,u=0,m=t*e.multiplier/n;for(;a<=i;){if(u=Math.floor((i+a)/2),u===0||u>=K-2)return[u,u,!1];let d=e.DataElement[u].x*e.multiplier/e.DataElement[u].y,p=e.DataElement[u-1].x*e.multiplier/e.DataElement[u-1].y,y=e.DataElement[u+1].x*e.multiplier/e.DataElement[u+1].y;if(m===d)return[u,u,!0];if(m===p)return[u-1,u-1,!0];if(m===y)return[u+1,u+1,!0];if(m<p)i=u-1;else{if(m>p&&m<d)return[u-1,u,!0];if(m>d&&m<y)return[u,u+1,!0];a=u+1}}return[u,u,!1]}function Ne(e,t,n){let[r,o,a]=Xt(e,t,n);if(!a)return 0;if(r===o){let i=e.DataElement[r].x;return t*e.multiplier/i}else{let i=e.DataElement[r].x,u=e.DataElement[r].y,m=e.DataElement[o].x,d=e.DataElement[o].y,p=n*(m*u-i*d),y=i*p,P=(m-i)*(t*u-i*n)*d,b=y+P;return t*e.multiplier*p/b}}function R(e,t,n){return t*e.multiplier/n}function at(e,t,n){return t*n/e.multiplier}function $t(e,t){let[n,r]=Ht(t),o=n,a=r,i=0,u=t;for(;o<a;){if(i=Math.floor((a+o)/2),i<=0||i>K-2)return[i,i,!1];let m=e.DataElement[i].x,d=e.DataElement[i-1].x,p=e.DataElement[i+1].x;if(u===m)return[i,i,!0];if(u===d)return[i-1,i-1,!0];if(u===p)return[i+1,i+1,!0];if(u<d)a=i-1;else{if(u>d&&u<m)return[i-1,i,!0];if(u>m&&u<p)return[i,i+1,!0];o=i+1}}return[i,i,!1]}function Zt(e,t){let[n,r]=Jt(t),o=n,a=r,i=0,u=t;for(;o<=a;){if(i=Math.floor((a+o)/2),i<=0||i>=K-2)return[i,i,!1];let m=e.DataElement[i].y,d=e.DataElement[i-1].y,p=e.DataElement[i+1].y;if(u===m)return[i,i,!0];if(u===d)return[i-1,i-1,!0];if(u===p)return[i+1,i+1,!0];if(u<p)o=i+1;else{if(u<d&&u>m)return[i-1,i,!0];if(u<m&&u>p)return[i,i+1,!0];a=i-1}}return[i,i,!1]}function ut(e,t,n,r){let o=r?t+n:t-n,[a,i,u]=$t(e,o);if(!u)return[0,0,!1,u];if(a===i)return[e.DataElement[i].price,e.DataElement[i].y,!1,u];{let m=e.DataElement[a].x,d=e.DataElement[i].x,p=e.DataElement[a].price,y=e.DataElement[i].price,P=e.DataElement[a].y,b=e.DataElement[i].y;if(t>=m&&t<=d)return r?[y,b,!0,u]:[p,P,!0,u];{let T,I;return r?(T=p+(y-p)*(t-m)/(d-m),I=P-(o-m)*e.multiplier/y):(T=p+(y-p)*(t-m)/(d-m),I=b+(d-o)*e.multiplier/p),[T,I,!1,u]}}}function en(e,t,n,r){let o=r?t-n:t+n,[a,i,u]=Zt(e,o);if(!u)return[0,0,!1,u];if(a===i)return[e.DataElement[i].price,e.DataElement[i].x,!1,u];{let m=e.DataElement[a].x,d=e.DataElement[i].x,p=e.DataElement[a].price,y=e.DataElement[i].price,P=e.DataElement[a].y,b=e.DataElement[i].y;if(t>=b&&t<=P)return r?[y,d,!0,u]:[p,m,!0,u];{let T,I;return r?(T=p+(y-p)*(P-t)/(P-b),I=m+y*(P-o)/e.multiplier):(T=p+(y-p)*(P-t)/(P-b),I=d-p*(o-b)/e.multiplier),[T,I,!1,u]}}}function tn(e,t){let n=ut(e,t,0,!1);return n[3]?n[0]:0}function nn(e,t,n,r){let o=Ne(e,t,n),a=R(e,t,o),i=R(e,n,o),u=R(e,r,o),m=!0,[d,p,y,P]=ut(e,a,u,m);if(!P)return 0;if(y)return r*e.multiplier/d;{let b=i-p;return at(e,b,o)}}function rn(e,t,n,r){let o=Ne(e,t,n),a=R(e,t,o),i=R(e,n,o),u=R(e,r,o),m=!1,[d,p,y,P]=en(e,i,u,m);if(!P)return 0;if(y)return r*d/e.multiplier;{let b=a-p;return at(e,b,o)}}function ct(e){let t=st.decode(e);return{accountType:t.accountType.toNumber(),status:t.status.toNumber(),multiplier:t.multiplier.toNumber(),validDataCount:t.validDataCount.toNumber(),DataElement:t.DataElement.map(n=>({x:n.x.toNumber(),y:n.y.toNumber(),price:n.price.toNumber()}))}}function on(e,t,n,r){let o=tn(e,R(e,t,Ne(e,t,n)))/e.multiplier;return r?o:1/o}var Ae=class{constructor({connection:t}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=t}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let t=await this.connection.getAccountInfo(M);t&&(this._layoutData=ct(t==null?void 0:t.data))}}};var Dt=require("@project-serum/serum"),C=A(require("bn.js"));var G=require("lodash"),lt=A(require("pino")),pt=A(require("pino-pretty")),mt={},sn={},an=(0,pt.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),un=(0,lt.default)({base:null,level:"silent"},an);function L(e){let t=(0,G.get)(mt,e);if(!t){let n=(0,G.get)(sn,e);t=un.child({name:e},{level:n}),(0,G.set)(mt,e,t)}return t.logWithError=(...n)=>{let r=n.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(r)},t}var yt=require("@solana/spl-token"),k=require("@solana/web3.js");function s({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var _e=[s({pubkey:yt.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:k.SystemProgram.programId,isWritable:!1}),s({pubkey:k.SYSVAR_RENT_PUBKEY,isWritable:!1})];function F({publicKey:e,transformSol:t}){if(e instanceof k.PublicKey)return t&&e.equals(z)?dt:e;if(t&&e===z.toBase58())return dt;if(typeof e=="string")try{return new k.PublicKey(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var $n=new k.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Zn=new k.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),er=new k.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),tr=new k.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),nr=new k.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),rr=new k.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),or=new k.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ir=new k.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),sr=new k.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ar=new k.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ur=new k.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),dt=new k.PublicKey("So11111111111111111111111111111111111111112"),z=k.PublicKey.default;var _=require("@solana/web3.js");var E=L("Raydium_txTool");function cn(e,t){e.length<1&&E.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&E.logWithError(`no signers provided:, ${t.toString()}`);let n=new _.Transaction;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);let r=n.compileMessage().serialize();return t.length+t.length*64+r.length}async function bt(e,t,n){let r=new _.PublicKey("RaydiumSimuLateTransaction11111111111111111"),o=[],a=new _.Transaction;a.feePayer=r;for(let m of t)cn([...a.instructions,m],[r])>_.PACKET_DATA_SIZE&&(o.push(a),a=new _.Transaction,a.feePayer=r),a.add(m);a.instructions.length>0&&o.push(a);let i=[];try{i=await Promise.all(o.map(m=>e.simulateTransaction(m)))}catch(m){m instanceof Error&&E.logWithError(`failed to simulate for instructions, RPC_ERROR, ${m.message}`)}let u=[];for(let m of i){let{value:d}=m;if(E.debug(`simulate result: ${JSON.stringify(m)}`),d.logs){let p=d.logs.filter(y=>y&&y.includes(n));E.debug(`filteredLog: ${JSON.stringify(u)}`),p.length||E.logWithError(` "simulate log not match keyword, keyword: ${n}`),u.push(...p)}}return u}function ft(e,t){let n=e.match(/{["\w:,]+}/g);return!n||n.length!==1?E.logWithError(`simulate log fail to match json, keyword: ${t}`):n[0]}function D(e,t){let r=new RegExp(`"${t}":(\\d+)`,"g").exec(e);return!r||r.length!==2?E.logWithError(`simulate log fail to match key", key: ${t}`):r[1]}async function De(e,t){let[n,r]=await _.PublicKey.findProgramAddress(e,t);return{publicKey:n,nonce:r}}var St=A(require("big.js")),$=A(require("bn.js"));var S=A(require("bn.js"));var ne=L("Raydium_bignumber");var xr=new S.default(0),Pt=new S.default(1),hr=new S.default(2),kr=new S.default(3),Lr=new S.default(5),xt=new S.default(10),ht=new S.default(100),Tr=new S.default(1e3),Sr=new S.default(1e4),gt=9007199254740991;function h(e){if(e instanceof S.default)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new S.default(e);ne.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&ne.logWithError(`BigNumberish number underflow: ${e}`),(e>=gt||e<=-gt)&&ne.logWithError(`BigNumberish number overflow: ${e}`),new S.default(String(e))):typeof e=="bigint"?new S.default(e.toString()):(ne.logWithError(`invalid BigNumberish value: ${e}`),new S.default(0))}var kt=A(require("toformat")),mn=kt.default,H=mn;var J=A(require("big.js")),Lt=A(require("decimal.js-light"));var re=L("module/fraction"),Oe=H(J.default),X=H(Lt.default),pn={[0]:X.ROUND_DOWN,[1]:X.ROUND_HALF_UP,[2]:X.ROUND_UP},dn={[0]:J.default.roundDown,[1]:J.default.roundHalfUp,[2]:J.default.roundUp},g=class{constructor(t,n=Pt){this.numerator=h(t),this.denominator=h(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new g(this.denominator,this.numerator)}add(t){let n=t instanceof g?t:new g(h(t));return this.denominator.eq(n.denominator)?new g(this.numerator.add(n.numerator),this.denominator):new g(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof g?t:new g(h(t));return this.denominator.eq(n.denominator)?new g(this.numerator.sub(n.numerator),this.denominator):new g(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof g?t:new g(h(t));return new g(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof g?t:new g(h(t));return new g(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||re.logWithError(`${t} is not an integer.`),t<=0&&re.logWithError(`${t} is not positive.`),X.set({precision:t+1,rounding:pn[r]});let o=new X(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||re.logWithError(`${t} is not an integer.`),t<0&&re.logWithError(`${t} is negative.`),Oe.DP=t,Oe.RM=dn[r]||1,new Oe(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var yn=L("Raydium_amount"),Tt=H(St.default);function bn(e,t){let n="0",r="0";if(e.includes(".")){let o=e.split(".");o.length===2?([n,r]=o,r=r.padEnd(t,"0")):yn.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,r.slice(0,t)||r]}var W=class extends g{constructor(n,r,o=!0,a){let i=new $.default(0),u=xt.pow(new $.default(n.decimals));if(o)i=h(r);else{let m=new $.default(0),d=new $.default(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[p,y]=bn(r.toString(),n.decimals);m=h(p),d=h(y)}m=m.mul(u),i=m.add(d)}super(i,u);this.logger=L(a||"Amount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new W(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new W(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,o=0){return super.toSignificant(n,r,o)}toFixed(n=this.token.decimals,r,o=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,o)}toExact(n={groupSeparator:""}){return Tt.DP=this.token.decimals,new Tt(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};var wt=require("@solana/web3.js"),It={symbol:"SOL",name:"Solana",decimals:9},v={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Cr={isQuantumSOL:!0,isLp:!1,official:!0,mint:new wt.PublicKey(v.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var oe=require("@solana/web3.js");var Ee=class{constructor({mint:t,decimals:n,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(t===z.toBase58()||t instanceof oe.PublicKey&&z.equals(t)){this.decimals=v.decimals,this.symbol=v.symbol,this.name=v.name,this.mint=new oe.PublicKey(v.mint);return}this.decimals=n,this.symbol=r,this.name=o,this.mint=a?oe.PublicKey.default:F({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},V=Ee;V.WSOL=new Ee(v);var Re=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},We=Re;We.SOL=new Re(It);var to=new g(ht);var co=L("Raydium_price");var de=require("@solana/spl-token"),q=require("@solana/web3.js");var ie=w([B("instruction"),c("amountIn"),c("minAmountOut")]),se=w([B("instruction"),c("maxAmountIn"),c("amountOut")]),ae=w([B("instruction"),B("nonce")]),ue=w([B("instruction"),B("nonce"),c("startTime")]),ce=w([c("status"),c("nonce"),c("maxOrder"),c("depth"),c("baseDecimal"),c("quoteDecimal"),c("state"),c("resetFlag"),c("minSize"),c("volMaxCutRatio"),c("amountWaveRatio"),c("baseLotSize"),c("quoteLotSize"),c("minPriceMultiplier"),c("maxPriceMultiplier"),c("systemDecimalValue"),c("minSeparateNumerator"),c("minSeparateDenominator"),c("tradeFeeNumerator"),c("tradeFeeDenominator"),c("pnlNumerator"),c("pnlDenominator"),c("swapFeeNumerator"),c("swapFeeDenominator"),c("baseNeedTakePnl"),c("quoteNeedTakePnl"),c("quoteTotalPnl"),c("baseTotalPnl"),N("quoteTotalDeposited"),N("baseTotalDeposited"),N("swapBaseInAmount"),N("swapQuoteOutAmount"),c("swapBase2QuoteFee"),N("swapQuoteInAmount"),N("swapBaseOutAmount"),c("swapQuote2BaseFee"),f("baseVault"),f("quoteVault"),f("baseMint"),f("quoteMint"),f("lpMint"),f("openOrders"),f("marketId"),f("marketProgramId"),f("targetOrders"),f("withdrawQueue"),f("lpVault"),f("owner"),c("lpReserve"),j(c(),3,"padding")]),Bt=w([c("accountType"),c("status"),c("nonce"),c("maxOrder"),c("depth"),c("baseDecimal"),c("quoteDecimal"),c("state"),c("resetFlag"),c("minSize"),c("volMaxCutRatio"),c("amountWaveRatio"),c("baseLotSize"),c("quoteLotSize"),c("minPriceMultiplier"),c("maxPriceMultiplier"),c("systemDecimalsValue"),c("abortTradeFactor"),c("priceTickMultiplier"),c("priceTick"),c("minSeparateNumerator"),c("minSeparateDenominator"),c("tradeFeeNumerator"),c("tradeFeeDenominator"),c("pnlNumerator"),c("pnlDenominator"),c("swapFeeNumerator"),c("swapFeeDenominator"),c("baseNeedTakePnl"),c("quoteNeedTakePnl"),c("quoteTotalPnl"),c("baseTotalPnl"),c("poolOpenTime"),c("punishPcAmount"),c("punishCoinAmount"),c("orderbookToInitTime"),N("swapBaseInAmount"),N("swapQuoteOutAmount"),N("swapQuoteInAmount"),N("swapBaseOutAmount"),c("swapQuote2BaseFee"),c("swapBase2QuoteFee"),f("baseVault"),f("quoteVault"),f("baseMint"),f("quoteMint"),f("lpMint"),f("modelDataAccount"),f("openOrders"),f("marketId"),f("marketProgramId"),f("targetOrders"),f("owner"),j(c(),64,"padding")]),me=w([B("instruction"),c("baseAmountIn"),c("quoteAmountIn"),c("fixedSide")]),le=w([B("instruction"),c("amountIn")]),Me={4:ce,5:Bt};var pe=L("Raydium_liquidity_instruction");function fn(e){let{poolKeys:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:a}=e,{version:i}=t;if(i===4||i===5){let u={poolKeys:t,userKeys:n};if(a==="in")return qt(ee(Y({},u),{amountIn:r,minAmountOut:o}),i);if(a==="out")return At(ee(Y({},u),{maxAmountIn:r,amountOut:o}),i);pe.logWithError("invalid params","params",e)}throw pe.logWithError("invalid version","poolKeys.version",i),new Error("invalid version")}function Ke(e){let t=w([B("instruction"),B("simulateType")]),n=Buffer.alloc(t.span);t.encode({instruction:12,simulateType:0},n);let r=[s({pubkey:e.id,isWritable:!1}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders,isWritable:!1}),s({pubkey:e.baseVault,isWritable:!1}),s({pubkey:e.quoteVault,isWritable:!1}),s({pubkey:e.lpMint,isWritable:!1}),s({pubkey:e.marketId,isWritable:!1})];return new q.TransactionInstruction({programId:e.programId,keys:r,data:n})}function qt({poolKeys:e,userKeys:t,amountIn:n,minAmountOut:r},o){let a=Buffer.alloc(ie.span);ie.encode({instruction:9,amountIn:h(n),minAmountOut:h(r)},a);let i=[s({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders})];return o===4&&i.push(s({pubkey:e.targetOrders})),i.push(s({pubkey:e.baseVault}),s({pubkey:e.quoteVault})),o===5&&i.push(s({pubkey:M})),i.push(s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId}),s({pubkey:e.marketBids}),s({pubkey:e.marketAsks}),s({pubkey:e.marketEventQueue}),s({pubkey:e.marketBaseVault}),s({pubkey:e.marketQuoteVault}),s({pubkey:e.marketAuthority,isWritable:!1}),s({pubkey:t.tokenAccountIn}),s({pubkey:t.tokenAccountOut}),s({pubkey:t.owner,isWritable:!1})),new q.TransactionInstruction({programId:e.programId,keys:i,data:a})}function At({poolKeys:e,userKeys:t,maxAmountIn:n,amountOut:r},o){let a=Buffer.alloc(se.span);se.encode({instruction:11,maxAmountIn:h(n),amountOut:h(r)},a);let i=[s({pubkey:q.SystemProgram.programId,isWritable:!1}),s({pubkey:e.id}),s({pubkey:e.authority,isWritable:!1}),s({pubkey:e.openOrders}),s({pubkey:e.targetOrders}),s({pubkey:e.baseVault}),s({pubkey:e.quoteVault})];return o===5&&i.push(s({pubkey:M})),i.push(s({pubkey:e.marketProgramId,isWritable:!1}),s({pubkey:e.marketId}),s({pubkey:e.marketBids}),s({pubkey:e.marketAsks}),s({pubkey:e.marketEventQueue}),s({pubkey:e.marketBaseVault}),s({pubkey:e.marketQuoteVault}),s({pubkey:e.marketAuthority,isWritable:!1}),s({pubkey:t.tokenAccountIn}),s({pubkey:t.tokenAccountOut}),s({pubkey:t.owner,isWritable:!1,isSigner:!0})),new q.TransactionInstruction({programId:e.programId,keys:i,data:a})}function gn(e){let a=e,{owner:t}=a,n=Je(a,["owner"]),r=Buffer.alloc(ae.span);ae.encode({instruction:10,nonce:n.nonce},r);let o=[..._e,s({pubkey:n.targetOrders}),s({pubkey:n.withdrawQueue}),s({pubkey:n.authority,isWritable:!1}),s({pubkey:n.lpMint}),s({pubkey:n.baseMint,isWritable:!1}),s({pubkey:n.quoteMint,isWritable:!1}),s({pubkey:n.baseVault}),s({pubkey:n.quoteVault}),s({pubkey:n.lpVault}),s({pubkey:n.marketId,isWritable:!1}),s({pubkey:t,isSigner:!0})];return new q.TransactionInstruction({programId:n.programId,keys:o,data:r})}function Pn(e){let{poolKeys:t,userKeys:n,startTime:r}=e,o=Buffer.alloc(ue.span);ue.encode({instruction:0,nonce:t.nonce,startTime:h(r)},o);let a=[..._e,s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.lpMint}),s({pubkey:t.baseMint,isWritable:!1}),s({pubkey:t.quoteMint,isWritable:!1}),s({pubkey:t.baseVault,isWritable:!1}),s({pubkey:t.quoteVault,isWritable:!1}),s({pubkey:t.withdrawQueue}),s({pubkey:t.targetOrders}),s({pubkey:n.lpTokenAccount}),s({pubkey:t.lpVault,isWritable:!1}),s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId,isWritable:!1}),s({pubkey:n.payer,isSigner:!0})];return new q.TransactionInstruction({programId:t.programId,keys:a,data:o})}function xn(e){let{poolKeys:t,userKeys:n,baseAmountIn:r,quoteAmountIn:o,fixedSide:a}=e,{version:i}=t;if(i===4||i===5){let u=Buffer.alloc(me.span);me.encode({instruction:3,baseAmountIn:h(r),quoteAmountIn:h(o),fixedSide:h(a==="base"?0:1)},u);let m=[s({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders,isWritable:!1}),s({pubkey:t.targetOrders}),s({pubkey:t.lpMint}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault})];return i===5&&m.push(s({pubkey:M})),m.push(s({pubkey:t.marketId,isWritable:!1}),s({pubkey:n.baseTokenAccount}),s({pubkey:n.quoteTokenAccount}),s({pubkey:n.lpTokenAccount}),s({pubkey:n.owner,isWritable:!1,isSigner:!0})),new q.TransactionInstruction({programId:t.programId,keys:m,data:u})}return pe.logWithError("invalid version","poolKeys.version",i),new q.TransactionInstruction({programId:t.programId,keys:[]})}function hn(e){let{poolKeys:t,userKeys:n,amountIn:r}=e,{version:o}=t;if(o===4||o===5){let a=Buffer.alloc(le.span);le.encode({instruction:4,amountIn:h(r)},a);let i=[s({pubkey:de.TOKEN_PROGRAM_ID,isWritable:!1}),s({pubkey:t.id}),s({pubkey:t.authority,isWritable:!1}),s({pubkey:t.openOrders}),s({pubkey:t.targetOrders}),s({pubkey:t.lpMint}),s({pubkey:t.baseVault}),s({pubkey:t.quoteVault})];return o===5?i.push(s({pubkey:M})):i.push(s({pubkey:t.withdrawQueue}),s({pubkey:t.lpVault})),i.push(s({pubkey:t.marketProgramId,isWritable:!1}),s({pubkey:t.marketId}),s({pubkey:t.marketBaseVault}),s({pubkey:t.marketQuoteVault}),s({pubkey:t.marketAuthority,isWritable:!1}),s({pubkey:n.lpTokenAccount}),s({pubkey:n.baseTokenAccount}),s({pubkey:n.quoteTokenAccount}),s({pubkey:n.owner,isWritable:!1,isSigner:!0}),s({pubkey:t.marketEventQueue}),s({pubkey:t.marketBids}),s({pubkey:t.marketAsks})),new q.TransactionInstruction({programId:t.programId,keys:i,data:a})}return pe.logWithError("invalid version","poolKeys.version",o),new q.TransactionInstruction({programId:t.programId,keys:[]})}var Ve=require("@solana/web3.js");var ve=L("Raydium_liquidity_serum"),Ue="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",Nt=new Ve.PublicKey(Ue),kn={[Ue]:3},_t={3:Nt};function Fe(e){let t=Se[e];return t||ve.logWithError("invalid version","version",e),t}function Ce(e){let t=_t[e];return t||ve.logWithError("invalid version","version",e),t}async function Qe({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,o;for(;r<100;){try{let a=n.concat(Buffer.from([r]),Buffer.alloc(7));o=await Ve.PublicKey.createProgramAddress(a,e)}catch(a){if(a instanceof TypeError)throw a;r++;continue}return{publicKey:o,nonce:r}}throw ve.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),new Error("unable to find a viable program address nonce")}var ye=L("Raydium_liquidity_util");function Ln(e,t){let n=e instanceof W?e.token:V.WSOL,{baseMint:r,quoteMint:o}=t;if(n.mint.equals(r))return"base";if(n.mint.equals(o))return"quote";let a=`liquidity getTokenSide - token not match with pool, params: ${JSON.stringify({token:n.mint,baseMint:r,quoteMint:o})}`;throw console.error(a),new Error(a)}function Tn(e,t){let{baseMint:n,quoteMint:r}=t;return e.mint.equals(n)||e.mint.equals(r)}function Sn(e){let{status:t,startTime:n}=e,r=t.toNumber();return{[0]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[1]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[2]:{swap:!1,addLiquidity:!1,removeLiquidity:!1},[3]:{swap:!1,addLiquidity:!1,removeLiquidity:!0},[4]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[5]:{swap:!1,addLiquidity:!0,removeLiquidity:!0},[6]:{swap:!0,addLiquidity:!0,removeLiquidity:!0},[7]:{swap:Date.now()/1e3>=n.toNumber(),addLiquidity:!0,removeLiquidity:!0}}[r]||{swap:!1,addLiquidity:!1,removeLiquidity:!1}}function wn(e){let t=Me[e];return t||ye.logWithError("invalid version","version",e),t}function Ot(e){let t=Te[e];return t||ye.logWithError("invalid version","version",e),t}async function O({name:e,programId:t,marketId:n}){let{publicKey:r}=await De([t.toBuffer(),n.toBuffer(),Buffer.from(e,"utf-8")],t);return r}async function Et({programId:e}){return De([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],e)}async function In({version:e,marketId:t,baseMint:n,quoteMint:r}){let o=Ot(e),[a,i,u]=[F({publicKey:t}),F({publicKey:n,transformSol:!0}),F({publicKey:r,transformSol:!0})],m=await O({name:"amm_associated_seed",programId:o,marketId:a}),d=await O({name:"lp_mint_associated_seed",programId:o,marketId:a}),{publicKey:p,nonce:y}=await Et({programId:o}),P=await O({name:"coin_vault_associated_seed",programId:o,marketId:a}),b=await O({name:"pc_vault_associated_seed",programId:o,marketId:a}),T=await O({name:"temp_lp_token_associated_seed",programId:o,marketId:a}),I=await O({name:"open_order_associated_seed",programId:o,marketId:a}),be=await O({name:"target_associated_seed",programId:o,marketId:a}),fe=await O({name:"withdraw_associated_seed",programId:o,marketId:a}),je=Fe(e),Ge=Ce(je),{publicKey:Rt}=await Qe({programId:Ge,marketId:a});return{id:m,baseMint:i,quoteMint:u,lpMint:d,version:e,programId:o,authority:p,nonce:y,baseVault:P,quoteVault:b,lpVault:T,openOrders:I,targetOrders:be,withdrawQueue:fe,marketVersion:je,marketProgramId:Ge,marketId:a,marketAuthority:Rt}}async function Bn({connection:e,pools:t}){let n=t.map(o=>Ke(o));return(await bt(e,n,"GetPoolData")).map(o=>{let a=ft(o,"GetPoolData"),i=new C.default(D(a,"status")),u=Number(D(a,"coin_decimals")),m=Number(D(a,"pc_decimals")),d=Number(D(a,"lp_decimals")),p=new C.default(D(a,"pool_coin_amount")),y=new C.default(D(a,"pool_pc_amount")),P=new C.default(D(a,"pool_lp_supply")),b="0";try{b=D(a,"pool_open_time")}catch{b="0"}return{status:i,baseDecimals:u,quoteDecimals:m,lpDecimals:d,baseReserve:p,quoteReserve:y,lpSupply:P,startTime:new C.default(b)}})}function qn(e,t,n){return Wt(e.token,t.token,n)}function Wt(e,t,n){let{baseMint:r,quoteMint:o}=n,a=Ye(e,n),i=Ye(t,n);return a===i&&ye.logWithError("tokens not match with pool","params",{tokenA:e.mint,tokenB:t.mint,baseMint:r,quoteMint:o}),[a,i]}function Ye(e,t){let{baseMint:n,quoteMint:r}=t;return e.mint.equals(n)?"base":e.mint.equals(r)?"quote":(ye.logWithError("token not match with pool","params",{token:e.mint,baseMint:n,quoteMint:r}),"base")}var An=e=>e==="a"||e==="b";async function Nn(e,t,n){let r=await e.getAccountInfo(t);if(r===null)return null;let o=ce.decode(r.data),a=await e.getTokenAccountBalance(o.baseVault),i=await e.getTokenAccountBalance(o.quoteVault),u=await Dt.OpenOrders.load(e,o.openOrders,n),m=10**o.baseDecimal.toNumber(),d=10**o.quoteDecimal.toNumber(),p=u.baseTokenTotal.toNumber()/m,y=u.quoteTokenTotal.toNumber()/d,P=o.baseNeedTakePnl.toNumber()/m,b=o.quoteNeedTakePnl.toNumber()/d,T=a.value.uiAmount+p-P,I=i.value.uiAmount+y-b,be=parseFloat(o.lpReserve.toString()),fe=T/I;return{baseAmount:T,quoteAmount:I,lpSupply:be,baseVaultKey:o.baseVault,quoteVaultKey:o.quoteVault,baseVaultBalance:a.value.uiAmount,quoteVaultBalance:i.value.uiAmount,openOrdersKey:o.openOrders,openOrdersTotalBase:p,openOrdersTotalQuote:y,basePnl:P,quotePnl:b,priceInQuote:fe}}0&&(module.exports={DataElement,LIQUIDITY_FEES_DENOMINATOR,LIQUIDITY_FEES_NUMERATOR,LIQUIDITY_PROGRAMID_TO_VERSION,LIQUIDITY_PROGRAM_ID_V4,LIQUIDITY_PROGRAM_ID_V5,LIQUIDITY_VERSION_TO_PROGRAM_ID,LIQUIDITY_VERSION_TO_SERUM_VERSION,LIQUIDITY_VERSION_TO_STATE_LAYOUT,LiquidityPoolStatus,MODEL_DATA_PUBKEY,SERUM_PROGRAMID_TO_VERSION,SERUM_PROGRAM_ID_V3,SERUM_VERSION_TO_PROGRAM_ID,StableLayout,_LIQUIDITY_PROGRAM_ID_V4,_LIQUIDITY_PROGRAM_ID_V5,_SERUM_PROGRAM_ID_V3,addLiquidityLayout,createPoolV4Layout,fixedSwapInLayout,fixedSwapOutLayout,formatLayout,getAmountSide,getAmountsSide,getAssociatedPoolKeys,getDxByDyBaseIn,getDyByDxBaseIn,getLiquidityAssociatedAuthority,getLiquidityAssociatedId,getLiquidityInfo,getLiquidityProgramId,getLiquidityStateLayout,getPoolEnabledFeatures,getSerumAssociatedAuthority,getSerumProgramId,getSerumVersion,getStablePrice,getTokenSide,getTokensSide,includesToken,initPoolLayout,isValidFixedSide,liquidityStateV4Layout,liquidityStateV5Layout,makeAMMSwapInstruction,makeAddLiquidityInstruction,makeCreatePoolInstruction,makeInitPoolInstruction,makeRemoveLiquidityInstruction,makeSimulatePoolInfoInstruction,makeSimulationPoolInfo,makeSwapFixedInInstruction,makeSwapFixedOutInstruction,modelDataInfoLayout,removeLiquidityLayout});
//# sourceMappingURL=index.js.map