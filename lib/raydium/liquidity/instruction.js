var Ee=Object.create;var T=Object.defineProperty,qe=Object.defineProperties,_e=Object.getOwnPropertyDescriptor,Oe=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertyNames,A=Object.getOwnPropertySymbols,Me=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var ue=(t,e,n)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,B=(t,e)=>{for(var n in e||(e={}))Y.call(e,n)&&ue(t,n,e[n]);if(A)for(var n of A(e))ae.call(e,n)&&ue(t,n,e[n]);return t},M=(t,e)=>qe(t,Oe(e));var se=(t,e)=>{var n={};for(var i in t)Y.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&A)for(var i of A(t))e.indexOf(i)<0&&ae.call(t,i)&&(n[i]=t[i]);return n};var Ue=(t,e)=>{for(var n in e)T(t,n,{get:e[n],enumerable:!0})},ce=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Ae(e))!Y.call(t,a)&&a!==n&&T(t,a,{get:()=>e[a],enumerable:!(i=_e(e,a))||i.enumerable});return t};var L=(t,e,n)=>(n=t!=null?Ee(Me(t)):{},ce(e||!t||!t.__esModule?T(n,"default",{value:t,enumerable:!0}):n,t)),Fe=t=>ce(T({},"__esModule",{value:!0}),t);var nt={};Ue(nt,{makeAMMSwapInstruction:()=>Ge,makeAddLiquidityInstruction:()=>et,makeCreatePoolInstruction:()=>Je,makeInitPoolInstruction:()=>$e,makeRemoveLiquidityInstruction:()=>tt,makeSimulatePoolInfoInstruction:()=>Ze,makeSwapFixedInInstruction:()=>Ie,makeSwapFixedOutInstruction:()=>De});module.exports=Fe(nt);var C=require("@solana/spl-token"),P=require("@solana/web3.js");var y=L(require("bn.js"));var fe=L(require("big.js")),ze=L(require("bn.js"));var N=require("lodash"),pe=L(require("pino")),le=L(require("pino-pretty")),me={},Re={},ve=(0,le.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Ve=(0,pe.default)({base:null,level:"silent"},ve);function h(t){let e=(0,N.get)(me,t);if(!e){let n=(0,N.get)(Re,t);e=Ve.child({name:t},{level:n}),(0,N.set)(me,t,e)}return e.logWithError=(...n)=>{let i=n.map(a=>typeof a=="object"?JSON.stringify(a):a).join(", ");throw new Error(i)},e}var de=L(require("toformat")),Ce=de.default,W=Ce;var I=L(require("big.js")),be=L(require("decimal.js-light"));var U=h("module/fraction"),Q=W(I.default),D=W(be.default),je={[0]:D.ROUND_DOWN,[1]:D.ROUND_HALF_UP,[2]:D.ROUND_UP},Ye={[0]:I.default.roundDown,[1]:I.default.roundHalfUp,[2]:I.default.roundUp},p=class{constructor(e,n=ye){this.numerator=d(e),this.denominator=d(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new p(this.denominator,this.numerator)}add(e){let n=e instanceof p?e:new p(d(e));return this.denominator.eq(n.denominator)?new p(this.numerator.add(n.numerator),this.denominator):new p(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof p?e:new p(d(e));return this.denominator.eq(n.denominator)?new p(this.numerator.sub(n.numerator),this.denominator):new p(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof p?e:new p(d(e));return new p(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof p?e:new p(d(e));return new p(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},i=1){Number.isInteger(e)||U.logWithError(`${e} is not an integer.`),e<=0&&U.logWithError(`${e} is not positive.`),D.set({precision:e+1,rounding:je[i]});let a=new D(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return a.toFormat(a.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},i=1){return Number.isInteger(e)||U.logWithError(`${e} is not an integer.`),e<0&&U.logWithError(`${e} is negative.`),Q.DP=e,Q.RM=Ye[i]||1,new Q(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var ht=h("Raydium_amount"),Lt=W(fe.default);var ge=require("@solana/web3.js"),xe={symbol:"SOL",name:"Solana",decimals:9},S={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},wt={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ge.PublicKey(S.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var F=require("@solana/web3.js");var ke=require("@solana/spl-token"),l=require("@solana/web3.js");function r({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var z=[r({pubkey:ke.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:l.SystemProgram.programId,isWritable:!1}),r({pubkey:l.SYSVAR_RENT_PUBKEY,isWritable:!1})];function he({publicKey:t,transformSol:e}){if(t instanceof l.PublicKey)return e&&t.equals(E)?Pe:t;if(e&&t===E.toBase58())return Pe;if(typeof t=="string")try{return new l.PublicKey(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var Nt=new l.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Wt=new l.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),It=new l.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Dt=new l.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Et=new l.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),qt=new l.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),_t=new l.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ot=new l.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),At=new l.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Mt=new l.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ut=new l.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Pe=new l.PublicKey("So11111111111111111111111111111111111111112"),E=l.PublicKey.default;var H=class{constructor({mint:e,decimals:n,symbol:i="UNKNOWN",name:a="UNKNOWN",skipMint:c=!1}){if(e===E.toBase58()||e instanceof F.PublicKey&&E.equals(e)){this.decimals=S.decimals,this.symbol=S.symbol,this.name=S.name,this.mint=new F.PublicKey(S.mint);return}this.decimals=n,this.symbol=i,this.name=a,this.mint=c?F.PublicKey.default:he({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},q=H;q.WSOL=new H(S);var X=class{constructor({decimals:e,symbol:n="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=i}equals(e){return this===e}},K=X;K.SOL=new X(xe);var Xt=new p(Le);var nn=h("Raydium_price");var R=h("Raydium_bignumber");var Pn=new y.default(0),ye=new y.default(1),kn=new y.default(2),hn=new y.default(3),Ln=new y.default(5),He=new y.default(10),Le=new y.default(100),Sn=new y.default(1e3),wn=new y.default(1e4),Se=9007199254740991;function d(t){if(t instanceof y.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new y.default(t);R.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&R.logWithError(`BigNumberish number underflow: ${t}`),(t>=Se||t<=-Se)&&R.logWithError(`BigNumberish number overflow: ${t}`),new y.default(String(t))):typeof t=="bigint"?new y.default(t.toString()):(R.logWithError(`invalid BigNumberish value: ${t}`),new y.default(0))}var Ne=require("@solana/web3.js"),w=L(require("bn.js"));var u=require("@solana/buffer-layout"),G=u.Layout,we=u.Structure;var Te=u.UInt;var Be=u.seq;var Z=u.blob;var v=class extends G{constructor(n,i,a){super(n,a);this.blob=Z(n),this.signed=i}decode(n,i=0){let a=new w.default(this.blob.decode(n,i),10,"le");return this.signed?a.fromTwos(this.span*8).clone():a}encode(n,i,a=0){return typeof n=="number"&&(n=new w.default(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),i,a)}};function x(t){return new Te(1,t)}function o(t){return new v(8,!1,t)}function k(t){return new v(16,!1,t)}var J=class extends G{constructor(n,i,a,c){super(n.span,c);this.layout=n,this.decoder=i,this.encoder=a}decode(n,i){return this.decoder(this.layout.decode(n,i))}encode(n,i,a){return this.layout.encode(this.encoder(n),i,a)}getSpan(n,i){return this.layout.getSpan(n,i)}};function m(t){return new J(Z(32),e=>new Ne.PublicKey(e),e=>e.toBuffer(),t)}var $=class extends we{decode(e,n){return super.decode(e,n)}};function f(t,e,n){return new $(t,e,n)}function _(t,e,n){let i,a=typeof e=="number"?e:(0,w.isBN)(e)?e.toNumber():new Proxy(e,{get(c,s){if(!i){let g=Reflect.get(c,"count");i=(0,w.isBN)(g)?g.toNumber():g,Reflect.set(c,"count",i)}return Reflect.get(c,s)},set(c,s,g){return s==="count"&&(i=g),Reflect.set(c,s,g)}});return Be(t,a,n)}var ee=f([x("instruction"),o("amountIn"),o("minAmountOut")]),te=f([x("instruction"),o("maxAmountIn"),o("amountOut")]),ne=f([x("instruction"),x("nonce")]),re=f([x("instruction"),x("nonce"),o("startTime")]),Rn=f([o("status"),o("nonce"),o("maxOrder"),o("depth"),o("baseDecimal"),o("quoteDecimal"),o("state"),o("resetFlag"),o("minSize"),o("volMaxCutRatio"),o("amountWaveRatio"),o("baseLotSize"),o("quoteLotSize"),o("minPriceMultiplier"),o("maxPriceMultiplier"),o("systemDecimalValue"),o("minSeparateNumerator"),o("minSeparateDenominator"),o("tradeFeeNumerator"),o("tradeFeeDenominator"),o("pnlNumerator"),o("pnlDenominator"),o("swapFeeNumerator"),o("swapFeeDenominator"),o("baseNeedTakePnl"),o("quoteNeedTakePnl"),o("quoteTotalPnl"),o("baseTotalPnl"),k("quoteTotalDeposited"),k("baseTotalDeposited"),k("swapBaseInAmount"),k("swapQuoteOutAmount"),o("swapBase2QuoteFee"),k("swapQuoteInAmount"),k("swapBaseOutAmount"),o("swapQuote2BaseFee"),m("baseVault"),m("quoteVault"),m("baseMint"),m("quoteMint"),m("lpMint"),m("openOrders"),m("marketId"),m("marketProgramId"),m("targetOrders"),m("withdrawQueue"),m("lpVault"),m("owner"),o("lpReserve"),_(o(),3,"padding")]),vn=f([o("accountType"),o("status"),o("nonce"),o("maxOrder"),o("depth"),o("baseDecimal"),o("quoteDecimal"),o("state"),o("resetFlag"),o("minSize"),o("volMaxCutRatio"),o("amountWaveRatio"),o("baseLotSize"),o("quoteLotSize"),o("minPriceMultiplier"),o("maxPriceMultiplier"),o("systemDecimalsValue"),o("abortTradeFactor"),o("priceTickMultiplier"),o("priceTick"),o("minSeparateNumerator"),o("minSeparateDenominator"),o("tradeFeeNumerator"),o("tradeFeeDenominator"),o("pnlNumerator"),o("pnlDenominator"),o("swapFeeNumerator"),o("swapFeeDenominator"),o("baseNeedTakePnl"),o("quoteNeedTakePnl"),o("quoteTotalPnl"),o("baseTotalPnl"),o("poolOpenTime"),o("punishPcAmount"),o("punishCoinAmount"),o("orderbookToInitTime"),k("swapBaseInAmount"),k("swapQuoteOutAmount"),k("swapQuoteInAmount"),k("swapBaseOutAmount"),o("swapQuote2BaseFee"),o("swapBase2QuoteFee"),m("baseVault"),m("quoteVault"),m("baseMint"),m("quoteMint"),m("lpMint"),m("modelDataAccount"),m("openOrders"),m("marketId"),m("marketProgramId"),m("targetOrders"),m("owner"),_(o(),64,"padding")]),oe=f([x("instruction"),o("baseAmountIn"),o("quoteAmountIn"),o("fixedSide")]),ie=f([x("instruction"),o("amountIn")]);var We=require("@solana/web3.js");var O=new We.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ke=5e4,Xe=f([o("x"),o("y"),o("price")]),Yn=f([o("accountType"),o("status"),o("multiplier"),o("validDataCount"),_(Xe,Ke,"DataElement")]);var V=h("Raydium_liquidity_instruction");function Ge(t){let{poolKeys:e,userKeys:n,amountIn:i,amountOut:a,fixedSide:c}=t,{version:s}=e;if(s===4||s===5){let g={poolKeys:e,userKeys:n};if(c==="in")return Ie(M(B({},g),{amountIn:i,minAmountOut:a}),s);if(c==="out")return De(M(B({},g),{maxAmountIn:i,amountOut:a}),s);V.logWithError("invalid params","params",t)}throw V.logWithError("invalid version","poolKeys.version",s),new Error("invalid version")}function Ze(t){let e=f([x("instruction"),x("simulateType")]),n=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},n);let i=[r({pubkey:t.id,isWritable:!1}),r({pubkey:t.authority,isWritable:!1}),r({pubkey:t.openOrders,isWritable:!1}),r({pubkey:t.baseVault,isWritable:!1}),r({pubkey:t.quoteVault,isWritable:!1}),r({pubkey:t.lpMint,isWritable:!1}),r({pubkey:t.marketId,isWritable:!1})];return new P.TransactionInstruction({programId:t.programId,keys:i,data:n})}function Ie({poolKeys:t,userKeys:e,amountIn:n,minAmountOut:i},a){let c=Buffer.alloc(ee.span);ee.encode({instruction:9,amountIn:d(n),minAmountOut:d(i)},c);let s=[r({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:t.id}),r({pubkey:t.authority,isWritable:!1}),r({pubkey:t.openOrders})];return a===4&&s.push(r({pubkey:t.targetOrders})),s.push(r({pubkey:t.baseVault}),r({pubkey:t.quoteVault})),a===5&&s.push(r({pubkey:O})),s.push(r({pubkey:t.marketProgramId,isWritable:!1}),r({pubkey:t.marketId}),r({pubkey:t.marketBids}),r({pubkey:t.marketAsks}),r({pubkey:t.marketEventQueue}),r({pubkey:t.marketBaseVault}),r({pubkey:t.marketQuoteVault}),r({pubkey:t.marketAuthority,isWritable:!1}),r({pubkey:e.tokenAccountIn}),r({pubkey:e.tokenAccountOut}),r({pubkey:e.owner,isWritable:!1})),new P.TransactionInstruction({programId:t.programId,keys:s,data:c})}function De({poolKeys:t,userKeys:e,maxAmountIn:n,amountOut:i},a){let c=Buffer.alloc(te.span);te.encode({instruction:11,maxAmountIn:d(n),amountOut:d(i)},c);let s=[r({pubkey:P.SystemProgram.programId,isWritable:!1}),r({pubkey:t.id}),r({pubkey:t.authority,isWritable:!1}),r({pubkey:t.openOrders}),r({pubkey:t.targetOrders}),r({pubkey:t.baseVault}),r({pubkey:t.quoteVault})];return a===5&&s.push(r({pubkey:O})),s.push(r({pubkey:t.marketProgramId,isWritable:!1}),r({pubkey:t.marketId}),r({pubkey:t.marketBids}),r({pubkey:t.marketAsks}),r({pubkey:t.marketEventQueue}),r({pubkey:t.marketBaseVault}),r({pubkey:t.marketQuoteVault}),r({pubkey:t.marketAuthority,isWritable:!1}),r({pubkey:e.tokenAccountIn}),r({pubkey:e.tokenAccountOut}),r({pubkey:e.owner,isWritable:!1,isSigner:!0})),new P.TransactionInstruction({programId:t.programId,keys:s,data:c})}function Je(t){let c=t,{owner:e}=c,n=se(c,["owner"]),i=Buffer.alloc(ne.span);ne.encode({instruction:10,nonce:n.nonce},i);let a=[...z,r({pubkey:n.targetOrders}),r({pubkey:n.withdrawQueue}),r({pubkey:n.authority,isWritable:!1}),r({pubkey:n.lpMint}),r({pubkey:n.baseMint,isWritable:!1}),r({pubkey:n.quoteMint,isWritable:!1}),r({pubkey:n.baseVault}),r({pubkey:n.quoteVault}),r({pubkey:n.lpVault}),r({pubkey:n.marketId,isWritable:!1}),r({pubkey:e,isSigner:!0})];return new P.TransactionInstruction({programId:n.programId,keys:a,data:i})}function $e(t){let{poolKeys:e,userKeys:n,startTime:i}=t,a=Buffer.alloc(re.span);re.encode({instruction:0,nonce:e.nonce,startTime:d(i)},a);let c=[...z,r({pubkey:e.id}),r({pubkey:e.authority,isWritable:!1}),r({pubkey:e.openOrders}),r({pubkey:e.lpMint}),r({pubkey:e.baseMint,isWritable:!1}),r({pubkey:e.quoteMint,isWritable:!1}),r({pubkey:e.baseVault,isWritable:!1}),r({pubkey:e.quoteVault,isWritable:!1}),r({pubkey:e.withdrawQueue}),r({pubkey:e.targetOrders}),r({pubkey:n.lpTokenAccount}),r({pubkey:e.lpVault,isWritable:!1}),r({pubkey:e.marketProgramId,isWritable:!1}),r({pubkey:e.marketId,isWritable:!1}),r({pubkey:n.payer,isSigner:!0})];return new P.TransactionInstruction({programId:e.programId,keys:c,data:a})}function et(t){let{poolKeys:e,userKeys:n,baseAmountIn:i,quoteAmountIn:a,fixedSide:c}=t,{version:s}=e;if(s===4||s===5){let g=Buffer.alloc(oe.span);oe.encode({instruction:3,baseAmountIn:d(i),quoteAmountIn:d(a),fixedSide:d(c==="base"?0:1)},g);let j=[r({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:e.id}),r({pubkey:e.authority,isWritable:!1}),r({pubkey:e.openOrders,isWritable:!1}),r({pubkey:e.targetOrders}),r({pubkey:e.lpMint}),r({pubkey:e.baseVault}),r({pubkey:e.quoteVault})];return s===5&&j.push(r({pubkey:O})),j.push(r({pubkey:e.marketId,isWritable:!1}),r({pubkey:n.baseTokenAccount}),r({pubkey:n.quoteTokenAccount}),r({pubkey:n.lpTokenAccount}),r({pubkey:n.owner,isWritable:!1,isSigner:!0})),new P.TransactionInstruction({programId:e.programId,keys:j,data:g})}return V.logWithError("invalid version","poolKeys.version",s),new P.TransactionInstruction({programId:e.programId,keys:[]})}function tt(t){let{poolKeys:e,userKeys:n,amountIn:i}=t,{version:a}=e;if(a===4||a===5){let c=Buffer.alloc(ie.span);ie.encode({instruction:4,amountIn:d(i)},c);let s=[r({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:e.id}),r({pubkey:e.authority,isWritable:!1}),r({pubkey:e.openOrders}),r({pubkey:e.targetOrders}),r({pubkey:e.lpMint}),r({pubkey:e.baseVault}),r({pubkey:e.quoteVault})];return a===5?s.push(r({pubkey:O})):s.push(r({pubkey:e.withdrawQueue}),r({pubkey:e.lpVault})),s.push(r({pubkey:e.marketProgramId,isWritable:!1}),r({pubkey:e.marketId}),r({pubkey:e.marketBaseVault}),r({pubkey:e.marketQuoteVault}),r({pubkey:e.marketAuthority,isWritable:!1}),r({pubkey:n.lpTokenAccount}),r({pubkey:n.baseTokenAccount}),r({pubkey:n.quoteTokenAccount}),r({pubkey:n.owner,isWritable:!1,isSigner:!0}),r({pubkey:e.marketEventQueue}),r({pubkey:e.marketBids}),r({pubkey:e.marketAsks})),new P.TransactionInstruction({programId:e.programId,keys:s,data:c})}return V.logWithError("invalid version","poolKeys.version",a),new P.TransactionInstruction({programId:e.programId,keys:[]})}0&&(module.exports={makeAMMSwapInstruction,makeAddLiquidityInstruction,makeCreatePoolInstruction,makeInitPoolInstruction,makeRemoveLiquidityInstruction,makeSimulatePoolInfoInstruction,makeSwapFixedInInstruction,makeSwapFixedOutInstruction});
//# sourceMappingURL=instruction.js.map