var qe=Object.create;var T=Object.defineProperty,_e=Object.defineProperties,Oe=Object.getOwnPropertyDescriptor,Ae=Object.getOwnPropertyDescriptors,Me=Object.getOwnPropertyNames,A=Object.getOwnPropertySymbols,Ue=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var se=(t,e,n)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,B=(t,e)=>{for(var n in e||(e={}))Y.call(e,n)&&se(t,n,e[n]);if(A)for(var n of A(e))ce.call(e,n)&&se(t,n,e[n]);return t},M=(t,e)=>_e(t,Ae(e));var me=(t,e)=>{var n={};for(var i in t)Y.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&A)for(var i of A(t))e.indexOf(i)<0&&ce.call(t,i)&&(n[i]=t[i]);return n};var ve=(t,e)=>{for(var n in e)T(t,n,{get:e[n],enumerable:!0})},pe=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Me(e))!Y.call(t,a)&&a!==n&&T(t,a,{get:()=>e[a],enumerable:!(i=Oe(e,a))||i.enumerable});return t};var L=(t,e,n)=>(n=t!=null?qe(Ue(t)):{},pe(e||!t||!t.__esModule?T(n,"default",{value:t,enumerable:!0}):n,t)),Fe=t=>pe(T({},"__esModule",{value:!0}),t);var tt={};ve(tt,{makeAMMSwapInstruction:()=>Xe,makeAddLiquidityInstruction:()=>$e,makeCreatePoolInstruction:()=>Ze,makeInitPoolInstruction:()=>Je,makeRemoveLiquidityInstruction:()=>et,makeSimulatePoolInfoInstruction:()=>Ge,makeSwapFixedInInstruction:()=>De,makeSwapFixedOutInstruction:()=>Ee});module.exports=Fe(tt);var C=require("@solana/spl-token"),P=require("@solana/web3.js");var y=L(require("bn.js"));var ge=L(require("big.js")),Qe=L(require("bn.js"));var N=require("lodash"),z=L(require("dayjs")),de=L(require("dayjs/plugin/utc"));z.default.extend(de.default);var Q=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,z.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},le={},Re={};function k(t){let e=(0,N.get)(le,t);if(!e){let n=(0,N.get)(Re,t);e=new Q({name:t,logLevel:n}),(0,N.set)(le,t,e)}return e}var be=L(require("toformat")),Ve=be.default,W=Ve;var I=L(require("big.js")),ye=L(require("decimal.js-light"));var U=k("module/fraction"),H=W(I.default),D=W(ye.default),Ce={[0]:D.ROUND_DOWN,[1]:D.ROUND_HALF_UP,[2]:D.ROUND_UP},je={[0]:I.default.roundDown,[1]:I.default.roundHalfUp,[2]:I.default.roundUp},p=class{constructor(e,n=fe){this.numerator=d(e),this.denominator=d(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new p(this.denominator,this.numerator)}add(e){let n=e instanceof p?e:new p(d(e));return this.denominator.eq(n.denominator)?new p(this.numerator.add(n.numerator),this.denominator):new p(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof p?e:new p(d(e));return this.denominator.eq(n.denominator)?new p(this.numerator.sub(n.numerator),this.denominator):new p(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof p?e:new p(d(e));return new p(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof p?e:new p(d(e));return new p(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},i=1){Number.isInteger(e)||U.logWithError(`${e} is not an integer.`),e<=0&&U.logWithError(`${e} is not positive.`),D.set({precision:e+1,rounding:Ce[i]});let a=new D(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return a.toFormat(a.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},i=1){return Number.isInteger(e)||U.logWithError(`${e} is not an integer.`),e<0&&U.logWithError(`${e} is negative.`),H.DP=e,H.RM=je[i]||1,new H(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var xt=k("Raydium_amount"),Pt=W(ge.default);var xe=require("@solana/web3.js"),Pe={symbol:"SOL",name:"Solana",decimals:9},S={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},kt={isQuantumSOL:!0,isLp:!1,official:!0,mint:new xe.PublicKey(S.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var v=require("@solana/web3.js");var ke=require("@solana/spl-token"),l=require("@solana/web3.js");function r({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var K=[r({pubkey:ke.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:l.SystemProgram.programId,isWritable:!1}),r({pubkey:l.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Le({publicKey:t,transformSol:e}){if(t instanceof l.PublicKey)return e&&t.equals(E)?he:t;if(e&&t===E.toBase58())return he;if(typeof t=="string")try{return new l.PublicKey(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var wt=new l.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Tt=new l.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Bt=new l.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Nt=new l.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Wt=new l.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),It=new l.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Dt=new l.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Et=new l.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qt=new l.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),_t=new l.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ot=new l.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),he=new l.PublicKey("So11111111111111111111111111111111111111112"),E=l.PublicKey.default;var X=class{constructor({mint:e,decimals:n,symbol:i="UNKNOWN",name:a="UNKNOWN",skipMint:c=!1}){if(e===E.toBase58()||e instanceof v.PublicKey&&E.equals(e)){this.decimals=S.decimals,this.symbol=S.symbol,this.name=S.name,this.mint=new v.PublicKey(S.mint);return}this.decimals=n,this.symbol=i,this.name=a,this.mint=c?v.PublicKey.default:Le({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},q=X;q.WSOL=new X(S);var Z=class{constructor({decimals:e,symbol:n="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=i}equals(e){return this===e}},G=Z;G.SOL=new Z(Pe);var zt=new p(Se);var $t=k("Raydium_price");var F=k("Raydium_bignumber");var fn=new y.default(0),fe=new y.default(1),gn=new y.default(2),xn=new y.default(3),Pn=new y.default(5),ze=new y.default(10),Se=new y.default(100),hn=new y.default(1e3),kn=new y.default(1e4),we=9007199254740991;function d(t){if(t instanceof y.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new y.default(t);F.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&F.logWithError(`BigNumberish number underflow: ${t}`),(t>=we||t<=-we)&&F.logWithError(`BigNumberish number overflow: ${t}`),new y.default(String(t))):typeof t=="bigint"?new y.default(t.toString()):(F.logWithError(`invalid BigNumberish value: ${t}`),new y.default(0))}var We=require("@solana/web3.js"),w=L(require("bn.js"));var u=require("@solana/buffer-layout"),J=u.Layout,Te=u.Structure;var Be=u.UInt;var Ne=u.seq;var $=u.blob;var R=class extends J{constructor(n,i,a){super(n,a);this.blob=$(n),this.signed=i}decode(n,i=0){let a=new w.default(this.blob.decode(n,i),10,"le");return this.signed?a.fromTwos(this.span*8).clone():a}encode(n,i,a=0){return typeof n=="number"&&(n=new w.default(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),i,a)}};function x(t){return new Be(1,t)}function o(t){return new R(8,!1,t)}function h(t){return new R(16,!1,t)}var ee=class extends J{constructor(n,i,a,c){super(n.span,c);this.layout=n,this.decoder=i,this.encoder=a}decode(n,i){return this.decoder(this.layout.decode(n,i))}encode(n,i,a){return this.layout.encode(this.encoder(n),i,a)}getSpan(n,i){return this.layout.getSpan(n,i)}};function m(t){return new ee($(32),e=>new We.PublicKey(e),e=>e.toBuffer(),t)}var te=class extends Te{decode(e,n){return super.decode(e,n)}};function f(t,e,n){return new te(t,e,n)}function _(t,e,n){let i,a=typeof e=="number"?e:(0,w.isBN)(e)?e.toNumber():new Proxy(e,{get(c,s){if(!i){let g=Reflect.get(c,"count");i=(0,w.isBN)(g)?g.toNumber():g,Reflect.set(c,"count",i)}return Reflect.get(c,s)},set(c,s,g){return s==="count"&&(i=g),Reflect.set(c,s,g)}});return Ne(t,a,n)}var ne=f([x("instruction"),o("amountIn"),o("minAmountOut")]),re=f([x("instruction"),o("maxAmountIn"),o("amountOut")]),oe=f([x("instruction"),x("nonce")]),ie=f([x("instruction"),x("nonce"),o("startTime")]),Mn=f([o("status"),o("nonce"),o("maxOrder"),o("depth"),o("baseDecimal"),o("quoteDecimal"),o("state"),o("resetFlag"),o("minSize"),o("volMaxCutRatio"),o("amountWaveRatio"),o("baseLotSize"),o("quoteLotSize"),o("minPriceMultiplier"),o("maxPriceMultiplier"),o("systemDecimalValue"),o("minSeparateNumerator"),o("minSeparateDenominator"),o("tradeFeeNumerator"),o("tradeFeeDenominator"),o("pnlNumerator"),o("pnlDenominator"),o("swapFeeNumerator"),o("swapFeeDenominator"),o("baseNeedTakePnl"),o("quoteNeedTakePnl"),o("quoteTotalPnl"),o("baseTotalPnl"),h("quoteTotalDeposited"),h("baseTotalDeposited"),h("swapBaseInAmount"),h("swapQuoteOutAmount"),o("swapBase2QuoteFee"),h("swapQuoteInAmount"),h("swapBaseOutAmount"),o("swapQuote2BaseFee"),m("baseVault"),m("quoteVault"),m("baseMint"),m("quoteMint"),m("lpMint"),m("openOrders"),m("marketId"),m("marketProgramId"),m("targetOrders"),m("withdrawQueue"),m("lpVault"),m("owner"),o("lpReserve"),_(o(),3,"padding")]),Un=f([o("accountType"),o("status"),o("nonce"),o("maxOrder"),o("depth"),o("baseDecimal"),o("quoteDecimal"),o("state"),o("resetFlag"),o("minSize"),o("volMaxCutRatio"),o("amountWaveRatio"),o("baseLotSize"),o("quoteLotSize"),o("minPriceMultiplier"),o("maxPriceMultiplier"),o("systemDecimalsValue"),o("abortTradeFactor"),o("priceTickMultiplier"),o("priceTick"),o("minSeparateNumerator"),o("minSeparateDenominator"),o("tradeFeeNumerator"),o("tradeFeeDenominator"),o("pnlNumerator"),o("pnlDenominator"),o("swapFeeNumerator"),o("swapFeeDenominator"),o("baseNeedTakePnl"),o("quoteNeedTakePnl"),o("quoteTotalPnl"),o("baseTotalPnl"),o("poolOpenTime"),o("punishPcAmount"),o("punishCoinAmount"),o("orderbookToInitTime"),h("swapBaseInAmount"),h("swapQuoteOutAmount"),h("swapQuoteInAmount"),h("swapBaseOutAmount"),o("swapQuote2BaseFee"),o("swapBase2QuoteFee"),m("baseVault"),m("quoteVault"),m("baseMint"),m("quoteMint"),m("lpMint"),m("modelDataAccount"),m("openOrders"),m("marketId"),m("marketProgramId"),m("targetOrders"),m("owner"),_(o(),64,"padding")]),ue=f([x("instruction"),o("baseAmountIn"),o("quoteAmountIn"),o("fixedSide")]),ae=f([x("instruction"),o("amountIn")]);var Ie=require("@solana/web3.js");var O=new Ie.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),He=5e4,Ke=f([o("x"),o("y"),o("price")]),Vn=f([o("accountType"),o("status"),o("multiplier"),o("validDataCount"),_(Ke,He,"DataElement")]);var V=k("Raydium_liquidity_instruction");function Xe(t){let{poolKeys:e,userKeys:n,amountIn:i,amountOut:a,fixedSide:c}=t,{version:s}=e;if(s===4||s===5){let g={poolKeys:e,userKeys:n};if(c==="in")return De(M(B({},g),{amountIn:i,minAmountOut:a}),s);if(c==="out")return Ee(M(B({},g),{maxAmountIn:i,amountOut:a}),s);V.logWithError("invalid params","params",t)}throw V.logWithError("invalid version","poolKeys.version",s),new Error("invalid version")}function Ge(t){let e=f([x("instruction"),x("simulateType")]),n=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},n);let i=[r({pubkey:t.id,isWritable:!1}),r({pubkey:t.authority,isWritable:!1}),r({pubkey:t.openOrders,isWritable:!1}),r({pubkey:t.baseVault,isWritable:!1}),r({pubkey:t.quoteVault,isWritable:!1}),r({pubkey:t.lpMint,isWritable:!1}),r({pubkey:t.marketId,isWritable:!1})];return new P.TransactionInstruction({programId:t.programId,keys:i,data:n})}function De({poolKeys:t,userKeys:e,amountIn:n,minAmountOut:i},a){let c=Buffer.alloc(ne.span);ne.encode({instruction:9,amountIn:d(n),minAmountOut:d(i)},c);let s=[r({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:t.id}),r({pubkey:t.authority,isWritable:!1}),r({pubkey:t.openOrders})];return a===4&&s.push(r({pubkey:t.targetOrders})),s.push(r({pubkey:t.baseVault}),r({pubkey:t.quoteVault})),a===5&&s.push(r({pubkey:O})),s.push(r({pubkey:t.marketProgramId,isWritable:!1}),r({pubkey:t.marketId}),r({pubkey:t.marketBids}),r({pubkey:t.marketAsks}),r({pubkey:t.marketEventQueue}),r({pubkey:t.marketBaseVault}),r({pubkey:t.marketQuoteVault}),r({pubkey:t.marketAuthority,isWritable:!1}),r({pubkey:e.tokenAccountIn}),r({pubkey:e.tokenAccountOut}),r({pubkey:e.owner,isWritable:!1})),new P.TransactionInstruction({programId:t.programId,keys:s,data:c})}function Ee({poolKeys:t,userKeys:e,maxAmountIn:n,amountOut:i},a){let c=Buffer.alloc(re.span);re.encode({instruction:11,maxAmountIn:d(n),amountOut:d(i)},c);let s=[r({pubkey:P.SystemProgram.programId,isWritable:!1}),r({pubkey:t.id}),r({pubkey:t.authority,isWritable:!1}),r({pubkey:t.openOrders}),r({pubkey:t.targetOrders}),r({pubkey:t.baseVault}),r({pubkey:t.quoteVault})];return a===5&&s.push(r({pubkey:O})),s.push(r({pubkey:t.marketProgramId,isWritable:!1}),r({pubkey:t.marketId}),r({pubkey:t.marketBids}),r({pubkey:t.marketAsks}),r({pubkey:t.marketEventQueue}),r({pubkey:t.marketBaseVault}),r({pubkey:t.marketQuoteVault}),r({pubkey:t.marketAuthority,isWritable:!1}),r({pubkey:e.tokenAccountIn}),r({pubkey:e.tokenAccountOut}),r({pubkey:e.owner,isWritable:!1,isSigner:!0})),new P.TransactionInstruction({programId:t.programId,keys:s,data:c})}function Ze(t){let c=t,{owner:e}=c,n=me(c,["owner"]),i=Buffer.alloc(oe.span);oe.encode({instruction:10,nonce:n.nonce},i);let a=[...K,r({pubkey:n.targetOrders}),r({pubkey:n.withdrawQueue}),r({pubkey:n.authority,isWritable:!1}),r({pubkey:n.lpMint}),r({pubkey:n.baseMint,isWritable:!1}),r({pubkey:n.quoteMint,isWritable:!1}),r({pubkey:n.baseVault}),r({pubkey:n.quoteVault}),r({pubkey:n.lpVault}),r({pubkey:n.marketId,isWritable:!1}),r({pubkey:e,isSigner:!0})];return new P.TransactionInstruction({programId:n.programId,keys:a,data:i})}function Je(t){let{poolKeys:e,userKeys:n,startTime:i}=t,a=Buffer.alloc(ie.span);ie.encode({instruction:0,nonce:e.nonce,startTime:d(i)},a);let c=[...K,r({pubkey:e.id}),r({pubkey:e.authority,isWritable:!1}),r({pubkey:e.openOrders}),r({pubkey:e.lpMint}),r({pubkey:e.baseMint,isWritable:!1}),r({pubkey:e.quoteMint,isWritable:!1}),r({pubkey:e.baseVault,isWritable:!1}),r({pubkey:e.quoteVault,isWritable:!1}),r({pubkey:e.withdrawQueue}),r({pubkey:e.targetOrders}),r({pubkey:n.lpTokenAccount}),r({pubkey:e.lpVault,isWritable:!1}),r({pubkey:e.marketProgramId,isWritable:!1}),r({pubkey:e.marketId,isWritable:!1}),r({pubkey:n.payer,isSigner:!0})];return new P.TransactionInstruction({programId:e.programId,keys:c,data:a})}function $e(t){let{poolKeys:e,userKeys:n,baseAmountIn:i,quoteAmountIn:a,fixedSide:c}=t,{version:s}=e;if(s===4||s===5){let g=Buffer.alloc(ue.span);ue.encode({instruction:3,baseAmountIn:d(i),quoteAmountIn:d(a),fixedSide:d(c==="base"?0:1)},g);let j=[r({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:e.id}),r({pubkey:e.authority,isWritable:!1}),r({pubkey:e.openOrders,isWritable:!1}),r({pubkey:e.targetOrders}),r({pubkey:e.lpMint}),r({pubkey:e.baseVault}),r({pubkey:e.quoteVault})];return s===5&&j.push(r({pubkey:O})),j.push(r({pubkey:e.marketId,isWritable:!1}),r({pubkey:n.baseTokenAccount}),r({pubkey:n.quoteTokenAccount}),r({pubkey:n.lpTokenAccount}),r({pubkey:n.owner,isWritable:!1,isSigner:!0})),new P.TransactionInstruction({programId:e.programId,keys:j,data:g})}return V.logWithError("invalid version","poolKeys.version",s),new P.TransactionInstruction({programId:e.programId,keys:[]})}function et(t){let{poolKeys:e,userKeys:n,amountIn:i}=t,{version:a}=e;if(a===4||a===5){let c=Buffer.alloc(ae.span);ae.encode({instruction:4,amountIn:d(i)},c);let s=[r({pubkey:C.TOKEN_PROGRAM_ID,isWritable:!1}),r({pubkey:e.id}),r({pubkey:e.authority,isWritable:!1}),r({pubkey:e.openOrders}),r({pubkey:e.targetOrders}),r({pubkey:e.lpMint}),r({pubkey:e.baseVault}),r({pubkey:e.quoteVault})];return a===5?s.push(r({pubkey:O})):s.push(r({pubkey:e.withdrawQueue}),r({pubkey:e.lpVault})),s.push(r({pubkey:e.marketProgramId,isWritable:!1}),r({pubkey:e.marketId}),r({pubkey:e.marketBaseVault}),r({pubkey:e.marketQuoteVault}),r({pubkey:e.marketAuthority,isWritable:!1}),r({pubkey:n.lpTokenAccount}),r({pubkey:n.baseTokenAccount}),r({pubkey:n.quoteTokenAccount}),r({pubkey:n.owner,isWritable:!1,isSigner:!0}),r({pubkey:e.marketEventQueue}),r({pubkey:e.marketBids}),r({pubkey:e.marketAsks})),new P.TransactionInstruction({programId:e.programId,keys:s,data:c})}return V.logWithError("invalid version","poolKeys.version",a),new P.TransactionInstruction({programId:e.programId,keys:[]})}0&&(module.exports={makeAMMSwapInstruction,makeAddLiquidityInstruction,makeCreatePoolInstruction,makeInitPoolInstruction,makeRemoveLiquidityInstruction,makeSimulatePoolInfoInstruction,makeSwapFixedInInstruction,makeSwapFixedOutInstruction});
//# sourceMappingURL=instruction.js.map