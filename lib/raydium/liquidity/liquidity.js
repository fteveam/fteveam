var Bn=Object.create;var be=Object.defineProperty,Nn=Object.defineProperties,qn=Object.getOwnPropertyDescriptor,Mn=Object.getOwnPropertyDescriptors,Dn=Object.getOwnPropertyNames,Le=Object.getOwnPropertySymbols,En=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable;var kt=(t,e,n)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,V=(t,e)=>{for(var n in e||(e={}))ve.call(e,n)&&kt(t,n,e[n]);if(Le)for(var n of Le(e))wt.call(e,n)&&kt(t,n,e[n]);return t},Z=(t,e)=>Nn(t,Mn(e));var v=(t,e)=>{var n={};for(var o in t)ve.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&Le)for(var o of Le(t))e.indexOf(o)<0&&wt.call(t,o)&&(n[o]=t[o]);return n};var On=(t,e)=>{for(var n in e)be(t,n,{get:e[n],enumerable:!0})},Tt=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Dn(e))!ve.call(t,r)&&r!==n&&be(t,r,{get:()=>e[r],enumerable:!(o=qn(e,r))||o.enumerable});return t};var R=(t,e,n)=>(n=t!=null?Bn(En(t)):{},Tt(e||!t||!t.__esModule?be(n,"default",{value:t,enumerable:!0}):n,t)),Rn=t=>Tt(be({},"__esModule",{value:!0}),t);var ko={};On(ko,{default:()=>We});module.exports=Rn(ko);var kn=require("@solana/web3.js"),G=R(require("bn.js"));var A=R(require("bn.js"));var Bt=R(require("big.js")),ke=R(require("bn.js"));var ye=require("lodash"),Ce=R(require("dayjs")),At=R(require("dayjs/plugin/utc"));Ce.default.extend(At.default);var Ke=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:3,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,Ce.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},It={},Wn={};function I(t){let e=(0,ye.get)(It,t);if(!e){let n=(0,ye.get)(Wn,t);e=new Ke({name:t,logLevel:n}),(0,ye.set)(It,t,e)}return e}var Lt=R(require("toformat")),vn=Lt.default,ge=vn;var he=R(require("big.js")),St=R(require("decimal.js-light"));var Se=I("module/fraction"),Fe=ge(he.default),Pe=ge(St.default),Kn={[0]:Pe.ROUND_DOWN,[1]:Pe.ROUND_HALF_UP,[2]:Pe.ROUND_UP},Cn={[0]:he.default.roundDown,[1]:he.default.roundHalfUp,[2]:he.default.roundUp},h=class{constructor(e,n=xe){this.numerator=T(e),this.denominator=T(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new h(this.denominator,this.numerator)}add(e){let n=e instanceof h?e:new h(T(e));return this.denominator.eq(n.denominator)?new h(this.numerator.add(n.numerator),this.denominator):new h(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof h?e:new h(T(e));return this.denominator.eq(n.denominator)?new h(this.numerator.sub(n.numerator),this.denominator):new h(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof h?e:new h(T(e));return new h(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof h?e:new h(T(e));return new h(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},o=1){Number.isInteger(e)||Se.logWithError(`${e} is not an integer.`),e<=0&&Se.logWithError(`${e} is not positive.`),Pe.set({precision:e+1,rounding:Kn[o]});let r=new Pe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},o=1){return Number.isInteger(e)||Se.logWithError(`${e} is not an integer.`),e<0&&Se.logWithError(`${e} is negative.`),Fe.DP=e,Fe.RM=Cn[o]||1,new Fe(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var Un=I("Raydium_amount"),_t=ge(Bt.default);function Vn(t,e){let n="0",o="0";if(t.includes(".")){let r=t.split(".");r.length===2?([n,o]=r,o=o.padEnd(e,"0")):Un.logWithError(`invalid number string, num: ${t}`)}else n=t;return[n,o.slice(0,e)||o]}var B=class extends h{constructor(n,o,r=!0,s){let i=new ke.default(0),a=ue.pow(new ke.default(n.decimals));if(r)i=T(o);else{let m=new ke.default(0),l=new ke.default(0);if(typeof o=="string"||typeof o=="number"||typeof o=="bigint"){let[p,f]=Vn(o.toString(),n.decimals);m=T(p),l=T(f)}m=m.mul(a),i=m.add(l)}super(i,a);this.logger=I(s||"Amount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new B(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new B(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,o,r=0){return super.toSignificant(n,o,r)}toFixed(n=this.token.decimals,o,r=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,o,r)}toExact(n={groupSeparator:""}){return _t.DP=this.token.decimals,new _t(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};var Nt=require("@solana/web3.js"),qt={symbol:"SOL",name:"Solana",decimals:9},X={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Ko={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Nt.PublicKey(X.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var Be=require("@solana/web3.js");var Mt=require("@solana/spl-token"),L=require("@solana/web3.js");function u({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var Ue=[u({pubkey:Mt.TOKEN_PROGRAM_ID,isWritable:!1}),u({pubkey:L.SystemProgram.programId,isWritable:!1}),u({pubkey:L.SYSVAR_RENT_PUBKEY,isWritable:!1})];function K({publicKey:t,transformSol:e}){if(t instanceof L.PublicKey)return e&&t.equals(ne)?_e:t;if(e&&t===ne.toBase58())return _e;if(typeof t=="string")try{return new L.PublicKey(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Dt(t){try{return new L.PublicKey(t)}catch{return t}}var Uo=new L.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Vo=new L.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Yo=new L.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),jo=new L.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Qo=new L.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),$o=new L.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Go=new L.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Jo=new L.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),zo=new L.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Zo=new L.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ho=new L.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),_e=new L.PublicKey("So11111111111111111111111111111111111111112"),ne=L.PublicKey.default;var Ve=class{constructor({mint:e,decimals:n,symbol:o="UNKNOWN",name:r="UNKNOWN",skipMint:s=!1}){if(e===ne.toBase58()||e instanceof Be.PublicKey&&ne.equals(e)){this.decimals=X.decimals,this.symbol=X.symbol,this.name=X.name,this.mint=new Be.PublicKey(X.mint);return}this.decimals=n,this.symbol=o,this.name=r,this.mint=s?Be.PublicKey.default:K({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},E=Ve;E.WSOL=new Ve(X);var je=class{constructor({decimals:e,symbol:n="UNKNOWN",name:o="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=o}equals(e){return this===e}},Ye=je;Ye.SOL=new je(qt);var Et=new h(Ot),j=class extends h{toSignificant(e=5,n,o){return this.mul(Et).toSignificant(e,n,o)}toFixed(e=2,n,o){return this.mul(Et).toFixed(e,n,o)}};var Yn=I("Raydium_price"),M=class extends h{constructor(n){let{baseToken:o,quoteToken:r,numerator:s,denominator:i}=n;super(s,i);this.baseToken=o,this.quoteToken=r,this.scalar=new h(Qe(o.decimals),Qe(r.decimals))}get raw(){return new h(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new M({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(n){this.quoteToken!==n.baseToken&&Yn.logWithError("mul token not equals");let o=super.mul(n);return new M({baseToken:this.baseToken,quoteToken:n.quoteToken,denominator:o.denominator,numerator:o.numerator})}toSignificant(n=this.quoteToken.decimals,o,r){return this.adjusted.toSignificant(n,o,r)}toFixed(n=this.quoteToken.decimals,o,r){return this.adjusted.toFixed(n,o,r)}};var Ne=I("Raydium_bignumber");var ce=new A.default(0),xe=new A.default(1),Sr=new A.default(2),_r=new A.default(3),Br=new A.default(5),ue=new A.default(10),Ot=new A.default(100),Nr=new A.default(1e3),qr=new A.default(1e4),Rt=9007199254740991;function T(t){if(t instanceof A.default)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new A.default(t);Ne.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&Ne.logWithError(`BigNumberish number underflow: ${t}`),(t>=Rt||t<=-Rt)&&Ne.logWithError(`BigNumberish number overflow: ${t}`),new A.default(String(t))):typeof t=="bigint"?new A.default(t.toString()):(Ne.logWithError(`invalid BigNumberish value: ${t}`),new A.default(0))}function Qe(t){return ue.pow(T(t))}function we(t){var a;if(t===void 0)return{denominator:"1",numerator:"0"};if(t instanceof A.default)return{numerator:t.toString(),denominator:"1"};if(t instanceof h)return{denominator:t.denominator.toString(),numerator:t.numerator.toString()};let e=String(t),[,n="",o="",r=""]=(a=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],s="1"+"0".repeat(r.length),i=n+(o==="0"?"":o)+r||"0";return{denominator:s,numerator:i,sign:n,int:o,dec:r}}function $e(t,e){let n=t.divmod(e);return n.mod.isZero()?n.div:n.div.negative!==0?n.div.isubn(1):n.div.iaddn(1)}function jn(t){var o;let[,e="",n=""]=(o=t.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?o:[];return`${e}${n}`}function Wt(t,e=0){return t instanceof A.default?t:new A.default(jn(vt(t).mul(ue.pow(new A.default(String(e))))))}function vt(t){if(t instanceof j)return new h(t.numerator,t.denominator);if(t instanceof M)return t.adjusted;if(t instanceof B)try{return vt(t.toExact())}catch{return new h(ce)}if(t instanceof h)return t;let e=String(t),n=we(e);return new h(n.numerator,n.denominator)}function Kt(t){let{token:e,numberPrice:n,decimalDone:o}=t,r=new E({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:s,denominator:i}=we(n),a=o?new A.default(s).mul(ue.pow(new A.default(e.decimals))):s,m=new A.default(i).mul(ue.pow(new A.default(r.decimals)));return new M({baseToken:r,denominator:m.toString(),quoteToken:new E(Z(V({},e),{skipMint:!0,mint:""})),numerator:a.toString()})}var Ct=require("@solana/web3.js"),Ft=R(require("bn.js"));var Qn=[E,B,Ct.PublicKey,h,Ft.default,M,j];function $n(t){return typeof t=="object"&&t!==null&&!Qn.some(e=>typeof e=="object"&&t instanceof e)}function me(t){return typeof t=="string"?Dt(t):Array.isArray(t)?t.map(e=>me(e)):$n(t)?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,me(n)])):t}var Ie=require("@solana/spl-token"),et=require("@solana/web3.js"),Zn=R(require("bn.js"));var C=require("@solana/web3.js");var ee=I("Raydium_txTool"),qe=class{constructor(e){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:e=[],endInstructions:n=[],signers:o=[]}){return this.instructions.push(...e),this.endInstructions.push(...n),this.signers.push(...o),this}build(e){let n=new C.Transaction;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{transaction:n,signers:this.signers,execute:async()=>{var r;let o=await Ut(this.connection);if(n.recentBlockhash=o,(r=this.owner)!=null&&r.isKeyPair)return(0,C.sendAndConfirmTransaction)(this.connection,n,this.signers);if(this.signAllTransactions){this.signers.length&&n.partialSign(...this.signers);let s=await this.signAllTransactions([n]);return await this.connection.sendRawTransaction(s[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:n=[],extInfo:o}=e,{transaction:r}=this.build(o),s=n.filter(m=>m.transaction.instructions.length>0),i=[...s.map(m=>m.transaction),r],a=[...s.map(m=>m.signers),this.signers];return{transactions:i,signers:a,execute:async()=>{var l;let m=await Ut(this.connection);if((l=this.owner)!=null&&l.isKeyPair)return await Promise.all(i.map(async(p,f)=>(p.recentBlockhash=m,await(0,C.sendAndConfirmTransaction)(this.connection,p,a[f]))));if(this.signAllTransactions){let p=i.map((d,g)=>(d.recentBlockhash=m,a[g].length&&d.partialSign(...a[g]),d)),f=await this.signAllTransactions(p),b=[];for(let d=0;d<f.length;d+=1){let g=await this.connection.sendRawTransaction(f[d].serialize(),{skipPreflight:!0});b.push(g)}return b}throw new Error("please connect wallet first")},extInfo:o||{}}}};async function Ut(t){var e,n;try{return((n=await((e=t.getLatestBlockhash)==null?void 0:e.call(t)))==null?void 0:n.blockhash)||(await t.getRecentBlockhash()).blockhash}catch{return(await t.getRecentBlockhash()).blockhash}}function Gn(t,e){t.length<1&&ee.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&ee.logWithError(`no signers provided:, ${e.toString()}`);let n=new C.Transaction;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=e[0],n.add(...t);let o=n.compileMessage().serialize();return e.length+e.length*64+o.length}async function Vt(t,e,n){let o=new C.PublicKey("RaydiumSimuLateTransaction11111111111111111"),r=[],s=new C.Transaction;s.feePayer=o;for(let m of e)Gn([...s.instructions,m],[o])>C.PACKET_DATA_SIZE&&(r.push(s),s=new C.Transaction,s.feePayer=o),s.add(m);s.instructions.length>0&&r.push(s);let i=[];try{i=await Promise.all(r.map(m=>t.simulateTransaction(m)))}catch(m){m instanceof Error&&ee.logWithError(`failed to simulate for instructions, RPC_ERROR, ${m.message}`)}let a=[];for(let m of i){let{value:l}=m;if(ee.debug(`simulate result: ${JSON.stringify(m)}`),l.logs){let p=l.logs.filter(f=>f&&f.includes(n));ee.debug(`filteredLog: ${JSON.stringify(a)}`),p.length||ee.logWithError(` "simulate log not match keyword, keyword: ${n}`),a.push(...p)}}return a}function Yt(t,e){let n=t.match(/{["\w:,]+}/g);return!n||n.length!==1?ee.logWithError(`simulate log fail to match json, keyword: ${e}`):n[0]}function H(t,e){let o=new RegExp(`"${e}":(\\d+)`,"g").exec(t);return!o||o.length!==2?ee.logWithError(`simulate log fail to match key", key: ${e}`):o[1]}async function Ge(t,e){let[n,o]=await C.PublicKey.findProgramAddress(t,e);return{publicKey:n,nonce:o}}var Jn=require("@solana/web3.js");var Zr=I("Raydium_accountInfo_util");var $t=require("@solana/web3.js"),le=R(require("bn.js"));var y=require("@solana/buffer-layout"),Je=y.Layout,jt=y.Structure;var ze=y.UInt;var Qt=y.seq;var Ze=y.blob;var Me=class extends Je{constructor(n,o,r){super(n,r);this.blob=Ze(n),this.signed=o}decode(n,o=0){let r=new le.default(this.blob.decode(n,o),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(n,o,r=0){return typeof n=="number"&&(n=new le.default(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),o,r)}};function W(t){return new ze(1,t)}function De(t){return new ze(4,t)}function c(t){return new Me(8,!1,t)}function Q(t){return new Me(16,!1,t)}var He=class extends Je{constructor(n,o,r,s){super(n.span,s);this.layout=n,this.decoder=o,this.encoder=r}decode(n,o){return this.decoder(this.layout.decode(n,o))}encode(n,o,r){return this.layout.encode(this.encoder(n),o,r)}getSpan(n,o){return this.layout.getSpan(n,o)}};function x(t){return new He(Ze(32),e=>new $t.PublicKey(e),e=>e.toBuffer(),t)}var Xe=class extends jt{decode(e,n){return super.decode(e,n)}};function D(t,e,n){return new Xe(t,e,n)}function Te(t,e,n){let o,r=typeof e=="number"?e:(0,le.isBN)(e)?e.toNumber():new Proxy(e,{get(s,i){if(!o){let a=Reflect.get(s,"count");o=(0,le.isBN)(a)?a.toNumber():a,Reflect.set(s,"count",o)}return Reflect.get(s,i)},set(s,i,a){return i==="count"&&(o=a),Reflect.set(s,i,a)}});return Qt(t,r,n)}var zn=D([x("mint"),x("owner"),c("amount"),De("delegateOption"),x("delegate"),W("state"),De("isNativeOption"),c("isNative"),c("delegatedAmount"),De("closeAuthorityOption"),x("closeAuthority")]);function tt({source:t,destination:e,owner:n,amount:o,multiSigners:r=[]}){return(0,Ie.createTransferInstruction)(t,e,n,T(o).toNumber(),r)}var nt=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ae=class{constructor({scope:e,moduleName:n}){this.disabled=!1;this.scope=e,this.logger=I(n)}createTxBuilder(e){return this.scope.checkOwner(),new qe({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(nt(e))}logInfo(...e){this.logger.info(nt(e))}logAndCreateError(...e){let n=nt(e);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var ot=require("@solana/web3.js"),rt=R(require("bn.js"));var Gt=new rt.default(25),Jt=new rt.default(1e4),zt="675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8",Hn=new ot.PublicKey(zt),Zt="5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h",Xn=new ot.PublicKey(Zt),Fi={[zt]:4,[Zt]:5},Ht={4:Hn,5:Xn},Xt={4:3,5:3};var Re=require("@solana/spl-token"),Y=require("@solana/web3.js");var it=D([W("instruction"),c("amountIn"),c("minAmountOut")]),st=D([W("instruction"),c("maxAmountIn"),c("amountOut")]),at=D([W("instruction"),W("nonce")]),ut=D([W("instruction"),W("nonce"),c("startTime")]),eo=D([c("status"),c("nonce"),c("maxOrder"),c("depth"),c("baseDecimal"),c("quoteDecimal"),c("state"),c("resetFlag"),c("minSize"),c("volMaxCutRatio"),c("amountWaveRatio"),c("baseLotSize"),c("quoteLotSize"),c("minPriceMultiplier"),c("maxPriceMultiplier"),c("systemDecimalValue"),c("minSeparateNumerator"),c("minSeparateDenominator"),c("tradeFeeNumerator"),c("tradeFeeDenominator"),c("pnlNumerator"),c("pnlDenominator"),c("swapFeeNumerator"),c("swapFeeDenominator"),c("baseNeedTakePnl"),c("quoteNeedTakePnl"),c("quoteTotalPnl"),c("baseTotalPnl"),Q("quoteTotalDeposited"),Q("baseTotalDeposited"),Q("swapBaseInAmount"),Q("swapQuoteOutAmount"),c("swapBase2QuoteFee"),Q("swapQuoteInAmount"),Q("swapBaseOutAmount"),c("swapQuote2BaseFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("withdrawQueue"),x("lpVault"),x("owner"),c("lpReserve"),Te(c(),3,"padding")]),ji=D([c("accountType"),c("status"),c("nonce"),c("maxOrder"),c("depth"),c("baseDecimal"),c("quoteDecimal"),c("state"),c("resetFlag"),c("minSize"),c("volMaxCutRatio"),c("amountWaveRatio"),c("baseLotSize"),c("quoteLotSize"),c("minPriceMultiplier"),c("maxPriceMultiplier"),c("systemDecimalsValue"),c("abortTradeFactor"),c("priceTickMultiplier"),c("priceTick"),c("minSeparateNumerator"),c("minSeparateDenominator"),c("tradeFeeNumerator"),c("tradeFeeDenominator"),c("pnlNumerator"),c("pnlDenominator"),c("swapFeeNumerator"),c("swapFeeDenominator"),c("baseNeedTakePnl"),c("quoteNeedTakePnl"),c("quoteTotalPnl"),c("baseTotalPnl"),c("poolOpenTime"),c("punishPcAmount"),c("punishCoinAmount"),c("orderbookToInitTime"),Q("swapBaseInAmount"),Q("swapQuoteOutAmount"),Q("swapQuoteInAmount"),Q("swapBaseOutAmount"),c("swapQuote2BaseFee"),c("swapBase2QuoteFee"),x("baseVault"),x("quoteVault"),x("baseMint"),x("quoteMint"),x("lpMint"),x("modelDataAccount"),x("openOrders"),x("marketId"),x("marketProgramId"),x("targetOrders"),x("owner"),Te(c(),64,"padding")]),ct=D([W("instruction"),c("baseAmountIn"),c("quoteAmountIn"),c("fixedSide")]),mt=D([W("instruction"),c("amountIn")]);var en=require("@solana/web3.js");var pe=new en.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),re=5e4,to=D([c("x"),c("y"),c("price")]),no=D([c("accountType"),c("status"),c("multiplier"),c("validDataCount"),Te(to,re,"DataElement")]);function oo(t,e){return[0,re-2]}function ro(t){return[0,re-2]}function io(t){return[0,re-2]}function so(t,e,n){let[o,r]=oo(e,n),s=o,i=r,a=0,m=e*t.multiplier/n;for(;s<=i;){if(a=Math.floor((i+s)/2),a===0||a>=re-2)return[a,a,!1];let l=t.DataElement[a].x*t.multiplier/t.DataElement[a].y,p=t.DataElement[a-1].x*t.multiplier/t.DataElement[a-1].y,f=t.DataElement[a+1].x*t.multiplier/t.DataElement[a+1].y;if(m===l)return[a,a,!0];if(m===p)return[a-1,a-1,!0];if(m===f)return[a+1,a+1,!0];if(m<p)i=a-1;else{if(m>p&&m<l)return[a-1,a,!0];if(m>l&&m<f)return[a,a+1,!0];s=a+1}}return[a,a,!1]}function lt(t,e,n){let[o,r,s]=so(t,e,n);if(!s)return 0;if(o===r){let i=t.DataElement[o].x;return e*t.multiplier/i}else{let i=t.DataElement[o].x,a=t.DataElement[o].y,m=t.DataElement[r].x,l=t.DataElement[r].y,p=n*(m*a-i*l),f=i*p,b=(m-i)*(e*a-i*n)*l,d=f+b;return e*t.multiplier*p/d}}function oe(t,e,n){return e*t.multiplier/n}function tn(t,e,n){return e*n/t.multiplier}function ao(t,e){let[n,o]=ro(e),r=n,s=o,i=0,a=e;for(;r<s;){if(i=Math.floor((s+r)/2),i<=0||i>re-2)return[i,i,!1];let m=t.DataElement[i].x,l=t.DataElement[i-1].x,p=t.DataElement[i+1].x;if(a===m)return[i,i,!0];if(a===l)return[i-1,i-1,!0];if(a===p)return[i+1,i+1,!0];if(a<l)s=i-1;else{if(a>l&&a<m)return[i-1,i,!0];if(a>m&&a<p)return[i,i+1,!0];r=i+1}}return[i,i,!1]}function uo(t,e){let[n,o]=io(e),r=n,s=o,i=0,a=e;for(;r<=s;){if(i=Math.floor((s+r)/2),i<=0||i>=re-2)return[i,i,!1];let m=t.DataElement[i].y,l=t.DataElement[i-1].y,p=t.DataElement[i+1].y;if(a===m)return[i,i,!0];if(a===l)return[i-1,i-1,!0];if(a===p)return[i+1,i+1,!0];if(a<p)r=i+1;else{if(a<l&&a>m)return[i-1,i,!0];if(a<m&&a>p)return[i,i+1,!0];s=i-1}}return[i,i,!1]}function nn(t,e,n,o){let r=o?e+n:e-n,[s,i,a]=ao(t,r);if(!a)return[0,0,!1,a];if(s===i)return[t.DataElement[i].price,t.DataElement[i].y,!1,a];{let m=t.DataElement[s].x,l=t.DataElement[i].x,p=t.DataElement[s].price,f=t.DataElement[i].price,b=t.DataElement[s].y,d=t.DataElement[i].y;if(e>=m&&e<=l)return o?[f,d,!0,a]:[p,b,!0,a];{let g,k;return o?(g=p+(f-p)*(e-m)/(l-m),k=b-(r-m)*t.multiplier/f):(g=p+(f-p)*(e-m)/(l-m),k=d+(l-r)*t.multiplier/p),[g,k,!1,a]}}}function co(t,e,n,o){let r=o?e-n:e+n,[s,i,a]=uo(t,r);if(!a)return[0,0,!1,a];if(s===i)return[t.DataElement[i].price,t.DataElement[i].x,!1,a];{let m=t.DataElement[s].x,l=t.DataElement[i].x,p=t.DataElement[s].price,f=t.DataElement[i].price,b=t.DataElement[s].y,d=t.DataElement[i].y;if(e>=d&&e<=b)return o?[f,l,!0,a]:[p,m,!0,a];{let g,k;return o?(g=p+(f-p)*(b-e)/(b-d),k=m+f*(b-r)/t.multiplier):(g=p+(f-p)*(b-e)/(b-d),k=l-p*(r-d)/t.multiplier),[g,k,!1,a]}}}function mo(t,e){let n=nn(t,e,0,!1);return n[3]?n[0]:0}function on(t,e,n,o){let r=lt(t,e,n),s=oe(t,e,r),i=oe(t,n,r),a=oe(t,o,r),m=!0,[l,p,f,b]=nn(t,s,a,m);if(!b)return 0;if(f)return o*t.multiplier/l;{let d=i-p;return tn(t,d,r)}}function rn(t,e,n,o){let r=lt(t,e,n),s=oe(t,e,r),i=oe(t,n,r),a=oe(t,o,r),m=!1,[l,p,f,b]=co(t,i,a,m);if(!b)return 0;if(f)return o*l/t.multiplier;{let d=s-p;return tn(t,d,r)}}function lo(t){let e=no.decode(t);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(n=>({x:n.x.toNumber(),y:n.y.toNumber(),price:n.price.toNumber()}))}}function sn(t,e,n,o){let r=mo(t,oe(t,e,lt(t,e,n)))/t.multiplier;return o?r:1/r}var Ee=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(pe);e&&(this._layoutData=lo(e==null?void 0:e.data))}}};var Oe=I("Raydium_liquidity_instruction");function an(t){let{poolKeys:e,userKeys:n,amountIn:o,amountOut:r,fixedSide:s}=t,{version:i}=e;if(i===4||i===5){let a={poolKeys:e,userKeys:n};if(s==="in")return po(Z(V({},a),{amountIn:o,minAmountOut:r}),i);if(s==="out")return fo(Z(V({},a),{maxAmountIn:o,amountOut:r}),i);Oe.logWithError("invalid params","params",t)}throw Oe.logWithError("invalid version","poolKeys.version",i),new Error("invalid version")}function un(t){let e=D([W("instruction"),W("simulateType")]),n=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},n);let o=[u({pubkey:t.id,isWritable:!1}),u({pubkey:t.authority,isWritable:!1}),u({pubkey:t.openOrders,isWritable:!1}),u({pubkey:t.baseVault,isWritable:!1}),u({pubkey:t.quoteVault,isWritable:!1}),u({pubkey:t.lpMint,isWritable:!1}),u({pubkey:t.marketId,isWritable:!1})];return new Y.TransactionInstruction({programId:t.programId,keys:o,data:n})}function po({poolKeys:t,userKeys:e,amountIn:n,minAmountOut:o},r){let s=Buffer.alloc(it.span);it.encode({instruction:9,amountIn:T(n),minAmountOut:T(o)},s);let i=[u({pubkey:Re.TOKEN_PROGRAM_ID,isWritable:!1}),u({pubkey:t.id}),u({pubkey:t.authority,isWritable:!1}),u({pubkey:t.openOrders})];return r===4&&i.push(u({pubkey:t.targetOrders})),i.push(u({pubkey:t.baseVault}),u({pubkey:t.quoteVault})),r===5&&i.push(u({pubkey:pe})),i.push(u({pubkey:t.marketProgramId,isWritable:!1}),u({pubkey:t.marketId}),u({pubkey:t.marketBids}),u({pubkey:t.marketAsks}),u({pubkey:t.marketEventQueue}),u({pubkey:t.marketBaseVault}),u({pubkey:t.marketQuoteVault}),u({pubkey:t.marketAuthority,isWritable:!1}),u({pubkey:e.tokenAccountIn}),u({pubkey:e.tokenAccountOut}),u({pubkey:e.owner,isWritable:!1})),new Y.TransactionInstruction({programId:t.programId,keys:i,data:s})}function fo({poolKeys:t,userKeys:e,maxAmountIn:n,amountOut:o},r){let s=Buffer.alloc(st.span);st.encode({instruction:11,maxAmountIn:T(n),amountOut:T(o)},s);let i=[u({pubkey:Y.SystemProgram.programId,isWritable:!1}),u({pubkey:t.id}),u({pubkey:t.authority,isWritable:!1}),u({pubkey:t.openOrders}),u({pubkey:t.targetOrders}),u({pubkey:t.baseVault}),u({pubkey:t.quoteVault})];return r===5&&i.push(u({pubkey:pe})),i.push(u({pubkey:t.marketProgramId,isWritable:!1}),u({pubkey:t.marketId}),u({pubkey:t.marketBids}),u({pubkey:t.marketAsks}),u({pubkey:t.marketEventQueue}),u({pubkey:t.marketBaseVault}),u({pubkey:t.marketQuoteVault}),u({pubkey:t.marketAuthority,isWritable:!1}),u({pubkey:e.tokenAccountIn}),u({pubkey:e.tokenAccountOut}),u({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Y.TransactionInstruction({programId:t.programId,keys:i,data:s})}function cn(t){let s=t,{owner:e}=s,n=v(s,["owner"]),o=Buffer.alloc(at.span);at.encode({instruction:10,nonce:n.nonce},o);let r=[...Ue,u({pubkey:n.targetOrders}),u({pubkey:n.withdrawQueue}),u({pubkey:n.authority,isWritable:!1}),u({pubkey:n.lpMint}),u({pubkey:n.baseMint,isWritable:!1}),u({pubkey:n.quoteMint,isWritable:!1}),u({pubkey:n.baseVault}),u({pubkey:n.quoteVault}),u({pubkey:n.lpVault}),u({pubkey:n.marketId,isWritable:!1}),u({pubkey:e,isSigner:!0})];return new Y.TransactionInstruction({programId:n.programId,keys:r,data:o})}function mn(t){let{poolKeys:e,userKeys:n,startTime:o}=t,r=Buffer.alloc(ut.span);ut.encode({instruction:0,nonce:e.nonce,startTime:T(o)},r);let s=[...Ue,u({pubkey:e.id}),u({pubkey:e.authority,isWritable:!1}),u({pubkey:e.openOrders}),u({pubkey:e.lpMint}),u({pubkey:e.baseMint,isWritable:!1}),u({pubkey:e.quoteMint,isWritable:!1}),u({pubkey:e.baseVault,isWritable:!1}),u({pubkey:e.quoteVault,isWritable:!1}),u({pubkey:e.withdrawQueue}),u({pubkey:e.targetOrders}),u({pubkey:n.lpTokenAccount}),u({pubkey:e.lpVault,isWritable:!1}),u({pubkey:e.marketProgramId,isWritable:!1}),u({pubkey:e.marketId,isWritable:!1}),u({pubkey:n.payer,isSigner:!0})];return new Y.TransactionInstruction({programId:e.programId,keys:s,data:r})}function ln(t){let{poolKeys:e,userKeys:n,baseAmountIn:o,quoteAmountIn:r,fixedSide:s}=t,{version:i}=e;if(i===4||i===5){let a=Buffer.alloc(ct.span);ct.encode({instruction:3,baseAmountIn:T(o),quoteAmountIn:T(r),fixedSide:T(s==="base"?0:1)},a);let m=[u({pubkey:Re.TOKEN_PROGRAM_ID,isWritable:!1}),u({pubkey:e.id}),u({pubkey:e.authority,isWritable:!1}),u({pubkey:e.openOrders,isWritable:!1}),u({pubkey:e.targetOrders}),u({pubkey:e.lpMint}),u({pubkey:e.baseVault}),u({pubkey:e.quoteVault})];return i===5&&m.push(u({pubkey:pe})),m.push(u({pubkey:e.marketId,isWritable:!1}),u({pubkey:n.baseTokenAccount}),u({pubkey:n.quoteTokenAccount}),u({pubkey:n.lpTokenAccount}),u({pubkey:n.owner,isWritable:!1,isSigner:!0})),new Y.TransactionInstruction({programId:e.programId,keys:m,data:a})}return Oe.logWithError("invalid version","poolKeys.version",i),new Y.TransactionInstruction({programId:e.programId,keys:[]})}function pn(t){let{poolKeys:e,userKeys:n,amountIn:o}=t,{version:r}=e;if(r===4||r===5){let s=Buffer.alloc(mt.span);mt.encode({instruction:4,amountIn:T(o)},s);let i=[u({pubkey:Re.TOKEN_PROGRAM_ID,isWritable:!1}),u({pubkey:e.id}),u({pubkey:e.authority,isWritable:!1}),u({pubkey:e.openOrders}),u({pubkey:e.targetOrders}),u({pubkey:e.lpMint}),u({pubkey:e.baseVault}),u({pubkey:e.quoteVault})];return r===5?i.push(u({pubkey:pe})):i.push(u({pubkey:e.withdrawQueue}),u({pubkey:e.lpVault})),i.push(u({pubkey:e.marketProgramId,isWritable:!1}),u({pubkey:e.marketId}),u({pubkey:e.marketBaseVault}),u({pubkey:e.marketQuoteVault}),u({pubkey:e.marketAuthority,isWritable:!1}),u({pubkey:n.lpTokenAccount}),u({pubkey:n.baseTokenAccount}),u({pubkey:n.quoteTokenAccount}),u({pubkey:n.owner,isWritable:!1,isSigner:!0}),u({pubkey:e.marketEventQueue}),u({pubkey:e.marketBids}),u({pubkey:e.marketAsks})),new Y.TransactionInstruction({programId:e.programId,keys:i,data:s})}return Oe.logWithError("invalid version","poolKeys.version",r),new Y.TransactionInstruction({programId:e.programId,keys:[]})}var go=require("@project-serum/serum"),de=R(require("bn.js"));var pt=require("@solana/web3.js");var dt=I("Raydium_liquidity_serum"),dn="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",bo=new pt.PublicKey(dn),ss={[dn]:3},yo={3:bo};function fn(t){let e=Xt[t];return e||dt.logWithError("invalid version","version",t),e}function bn(t){let e=yo[t];return e||dt.logWithError("invalid version","version",t),e}async function yn({programId:t,marketId:e}){let n=[e.toBuffer()],o=0,r;for(;o<100;){try{let s=n.concat(Buffer.from([o]),Buffer.alloc(7));r=await pt.PublicKey.createProgramAddress(s,t)}catch(s){if(s instanceof TypeError)throw s;o++;continue}return{publicKey:r,nonce:o}}throw dt.logWithError("unable to find a viable program address nonce","params",{programId:t,marketId:e}),new Error("unable to find a viable program address nonce")}var ft=I("Raydium_liquidity_util");function bt(t,e){let n=t instanceof B?t.token:E.WSOL,{baseMint:o,quoteMint:r}=e;if(n.mint.equals(o))return"base";if(n.mint.equals(r))return"quote";let s=`liquidity getTokenSide - token not match with pool, params: ${JSON.stringify({token:n.mint,baseMint:o,quoteMint:r})}`;throw console.error(s),new Error(s)}function yt(t,e){let{baseMint:n,quoteMint:o}=e;return t.mint.equals(n)||t.mint.equals(o)}function ho(t){let e=Ht[t];return e||ft.logWithError("invalid version","version",t),e}async function te({name:t,programId:e,marketId:n}){let{publicKey:o}=await Ge([e.toBuffer(),n.toBuffer(),Buffer.from(t,"utf-8")],e);return o}async function Po({programId:t}){return Ge([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],t)}async function gt({version:t,marketId:e,baseMint:n,quoteMint:o}){let r=ho(t),[s,i,a]=[K({publicKey:e}),K({publicKey:n,transformSol:!0}),K({publicKey:o,transformSol:!0})],m=await te({name:"amm_associated_seed",programId:r,marketId:s}),l=await te({name:"lp_mint_associated_seed",programId:r,marketId:s}),{publicKey:p,nonce:f}=await Po({programId:r}),b=await te({name:"coin_vault_associated_seed",programId:r,marketId:s}),d=await te({name:"pc_vault_associated_seed",programId:r,marketId:s}),g=await te({name:"temp_lp_token_associated_seed",programId:r,marketId:s}),k=await te({name:"open_order_associated_seed",programId:r,marketId:s}),N=await te({name:"target_associated_seed",programId:r,marketId:s}),w=await te({name:"withdraw_associated_seed",programId:r,marketId:s}),S=fn(t),_=bn(S),{publicKey:q}=await yn({programId:_,marketId:s});return{id:m,baseMint:i,quoteMint:a,lpMint:l,version:t,programId:r,authority:p,nonce:f,baseVault:b,quoteVault:d,lpVault:g,openOrders:k,targetOrders:N,withdrawQueue:w,marketVersion:S,marketProgramId:_,marketId:s,marketAuthority:q}}async function hn({connection:t,pools:e}){let n=e.map(r=>un(r));return(await Vt(t,n,"GetPoolData")).map(r=>{let s=Yt(r,"GetPoolData"),i=new de.default(H(s,"status")),a=Number(H(s,"coin_decimals")),m=Number(H(s,"pc_decimals")),l=Number(H(s,"lp_decimals")),p=new de.default(H(s,"pool_coin_amount")),f=new de.default(H(s,"pool_pc_amount")),b=new de.default(H(s,"pool_lp_supply")),d="0";try{d=H(s,"pool_open_time")}catch{d="0"}return{status:i,baseDecimals:a,quoteDecimals:m,lpDecimals:l,baseReserve:p,quoteReserve:f,lpSupply:b,startTime:new de.default(d)}})}function Pn(t,e,n){return xo(t.token,e.token,n)}function xo(t,e,n){let{baseMint:o,quoteMint:r}=n,s=gn(t,n),i=gn(e,n);return s===i&&ft.logWithError("tokens not match with pool","params",{tokenA:t.mint,tokenB:e.mint,baseMint:o,quoteMint:r}),[s,i]}function gn(t,e){let{baseMint:n,quoteMint:o}=e;return t.mint.equals(n)?"base":t.mint.equals(o)?"quote":(ft.logWithError("token not match with pool","params",{token:t.mint,baseMint:n,quoteMint:o}),"base")}var xn=t=>t==="a"||t==="b";var We=class extends Ae{constructor(n){super(n);this._poolInfos=[];this._poolInfoMap=new Map;this._pairsInfo=[];this._pairsInfoMap=new Map;this._lpTokenMap=new Map;this._lpPriceMap=new Map;this._officialIds=new Set;this._unOfficialIds=new Set;this._sdkParseInfoCache=new Map;this._stableLayout=new Ee({connection:this.scope.connection})}async load(n){if(await this.scope.fetchLiquidity(n==null?void 0:n.forceUpdate),!this.scope.apiData.liquidityPools)return;let{data:o}=this.scope.apiData.liquidityPools,[r,s]=[o.official||[],o.unOfficial||[]];this._poolInfos=[...r,...s],this._officialIds=new Set(r.map(i=>{var m,l;let a=`${(m=this.scope.token.allTokenMap.get(i.baseMint))==null?void 0:m.symbol} - ${(l=this.scope.token.allTokenMap.get(i.quoteMint))==null?void 0:l.symbol}`;return this._poolInfoMap.set(i.id,i),this._lpTokenMap.set(i.lpMint,new E({mint:i.lpMint,decimals:i.lpDecimals,symbol:a,name:`${a} LP`})),i.id})),this._unOfficialIds=new Set(s.map(i=>{var m,l;let a=`${(m=this.scope.token.allTokenMap.get(i.baseMint))==null?void 0:m.symbol} - ${(l=this.scope.token.allTokenMap.get(i.quoteMint))==null?void 0:l.symbol}`;return this._poolInfoMap.set(i.id,i),this._lpTokenMap.set(i.lpMint,new E({mint:i.lpMint,decimals:i.lpDecimals,symbol:a,name:`${a} LP`})),i.id}))}async loadPairs(n){var o;return await this.scope.fetchPairs(n==null?void 0:n.forceUpdate),this._pairsInfo=((o=this.scope.apiData.liquidityPairsInfo)==null?void 0:o.data)||[],this._pairsInfoMap=new Map(this._pairsInfo.map(r=>{let s=this._lpTokenMap.get(r.lpMint),i=s&&r.lpPrice?Kt({token:s,numberPrice:r.lpPrice,decimalDone:!0}):null;return i&&this._lpPriceMap.set(r.lpMint,i),[r.ammId,r]})),this._pairsInfo}get allPools(){return this._poolInfos}get allPoolIdSet(){return{official:this._officialIds,unOfficial:this._unOfficialIds}}get allPoolMap(){return this._poolInfoMap}get allPairs(){return this._pairsInfo}get allPairsMap(){return this._pairsInfoMap}get lpTokenMap(){return this._lpTokenMap}get lpPriceMap(){return this._lpPriceMap}async fetchMultipleInfo(n){return await this._stableLayout.initStableModelLayout(),await hn(Z(V({},n),{connection:this.scope.connection}))}async sdkParseJsonLiquidityInfo(n){if(!n.length)return[];let o=n.map(r=>r.id).join("-");if(this._sdkParseInfoCache.has(o))return this._sdkParseInfoCache.get(o);try{let s=(await this.fetchMultipleInfo({pools:n.map(me)})).map((i,a)=>V(V({jsonInfo:n[a]},me(n[a])),i));return this._sdkParseInfoCache.set(o,s),s}catch(r){return console.error(r),[]}}computeAmountOut({poolKeys:n,poolInfo:o,amountIn:r,outputToken:s,slippage:i}){this.checkDisabled();let a=I("Raydium_computeAmountOut"),m=r.token,l=s;(!yt(m,n)||!yt(l,n))&&a.logWithError("token not match with pool","poolKeys",n);let{baseReserve:p,quoteReserve:f}=o;this.logDebug("baseReserve:",p.toString(),"quoteReserve:",f.toString());let b=r.token;this.logDebug("inputToken:",b),this.logDebug("amountIn:",r.toFixed()),this.logDebug("outputToken:",s),this.logDebug("slippage:",`${i.toSignificant()}%`);let d=[p,f],g=bt(r,n);g==="quote"&&d.reverse(),this.logDebug("input side:",g);let[k,N]=d,w;if(n.version===4)w=new M({baseToken:b,denominator:k,quoteToken:s,numerator:N});else{let $=sn(this._stableLayout.stableModelData,p.toNumber(),f.toNumber(),!1);w=new M({baseToken:b,denominator:g==="quote"?new G.default($*1e6):new G.default(1e6),quoteToken:s,numerator:g==="quote"?new G.default(1e6):new G.default($*1e6)})}this.logDebug("currentPrice:",`1 ${b.symbol} \u2248 ${w.toFixed()} ${s.symbol}`),this.logDebug("currentPrice invert:",`1 ${s.symbol} \u2248 ${w.invert().toFixed()} ${b.symbol}`);let S=r.raw,_=ce,q=ce;if(!S.isZero())if(n.version===4){q=S.mul(Gt).div(Jt);let $=S.sub(q),ae=k.add($);_=N.mul($).div(ae)}else{q=S.mul(new G.default(2)).div(new G.default(1e4));let $=S.sub(q),ae=g==="quote"?on:rn;_=new G.default(ae(this._stableLayout.stableModelData,f.toNumber(),p.toNumber(),$.toNumber()))}let F=new j(xe).add(i).invert().mul(_).quotient,O=new B(s,_),z=new B(s,F);this.logDebug("amountOut:",O.toFixed(),"minAmountOut:",z.toFixed());let U=new M({baseToken:b,denominator:S.sub(q),quoteToken:s,numerator:_});!S.isZero()&&!_.isZero()&&(U=new M({baseToken:b,denominator:S.sub(q),quoteToken:s,numerator:_}),this.logDebug("executionPrice:",`1 ${b.symbol} \u2248 ${U.toFixed()} ${s.symbol}`),this.logDebug("executionPrice invert:",`1 ${s.symbol} \u2248 ${U.invert().toFixed()} ${b.symbol}`));let ie=new j(parseInt(String(Math.abs(parseFloat(U.toFixed())-parseFloat(w.toFixed()))*1e9)),parseInt(String(parseFloat(w.toFixed())*1e9))),se=new B(b,q);return{amountOut:O,minAmountOut:z,currentPrice:w,executionPrice:U,priceImpact:ie,fee:se}}async computePairAmount({poolId:n,amount:o,anotherToken:r,slippage:s}){let i=K({publicKey:n}),a=this._poolInfoMap.get(i.toBase58());a||this.logAndCreateError("pool not found",i.toBase58());let m=(await this.sdkParseJsonLiquidityInfo([a]))[0];m||this.logAndCreateError("pool parseInfo not found",i.toBase58());let{baseReserve:l,quoteReserve:p}=m;this.logDebug("baseReserve:",l.toString(),"quoteReserve:",p.toString());let f=o.token;this.logDebug("tokenIn:",f,"amount:",o.toFixed(),"anotherToken:",r,"slippage:",`${s.toSignificant()}%`);let b=bt(o,me(a));this.logDebug("input side:",b);let d=ce;o.isZero()||(d=b==="base"?$e(o.raw.mul(p),l):$e(o.raw.mul(l),p));let k=new j(xe).add(s).mul(d).quotient,N=new B(r,d),w=new B(r,k);return this.logDebug("anotherAmount:",N.toFixed(),"maxAnotherAmount:",w.toFixed()),{anotherAmount:N,maxAnotherAmount:w}}async swapWithAMM(n){let{poolKeys:o,payer:r,amountIn:s,amountOut:i,fixedSide:a,config:m}=n;this.logDebug("amountIn:",s),this.logDebug("amountOut:",i),(s.isZero()||i.isZero())&&this.logAndCreateError("amounts must greater than zero","amounts",{amountIn:s.toFixed(),amountOut:i.toFixed()});let{account:l}=this.scope,p=this.createTxBuilder(),{bypassAssociatedCheck:f=!1}=m||{},[b,d]=[s.token,i.token],g=await l.getCreatedTokenAccount({mint:b.mint,associatedOnly:!1}),k=await l.getCreatedTokenAccount({mint:d.mint}),[N,w]=[s.raw,i.raw],F=await l.handleTokenAccount({side:"in",amount:N,mint:b.mint,tokenAccount:g,bypassAssociatedCheck:f}),{tokenAccount:S}=F,_=v(F,["tokenAccount"]);p.addInstruction(_);let O=await l.handleTokenAccount({side:"out",amount:0,mint:d.mint,tokenAccount:k,payer:r,bypassAssociatedCheck:f}),{tokenAccount:q}=O,J=v(O,["tokenAccount"]);return p.addInstruction(J),p.addInstruction({instructions:[an({poolKeys:o,userKeys:{tokenAccountIn:S,tokenAccountOut:q,owner:this.scope.ownerPubKey},amountIn:N,amountOut:w,fixedSide:a})]}),p.buildMultiTx({extInfo:{amountOut:i}})}async createPool(n){this.checkDisabled(),this.scope.checkOwner(),n.version!==4&&this.logAndCreateError("invalid version","poolKeys.version",n.version);let o=this.createTxBuilder(),r=await gt(n);return await o.addInstruction({instructions:[cn(Z(V({},r),{owner:this.scope.ownerPubKey}))]}).build()}async initPool(n){n.version!==4&&this.logAndCreateError("invalid version","poolKeys.version",n.version);let{baseAmount:o,quoteAmount:r,startTime:s=0,config:i}=n,a=await gt(n),{baseMint:m,quoteMint:l,lpMint:p,baseVault:f,quoteVault:b}=a,d=this.createTxBuilder(),{account:g}=this.scope,k=!!(i!=null&&i.bypassAssociatedCheck),N=await g.getCreatedTokenAccount({mint:m,associatedOnly:!1}),w=await g.getCreatedTokenAccount({mint:l,associatedOnly:!1});!N&&!w&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",g.tokenAccounts);let S=await g.getCreatedTokenAccount({mint:p,associatedOnly:!1}),U=await g.handleTokenAccount({side:"in",amount:o.raw,mint:m,tokenAccount:N,bypassAssociatedCheck:k}),{tokenAccount:_}=U,q=v(U,["tokenAccount"]);d.addInstruction(q);let ie=await g.handleTokenAccount({side:"in",amount:r.raw,mint:l,tokenAccount:w,bypassAssociatedCheck:k}),{tokenAccount:J}=ie,F=v(ie,["tokenAccount"]);d.addInstruction(F);let se=await g.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:S,bypassAssociatedCheck:k}),{tokenAccount:O}=se,z=v(se,["tokenAccount"]);return d.addInstruction(z),d.addInstruction({instructions:[tt({source:_,destination:f,owner:this.scope.ownerPubKey,amount:o.raw}),tt({source:J,destination:b,owner:this.scope.ownerPubKey,amount:r.raw}),mn({poolKeys:a,userKeys:{lpTokenAccount:O,payer:this.scope.ownerPubKey},startTime:s})]}),await d.build()}async addLiquidity(n){let{poolId:o,amountInA:r,amountInB:s,fixedSide:i,config:a}=n,m=K({publicKey:o}),l=this.allPools.find(_n=>_n.id===m.toBase58());l||this.logAndCreateError("pool not found",o);let f=(await this.sdkParseJsonLiquidityInfo([l]))[0];f||this.logAndCreateError("pool parse error",f),this.logDebug("amountInA:",r,"amountInB:",s),(r.isZero()||s.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:r.toFixed(),amountInB:s.toFixed()});let{account:b}=this.scope,d=(a==null?void 0:a.bypassAssociatedCheck)||!1,[g,k]=[r.token,s.token],N=await b.getCreatedTokenAccount({mint:g.mint,associatedOnly:!1}),w=await b.getCreatedTokenAccount({mint:k.mint,associatedOnly:!1});!N&&!w&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",b.tokenAccounts);let S=await b.getCreatedTokenAccount({mint:f.lpMint}),_=[g,k],q=[N,w],J=[r.raw,s.raw],[F]=Pn(r,s,f),O="base";(!["quote","base"].includes(F)||!xn(i))&&this.logAndCreateError("invalid fixedSide","fixedSide",i),F==="quote"?(_.reverse(),q.reverse(),J.reverse(),O=i==="a"?"quote":"base"):F==="base"&&(O=i==="a"?"base":"quote");let[z,U]=_,[ie,se]=q,[$,ae]=J,fe=this.createTxBuilder(),ht=await b.handleTokenAccount({side:"in",amount:$,mint:z.mint,tokenAccount:ie,bypassAssociatedCheck:d}),{tokenAccount:wn}=ht,Tn=v(ht,["tokenAccount"]);fe.addInstruction(Tn);let Pt=await b.handleTokenAccount({side:"in",amount:ae,mint:U.mint,tokenAccount:se,bypassAssociatedCheck:d}),{tokenAccount:In}=Pt,An=v(Pt,["tokenAccount"]);fe.addInstruction(An);let xt=await b.handleTokenAccount({side:"out",amount:0,mint:f.lpMint,tokenAccount:S,bypassAssociatedCheck:d}),{tokenAccount:Ln}=xt,Sn=v(xt,["tokenAccount"]);return fe.addInstruction(Sn),fe.addInstruction({instructions:[ln({poolKeys:f,userKeys:{baseTokenAccount:wn,quoteTokenAccount:In,lpTokenAccount:Ln,owner:this.scope.ownerPubKey},baseAmountIn:$,quoteAmountIn:ae,fixedSide:O})]}),await fe.build()}async removeLiquidity(n){let{poolId:o,amountIn:r,config:s}=n,i=K({publicKey:o}),a=this.allPools.find(U=>U.id===i.toBase58());a||this.logAndCreateError("pool not found",o);let l=(await this.sdkParseJsonLiquidityInfo([a]))[0];l||this.logAndCreateError("pool pass error",l);let{baseMint:p,quoteMint:f,lpMint:b}=l;this.logDebug("amountIn:",r),r.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",r.toFixed()),r.token.mint.equals(b)||this.logAndCreateError("amountIn's token not match lpMint","amountIn",r);let{account:d}=this.scope,g=await d.getCreatedTokenAccount({mint:b,associatedOnly:!1});g||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",d.tokenAccounts);let k=await d.getCreatedTokenAccount({mint:p}),N=await d.getCreatedTokenAccount({mint:f}),w=this.createTxBuilder(),S=(s==null?void 0:s.bypassAssociatedCheck)||!1,O=await d.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:k,bypassAssociatedCheck:S}),{tokenAccount:_}=O,q=v(O,["tokenAccount"]);w.addInstruction(q);let z=await d.handleTokenAccount({side:"out",amount:0,mint:f,tokenAccount:N,bypassAssociatedCheck:S}),{tokenAccount:J}=z,F=v(z,["tokenAccount"]);return w.addInstruction(F),w.addInstruction({instructions:[kn.ComputeBudgetProgram.requestUnits({units:4e5,additionalFee:0}),pn({poolKeys:l,userKeys:{lpTokenAccount:g,baseTokenAccount:_,quoteTokenAccount:J,owner:this.scope.ownerPubKey},amountIn:r.raw})]}),await w.build()}lpMintToTokenAmount({poolId:n,amount:o,decimalDone:r}){let s=K({publicKey:n});s||this.logAndCreateError("pool not found");let i=this._poolInfoMap.get(s.toBase58()),a=we(o),m=new E({mint:i.lpMint,decimals:i.lpDecimals}),l=r?new h(a.numerator,a.denominator):new h(a.numerator,a.denominator).mul(new G.default(10).pow(new G.default(m.decimals)));return new B(m,Wt(l))}getFixedSide({poolId:n,inputMint:o}){let[r,s]=[K({publicKey:n}),K({publicKey:o})],i=this._poolInfoMap.get(r.toBase58());i||this.logAndCreateError("pool not found",r.toBase58());let a=i.baseMint===s.toBase58();return(s.equals(_e)||s.equals(ne))&&(a=!a),a?"a":"b"}};0&&(module.exports={});
//# sourceMappingURL=liquidity.js.map