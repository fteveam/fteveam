var Or=Object.create;var J=Object.defineProperty,Ur=Object.defineProperties,Cr=Object.getOwnPropertyDescriptor,qr=Object.getOwnPropertyDescriptors,Gr=Object.getOwnPropertyNames,je=Object.getOwnPropertySymbols,jr=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty,Yr=Object.prototype.propertyIsEnumerable;var Ye=(e,r,t)=>r in e?J(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,T=(e,r)=>{for(var t in r||(r={}))$e.call(r,t)&&Ye(e,t,r[t]);if(je)for(var t of je(r))Yr.call(r,t)&&Ye(e,t,r[t]);return e},F=(e,r)=>Ur(e,qr(r));var $r=(e,r)=>{for(var t in r)J(e,t,{get:r[t],enumerable:!0})},He=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Gr(r))!$e.call(e,o)&&o!==t&&J(e,o,{get:()=>r[o],enumerable:!(n=Cr(r,o))||n.enumerable});return e};var B=(e,r,t)=>(t=e!=null?Or(jr(e)):{},He(r||!e||!e.__esModule?J(t,"default",{value:e,enumerable:!0}):t,e)),Hr=e=>He(J({},"__esModule",{value:!0}),e);var Vt={};$r(Vt,{FARM_LOCK_MINT:()=>zr,FARM_LOCK_VAULT:()=>Xr,FARM_PROGRAMID_TO_VERSION:()=>Le,FARM_PROGRAM_ID_V3:()=>xe,FARM_PROGRAM_ID_V3_PUBKEY:()=>rr,FARM_PROGRAM_ID_V5:()=>Se,FARM_PROGRAM_ID_V5_PUBKEY:()=>tr,FARM_PROGRAM_ID_V6:()=>Te,FARM_PROGRAM_ID_V6_PUBKEY:()=>nr,FARM_VERSION_TO_LEDGER_LAYOUT:()=>Be,FARM_VERSION_TO_PROGRAMID:()=>Re,FARM_VERSION_TO_STATE_LAYOUT:()=>ke,associatedLedgerAccountLayout:()=>se,calFarmRewardAmount:()=>Bt,calculateFarmPoolAprList:()=>_t,createAssociatedLedgerAccountInstruction:()=>Kt,dwLayout:()=>dt,farmAddRewardLayout:()=>st,farmDespotVersionToInstruction:()=>et,farmLedgerLayoutV3_1:()=>ut,farmLedgerLayoutV3_2:()=>Ae,farmLedgerLayoutV5_1:()=>ct,farmLedgerLayoutV5_2:()=>Ke,farmLedgerLayoutV6_1:()=>De,farmRewardInfoToConfig:()=>kt,farmRewardLayout:()=>ue,farmRewardRestartLayout:()=>at,farmRewardTimeInfoLayout:()=>sr,farmStateV3Layout:()=>Fe,farmStateV5Layout:()=>Ie,farmStateV6Layout:()=>_e,farmWithdrawVersionToInstruction:()=>tt,fetchMultipleFarmInfoAndUpdate:()=>Wr,getAssociatedAuthority:()=>Lt,getAssociatedLedgerAccount:()=>Kr,getAssociatedLedgerPoolAccount:()=>Tt,getFarmLedgerLayout:()=>Dr,getFarmProgramId:()=>Rt,getFarmStateLayout:()=>Vr,getFarmVersion:()=>Ar,isValidFarmVersion:()=>Zr,judgeFarmType:()=>Ft,makeCreateFarmInstruction:()=>Dt,mergeSdkFarmInfo:()=>Nt,poolTypeV6:()=>Ne,realFarmStateV3Layout:()=>or,realFarmStateV5Layout:()=>ir,realFarmV6Layout:()=>ar,updateFarmPoolInfo:()=>Er,validateFarmRewards:()=>nt,whetherIsStakeFarmPool:()=>It,withdrawRewardLayout:()=>ot});module.exports=Hr(Vt);var Xe=require("@solana/web3.js"),$=B(require("bn.js"));var s=require("@solana/buffer-layout"),ge=s.Layout,Je=s.Structure;var ye=s.UInt;var ze=s.seq;var z=s.blob;var ie=class extends ge{constructor(t,n,o){super(t,o);this.blob=z(t),this.signed=n}decode(t,n=0){let o=new $.default(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new $.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function A(e){return new ye(1,e)}function ae(e){return new ye(4,e)}function i(e){return new ie(8,!1,e)}function V(e){return new ie(16,!1,e)}var be=class extends ge{constructor(t,n,o,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function m(e){return new be(z(32),r=>new Xe.PublicKey(r),r=>r.toBuffer(),e)}var we=class extends Je{decode(r,t){return super.decode(r,t)}};function w(e,r,t){return new we(e,r,t)}function k(e,r,t){let n,o=typeof r=="number"?r:(0,$.isBN)(r)?r.toNumber():new Proxy(r,{get(a,c){if(!n){let d=Reflect.get(a,"count");n=(0,$.isBN)(d)?d.toNumber():d,Reflect.set(a,"count",n)}return Reflect.get(a,c)},set(a,c,d){return c==="count"&&(n=d),Reflect.set(a,c,d)}});return ze(e,o,t)}var H=require("@solana/web3.js");var X=require("lodash"),he=B(require("dayjs")),Qe=B(require("dayjs/plugin/utc"));he.default.extend(Qe.default);var Pe=class{constructor(r){this.logLevel=r.logLevel!==void 0?r.logLevel:0,this.name=r.name}set level(r){this.logLevel=r}get time(){return(0,he.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(r){return r<=this.logLevel}error(...r){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...r),this):this}logWithError(...r){let t=r.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...r){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...r),this):this}info(...r){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...r),this):this}debug(...r){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...r),this):this}},Ze={},Jr={};function P(e){let r=(0,X.get)(Ze,e);if(!r){let t=(0,X.get)(Jr,e);r=new Pe({name:e,logLevel:t}),(0,X.set)(Ze,e,r)}return r}var er=P("Raydium_farm_config"),xe="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",rr=new H.PublicKey(xe),Se="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",tr=new H.PublicKey(Se),Te="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",nr=new H.PublicKey(Te),Le={[xe]:3,[Se]:5,[Te]:6},Re={3:rr,5:tr,6:nr},zr=new H.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Xr=new H.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),ke={3:Fe,5:Ie,6:_e},Be={3:Ae,5:Ke,6:De},Zr=e=>[3,5,6].indexOf(e)!==-1,Qr={3:10,5:11,6:1},et=e=>{let r=Qr[e];return r||er.logWithError("invalid deposit farm version"),r},rt={3:11,5:12,6:2},tt=e=>{let r=rt[e];return r||er.logWithError("invalid withdraw farm version"),r},nt=e=>{var c;let{version:r,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,a={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(c=a[r])==null?void 0:c.call(a)},Ne={"Standard SPL":0,"Option tokens":1};var se=w([A("instruction")]),ot=w([A("instruction")]),it=w([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),V("accRewardPerShare"),m("rewardVault"),m("rewardMint"),m("rewardSender"),i("rewardType"),k(i(),15,"padding")]),or=w([i("state"),i("nonce"),m("lpVault"),m("rewardVault"),m(),m(),i(),i(),i("totalReward"),V("perShareReward"),i("lastSlot"),i("perSlotReward")]),ir=w([i("state"),i("nonce"),m("lpVault"),m("rewardVaultA"),i("totalRewardA"),V("perShareRewardA"),i("perSlotRewardA"),A("option"),m("rewardVaultB"),z(7),i("totalRewardB"),V("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),m()]),ar=w([i(),i("state"),i("nonce"),i("validRewardTokenNum"),V("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),m("lpMint"),m("lpVault"),k(it,5,"rewardInfos"),m("creator"),m(),k(i(),32,"padding")]),Fe=new Proxy(or,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return F(T({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,r,t)}}),Ie=new Proxy(ir,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return F(T({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,r,t)}}),_e=new Proxy(ar,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return F(T({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var c;return F(T({},a),{rewardType:((c=Object.entries(Ne).find(d=>String(d[1])===a.rewardType.toString()))!=null?c:["Standard SPL"])[0]})})})}:Reflect.get(e,r,t)}}),sr=w([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),ue=w([A("instruction"),i("nonce"),k(sr,5,"rewardTimeInfo")]),at=w([A("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),st=w([A("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),ut=w([i("state"),m("id"),m("owner"),i("deposited"),k(i(),1,"rewardDebts")]),Ae=w([i("state"),m("id"),m("owner"),i("deposited"),k(V(),1,"rewardDebts"),k(i(),17)]),ct=w([i("state"),m("id"),m("owner"),i("deposited"),k(i(),2,"rewardDebts")]),Ke=w([i("state"),m("id"),m("owner"),i("deposited"),k(V(),2,"rewardDebts"),k(i(),17)]),De=w([i(),i("state"),m("id"),m("owner"),i("deposited"),k(V(),5,"rewardDebts"),k(i(),16)]),dt=w([A("instruction"),i("amount")]);var x=B(require("bn.js"));var cr=require("@solana/web3.js");function ur(e,r=1,t=[]){let n=[...e];if(r<=0)return t;for(;n.length;)t.push(n.splice(0,r));return t}var Ve=P("Raydium_accountInfo_util");async function mt(e,r,t){let{batchRequest:n,commitment:o}=T({batchRequest:!1},t),a=ur(r,100),c=new Array(a.length).fill([]);if(n){let d=a.map(S=>{let N=e._buildArgs([S.map(_=>_.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:N}});c=(await e._rpcBatchRequest(d)).map(S=>(S.error&&Ve.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${S.error.message}`),S.result.value.map(N=>{if(N){let{data:_,executable:M,lamports:L,owner:f,rentEpoch:D}=N;return _.length!==2&&_[1]!=="base64"&&Ve.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(_[0],"base64"),executable:M,lamports:L,owner:new cr.PublicKey(f),rentEpoch:D}}return null})))}else try{c=await Promise.all(a.map(d=>e.getMultipleAccountsInfo(d,o)))}catch(d){d instanceof Error&&Ve.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.message}`)}return c.flat()}async function dr(e,r,t){let n=await mt(e,r.map(o=>o.pubkey),t);return r.map((o,a)=>F(T({},o),{accountInfo:n[a]}))}var h=B(require("bn.js"));var fr=B(require("big.js")),re=B(require("bn.js"));var mr=B(require("toformat")),lt=mr.default,Z=lt;var Q=B(require("big.js")),lr=B(require("decimal.js-light"));var ce=P("module/fraction"),Ee=Z(Q.default),ee=Z(lr.default),pt={[0]:ee.ROUND_DOWN,[1]:ee.ROUND_HALF_UP,[2]:ee.ROUND_UP},ft={[0]:Q.default.roundDown,[1]:Q.default.roundHalfUp,[2]:Q.default.roundUp},u=class{constructor(r,t=O){this.numerator=y(r),this.denominator=y(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new u(this.denominator,this.numerator)}add(r){let t=r instanceof u?r:new u(y(r));return this.denominator.eq(t.denominator)?new u(this.numerator.add(t.numerator),this.denominator):new u(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(r){let t=r instanceof u?r:new u(y(r));return this.denominator.eq(t.denominator)?new u(this.numerator.sub(t.numerator),this.denominator):new u(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(r){let t=r instanceof u?r:new u(y(r));return new u(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(r){let t=r instanceof u?r:new u(y(r));return new u(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(r,t={groupSeparator:""},n=1){Number.isInteger(r)||ce.logWithError(`${r} is not an integer.`),r<=0&&ce.logWithError(`${r} is not positive.`),ee.set({precision:r+1,rounding:pt[n]});let o=new ee(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(r);return o.toFormat(o.decimalPlaces(),t)}toFixed(r,t={groupSeparator:""},n=1){return Number.isInteger(r)||ce.logWithError(`${r} is not an integer.`),r<0&&ce.logWithError(`${r} is negative.`),Ee.DP=r,Ee.RM=ft[n]||1,new Ee(this.numerator.toString()).div(this.denominator.toString()).toFormat(r,t)}isZero(){return this.numerator.isZero()}};var yt=P("Raydium_amount"),pr=Z(fr.default);function bt(e,r){let t="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([t,n]=o,n=n.padEnd(r,"0")):yt.logWithError(`invalid number string, num: ${e}`)}else t=e;return[t,n.slice(0,r)||n]}var I=class extends u{constructor(t,n,o=!0,a){let c=new re.default(0),d=U.pow(new re.default(t.decimals));if(o)c=y(n);else{let l=new re.default(0),S=new re.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[N,_]=bt(n.toString(),t.decimals);l=y(N),S=y(_)}l=l.mul(d),c=l.add(S)}super(c,d);this.logger=P(a||"Amount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new I(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new I(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return pr.DP=this.token.decimals,new pr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var gr=require("@solana/web3.js"),yr={symbol:"SOL",name:"Solana",decimals:9},C={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},In={isQuantumSOL:!0,isLp:!1,official:!0,mint:new gr.PublicKey(C.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var me=require("@solana/web3.js");var wr=require("@solana/spl-token"),g=require("@solana/web3.js");function b({pubkey:e,isSigner:r=!1,isWritable:t=!0}){return{pubkey:e,isWritable:t,isSigner:r}}var Pr=[b({pubkey:wr.TOKEN_PROGRAM_ID,isWritable:!1}),b({pubkey:g.SystemProgram.programId,isWritable:!1}),b({pubkey:g.SYSVAR_RENT_PUBKEY,isWritable:!1})];function de({publicKey:e,transformSol:r}){if(e instanceof g.PublicKey)return r&&e.equals(q)?br:e;if(r&&e===q.toBase58())return br;if(typeof e=="string")try{return new g.PublicKey(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function hr(e){try{return new g.PublicKey(e)}catch{return e}}var xr=new g.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Kn=new g.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Dn=new g.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Vn=new g.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),En=new g.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Wn=new g.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Mn=new g.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),vn=new g.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),On=new g.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Un=new g.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Cn=new g.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),br=new g.PublicKey("So11111111111111111111111111111111111111112"),q=g.PublicKey.default;var We=class{constructor({mint:r,decimals:t,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(r===q.toBase58()||r instanceof me.PublicKey&&q.equals(r)){this.decimals=C.decimals,this.symbol=C.symbol,this.name=C.name,this.mint=new me.PublicKey(C.mint);return}this.decimals=t,this.symbol=n,this.name=o,this.mint=a?me.PublicKey.default:de({publicKey:r})}equals(r){return this===r?!0:this.mint.equals(r.mint)}},W=We;W.WSOL=new We(C);var ve=class{constructor({decimals:r,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=r,this.symbol=t,this.name=n}equals(r){return this===r}},Me=ve;Me.SOL=new ve(yr);var Sr=new u(Tr),G=class extends u{toSignificant(r=5,t,n){return this.mul(Sr).toSignificant(r,t,n)}toFixed(r=2,t,n){return this.mul(Sr).toFixed(r,t,n)}};var wt=P("Raydium_price"),K=class extends u{constructor(t){let{baseToken:n,quoteToken:o,numerator:a,denominator:c}=t;super(a,c);this.baseToken=n,this.quoteToken=o,this.scalar=new u(Oe(n.decimals),Oe(o.decimals))}get raw(){return new u(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new K({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&wt.logWithError("mul token not equals");let n=super.mul(t);return new K({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var le=P("Raydium_bignumber");var kr=new h.default(0),O=new h.default(1),wo=new h.default(2),Po=new h.default(3),ho=new h.default(5),U=new h.default(10),Tr=new h.default(100),xo=new h.default(1e3),So=new h.default(1e4),Lr=9007199254740991;function y(e){if(e instanceof h.default)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new h.default(e);le.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&le.logWithError(`BigNumberish number underflow: ${e}`),(e>=Lr||e<=-Lr)&&le.logWithError(`BigNumberish number overflow: ${e}`),new h.default(String(e))):typeof e=="bigint"?new h.default(e.toString()):(le.logWithError(`invalid BigNumberish value: ${e}`),new h.default(0))}function Oe(e){return U.pow(y(e))}function Br(e){var d;if(e===void 0)return{denominator:"1",numerator:"0"};if(e instanceof h.default)return{numerator:e.toString(),denominator:"1"};if(e instanceof u)return{denominator:e.denominator.toString(),numerator:e.numerator.toString()};let r=String(e),[,t="",n="",o=""]=(d=r.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?d:[],a="1"+"0".repeat(o.length),c=t+(n==="0"?"":n)+o||"0";return{denominator:a,numerator:c,sign:t,int:n,dec:o}}function Pt(e){var n;let[,r="",t=""]=(n=e.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${r}${t}`}function ht(e,r=0){return e instanceof h.default?e:new h.default(Pt(j(e).mul(U.pow(new h.default(String(r))))))}function j(e){if(e instanceof G)return new u(e.numerator,e.denominator);if(e instanceof K)return e.adjusted;if(e instanceof I)try{return j(e.toExact())}catch{return new u(kr)}if(e instanceof u)return e;let r=String(e),t=Br(r);return new u(t.numerator,t.denominator)}function Nr(e,r){if(e==null||r==null)return;let t=j(e),n=j(r);return t.mul(n)}function Rr(e){let r=new W({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),t=ht(Nr(e,10**r.decimals));return new I(r,t)}function Ue(e,r){return Rr(!r||!e?0:Nr(e,r))}var te=require("@solana/web3.js");var Io=P("Raydium_txTool");async function pe(e,r){let[t,n]=await te.PublicKey.findProgramAddress(e,r);return{publicKey:t,nonce:n}}var Fr=e=>typeof e=="number";function Ce(e,r,t){let n=Fr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()<=n}function qe(e,r,t){let n=Fr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()>n}var Ge=w([m("mint"),m("owner"),i("amount"),ae("delegateOption"),m("delegate"),A("state"),ae("isNativeOption"),i("isNative"),i("delegatedAmount"),ae("closeAuthorityOption"),m("closeAuthority")]);var Ir=require("@solana/web3.js"),_r=B(require("bn.js"));var xt=[W,I,Ir.PublicKey,u,_r.default,K,G];function St(e){return typeof e=="object"&&e!==null&&!xt.some(r=>typeof r=="object"&&e instanceof r)}function ne(e){return typeof e=="string"?hr(e):Array.isArray(e)?e.map(r=>ne(r)):St(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,ne(t)])):e}var oe=P("Raydium.farm.util");async function Tt({programId:e,poolId:r,mint:t,type:n}){let{publicKey:o}=await pe([r.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function Ar(e){let t=de({publicKey:e}).toBase58();return Le[t]}async function Kr({programId:e,poolId:r,owner:t}){let{publicKey:n}=await pe([r.toBuffer(),t.toBuffer(),Buffer.from(Ar(e)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return n}var Lt=async({programId:e,poolId:r})=>await pe([r.toBuffer()],e);function Rt(e){return Re[e]}function kt(e){return{isSet:new x.default(1),rewardPerSecond:y(e.rewardPerSecond),rewardOpenTime:y(e.rewardOpenTime),rewardEndTime:y(e.rewardEndTime),rewardType:y(e.rewardType)}}function Bt(e){return y(e.rewardEndTime).sub(y(e.rewardOpenTime)).mul(y(e.rewardPerSecond))}function Dr(e){let r=Be[e];return r||oe.logWithError("invalid version",e),r}function Vr(e){let r=ke[e];return r||oe.logWithError("invalid version",e),r}function Er(e,r,t,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new x.default(t)))return e;let o=new x.default(t).sub(e.lastSlot);e.lastSlot=new x.default(t);for(let a of e.rewardInfos){if(r.amount.eq(new x.default(0)))continue;let c=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(c.mul(new x.default(10).pow(new x.default(e.version===3?9:15))).div(r.amount)),a.totalReward=a.totalReward.add(c)}}else if(e.version===6)for(let o of e.rewardInfos){if(o.rewardState.eq(new x.default(0)))continue;let a=x.default.min(new x.default(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let d=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),l=o.totalReward.sub(o.totalRewardEmissioned);l.lt(d)?(d=l,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(l.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!r.amount.eq(new x.default(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(d.mul(e.rewardMultiplier).div(r.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(d))}return e}async function Wr({connection:e,farmPools:r,owner:t,config:n}){var M;let o=!1,a=!1,c=new x.default(10),d=[];for(let L of r){let f=ne(L);f.version===6?a=!0:o=!0,d.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),t&&d.push({pubkey:await Kr({programId:f.programId,poolId:f.id,owner:t}),version:f.version,key:"ledger",poolId:f.id})}let l={},S=await dr(e,d,n);for(let{pubkey:L,version:f,key:D,poolId:fe,accountInfo:R}of S){let E=fe.toBase58();if(l[E]=T({},l[E]),D==="state"){let v=Vr(f);(!R||!R.data||R.data.length!==v.span)&&oe.logWithError(`invalid farm state account info, pools.id, ${L}`),l[E].state=v.decode(R.data)}else if(D==="lpVault")(!R||!R.data||R.data.length!==Ge.span)&&oe.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),l[E].lpVault=Ge.decode(R.data);else if(D==="ledger"){let v=Dr(f);R&&R.data&&(R.data.length!==v.span&&oe.logWithError(`invalid farm ledger account info, ledger, ${L}`),l[E].ledger=v.decode(R.data))}}let N=a||o?await e.getSlot():0,_=a&&(M=await e.getBlockTime(N))!=null?M:0;for(let L of Object.keys(l))l[L].state=Er(l[L].state,l[L].lpVault,N,_);for(let[L,{state:f,ledger:D}]of Object.entries(l))if(D){let fe=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?c.pow(new x.default(9)):c.pow(new x.default(15)),R=f.rewardInfos.map((E,v)=>{let vr=D.rewardDebts[v];return D.deposited.mul(f.version===6?E.accRewardPerShare:E.perShareReward).div(fe).sub(vr)});l[L].wrapped=F(T({},l[L].wrapped),{pendingRewards:R})}return l}async function Nt(e){let{farmPools:r}=e,t=await Wr(e);return r.map((o,a)=>F(T(T(T({},r[a]),ne(o)),t[o.id]),{jsonInfo:r[a]}))}function Ft(e,r=Date.now()){if(e.version===6){let t=e.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>Ce(r,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>qe(r,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}function It(e){return e.state.rewardInfos.length===1&&String(e.lpMint)===xr.toBase58()}function _t(e,r){return e.version===6?e.state.rewardInfos.map(({rewardPerSecond:t,rewardOpenTime:n,rewardEndTime:o},a)=>{var M;let c=Ce(r.currentBlockChainDate,n.toNumber(),{unit:"s"}),d=qe(r.currentBlockChainDate,o.toNumber(),{unit:"s"});if(c||d)return;let l=r.rewardTokens[a];if(!l)return;let S=r.rewardTokenPrices[a];if(!S)return;let N=Ue(new u(t,O).div(U.pow(new x.default(l.decimals||1))).mul(new x.default(60*60*24*365)),S);return r.tvl?r.tvl.isZero()?j(0):N.div((M=r.tvl)!=null?M:O):void 0}):e.state.rewardInfos.map(({perSlotReward:n},o)=>{var S;let a=r.rewardTokens[o];if(!a)return;let c=r.rewardTokenPrices[o];if(!c)return;let d=Ue(new u(n,O).div(U.pow(new x.default(a.decimals||1))).mul(new x.default(r.blockSlotCountForSecond*60*60*24*365)),c);return r.tvl?r.tvl.isZero()?j(0):d.div((S=r.tvl)!=null?S:O):void 0})}var Y=require("@solana/web3.js"),Mr=B(require("bn.js"));var At=P("Raydium_farm_instruction");async function Kt(e){let{version:r,id:t,ledger:n,programId:o,owner:a}=e,c={3:9,5:10}[r];c||At.logWithError(`invalid farm pool version: ${r}`);let d=Buffer.alloc(se.span);se.encode({instruction:c},d);let l=[b({pubkey:t}),b({pubkey:n}),b({pubkey:a,isWritable:!1}),b({pubkey:Y.SystemProgram.programId,isWritable:!1}),b({pubkey:Y.SYSVAR_RENT_PUBKEY,isWritable:!1})];return new Y.TransactionInstruction({programId:o,keys:l,data:d})}function Dt(e){var n;let r=Buffer.alloc(ue.span);ue.encode({instruction:0,nonce:new Mr.default(e.nonce),rewardTimeInfo:e.rewardInfoConfig},r);let t=[...Pr,b({pubkey:e.farmKeyPair.publicKey}),b({pubkey:e.farmAuthority,isWritable:!1}),b({pubkey:e.lpVault}),b({pubkey:e.lpMint,isWritable:!1}),b({pubkey:e.lockVault}),b({pubkey:e.lockMint,isWritable:!1}),b({pubkey:(n=e.lockUserAccount)!=null?n:q}),b({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)t.push(b({pubkey:o.rewardMint,isWritable:!1}),b({pubkey:o.rewardVault}),b({pubkey:o.userRewardToken}));return new Y.TransactionInstruction({programId:e.programId,keys:t,data:r})}0&&(module.exports={FARM_LOCK_MINT,FARM_LOCK_VAULT,FARM_PROGRAMID_TO_VERSION,FARM_PROGRAM_ID_V3,FARM_PROGRAM_ID_V3_PUBKEY,FARM_PROGRAM_ID_V5,FARM_PROGRAM_ID_V5_PUBKEY,FARM_PROGRAM_ID_V6,FARM_PROGRAM_ID_V6_PUBKEY,FARM_VERSION_TO_LEDGER_LAYOUT,FARM_VERSION_TO_PROGRAMID,FARM_VERSION_TO_STATE_LAYOUT,associatedLedgerAccountLayout,calFarmRewardAmount,calculateFarmPoolAprList,createAssociatedLedgerAccountInstruction,dwLayout,farmAddRewardLayout,farmDespotVersionToInstruction,farmLedgerLayoutV3_1,farmLedgerLayoutV3_2,farmLedgerLayoutV5_1,farmLedgerLayoutV5_2,farmLedgerLayoutV6_1,farmRewardInfoToConfig,farmRewardLayout,farmRewardRestartLayout,farmRewardTimeInfoLayout,farmStateV3Layout,farmStateV5Layout,farmStateV6Layout,farmWithdrawVersionToInstruction,fetchMultipleFarmInfoAndUpdate,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getFarmLedgerLayout,getFarmProgramId,getFarmStateLayout,getFarmVersion,isValidFarmVersion,judgeFarmType,makeCreateFarmInstruction,mergeSdkFarmInfo,poolTypeV6,realFarmStateV3Layout,realFarmStateV5Layout,realFarmV6Layout,updateFarmPoolInfo,validateFarmRewards,whetherIsStakeFarmPool,withdrawRewardLayout});
//# sourceMappingURL=index.js.map