var Or=Object.create;var J=Object.defineProperty,vr=Object.defineProperties,Ur=Object.getOwnPropertyDescriptor,Cr=Object.getOwnPropertyDescriptors,qr=Object.getOwnPropertyNames,qe=Object.getOwnPropertySymbols,Gr=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty,jr=Object.prototype.propertyIsEnumerable;var Ge=(e,r,t)=>r in e?J(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,T=(e,r)=>{for(var t in r||(r={}))je.call(r,t)&&Ge(e,t,r[t]);if(qe)for(var t of qe(r))jr.call(r,t)&&Ge(e,t,r[t]);return e},F=(e,r)=>vr(e,Cr(r));var Yr=(e,r)=>{for(var t in r)J(e,t,{get:r[t],enumerable:!0})},Ye=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of qr(r))!je.call(e,o)&&o!==t&&J(e,o,{get:()=>r[o],enumerable:!(n=Ur(r,o))||n.enumerable});return e};var B=(e,r,t)=>(t=e!=null?Or(Gr(e)):{},Ye(r||!e||!e.__esModule?J(t,"default",{value:e,enumerable:!0}):t,e)),$r=e=>Ye(J({},"__esModule",{value:!0}),e);var Et={};Yr(Et,{FARM_LOCK_MINT:()=>Xr,FARM_LOCK_VAULT:()=>Zr,FARM_PROGRAMID_TO_VERSION:()=>Se,FARM_PROGRAM_ID_V3:()=>Pe,FARM_PROGRAM_ID_V3_PUBKEY:()=>er,FARM_PROGRAM_ID_V5:()=>he,FARM_PROGRAM_ID_V5_PUBKEY:()=>rr,FARM_PROGRAM_ID_V6:()=>xe,FARM_PROGRAM_ID_V6_PUBKEY:()=>tr,FARM_VERSION_TO_LEDGER_LAYOUT:()=>Re,FARM_VERSION_TO_PROGRAMID:()=>Te,FARM_VERSION_TO_STATE_LAYOUT:()=>Le,associatedLedgerAccountLayout:()=>se,calFarmRewardAmount:()=>Nt,calculateFarmPoolAprList:()=>At,createAssociatedLedgerAccountInstruction:()=>Vt,dwLayout:()=>mt,farmAddRewardLayout:()=>ut,farmDespotVersionToInstruction:()=>rt,farmLedgerLayoutV3_1:()=>ct,farmLedgerLayoutV3_2:()=>Ie,farmLedgerLayoutV5_1:()=>dt,farmLedgerLayoutV5_2:()=>_e,farmLedgerLayoutV6_1:()=>Ae,farmRewardInfoToConfig:()=>Bt,farmRewardLayout:()=>ue,farmRewardRestartLayout:()=>st,farmRewardTimeInfoLayout:()=>ar,farmStateV3Layout:()=>Be,farmStateV5Layout:()=>Ne,farmStateV6Layout:()=>Fe,farmWithdrawVersionToInstruction:()=>nt,fetchMultipleFarmInfoAndUpdate:()=>Er,getAssociatedAuthority:()=>Rt,getAssociatedLedgerAccount:()=>Ar,getAssociatedLedgerPoolAccount:()=>Lt,getFarmLedgerLayout:()=>Kr,getFarmProgramId:()=>kt,getFarmStateLayout:()=>Vr,getFarmVersion:()=>_r,isValidFarmVersion:()=>Qr,judgeFarmType:()=>It,makeCreateFarmInstruction:()=>Dt,mergeSdkFarmInfo:()=>Ft,poolTypeV6:()=>ke,realFarmStateV3Layout:()=>nr,realFarmStateV5Layout:()=>or,realFarmV6Layout:()=>ir,updateFarmPoolInfo:()=>Dr,validateFarmRewards:()=>ot,whetherIsStakeFarmPool:()=>_t,withdrawRewardLayout:()=>it});module.exports=$r(Et);var Je=require("@solana/web3.js"),$=B(require("bn.js"));var s=require("@solana/buffer-layout"),ye=s.Layout,$e=s.Structure;var ge=s.UInt;var He=s.seq;var z=s.blob;var ie=class extends ye{constructor(t,n,o){super(t,o);this.blob=z(t),this.signed=n}decode(t,n=0){let o=new $.default(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new $.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function A(e){return new ge(1,e)}function ae(e){return new ge(4,e)}function i(e){return new ie(8,!1,e)}function D(e){return new ie(16,!1,e)}var be=class extends ye{constructor(t,n,o,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function m(e){return new be(z(32),r=>new Je.PublicKey(r),r=>r.toBuffer(),e)}var we=class extends $e{decode(r,t){return super.decode(r,t)}};function w(e,r,t){return new we(e,r,t)}function k(e,r,t){let n,o=typeof r=="number"?r:(0,$.isBN)(r)?r.toNumber():new Proxy(r,{get(a,c){if(!n){let d=Reflect.get(a,"count");n=(0,$.isBN)(d)?d.toNumber():d,Reflect.set(a,"count",n)}return Reflect.get(a,c)},set(a,c,d){return c==="count"&&(n=d),Reflect.set(a,c,d)}});return He(e,o,t)}var H=require("@solana/web3.js");var X=require("lodash"),Xe=B(require("pino")),Ze=B(require("pino-pretty")),ze={},Hr={},Jr=(0,Ze.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),zr=(0,Xe.default)({base:null,level:"silent"},Jr);function P(e){let r=(0,X.get)(ze,e);if(!r){let t=(0,X.get)(Hr,e);r=zr.child({name:e},{level:t}),(0,X.set)(ze,e,r)}return r.logWithError=(...t)=>{let n=t.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(n)},r}var Qe=P("Raydium_farm_config"),Pe="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",er=new H.PublicKey(Pe),he="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",rr=new H.PublicKey(he),xe="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",tr=new H.PublicKey(xe),Se={[Pe]:3,[he]:5,[xe]:6},Te={3:er,5:rr,6:tr},Xr=new H.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Zr=new H.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),Le={3:Be,5:Ne,6:Fe},Re={3:Ie,5:_e,6:Ae},Qr=e=>[3,5,6].indexOf(e)!==-1,et={3:10,5:11,6:1},rt=e=>{let r=et[e];return r||Qe.logWithError("invalid deposit farm version"),r},tt={3:11,5:12,6:2},nt=e=>{let r=tt[e];return r||Qe.logWithError("invalid withdraw farm version"),r},ot=e=>{var c;let{version:r,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,a={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(c=a[r])==null?void 0:c.call(a)},ke={"Standard SPL":0,"Option tokens":1};var se=w([A("instruction")]),it=w([A("instruction")]),at=w([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),D("accRewardPerShare"),m("rewardVault"),m("rewardMint"),m("rewardSender"),i("rewardType"),k(i(),15,"padding")]),nr=w([i("state"),i("nonce"),m("lpVault"),m("rewardVault"),m(),m(),i(),i(),i("totalReward"),D("perShareReward"),i("lastSlot"),i("perSlotReward")]),or=w([i("state"),i("nonce"),m("lpVault"),m("rewardVaultA"),i("totalRewardA"),D("perShareRewardA"),i("perSlotRewardA"),A("option"),m("rewardVaultB"),z(7),i("totalRewardB"),D("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),m()]),ir=w([i(),i("state"),i("nonce"),i("validRewardTokenNum"),D("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),m("lpMint"),m("lpVault"),k(at,5,"rewardInfos"),m("creator"),m(),k(i(),32,"padding")]),Be=new Proxy(nr,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return F(T({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,r,t)}}),Ne=new Proxy(or,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return F(T({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,r,t)}}),Fe=new Proxy(ir,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return F(T({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var c;return F(T({},a),{rewardType:((c=Object.entries(ke).find(d=>String(d[1])===a.rewardType.toString()))!=null?c:["Standard SPL"])[0]})})})}:Reflect.get(e,r,t)}}),ar=w([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),ue=w([A("instruction"),i("nonce"),k(ar,5,"rewardTimeInfo")]),st=w([A("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),ut=w([A("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),ct=w([i("state"),m("id"),m("owner"),i("deposited"),k(i(),1,"rewardDebts")]),Ie=w([i("state"),m("id"),m("owner"),i("deposited"),k(D(),1,"rewardDebts"),k(i(),17)]),dt=w([i("state"),m("id"),m("owner"),i("deposited"),k(i(),2,"rewardDebts")]),_e=w([i("state"),m("id"),m("owner"),i("deposited"),k(D(),2,"rewardDebts"),k(i(),17)]),Ae=w([i(),i("state"),m("id"),m("owner"),i("deposited"),k(D(),5,"rewardDebts"),k(i(),16)]),mt=w([A("instruction"),i("amount")]);var x=B(require("bn.js"));var ur=require("@solana/web3.js");function sr(e,r=1,t=[]){let n=[...e];if(r<=0)return t;for(;n.length;)t.push(n.splice(0,r));return t}var Ke=P("Raydium_accountInfo_util");async function lt(e,r,t){let{batchRequest:n,commitment:o}=T({batchRequest:!1},t),a=sr(r,100),c=new Array(a.length).fill([]);if(n){let d=a.map(S=>{let N=e._buildArgs([S.map(_=>_.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:N}});c=(await e._rpcBatchRequest(d)).map(S=>(S.error&&Ke.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${S.error.message}`),S.result.value.map(N=>{if(N){let{data:_,executable:M,lamports:L,owner:f,rentEpoch:V}=N;return _.length!==2&&_[1]!=="base64"&&Ke.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(_[0],"base64"),executable:M,lamports:L,owner:new ur.PublicKey(f),rentEpoch:V}}return null})))}else try{c=await Promise.all(a.map(d=>e.getMultipleAccountsInfo(d,o)))}catch(d){d instanceof Error&&Ke.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.message}`)}return c.flat()}async function cr(e,r,t){let n=await lt(e,r.map(o=>o.pubkey),t);return r.map((o,a)=>F(T({},o),{accountInfo:n[a]}))}var h=B(require("bn.js"));var pr=B(require("big.js")),re=B(require("bn.js"));var dr=B(require("toformat")),pt=dr.default,Z=pt;var Q=B(require("big.js")),mr=B(require("decimal.js-light"));var ce=P("module/fraction"),Ve=Z(Q.default),ee=Z(mr.default),ft={[0]:ee.ROUND_DOWN,[1]:ee.ROUND_HALF_UP,[2]:ee.ROUND_UP},yt={[0]:Q.default.roundDown,[1]:Q.default.roundHalfUp,[2]:Q.default.roundUp},u=class{constructor(r,t=v){this.numerator=g(r),this.denominator=g(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new u(this.denominator,this.numerator)}add(r){let t=r instanceof u?r:new u(g(r));return this.denominator.eq(t.denominator)?new u(this.numerator.add(t.numerator),this.denominator):new u(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(r){let t=r instanceof u?r:new u(g(r));return this.denominator.eq(t.denominator)?new u(this.numerator.sub(t.numerator),this.denominator):new u(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(r){let t=r instanceof u?r:new u(g(r));return new u(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(r){let t=r instanceof u?r:new u(g(r));return new u(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(r,t={groupSeparator:""},n=1){Number.isInteger(r)||ce.logWithError(`${r} is not an integer.`),r<=0&&ce.logWithError(`${r} is not positive.`),ee.set({precision:r+1,rounding:ft[n]});let o=new ee(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(r);return o.toFormat(o.decimalPlaces(),t)}toFixed(r,t={groupSeparator:""},n=1){return Number.isInteger(r)||ce.logWithError(`${r} is not an integer.`),r<0&&ce.logWithError(`${r} is negative.`),Ve.DP=r,Ve.RM=yt[n]||1,new Ve(this.numerator.toString()).div(this.denominator.toString()).toFormat(r,t)}isZero(){return this.numerator.isZero()}};var bt=P("Raydium_amount"),lr=Z(pr.default);function wt(e,r){let t="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([t,n]=o,n=n.padEnd(r,"0")):bt.logWithError(`invalid number string, num: ${e}`)}else t=e;return[t,n.slice(0,r)||n]}var I=class extends u{constructor(t,n,o=!0,a){let c=new re.default(0),d=U.pow(new re.default(t.decimals));if(o)c=g(n);else{let l=new re.default(0),S=new re.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[N,_]=wt(n.toString(),t.decimals);l=g(N),S=g(_)}l=l.mul(d),c=l.add(S)}super(c,d);this.logger=P(a||"Amount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new I(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new I(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return lr.DP=this.token.decimals,new lr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};var fr=require("@solana/web3.js"),yr={symbol:"SOL",name:"Solana",decimals:9},C={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Kn={isQuantumSOL:!0,isLp:!1,official:!0,mint:new fr.PublicKey(C.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var me=require("@solana/web3.js");var br=require("@solana/spl-token"),y=require("@solana/web3.js");function b({pubkey:e,isSigner:r=!1,isWritable:t=!0}){return{pubkey:e,isWritable:t,isSigner:r}}var wr=[b({pubkey:br.TOKEN_PROGRAM_ID,isWritable:!1}),b({pubkey:y.SystemProgram.programId,isWritable:!1}),b({pubkey:y.SYSVAR_RENT_PUBKEY,isWritable:!1})];function de({publicKey:e,transformSol:r}){if(e instanceof y.PublicKey)return r&&e.equals(q)?gr:e;if(r&&e===q.toBase58())return gr;if(typeof e=="string")try{return new y.PublicKey(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Pr(e){try{return new y.PublicKey(e)}catch{return e}}var hr=new y.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),En=new y.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Wn=new y.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Mn=new y.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),On=new y.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),vn=new y.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Un=new y.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Cn=new y.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qn=new y.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Gn=new y.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),jn=new y.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),gr=new y.PublicKey("So11111111111111111111111111111111111111112"),q=y.PublicKey.default;var De=class{constructor({mint:r,decimals:t,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(r===q.toBase58()||r instanceof me.PublicKey&&q.equals(r)){this.decimals=C.decimals,this.symbol=C.symbol,this.name=C.name,this.mint=new me.PublicKey(C.mint);return}this.decimals=t,this.symbol=n,this.name=o,this.mint=a?me.PublicKey.default:de({publicKey:r})}equals(r){return this===r?!0:this.mint.equals(r.mint)}},W=De;W.WSOL=new De(C);var We=class{constructor({decimals:r,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=r,this.symbol=t,this.name=n}equals(r){return this===r}},Ee=We;Ee.SOL=new We(yr);var xr=new u(Sr),G=class extends u{toSignificant(r=5,t,n){return this.mul(xr).toSignificant(r,t,n)}toFixed(r=2,t,n){return this.mul(xr).toFixed(r,t,n)}};var Pt=P("Raydium_price"),K=class extends u{constructor(t){let{baseToken:n,quoteToken:o,numerator:a,denominator:c}=t;super(a,c);this.baseToken=n,this.quoteToken=o,this.scalar=new u(Me(n.decimals),Me(o.decimals))}get raw(){return new u(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new K({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Pt.logWithError("mul token not equals");let n=super.mul(t);return new K({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var le=P("Raydium_bignumber");var Rr=new h.default(0),v=new h.default(1),xo=new h.default(2),So=new h.default(3),To=new h.default(5),U=new h.default(10),Sr=new h.default(100),Lo=new h.default(1e3),Ro=new h.default(1e4),Tr=9007199254740991;function g(e){if(e instanceof h.default)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new h.default(e);le.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&le.logWithError(`BigNumberish number underflow: ${e}`),(e>=Tr||e<=-Tr)&&le.logWithError(`BigNumberish number overflow: ${e}`),new h.default(String(e))):typeof e=="bigint"?new h.default(e.toString()):(le.logWithError(`invalid BigNumberish value: ${e}`),new h.default(0))}function Me(e){return U.pow(g(e))}function kr(e){var d;if(e===void 0)return{denominator:"1",numerator:"0"};if(e instanceof h.default)return{numerator:e.toString(),denominator:"1"};if(e instanceof u)return{denominator:e.denominator.toString(),numerator:e.numerator.toString()};let r=String(e),[,t="",n="",o=""]=(d=r.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?d:[],a="1"+"0".repeat(o.length),c=t+(n==="0"?"":n)+o||"0";return{denominator:a,numerator:c,sign:t,int:n,dec:o}}function ht(e){var n;let[,r="",t=""]=(n=e.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${r}${t}`}function xt(e,r=0){return e instanceof h.default?e:new h.default(ht(j(e).mul(U.pow(new h.default(String(r))))))}function j(e){if(e instanceof G)return new u(e.numerator,e.denominator);if(e instanceof K)return e.adjusted;if(e instanceof I)try{return j(e.toExact())}catch{return new u(Rr)}if(e instanceof u)return e;let r=String(e),t=kr(r);return new u(t.numerator,t.denominator)}function Br(e,r){if(e==null||r==null)return;let t=j(e),n=j(r);return t.mul(n)}function Lr(e){let r=new W({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),t=xt(Br(e,10**r.decimals));return new I(r,t)}function Oe(e,r){return Lr(!r||!e?0:Br(e,r))}var te=require("@solana/web3.js");var Ko=P("Raydium_txTool");async function pe(e,r){let[t,n]=await te.PublicKey.findProgramAddress(e,r);return{publicKey:t,nonce:n}}var Nr=e=>typeof e=="number";function ve(e,r,t){let n=Nr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()<=n}function Ue(e,r,t){let n=Nr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()>n}var Ce=w([m("mint"),m("owner"),i("amount"),ae("delegateOption"),m("delegate"),A("state"),ae("isNativeOption"),i("isNative"),i("delegatedAmount"),ae("closeAuthorityOption"),m("closeAuthority")]);var Fr=require("@solana/web3.js"),Ir=B(require("bn.js"));var St=[W,I,Fr.PublicKey,u,Ir.default,K,G];function Tt(e){return typeof e=="object"&&e!==null&&!St.some(r=>typeof r=="object"&&e instanceof r)}function ne(e){return typeof e=="string"?Pr(e):Array.isArray(e)?e.map(r=>ne(r)):Tt(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,ne(t)])):e}var oe=P("Raydium.farm.util");async function Lt({programId:e,poolId:r,mint:t,type:n}){let{publicKey:o}=await pe([r.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function _r(e){let t=de({publicKey:e}).toBase58();return Se[t]}async function Ar({programId:e,poolId:r,owner:t}){let{publicKey:n}=await pe([r.toBuffer(),t.toBuffer(),Buffer.from(_r(e)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return n}var Rt=async({programId:e,poolId:r})=>await pe([r.toBuffer()],e);function kt(e){return Te[e]}function Bt(e){return{isSet:new x.default(1),rewardPerSecond:g(e.rewardPerSecond),rewardOpenTime:g(e.rewardOpenTime),rewardEndTime:g(e.rewardEndTime),rewardType:g(e.rewardType)}}function Nt(e){return g(e.rewardEndTime).sub(g(e.rewardOpenTime)).mul(g(e.rewardPerSecond))}function Kr(e){let r=Re[e];return r||oe.logWithError("invalid version",e),r}function Vr(e){let r=Le[e];return r||oe.logWithError("invalid version",e),r}function Dr(e,r,t,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new x.default(t)))return e;let o=new x.default(t).sub(e.lastSlot);e.lastSlot=new x.default(t);for(let a of e.rewardInfos){if(r.amount.eq(new x.default(0)))continue;let c=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(c.mul(new x.default(10).pow(new x.default(e.version===3?9:15))).div(r.amount)),a.totalReward=a.totalReward.add(c)}}else if(e.version===6)for(let o of e.rewardInfos){if(o.rewardState.eq(new x.default(0)))continue;let a=x.default.min(new x.default(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let d=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),l=o.totalReward.sub(o.totalRewardEmissioned);l.lt(d)?(d=l,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(l.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!r.amount.eq(new x.default(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(d.mul(e.rewardMultiplier).div(r.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(d))}return e}async function Er({connection:e,farmPools:r,owner:t,config:n}){var M;let o=!1,a=!1,c=new x.default(10),d=[];for(let L of r){let f=ne(L);f.version===6?a=!0:o=!0,d.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),t&&d.push({pubkey:await Ar({programId:f.programId,poolId:f.id,owner:t}),version:f.version,key:"ledger",poolId:f.id})}let l={},S=await cr(e,d,n);for(let{pubkey:L,version:f,key:V,poolId:fe,accountInfo:R}of S){let E=fe.toBase58();if(l[E]=T({},l[E]),V==="state"){let O=Vr(f);(!R||!R.data||R.data.length!==O.span)&&oe.logWithError(`invalid farm state account info, pools.id, ${L}`),l[E].state=O.decode(R.data)}else if(V==="lpVault")(!R||!R.data||R.data.length!==Ce.span)&&oe.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),l[E].lpVault=Ce.decode(R.data);else if(V==="ledger"){let O=Kr(f);R&&R.data&&(R.data.length!==O.span&&oe.logWithError(`invalid farm ledger account info, ledger, ${L}`),l[E].ledger=O.decode(R.data))}}let N=a||o?await e.getSlot():0,_=a&&(M=await e.getBlockTime(N))!=null?M:0;for(let L of Object.keys(l))l[L].state=Dr(l[L].state,l[L].lpVault,N,_);for(let[L,{state:f,ledger:V}]of Object.entries(l))if(V){let fe=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?c.pow(new x.default(9)):c.pow(new x.default(15)),R=f.rewardInfos.map((E,O)=>{let Mr=V.rewardDebts[O];return V.deposited.mul(f.version===6?E.accRewardPerShare:E.perShareReward).div(fe).sub(Mr)});l[L].wrapped=F(T({},l[L].wrapped),{pendingRewards:R})}return l}async function Ft(e){let{farmPools:r}=e,t=await Er(e);return r.map((o,a)=>F(T(T(T({},r[a]),ne(o)),t[o.id]),{jsonInfo:r[a]}))}function It(e,r=Date.now()){if(e.version===6){let t=e.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>ve(r,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>Ue(r,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}function _t(e){return e.state.rewardInfos.length===1&&String(e.lpMint)===hr.toBase58()}function At(e,r){return e.version===6?e.state.rewardInfos.map(({rewardPerSecond:t,rewardOpenTime:n,rewardEndTime:o},a)=>{var M;let c=ve(r.currentBlockChainDate,n.toNumber(),{unit:"s"}),d=Ue(r.currentBlockChainDate,o.toNumber(),{unit:"s"});if(c||d)return;let l=r.rewardTokens[a];if(!l)return;let S=r.rewardTokenPrices[a];if(!S)return;let N=Oe(new u(t,v).div(U.pow(new x.default(l.decimals||1))).mul(new x.default(60*60*24*365)),S);return r.tvl?r.tvl.isZero()?j(0):N.div((M=r.tvl)!=null?M:v):void 0}):e.state.rewardInfos.map(({perSlotReward:n},o)=>{var S;let a=r.rewardTokens[o];if(!a)return;let c=r.rewardTokenPrices[o];if(!c)return;let d=Oe(new u(n,v).div(U.pow(new x.default(a.decimals||1))).mul(new x.default(r.blockSlotCountForSecond*60*60*24*365)),c);return r.tvl?r.tvl.isZero()?j(0):d.div((S=r.tvl)!=null?S:v):void 0})}var Y=require("@solana/web3.js"),Wr=B(require("bn.js"));var Kt=P("Raydium_farm_instruction");async function Vt(e){let{version:r,id:t,ledger:n,programId:o,owner:a}=e,c={3:9,5:10}[r];c||Kt.logWithError(`invalid farm pool version: ${r}`);let d=Buffer.alloc(se.span);se.encode({instruction:c},d);let l=[b({pubkey:t}),b({pubkey:n}),b({pubkey:a,isWritable:!1}),b({pubkey:Y.SystemProgram.programId,isWritable:!1}),b({pubkey:Y.SYSVAR_RENT_PUBKEY,isWritable:!1})];return new Y.TransactionInstruction({programId:o,keys:l,data:d})}function Dt(e){var n;let r=Buffer.alloc(ue.span);ue.encode({instruction:0,nonce:new Wr.default(e.nonce),rewardTimeInfo:e.rewardInfoConfig},r);let t=[...wr,b({pubkey:e.farmKeyPair.publicKey}),b({pubkey:e.farmAuthority,isWritable:!1}),b({pubkey:e.lpVault}),b({pubkey:e.lpMint,isWritable:!1}),b({pubkey:e.lockVault}),b({pubkey:e.lockMint,isWritable:!1}),b({pubkey:(n=e.lockUserAccount)!=null?n:q}),b({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)t.push(b({pubkey:o.rewardMint,isWritable:!1}),b({pubkey:o.rewardVault}),b({pubkey:o.userRewardToken}));return new Y.TransactionInstruction({programId:e.programId,keys:t,data:r})}0&&(module.exports={FARM_LOCK_MINT,FARM_LOCK_VAULT,FARM_PROGRAMID_TO_VERSION,FARM_PROGRAM_ID_V3,FARM_PROGRAM_ID_V3_PUBKEY,FARM_PROGRAM_ID_V5,FARM_PROGRAM_ID_V5_PUBKEY,FARM_PROGRAM_ID_V6,FARM_PROGRAM_ID_V6_PUBKEY,FARM_VERSION_TO_LEDGER_LAYOUT,FARM_VERSION_TO_PROGRAMID,FARM_VERSION_TO_STATE_LAYOUT,associatedLedgerAccountLayout,calFarmRewardAmount,calculateFarmPoolAprList,createAssociatedLedgerAccountInstruction,dwLayout,farmAddRewardLayout,farmDespotVersionToInstruction,farmLedgerLayoutV3_1,farmLedgerLayoutV3_2,farmLedgerLayoutV5_1,farmLedgerLayoutV5_2,farmLedgerLayoutV6_1,farmRewardInfoToConfig,farmRewardLayout,farmRewardRestartLayout,farmRewardTimeInfoLayout,farmStateV3Layout,farmStateV5Layout,farmStateV6Layout,farmWithdrawVersionToInstruction,fetchMultipleFarmInfoAndUpdate,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getFarmLedgerLayout,getFarmProgramId,getFarmStateLayout,getFarmVersion,isValidFarmVersion,judgeFarmType,makeCreateFarmInstruction,mergeSdkFarmInfo,poolTypeV6,realFarmStateV3Layout,realFarmStateV5Layout,realFarmV6Layout,updateFarmPoolInfo,validateFarmRewards,whetherIsStakeFarmPool,withdrawRewardLayout});
//# sourceMappingURL=index.js.map