var it=Object.defineProperty,at=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var xe=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var Se=(e,t,r)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x=(e,t)=>{for(var r in t||(t={}))ut.call(t,r)&&Se(e,r,t[r]);if(xe)for(var r of xe(t))ct.call(t,r)&&Se(e,r,t[r]);return e},N=(e,t)=>at(e,st(t));import w from"bn.js";import{PublicKey as yt}from"@solana/web3.js";function Le(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}import{get as Te,set as dt}from"lodash";import mt from"pino";import pt from"pino-pretty";var Be={},lt={},ft=pt({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),gt=mt({base:null,level:"silent"},ft);function P(e){let t=Te(Be,e);if(!t){let r=Te(lt,e);t=gt.child({name:e},{level:r}),dt(Be,e,t)}return t.logWithError=(...r)=>{let n=r.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(n)},t}var ie=P("Raydium_accountInfo_util");async function bt(e,t,r){let{batchRequest:n,commitment:o}=x({batchRequest:!1},r),a=Le(t,100),c=new Array(a.length).fill([]);if(n){let u=a.map(h=>{let R=e._buildArgs([h.map(k=>k.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:R}});c=(await e._rpcBatchRequest(u)).map(h=>(h.error&&ie.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${h.error.message}`),h.result.value.map(R=>{if(R){let{data:k,executable:W,lamports:L,owner:f,rentEpoch:I}=R;return k.length!==2&&k[1]!=="base64"&&ie.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(k[0],"base64"),executable:W,lamports:L,owner:new yt(f),rentEpoch:I}}return null})))}else try{c=await Promise.all(a.map(u=>e.getMultipleAccountsInfo(u,o)))}catch(u){u instanceof Error&&ie.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return c.flat()}async function Re(e,t,r){let n=await bt(e,t.map(o=>o.pubkey),r);return t.map((o,a)=>N(x({},o),{accountInfo:n[a]}))}import b from"bn.js";import Tt from"big.js";import Z from"bn.js";import wt from"toformat";var Pt=wt,q=Pt;import X from"big.js";import ht from"decimal.js-light";var J=P("module/fraction"),ae=q(X),G=q(ht),xt={[0]:G.ROUND_DOWN,[1]:G.ROUND_HALF_UP,[2]:G.ROUND_UP},St={[0]:X.roundDown,[1]:X.roundHalfUp,[2]:X.roundUp},s=class{constructor(t,r=O){this.numerator=g(t),this.denominator=g(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(t){let r=t instanceof s?t:new s(g(t));return this.denominator.eq(r.denominator)?new s(this.numerator.add(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof s?t:new s(g(t));return this.denominator.eq(r.denominator)?new s(this.numerator.sub(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof s?t:new s(g(t));return new s(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof s?t:new s(g(t));return new s(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||J.logWithError(`${t} is not an integer.`),t<=0&&J.logWithError(`${t} is not positive.`),G.set({precision:t+1,rounding:xt[n]});let o=new G(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||J.logWithError(`${t} is not an integer.`),t<0&&J.logWithError(`${t} is negative.`),ae.DP=t,ae.RM=St[n]||1,new ae(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var Bt=P("Raydium_amount"),Ne=q(Tt);function Rt(e,t){let r="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([r,n]=o,n=n.padEnd(t,"0")):Bt.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var _=class extends s{constructor(r,n,o=!0,a){let c=new Z(0),u=M.pow(new Z(r.decimals));if(o)c=g(n);else{let m=new Z(0),h=new Z(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[R,k]=Rt(n.toString(),r.decimals);m=g(R),h=g(k)}m=m.mul(u),c=m.add(h)}super(c,u);this.logger=P(a||"Amount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new _(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new _(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return Ne.DP=this.token.decimals,new Ne(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};import{PublicKey as Nt}from"@solana/web3.js";var _e={symbol:"SOL",name:"Solana",decimals:9},U={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Cr={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Nt(U.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as ue}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _t}from"@solana/spl-token";import{PublicKey as S,SystemProgram as kt,SYSVAR_RENT_PUBKEY as Ft}from"@solana/web3.js";function se({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var $r=[se({pubkey:_t,isWritable:!1}),se({pubkey:kt.programId,isWritable:!1}),se({pubkey:Ft,isWritable:!1})];function Q({publicKey:e,transformSol:t}){if(e instanceof S)return t&&e.equals(j)?ke:e;if(t&&e===j.toBase58())return ke;if(typeof e=="string")try{return new S(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Fe(e){try{return new S(e)}catch{return e}}var Ae=new S("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Hr=new S("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),zr=new S("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Jr=new S("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Xr=new S("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Zr=new S("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Qr=new S("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),en=new S("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),tn=new S("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),rn=new S("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),nn=new S("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ke=new S("So11111111111111111111111111111111111111112"),j=S.default;var ce=class{constructor({mint:t,decimals:r,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(t===j.toBase58()||t instanceof ue&&j.equals(t)){this.decimals=U.decimals,this.symbol=U.symbol,this.name=U.name,this.mint=new ue(U.mint);return}this.decimals=r,this.symbol=n,this.name=o,this.mint=a?ue.default:Q({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},E=ce;E.WSOL=new ce(U);var me=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},de=me;de.SOL=new me(_e);var Ie=new s(De),v=class extends s{toSignificant(t=5,r,n){return this.mul(Ie).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(Ie).toFixed(t,r,n)}};var At=P("Raydium_price"),F=class extends s{constructor(r){let{baseToken:n,quoteToken:o,numerator:a,denominator:c}=r;super(a,c);this.baseToken=n,this.quoteToken=o,this.scalar=new s(pe(n.decimals),pe(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new F({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&At.logWithError("mul token not equals");let n=super.mul(r);return new F({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};var ee=P("Raydium_bignumber");var We=new b(0),O=new b(1),En=new b(2),Wn=new b(3),Kn=new b(5),M=new b(10),De=new b(100),On=new b(1e3),Mn=new b(1e4),Ve=9007199254740991;function g(e){if(e instanceof b)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new b(e);ee.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&ee.logWithError(`BigNumberish number underflow: ${e}`),(e>=Ve||e<=-Ve)&&ee.logWithError(`BigNumberish number overflow: ${e}`),new b(String(e))):typeof e=="bigint"?new b(e.toString()):(ee.logWithError(`invalid BigNumberish value: ${e}`),new b(0))}function pe(e){return M.pow(g(e))}function Ke(e){var u;if(e===void 0)return{denominator:"1",numerator:"0"};if(e instanceof b)return{numerator:e.toString(),denominator:"1"};if(e instanceof s)return{denominator:e.denominator.toString(),numerator:e.numerator.toString()};let t=String(e),[,r="",n="",o=""]=(u=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?u:[],a="1"+"0".repeat(o.length),c=r+(n==="0"?"":n)+o||"0";return{denominator:a,numerator:c,sign:r,int:n,dec:o}}function It(e){var n;let[,t="",r=""]=(n=e.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${t}${r}`}function Dt(e,t=0){return e instanceof b?e:new b(It(C(e).mul(M.pow(new b(String(t))))))}function C(e){if(e instanceof v)return new s(e.numerator,e.denominator);if(e instanceof F)return e.adjusted;if(e instanceof _)try{return C(e.toExact())}catch{return new s(We)}if(e instanceof s)return e;let t=String(e),r=Ke(t);return new s(r.numerator,r.denominator)}function Oe(e,t){if(e==null||t==null)return;let r=C(e),n=C(t);return r.mul(n)}function Ee(e){let t=new E({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),r=Dt(Oe(e,10**t.decimals));return new _(t,r)}function le(e,t){return Ee(!t||!e?0:Oe(e,t))}import{PACKET_DATA_SIZE as qn,PublicKey as Vt,sendAndConfirmTransaction as jn,Transaction as Hn}from"@solana/web3.js";var Xn=P("Raydium_txTool");async function te(e,t){let[r,n]=await Vt.findProgramAddress(e,t);return{publicKey:r,nonce:n}}var Me=e=>typeof e=="number";function fe(e,t,r){let n=Me(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()<=n}function ge(e,t,r){let n=Me(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()>n}import{PublicKey as Ut}from"@solana/web3.js";import Ce,{isBN as qe}from"bn.js";import{bits as to,BitStructure as ro,blob as Et,Blob as no,cstr as oo,f32 as io,f32be as ao,f64 as so,f64be as uo,greedy as co,Layout as Wt,ns64 as mo,ns64be as po,nu64 as lo,nu64be as fo,offset as go,s16 as yo,s16be as bo,s24 as wo,s24be as Po,s32 as ho,s32be as xo,s40 as So,s40be as Lo,s48 as To,s48be as Bo,s8 as Ro,seq as Kt,struct as No,Structure as Ot,u16 as _o,u16be as ko,u24 as Fo,u24be as Ao,u32 as Io,u32be as Do,u40 as Vo,u40be as Eo,u48 as Wo,u48be as Ko,u8 as Oo,UInt as Mt,union as Mo,Union as Uo,unionLayoutDiscriminator as vo,utf8 as Co}from"@solana/buffer-layout";var ye=Wt,Ue=Ot;var be=Mt;var ve=Kt;var Y=Et;var re=class extends ye{constructor(r,n,o){super(r,o);this.blob=Y(r),this.signed=n}decode(r,n=0){let o=new Ce(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new Ce(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function A(e){return new be(1,e)}function ne(e){return new be(4,e)}function i(e){return new re(8,!1,e)}function D(e){return new re(16,!1,e)}var we=class extends ye{constructor(r,n,o,a){super(r.span,a);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function d(e){return new we(Y(32),t=>new Ut(t),t=>t.toBuffer(),e)}var Pe=class extends Ue{decode(t,r){return super.decode(t,r)}};function y(e,t,r){return new Pe(e,t,r)}function B(e,t,r){let n,o=typeof t=="number"?t:qe(t)?t.toNumber():new Proxy(t,{get(a,c){if(!n){let u=Reflect.get(a,"count");n=qe(u)?u.toNumber():u,Reflect.set(a,"count",n)}return Reflect.get(a,c)},set(a,c,u){return c==="count"&&(n=u),Reflect.set(a,c,u)}});return ve(e,o,r)}var he=y([d("mint"),d("owner"),i("amount"),ne("delegateOption"),d("delegate"),A("state"),ne("isNativeOption"),i("isNative"),i("delegatedAmount"),ne("closeAuthorityOption"),d("closeAuthority")]);import{PublicKey as $}from"@solana/web3.js";var ci=y([A("instruction")]),di=y([A("instruction")]),vt=y([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),D("accRewardPerShare"),d("rewardVault"),d("rewardMint"),d("rewardSender"),i("rewardType"),B(i(),15,"padding")]),Ct=y([i("state"),i("nonce"),d("lpVault"),d("rewardVault"),d(),d(),i(),i(),i("totalReward"),D("perShareReward"),i("lastSlot"),i("perSlotReward")]),qt=y([i("state"),i("nonce"),d("lpVault"),d("rewardVaultA"),i("totalRewardA"),D("perShareRewardA"),i("perSlotRewardA"),A("option"),d("rewardVaultB"),Y(7),i("totalRewardB"),D("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),d()]),Gt=y([i(),i("state"),i("nonce"),i("validRewardTokenNum"),D("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),d("lpMint"),d("lpVault"),B(vt,5,"rewardInfos"),d("creator"),d(),B(i(),32,"padding")]),Ge=new Proxy(Ct,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return N(x({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,t,r)}}),je=new Proxy(qt,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return N(x({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,t,r)}}),Ye=new Proxy(Gt,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return N(x({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var c;return N(x({},a),{rewardType:((c=Object.entries(Je).find(u=>String(u[1])===a.rewardType.toString()))!=null?c:["Standard SPL"])[0]})})})}:Reflect.get(e,t,r)}}),jt=y([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),mi=y([A("instruction"),i("nonce"),B(jt,5,"rewardTimeInfo")]),pi=y([A("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),li=y([A("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),fi=y([i("state"),d("id"),d("owner"),i("deposited"),B(i(),1,"rewardDebts")]),$e=y([i("state"),d("id"),d("owner"),i("deposited"),B(D(),1,"rewardDebts"),B(i(),17)]),gi=y([i("state"),d("id"),d("owner"),i("deposited"),B(i(),2,"rewardDebts")]),He=y([i("state"),d("id"),d("owner"),i("deposited"),B(D(),2,"rewardDebts"),B(i(),17)]),ze=y([i(),i("state"),d("id"),d("owner"),i("deposited"),B(D(),5,"rewardDebts"),B(i(),16)]),yi=y([A("instruction"),i("amount")]);var Li=P("Raydium_farm_config"),Xe="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",Yt=new $(Xe),Ze="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",$t=new $(Ze),Qe="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",Ht=new $(Qe),et={[Xe]:3,[Ze]:5,[Qe]:6},tt={3:Yt,5:$t,6:Ht},Ti=new $("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Bi=new $("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),rt={3:Ge,5:je,6:Ye},nt={3:$e,5:He,6:ze};var Je={"Standard SPL":0,"Option tokens":1};import{PublicKey as zt}from"@solana/web3.js";import Jt from"bn.js";var Xt=[E,_,zt,s,Jt,F,v];function Zt(e){return typeof e=="object"&&e!==null&&!Xt.some(t=>typeof t=="object"&&e instanceof t)}function H(e){return typeof e=="string"?Fe(e):Array.isArray(e)?e.map(t=>H(t)):Zt(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,H(r)])):e}var z=P("Raydium.farm.util");async function la({programId:e,poolId:t,mint:r,type:n}){let{publicKey:o}=await te([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function Qt(e){let r=Q({publicKey:e}).toBase58();return et[r]}async function er({programId:e,poolId:t,owner:r}){let{publicKey:n}=await te([t.toBuffer(),r.toBuffer(),Buffer.from(Qt(e)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return n}var fa=async({programId:e,poolId:t})=>await te([t.toBuffer()],e);function ga(e){return tt[e]}function ya(e){return{isSet:new w(1),rewardPerSecond:g(e.rewardPerSecond),rewardOpenTime:g(e.rewardOpenTime),rewardEndTime:g(e.rewardEndTime),rewardType:g(e.rewardType)}}function ba(e){return g(e.rewardEndTime).sub(g(e.rewardOpenTime)).mul(g(e.rewardPerSecond))}function tr(e){let t=nt[e];return t||z.logWithError("invalid version",e),t}function rr(e){let t=rt[e];return t||z.logWithError("invalid version",e),t}function nr(e,t,r,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new w(r)))return e;let o=new w(r).sub(e.lastSlot);e.lastSlot=new w(r);for(let a of e.rewardInfos){if(t.amount.eq(new w(0)))continue;let c=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(c.mul(new w(10).pow(new w(e.version===3?9:15))).div(t.amount)),a.totalReward=a.totalReward.add(c)}}else if(e.version===6)for(let o of e.rewardInfos){if(o.rewardState.eq(new w(0)))continue;let a=w.min(new w(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let u=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),m=o.totalReward.sub(o.totalRewardEmissioned);m.lt(u)?(u=m,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(m.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!t.amount.eq(new w(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(u.mul(e.rewardMultiplier).div(t.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(u))}return e}async function or({connection:e,farmPools:t,owner:r,config:n}){var W;let o=!1,a=!1,c=new w(10),u=[];for(let L of t){let f=H(L);f.version===6?a=!0:o=!0,u.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),r&&u.push({pubkey:await er({programId:f.programId,poolId:f.id,owner:r}),version:f.version,key:"ledger",poolId:f.id})}let m={},h=await Re(e,u,n);for(let{pubkey:L,version:f,key:I,poolId:oe,accountInfo:T}of h){let V=oe.toBase58();if(m[V]=x({},m[V]),I==="state"){let K=rr(f);(!T||!T.data||T.data.length!==K.span)&&z.logWithError(`invalid farm state account info, pools.id, ${L}`),m[V].state=K.decode(T.data)}else if(I==="lpVault")(!T||!T.data||T.data.length!==he.span)&&z.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),m[V].lpVault=he.decode(T.data);else if(I==="ledger"){let K=tr(f);T&&T.data&&(T.data.length!==K.span&&z.logWithError(`invalid farm ledger account info, ledger, ${L}`),m[V].ledger=K.decode(T.data))}}let R=a||o?await e.getSlot():0,k=a&&(W=await e.getBlockTime(R))!=null?W:0;for(let L of Object.keys(m))m[L].state=nr(m[L].state,m[L].lpVault,R,k);for(let[L,{state:f,ledger:I}]of Object.entries(m))if(I){let oe=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?c.pow(new w(9)):c.pow(new w(15)),T=f.rewardInfos.map((V,K)=>{let ot=I.rewardDebts[K];return I.deposited.mul(f.version===6?V.accRewardPerShare:V.perShareReward).div(oe).sub(ot)});m[L].wrapped=N(x({},m[L].wrapped),{pendingRewards:T})}return m}async function wa(e){let{farmPools:t}=e,r=await or(e);return t.map((o,a)=>N(x(x(x({},t[a]),H(o)),r[o.id]),{jsonInfo:t[a]}))}function Pa(e,t=Date.now()){if(e.version===6){let r=e.state.rewardInfos;if(r.every(({rewardOpenTime:n})=>fe(t,n.toNumber(),{unit:"s"})))return"upcoming pool";if(r.every(({rewardEndTime:n})=>ge(t,n.toNumber(),{unit:"s"})))return"closed pool"}else{let r=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(r.length===2){if(String(r[0])==="0"&&String(r[1])!=="0")return"normal fusion pool";if(String(r[0])!=="0"&&String(r[1])!=="0")return"dual fusion pool";if(String(r[0])==="0"&&String(r[1])==="0")return"closed pool"}else if(r.length===1&&String(r[0])==="0")return"closed pool"}}function ha(e){return e.state.rewardInfos.length===1&&String(e.lpMint)===Ae.toBase58()}function xa(e,t){return e.version===6?e.state.rewardInfos.map(({rewardPerSecond:r,rewardOpenTime:n,rewardEndTime:o},a)=>{var W;let c=fe(t.currentBlockChainDate,n.toNumber(),{unit:"s"}),u=ge(t.currentBlockChainDate,o.toNumber(),{unit:"s"});if(c||u)return;let m=t.rewardTokens[a];if(!m)return;let h=t.rewardTokenPrices[a];if(!h)return;let R=le(new s(r,O).div(M.pow(new w(m.decimals||1))).mul(new w(60*60*24*365)),h);return t.tvl?t.tvl.isZero()?C(0):R.div((W=t.tvl)!=null?W:O):void 0}):e.state.rewardInfos.map(({perSlotReward:n},o)=>{var h;let a=t.rewardTokens[o];if(!a)return;let c=t.rewardTokenPrices[o];if(!c)return;let u=le(new s(n,O).div(M.pow(new w(a.decimals||1))).mul(new w(t.blockSlotCountForSecond*60*60*24*365)),c);return t.tvl?t.tvl.isZero()?C(0):u.div((h=t.tvl)!=null?h:O):void 0})}export{ba as calFarmRewardAmount,xa as calculateFarmPoolAprList,ya as farmRewardInfoToConfig,or as fetchMultipleFarmInfoAndUpdate,fa as getAssociatedAuthority,er as getAssociatedLedgerAccount,la as getAssociatedLedgerPoolAccount,tr as getFarmLedgerLayout,ga as getFarmProgramId,rr as getFarmStateLayout,Qt as getFarmVersion,Pa as judgeFarmType,wa as mergeSdkFarmInfo,nr as updateFarmPoolInfo,ha as whetherIsStakeFarmPool};
//# sourceMappingURL=util.mjs.map