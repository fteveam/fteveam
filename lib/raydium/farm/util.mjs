var st=Object.defineProperty,ut=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var dt=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable;var Le=(t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,x=(t,e)=>{for(var r in e||(e={}))dt.call(e,r)&&Le(t,r,e[r]);if(Se)for(var r of Se(e))mt.call(e,r)&&Le(t,r,e[r]);return t},N=(t,e)=>ut(t,ct(e));import w from"bn.js";import{PublicKey as gt}from"@solana/web3.js";function Te(t,e=1,r=[]){let n=[...t];if(e<=0)return r;for(;n.length;)r.push(n.splice(0,e));return r}import{get as Be,set as pt}from"lodash";import Ne from"dayjs";import lt from"dayjs/plugin/utc";Ne.extend(lt);var ie=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Ne().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let r=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Re={},ft={};function h(t){let e=Be(Re,t);if(!e){let r=Be(ft,t);e=new ie({name:t,logLevel:r}),pt(Re,t,e)}return e}var ae=h("Raydium_accountInfo_util");async function yt(t,e,r){let{batchRequest:n,commitment:o}=x({batchRequest:!1},r),a=Te(e,100),c=new Array(a.length).fill([]);if(n){let u=a.map(P=>{let R=t._buildArgs([P.map(k=>k.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:R}});c=(await t._rpcBatchRequest(u)).map(P=>(P.error&&ae.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${P.error.message}`),P.result.value.map(R=>{if(R){let{data:k,executable:W,lamports:L,owner:f,rentEpoch:I}=R;return k.length!==2&&k[1]!=="base64"&&ae.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(k[0],"base64"),executable:W,lamports:L,owner:new gt(f),rentEpoch:I}}return null})))}else try{c=await Promise.all(a.map(u=>t.getMultipleAccountsInfo(u,o)))}catch(u){u instanceof Error&&ae.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return c.flat()}async function _e(t,e,r){let n=await yt(t,e.map(o=>o.pubkey),r);return e.map((o,a)=>N(x({},o),{accountInfo:n[a]}))}import b from"bn.js";import Lt from"big.js";import Z from"bn.js";import bt from"toformat";var wt=bt,q=wt;import X from"big.js";import ht from"decimal.js-light";var J=h("module/fraction"),se=q(X),G=q(ht),Pt={[0]:G.ROUND_DOWN,[1]:G.ROUND_HALF_UP,[2]:G.ROUND_UP},xt={[0]:X.roundDown,[1]:X.roundHalfUp,[2]:X.roundUp},s=class{constructor(e,r=O){this.numerator=g(e),this.denominator=g(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(e){let r=e instanceof s?e:new s(g(e));return this.denominator.eq(r.denominator)?new s(this.numerator.add(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(e){let r=e instanceof s?e:new s(g(e));return this.denominator.eq(r.denominator)?new s(this.numerator.sub(r.numerator),this.denominator):new s(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(e){let r=e instanceof s?e:new s(g(e));return new s(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(e){let r=e instanceof s?e:new s(g(e));return new s(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(e,r={groupSeparator:""},n=1){Number.isInteger(e)||J.logWithError(`${e} is not an integer.`),e<=0&&J.logWithError(`${e} is not positive.`),G.set({precision:e+1,rounding:Pt[n]});let o=new G(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),r)}toFixed(e,r={groupSeparator:""},n=1){return Number.isInteger(e)||J.logWithError(`${e} is not an integer.`),e<0&&J.logWithError(`${e} is negative.`),se.DP=e,se.RM=xt[n]||1,new se(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,r)}isZero(){return this.numerator.isZero()}};var Tt=h("Raydium_amount"),ke=q(Lt);function Bt(t,e){let r="0",n="0";if(t.includes(".")){let o=t.split(".");o.length===2?([r,n]=o,n=n.padEnd(e,"0")):Tt.logWithError(`invalid number string, num: ${t}`)}else r=t;return[r,n.slice(0,e)||n]}var _=class extends s{constructor(r,n,o=!0,a){let c=new Z(0),u=v.pow(new Z(r.decimals));if(o)c=g(n);else{let m=new Z(0),P=new Z(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[R,k]=Bt(n.toString(),r.decimals);m=g(R),P=g(k)}m=m.mul(u),c=m.add(P)}super(c,u);this.logger=h(a||"Amount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new _(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new _(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return ke.DP=this.token.decimals,new ke(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};import{PublicKey as Rt}from"@solana/web3.js";var Fe={symbol:"SOL",name:"Solana",decimals:9},U={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},vr={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Rt(U.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as ce}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Nt}from"@solana/spl-token";import{PublicKey as S,SystemProgram as _t,SYSVAR_RENT_PUBKEY as kt}from"@solana/web3.js";function ue({pubkey:t,isSigner:e=!1,isWritable:r=!0}){return{pubkey:t,isWritable:r,isSigner:e}}var Gr=[ue({pubkey:Nt,isWritable:!1}),ue({pubkey:_t.programId,isWritable:!1}),ue({pubkey:kt,isWritable:!1})];function Q({publicKey:t,transformSol:e}){if(t instanceof S)return e&&t.equals(j)?Ae:t;if(e&&t===j.toBase58())return Ae;if(typeof t=="string")try{return new S(t)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Ie(t){try{return new S(t)}catch{return t}}var De=new S("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),jr=new S("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Yr=new S("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),$r=new S("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Hr=new S("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),zr=new S("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Jr=new S("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Xr=new S("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Zr=new S("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Qr=new S("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),en=new S("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ae=new S("So11111111111111111111111111111111111111112"),j=S.default;var de=class{constructor({mint:e,decimals:r,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(e===j.toBase58()||e instanceof ce&&j.equals(e)){this.decimals=U.decimals,this.symbol=U.symbol,this.name=U.name,this.mint=new ce(U.mint);return}this.decimals=r,this.symbol=n,this.name=o,this.mint=a?ce.default:Q({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},E=de;E.WSOL=new de(U);var pe=class{constructor({decimals:e,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=r,this.name=n}equals(e){return this===e}},me=pe;me.SOL=new pe(Fe);var Ve=new s(Ee),M=class extends s{toSignificant(e=5,r,n){return this.mul(Ve).toSignificant(e,r,n)}toFixed(e=2,r,n){return this.mul(Ve).toFixed(e,r,n)}};var Ft=h("Raydium_price"),F=class extends s{constructor(r){let{baseToken:n,quoteToken:o,numerator:a,denominator:c}=r;super(a,c);this.baseToken=n,this.quoteToken=o,this.scalar=new s(le(n.decimals),le(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new F({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&Ft.logWithError("mul token not equals");let n=super.mul(r);return new F({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};var ee=h("Raydium_bignumber");var Oe=new b(0),O=new b(1),In=new b(2),Dn=new b(3),Vn=new b(5),v=new b(10),Ee=new b(100),En=new b(1e3),Wn=new b(1e4),We=9007199254740991;function g(t){if(t instanceof b)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new b(t);ee.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&ee.logWithError(`BigNumberish number underflow: ${t}`),(t>=We||t<=-We)&&ee.logWithError(`BigNumberish number overflow: ${t}`),new b(String(t))):typeof t=="bigint"?new b(t.toString()):(ee.logWithError(`invalid BigNumberish value: ${t}`),new b(0))}function le(t){return v.pow(g(t))}function ve(t){var u;if(t===void 0)return{denominator:"1",numerator:"0"};if(t instanceof b)return{numerator:t.toString(),denominator:"1"};if(t instanceof s)return{denominator:t.denominator.toString(),numerator:t.numerator.toString()};let e=String(t),[,r="",n="",o=""]=(u=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?u:[],a="1"+"0".repeat(o.length),c=r+(n==="0"?"":n)+o||"0";return{denominator:a,numerator:c,sign:r,int:n,dec:o}}function At(t){var n;let[,e="",r=""]=(n=t.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${e}${r}`}function It(t,e=0){return t instanceof b?t:new b(At(C(t).mul(v.pow(new b(String(e))))))}function C(t){if(t instanceof M)return new s(t.numerator,t.denominator);if(t instanceof F)return t.adjusted;if(t instanceof _)try{return C(t.toExact())}catch{return new s(Oe)}if(t instanceof s)return t;let e=String(t),r=ve(e);return new s(r.numerator,r.denominator)}function Ue(t,e){if(t==null||e==null)return;let r=C(t),n=C(e);return r.mul(n)}function Ke(t){let e=new E({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),r=It(Ue(t,10**e.decimals));return new _(e,r)}function fe(t,e){return Ke(!e||!t?0:Ue(t,e))}import{PACKET_DATA_SIZE as Un,PublicKey as Dt,sendAndConfirmTransaction as Cn,Transaction as jn}from"@solana/web3.js";var Hn=h("Raydium_txTool");async function te(t,e){let[r,n]=await Dt.findProgramAddress(t,e);return{publicKey:r,nonce:n}}var Me=t=>typeof t=="number";function ge(t,e,r){let n=Me(e)?e*((r==null?void 0:r.unit)==="s"?1e3:1):e;return new Date(t).getTime()<=n}function ye(t,e,r){let n=Me(e)?e*((r==null?void 0:r.unit)==="s"?1e3:1):e;return new Date(t).getTime()>n}import{PublicKey as vt}from"@solana/web3.js";import Ge,{isBN as je}from"bn.js";import{bits as Zn,BitStructure as Qn,blob as Vt,Blob as eo,cstr as to,f32 as ro,f32be as no,f64 as oo,f64be as io,greedy as ao,Layout as Et,ns64 as so,ns64be as uo,nu64 as co,nu64be as mo,offset as po,s16 as lo,s16be as fo,s24 as go,s24be as yo,s32 as bo,s32be as wo,s40 as ho,s40be as Po,s48 as xo,s48be as So,s8 as Lo,seq as Wt,struct as To,Structure as Kt,u16 as Bo,u16be as Ro,u24 as No,u24be as _o,u32 as ko,u32be as Fo,u40 as Ao,u40be as Io,u48 as Do,u48be as Vo,u8 as Eo,UInt as Ot,union as Wo,Union as Ko,unionLayoutDiscriminator as Oo,utf8 as vo}from"@solana/buffer-layout";var be=Et,Ce=Kt;var we=Ot;var qe=Wt;var Y=Vt;var re=class extends be{constructor(r,n,o){super(r,o);this.blob=Y(r),this.signed=n}decode(r,n=0){let o=new Ge(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new Ge(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function A(t){return new we(1,t)}function ne(t){return new we(4,t)}function i(t){return new re(8,!1,t)}function D(t){return new re(16,!1,t)}var he=class extends be{constructor(r,n,o,a){super(r.span,a);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function d(t){return new he(Y(32),e=>new vt(e),e=>e.toBuffer(),t)}var Pe=class extends Ce{decode(e,r){return super.decode(e,r)}};function y(t,e,r){return new Pe(t,e,r)}function B(t,e,r){let n,o=typeof e=="number"?e:je(e)?e.toNumber():new Proxy(e,{get(a,c){if(!n){let u=Reflect.get(a,"count");n=je(u)?u.toNumber():u,Reflect.set(a,"count",n)}return Reflect.get(a,c)},set(a,c,u){return c==="count"&&(n=u),Reflect.set(a,c,u)}});return qe(t,o,r)}var xe=y([d("mint"),d("owner"),i("amount"),ne("delegateOption"),d("delegate"),A("state"),ne("isNativeOption"),i("isNative"),i("delegatedAmount"),ne("closeAuthorityOption"),d("closeAuthority")]);import{PublicKey as $}from"@solana/web3.js";var ai=y([A("instruction")]),si=y([A("instruction")]),Ut=y([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),D("accRewardPerShare"),d("rewardVault"),d("rewardMint"),d("rewardSender"),i("rewardType"),B(i(),15,"padding")]),Mt=y([i("state"),i("nonce"),d("lpVault"),d("rewardVault"),d(),d(),i(),i(),i("totalReward"),D("perShareReward"),i("lastSlot"),i("perSlotReward")]),Ct=y([i("state"),i("nonce"),d("lpVault"),d("rewardVaultA"),i("totalRewardA"),D("perShareRewardA"),i("perSlotRewardA"),A("option"),d("rewardVaultB"),Y(7),i("totalRewardB"),D("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),d()]),qt=y([i(),i("state"),i("nonce"),i("validRewardTokenNum"),D("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),d("lpMint"),d("lpVault"),B(Ut,5,"rewardInfos"),d("creator"),d(),B(i(),32,"padding")]),Ye=new Proxy(Mt,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return N(x({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(t,e,r)}}),$e=new Proxy(Ct,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return N(x({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(t,e,r)}}),He=new Proxy(qt,{get(t,e,r){return e==="decode"?(...n)=>{let o=t.decode(...n);return N(x({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var c;return N(x({},a),{rewardType:((c=Object.entries(Ze).find(u=>String(u[1])===a.rewardType.toString()))!=null?c:["Standard SPL"])[0]})})})}:Reflect.get(t,e,r)}}),Gt=y([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),ui=y([A("instruction"),i("nonce"),B(Gt,5,"rewardTimeInfo")]),ci=y([A("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),di=y([A("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),mi=y([i("state"),d("id"),d("owner"),i("deposited"),B(i(),1,"rewardDebts")]),ze=y([i("state"),d("id"),d("owner"),i("deposited"),B(D(),1,"rewardDebts"),B(i(),17)]),pi=y([i("state"),d("id"),d("owner"),i("deposited"),B(i(),2,"rewardDebts")]),Je=y([i("state"),d("id"),d("owner"),i("deposited"),B(D(),2,"rewardDebts"),B(i(),17)]),Xe=y([i(),i("state"),d("id"),d("owner"),i("deposited"),B(D(),5,"rewardDebts"),B(i(),16)]),li=y([A("instruction"),i("amount")]);var Pi=h("Raydium_farm_config"),Qe="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",jt=new $(Qe),et="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",Yt=new $(et),tt="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",$t=new $(tt),rt={[Qe]:3,[et]:5,[tt]:6},nt={3:jt,5:Yt,6:$t},xi=new $("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Si=new $("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),ot={3:Ye,5:$e,6:He},it={3:ze,5:Je,6:Xe};var Ze={"Standard SPL":0,"Option tokens":1};import{PublicKey as Ht}from"@solana/web3.js";import zt from"bn.js";var Jt=[E,_,Ht,s,zt,F,M];function Xt(t){return typeof t=="object"&&t!==null&&!Jt.some(e=>typeof e=="object"&&t instanceof e)}function H(t){return typeof t=="string"?Ie(t):Array.isArray(t)?t.map(e=>H(e)):Xt(t)?Object.fromEntries(Object.entries(t).map(([e,r])=>[e,H(r)])):t}var z=h("Raydium.farm.util");async function da({programId:t,poolId:e,mint:r,type:n}){let{publicKey:o}=await te([e.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],t);return o}function Zt(t){let r=Q({publicKey:t}).toBase58();return rt[r]}async function Qt({programId:t,poolId:e,owner:r}){let{publicKey:n}=await te([e.toBuffer(),r.toBuffer(),Buffer.from(Zt(t)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],t);return n}var ma=async({programId:t,poolId:e})=>await te([e.toBuffer()],t);function pa(t){return nt[t]}function la(t){return{isSet:new w(1),rewardPerSecond:g(t.rewardPerSecond),rewardOpenTime:g(t.rewardOpenTime),rewardEndTime:g(t.rewardEndTime),rewardType:g(t.rewardType)}}function fa(t){return g(t.rewardEndTime).sub(g(t.rewardOpenTime)).mul(g(t.rewardPerSecond))}function er(t){let e=it[t];return e||z.logWithError("invalid version",t),e}function tr(t){let e=ot[t];return e||z.logWithError("invalid version",t),e}function rr(t,e,r,n){if(t.version===3||t.version===5){if(t.lastSlot.gte(new w(r)))return t;let o=new w(r).sub(t.lastSlot);t.lastSlot=new w(r);for(let a of t.rewardInfos){if(e.amount.eq(new w(0)))continue;let c=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(c.mul(new w(10).pow(new w(t.version===3?9:15))).div(e.amount)),a.totalReward=a.totalReward.add(c)}}else if(t.version===6)for(let o of t.rewardInfos){if(o.rewardState.eq(new w(0)))continue;let a=w.min(new w(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let u=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),m=o.totalReward.sub(o.totalRewardEmissioned);m.lt(u)?(u=m,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(m.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!e.amount.eq(new w(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(u.mul(t.rewardMultiplier).div(e.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(u))}return t}async function nr({connection:t,farmPools:e,owner:r,config:n}){var W;let o=!1,a=!1,c=new w(10),u=[];for(let L of e){let f=H(L);f.version===6?a=!0:o=!0,u.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),r&&u.push({pubkey:await Qt({programId:f.programId,poolId:f.id,owner:r}),version:f.version,key:"ledger",poolId:f.id})}let m={},P=await _e(t,u,n);for(let{pubkey:L,version:f,key:I,poolId:oe,accountInfo:T}of P){let V=oe.toBase58();if(m[V]=x({},m[V]),I==="state"){let K=tr(f);(!T||!T.data||T.data.length!==K.span)&&z.logWithError(`invalid farm state account info, pools.id, ${L}`),m[V].state=K.decode(T.data)}else if(I==="lpVault")(!T||!T.data||T.data.length!==xe.span)&&z.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),m[V].lpVault=xe.decode(T.data);else if(I==="ledger"){let K=er(f);T&&T.data&&(T.data.length!==K.span&&z.logWithError(`invalid farm ledger account info, ledger, ${L}`),m[V].ledger=K.decode(T.data))}}let R=a||o?await t.getSlot():0,k=a&&(W=await t.getBlockTime(R))!=null?W:0;for(let L of Object.keys(m))m[L].state=rr(m[L].state,m[L].lpVault,R,k);for(let[L,{state:f,ledger:I}]of Object.entries(m))if(I){let oe=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?c.pow(new w(9)):c.pow(new w(15)),T=f.rewardInfos.map((V,K)=>{let at=I.rewardDebts[K];return I.deposited.mul(f.version===6?V.accRewardPerShare:V.perShareReward).div(oe).sub(at)});m[L].wrapped=N(x({},m[L].wrapped),{pendingRewards:T})}return m}async function ga(t){let{farmPools:e}=t,r=await nr(t);return e.map((o,a)=>N(x(x(x({},e[a]),H(o)),r[o.id]),{jsonInfo:e[a]}))}function ya(t,e=Date.now()){if(t.version===6){let r=t.state.rewardInfos;if(r.every(({rewardOpenTime:n})=>ge(e,n.toNumber(),{unit:"s"})))return"upcoming pool";if(r.every(({rewardEndTime:n})=>ye(e,n.toNumber(),{unit:"s"})))return"closed pool"}else{let r=t.state.rewardInfos.map(({perSlotReward:n})=>n);if(r.length===2){if(String(r[0])==="0"&&String(r[1])!=="0")return"normal fusion pool";if(String(r[0])!=="0"&&String(r[1])!=="0")return"dual fusion pool";if(String(r[0])==="0"&&String(r[1])==="0")return"closed pool"}else if(r.length===1&&String(r[0])==="0")return"closed pool"}}function ba(t){return t.state.rewardInfos.length===1&&String(t.lpMint)===De.toBase58()}function wa(t,e){return t.version===6?t.state.rewardInfos.map(({rewardPerSecond:r,rewardOpenTime:n,rewardEndTime:o},a)=>{var W;let c=ge(e.currentBlockChainDate,n.toNumber(),{unit:"s"}),u=ye(e.currentBlockChainDate,o.toNumber(),{unit:"s"});if(c||u)return;let m=e.rewardTokens[a];if(!m)return;let P=e.rewardTokenPrices[a];if(!P)return;let R=fe(new s(r,O).div(v.pow(new w(m.decimals||1))).mul(new w(60*60*24*365)),P);return e.tvl?e.tvl.isZero()?C(0):R.div((W=e.tvl)!=null?W:O):void 0}):t.state.rewardInfos.map(({perSlotReward:n},o)=>{var P;let a=e.rewardTokens[o];if(!a)return;let c=e.rewardTokenPrices[o];if(!c)return;let u=fe(new s(n,O).div(v.pow(new w(a.decimals||1))).mul(new w(e.blockSlotCountForSecond*60*60*24*365)),c);return e.tvl?e.tvl.isZero()?C(0):u.div((P=e.tvl)!=null?P:O):void 0})}export{fa as calFarmRewardAmount,wa as calculateFarmPoolAprList,la as farmRewardInfoToConfig,nr as fetchMultipleFarmInfoAndUpdate,ma as getAssociatedAuthority,Qt as getAssociatedLedgerAccount,da as getAssociatedLedgerPoolAccount,er as getFarmLedgerLayout,pa as getFarmProgramId,tr as getFarmStateLayout,Zt as getFarmVersion,ya as judgeFarmType,ga as mergeSdkFarmInfo,rr as updateFarmPoolInfo,ba as whetherIsStakeFarmPool};
//# sourceMappingURL=util.mjs.map