var dr=Object.defineProperty,mr=Object.defineProperties;var lr=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var pr=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable;var Le=(e,r,t)=>r in e?dr(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,S=(e,r)=>{for(var t in r||(r={}))pr.call(r,t)&&Le(e,t,r[t]);if(Te)for(var t of Te(r))fr.call(r,t)&&Le(e,t,r[t]);return e},N=(e,r)=>mr(e,lr(r));import{PublicKey as hr}from"@solana/web3.js";import Be,{isBN as Ne}from"bn.js";import{bits as Pt,BitStructure as ht,blob as yr,Blob as xt,cstr as St,f32 as Tt,f32be as Lt,f64 as Rt,f64be as kt,greedy as Bt,Layout as gr,ns64 as Nt,ns64be as Ft,nu64 as It,nu64be as _t,offset as At,s16 as Kt,s16be as Vt,s24 as Dt,s24be as Et,s32 as Wt,s32be as Mt,s40 as Ot,s40be as vt,s48 as Ut,s48be as Ct,s8 as qt,seq as br,struct as Gt,Structure as wr,u16 as jt,u16be as Yt,u24 as $t,u24be as Ht,u32 as Jt,u32be as zt,u40 as Xt,u40be as Zt,u48 as Qt,u48be as en,u8 as rn,UInt as Pr,union as tn,Union as nn,unionLayoutDiscriminator as on,utf8 as an}from"@solana/buffer-layout";var ae=gr,Re=wr;var se=Pr;var ke=br;var j=yr;var X=class extends ae{constructor(t,n,o){super(t,o);this.blob=j(t),this.signed=n}decode(t,n=0){let o=new Be(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Be(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function _(e){return new se(1,e)}function Z(e){return new se(4,e)}function i(e){return new X(8,!1,e)}function V(e){return new X(16,!1,e)}var ue=class extends ae{constructor(t,n,o,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function d(e){return new ue(j(32),r=>new hr(r),r=>r.toBuffer(),e)}var ce=class extends Re{decode(r,t){return super.decode(r,t)}};function b(e,r,t){return new ce(e,r,t)}function k(e,r,t){let n,o=typeof r=="number"?r:Ne(r)?r.toNumber():new Proxy(r,{get(a,u){if(!n){let c=Reflect.get(a,"count");n=Ne(c)?c.toNumber():c,Reflect.set(a,"count",n)}return Reflect.get(a,u)},set(a,u,c){return u==="count"&&(n=c),Reflect.set(a,u,c)}});return ke(e,o,t)}import{PublicKey as Y}from"@solana/web3.js";import{get as Fe,set as xr}from"lodash";import Sr from"pino";import Tr from"pino-pretty";var Ie={},Lr={},Rr=Tr({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),kr=Sr({base:null,level:"silent"},Rr);function w(e){let r=Fe(Ie,e);if(!r){let t=Fe(Lr,e);r=kr.child({name:e},{level:t}),xr(Ie,e,r)}return r.logWithError=(...t)=>{let n=t.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(n)},r}var _e=w("Raydium_farm_config"),Ae="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",Br=new Y(Ae),Ke="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",Nr=new Y(Ke),Ve="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",Fr=new Y(Ve),De={[Ae]:3,[Ke]:5,[Ve]:6},Ee={3:Br,5:Nr,6:Fr},_n=new Y("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),An=new Y("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),We={3:ve,5:Ue,6:Ce},Me={3:qe,5:Ge,6:je},Kn=e=>[3,5,6].indexOf(e)!==-1,Ir={3:10,5:11,6:1},Vn=e=>{let r=Ir[e];return r||_e.logWithError("invalid deposit farm version"),r},_r={3:11,5:12,6:2},Dn=e=>{let r=_r[e];return r||_e.logWithError("invalid withdraw farm version"),r},En=e=>{var u;let{version:r,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,a={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(u=a[r])==null?void 0:u.call(a)},Oe={"Standard SPL":0,"Option tokens":1};var de=b([_("instruction")]),qn=b([_("instruction")]),Ar=b([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),V("accRewardPerShare"),d("rewardVault"),d("rewardMint"),d("rewardSender"),i("rewardType"),k(i(),15,"padding")]),Kr=b([i("state"),i("nonce"),d("lpVault"),d("rewardVault"),d(),d(),i(),i(),i("totalReward"),V("perShareReward"),i("lastSlot"),i("perSlotReward")]),Vr=b([i("state"),i("nonce"),d("lpVault"),d("rewardVaultA"),i("totalRewardA"),V("perShareRewardA"),i("perSlotRewardA"),_("option"),d("rewardVaultB"),j(7),i("totalRewardB"),V("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),d()]),Dr=b([i(),i("state"),i("nonce"),i("validRewardTokenNum"),V("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),d("lpMint"),d("lpVault"),k(Ar,5,"rewardInfos"),d("creator"),d(),k(i(),32,"padding")]),ve=new Proxy(Kr,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,r,t)}}),Ue=new Proxy(Vr,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,r,t)}}),Ce=new Proxy(Dr,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var u;return N(S({},a),{rewardType:((u=Object.entries(Oe).find(c=>String(c[1])===a.rewardType.toString()))!=null?u:["Standard SPL"])[0]})})})}:Reflect.get(e,r,t)}}),Er=b([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),me=b([_("instruction"),i("nonce"),k(Er,5,"rewardTimeInfo")]),Gn=b([_("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),jn=b([_("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),Yn=b([i("state"),d("id"),d("owner"),i("deposited"),k(i(),1,"rewardDebts")]),qe=b([i("state"),d("id"),d("owner"),i("deposited"),k(V(),1,"rewardDebts"),k(i(),17)]),$n=b([i("state"),d("id"),d("owner"),i("deposited"),k(i(),2,"rewardDebts")]),Ge=b([i("state"),d("id"),d("owner"),i("deposited"),k(V(),2,"rewardDebts"),k(i(),17)]),je=b([i(),i("state"),d("id"),d("owner"),i("deposited"),k(V(),5,"rewardDebts"),k(i(),16)]),Hn=b([_("instruction"),i("amount")]);import h from"bn.js";import{PublicKey as Wr}from"@solana/web3.js";function Ye(e,r=1,t=[]){let n=[...e];if(r<=0)return t;for(;n.length;)t.push(n.splice(0,r));return t}var le=w("Raydium_accountInfo_util");async function Mr(e,r,t){let{batchRequest:n,commitment:o}=S({batchRequest:!1},t),a=Ye(r,100),u=new Array(a.length).fill([]);if(n){let c=a.map(x=>{let B=e._buildArgs([x.map(I=>I.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:B}});u=(await e._rpcBatchRequest(c)).map(x=>(x.error&&le.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${x.error.message}`),x.result.value.map(B=>{if(B){let{data:I,executable:W,lamports:L,owner:f,rentEpoch:K}=B;return I.length!==2&&I[1]!=="base64"&&le.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(I[0],"base64"),executable:W,lamports:L,owner:new Wr(f),rentEpoch:K}}return null})))}else try{u=await Promise.all(a.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&le.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return u.flat()}async function $e(e,r,t){let n=await Mr(e,r.map(o=>o.pubkey),t);return r.map((o,a)=>N(S({},o),{accountInfo:n[a]}))}import P from"bn.js";import jr from"big.js";import re from"bn.js";import Or from"toformat";var vr=Or,$=vr;import ee from"big.js";import Ur from"decimal.js-light";var Q=w("module/fraction"),pe=$(ee),H=$(Ur),Cr={[0]:H.ROUND_DOWN,[1]:H.ROUND_HALF_UP,[2]:H.ROUND_UP},qr={[0]:ee.roundDown,[1]:ee.roundHalfUp,[2]:ee.roundUp},s=class{constructor(r,t=O){this.numerator=y(r),this.denominator=y(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(r){let t=r instanceof s?r:new s(y(r));return this.denominator.eq(t.denominator)?new s(this.numerator.add(t.numerator),this.denominator):new s(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(r){let t=r instanceof s?r:new s(y(r));return this.denominator.eq(t.denominator)?new s(this.numerator.sub(t.numerator),this.denominator):new s(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(r){let t=r instanceof s?r:new s(y(r));return new s(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(r){let t=r instanceof s?r:new s(y(r));return new s(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(r,t={groupSeparator:""},n=1){Number.isInteger(r)||Q.logWithError(`${r} is not an integer.`),r<=0&&Q.logWithError(`${r} is not positive.`),H.set({precision:r+1,rounding:Cr[n]});let o=new H(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(r);return o.toFormat(o.decimalPlaces(),t)}toFixed(r,t={groupSeparator:""},n=1){return Number.isInteger(r)||Q.logWithError(`${r} is not an integer.`),r<0&&Q.logWithError(`${r} is negative.`),pe.DP=r,pe.RM=qr[n]||1,new pe(this.numerator.toString()).div(this.denominator.toString()).toFormat(r,t)}isZero(){return this.numerator.isZero()}};var Yr=w("Raydium_amount"),He=$(jr);function $r(e,r){let t="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([t,n]=o,n=n.padEnd(r,"0")):Yr.logWithError(`invalid number string, num: ${e}`)}else t=e;return[t,n.slice(0,r)||n]}var F=class extends s{constructor(t,n,o=!0,a){let u=new re(0),c=v.pow(new re(t.decimals));if(o)u=y(n);else{let m=new re(0),x=new re(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[B,I]=$r(n.toString(),t.decimals);m=y(B),x=y(I)}m=m.mul(c),u=m.add(x)}super(u,c);this.logger=w(a||"Amount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new F(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new F(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return He.DP=this.token.decimals,new He(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Hr}from"@solana/web3.js";var Je={symbol:"SOL",name:"Solana",decimals:9},U={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},ko={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Hr(U.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as fe}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jr}from"@solana/spl-token";import{PublicKey as T,SystemProgram as zr,SYSVAR_RENT_PUBKEY as Xr}from"@solana/web3.js";function g({pubkey:e,isSigner:r=!1,isWritable:t=!0}){return{pubkey:e,isWritable:t,isSigner:r}}var Xe=[g({pubkey:Jr,isWritable:!1}),g({pubkey:zr.programId,isWritable:!1}),g({pubkey:Xr,isWritable:!1})];function te({publicKey:e,transformSol:r}){if(e instanceof T)return r&&e.equals(C)?ze:e;if(r&&e===C.toBase58())return ze;if(typeof e=="string")try{return new T(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Ze(e){try{return new T(e)}catch{return e}}var Qe=new T("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),_o=new T("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ao=new T("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ko=new T("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Vo=new T("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Do=new T("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Eo=new T("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Wo=new T("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Mo=new T("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Oo=new T("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),vo=new T("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ze=new T("So11111111111111111111111111111111111111112"),C=T.default;var ye=class{constructor({mint:r,decimals:t,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(r===C.toBase58()||r instanceof fe&&C.equals(r)){this.decimals=U.decimals,this.symbol=U.symbol,this.name=U.name,this.mint=new fe(U.mint);return}this.decimals=t,this.symbol=n,this.name=o,this.mint=a?fe.default:te({publicKey:r})}equals(r){return this===r?!0:this.mint.equals(r.mint)}},E=ye;E.WSOL=new ye(U);var be=class{constructor({decimals:r,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=r,this.symbol=t,this.name=n}equals(r){return this===r}},ge=be;ge.SOL=new be(Je);var er=new s(rr),q=class extends s{toSignificant(r=5,t,n){return this.mul(er).toSignificant(r,t,n)}toFixed(r=2,t,n){return this.mul(er).toFixed(r,t,n)}};var Zr=w("Raydium_price"),A=class extends s{constructor(t){let{baseToken:n,quoteToken:o,numerator:a,denominator:u}=t;super(a,u);this.baseToken=n,this.quoteToken=o,this.scalar=new s(we(n.decimals),we(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new A({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Zr.logWithError("mul token not equals");let n=super.mul(t);return new A({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var ne=w("Raydium_bignumber");var or=new P(0),O=new P(1),bi=new P(2),wi=new P(3),Pi=new P(5),v=new P(10),rr=new P(100),hi=new P(1e3),xi=new P(1e4),tr=9007199254740991;function y(e){if(e instanceof P)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new P(e);ne.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&ne.logWithError(`BigNumberish number underflow: ${e}`),(e>=tr||e<=-tr)&&ne.logWithError(`BigNumberish number overflow: ${e}`),new P(String(e))):typeof e=="bigint"?new P(e.toString()):(ne.logWithError(`invalid BigNumberish value: ${e}`),new P(0))}function we(e){return v.pow(y(e))}function ir(e){var c;if(e===void 0)return{denominator:"1",numerator:"0"};if(e instanceof P)return{numerator:e.toString(),denominator:"1"};if(e instanceof s)return{denominator:e.denominator.toString(),numerator:e.numerator.toString()};let r=String(e),[,t="",n="",o=""]=(c=r.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?c:[],a="1"+"0".repeat(o.length),u=t+(n==="0"?"":n)+o||"0";return{denominator:a,numerator:u,sign:t,int:n,dec:o}}function Qr(e){var n;let[,r="",t=""]=(n=e.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${r}${t}`}function et(e,r=0){return e instanceof P?e:new P(Qr(G(e).mul(v.pow(new P(String(r))))))}function G(e){if(e instanceof q)return new s(e.numerator,e.denominator);if(e instanceof A)return e.adjusted;if(e instanceof F)try{return G(e.toExact())}catch{return new s(or)}if(e instanceof s)return e;let r=String(e),t=ir(r);return new s(t.numerator,t.denominator)}function ar(e,r){if(e==null||r==null)return;let t=G(e),n=G(r);return t.mul(n)}function nr(e){let r=new E({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),t=et(ar(e,10**r.decimals));return new F(r,t)}function Pe(e,r){return nr(!r||!e?0:ar(e,r))}import{PACKET_DATA_SIZE as Ri,PublicKey as rt,sendAndConfirmTransaction as Bi,Transaction as Ii}from"@solana/web3.js";var Ki=w("Raydium_txTool");async function oe(e,r){let[t,n]=await rt.findProgramAddress(e,r);return{publicKey:t,nonce:n}}var sr=e=>typeof e=="number";function he(e,r,t){let n=sr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()<=n}function xe(e,r,t){let n=sr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()>n}var Se=b([d("mint"),d("owner"),i("amount"),Z("delegateOption"),d("delegate"),_("state"),Z("isNativeOption"),i("isNative"),i("delegatedAmount"),Z("closeAuthorityOption"),d("closeAuthority")]);import{PublicKey as tt}from"@solana/web3.js";import nt from"bn.js";var ot=[E,F,tt,s,nt,A,q];function it(e){return typeof e=="object"&&e!==null&&!ot.some(r=>typeof r=="object"&&e instanceof r)}function J(e){return typeof e=="string"?Ze(e):Array.isArray(e)?e.map(r=>J(r)):it(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,J(t)])):e}var z=w("Raydium.farm.util");async function La({programId:e,poolId:r,mint:t,type:n}){let{publicKey:o}=await oe([r.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function at(e){let t=te({publicKey:e}).toBase58();return De[t]}async function st({programId:e,poolId:r,owner:t}){let{publicKey:n}=await oe([r.toBuffer(),t.toBuffer(),Buffer.from(at(e)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return n}var Ra=async({programId:e,poolId:r})=>await oe([r.toBuffer()],e);function ka(e){return Ee[e]}function Ba(e){return{isSet:new h(1),rewardPerSecond:y(e.rewardPerSecond),rewardOpenTime:y(e.rewardOpenTime),rewardEndTime:y(e.rewardEndTime),rewardType:y(e.rewardType)}}function Na(e){return y(e.rewardEndTime).sub(y(e.rewardOpenTime)).mul(y(e.rewardPerSecond))}function ut(e){let r=Me[e];return r||z.logWithError("invalid version",e),r}function ct(e){let r=We[e];return r||z.logWithError("invalid version",e),r}function dt(e,r,t,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new h(t)))return e;let o=new h(t).sub(e.lastSlot);e.lastSlot=new h(t);for(let a of e.rewardInfos){if(r.amount.eq(new h(0)))continue;let u=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(u.mul(new h(10).pow(new h(e.version===3?9:15))).div(r.amount)),a.totalReward=a.totalReward.add(u)}}else if(e.version===6)for(let o of e.rewardInfos){if(o.rewardState.eq(new h(0)))continue;let a=h.min(new h(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let c=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),m=o.totalReward.sub(o.totalRewardEmissioned);m.lt(c)?(c=m,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(m.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!r.amount.eq(new h(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(c.mul(e.rewardMultiplier).div(r.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(c))}return e}async function mt({connection:e,farmPools:r,owner:t,config:n}){var W;let o=!1,a=!1,u=new h(10),c=[];for(let L of r){let f=J(L);f.version===6?a=!0:o=!0,c.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),t&&c.push({pubkey:await st({programId:f.programId,poolId:f.id,owner:t}),version:f.version,key:"ledger",poolId:f.id})}let m={},x=await $e(e,c,n);for(let{pubkey:L,version:f,key:K,poolId:ie,accountInfo:R}of x){let D=ie.toBase58();if(m[D]=S({},m[D]),K==="state"){let M=ct(f);(!R||!R.data||R.data.length!==M.span)&&z.logWithError(`invalid farm state account info, pools.id, ${L}`),m[D].state=M.decode(R.data)}else if(K==="lpVault")(!R||!R.data||R.data.length!==Se.span)&&z.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),m[D].lpVault=Se.decode(R.data);else if(K==="ledger"){let M=ut(f);R&&R.data&&(R.data.length!==M.span&&z.logWithError(`invalid farm ledger account info, ledger, ${L}`),m[D].ledger=M.decode(R.data))}}let B=a||o?await e.getSlot():0,I=a&&(W=await e.getBlockTime(B))!=null?W:0;for(let L of Object.keys(m))m[L].state=dt(m[L].state,m[L].lpVault,B,I);for(let[L,{state:f,ledger:K}]of Object.entries(m))if(K){let ie=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?u.pow(new h(9)):u.pow(new h(15)),R=f.rewardInfos.map((D,M)=>{let cr=K.rewardDebts[M];return K.deposited.mul(f.version===6?D.accRewardPerShare:D.perShareReward).div(ie).sub(cr)});m[L].wrapped=N(S({},m[L].wrapped),{pendingRewards:R})}return m}async function Fa(e){let{farmPools:r}=e,t=await mt(e);return r.map((o,a)=>N(S(S(S({},r[a]),J(o)),t[o.id]),{jsonInfo:r[a]}))}function Ia(e,r=Date.now()){if(e.version===6){let t=e.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>he(r,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>xe(r,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}function _a(e){return e.state.rewardInfos.length===1&&String(e.lpMint)===Qe.toBase58()}function Aa(e,r){return e.version===6?e.state.rewardInfos.map(({rewardPerSecond:t,rewardOpenTime:n,rewardEndTime:o},a)=>{var W;let u=he(r.currentBlockChainDate,n.toNumber(),{unit:"s"}),c=xe(r.currentBlockChainDate,o.toNumber(),{unit:"s"});if(u||c)return;let m=r.rewardTokens[a];if(!m)return;let x=r.rewardTokenPrices[a];if(!x)return;let B=Pe(new s(t,O).div(v.pow(new h(m.decimals||1))).mul(new h(60*60*24*365)),x);return r.tvl?r.tvl.isZero()?G(0):B.div((W=r.tvl)!=null?W:O):void 0}):e.state.rewardInfos.map(({perSlotReward:n},o)=>{var x;let a=r.rewardTokens[o];if(!a)return;let u=r.rewardTokenPrices[o];if(!u)return;let c=Pe(new s(n,O).div(v.pow(new h(a.decimals||1))).mul(new h(r.blockSlotCountForSecond*60*60*24*365)),u);return r.tvl?r.tvl.isZero()?G(0):c.div((x=r.tvl)!=null?x:O):void 0})}import{SystemProgram as lt,SYSVAR_RENT_PUBKEY as pt,TransactionInstruction as ur}from"@solana/web3.js";import ft from"bn.js";var yt=w("Raydium_farm_instruction");async function Ua(e){let{version:r,id:t,ledger:n,programId:o,owner:a}=e,u={3:9,5:10}[r];u||yt.logWithError(`invalid farm pool version: ${r}`);let c=Buffer.alloc(de.span);de.encode({instruction:u},c);let m=[g({pubkey:t}),g({pubkey:n}),g({pubkey:a,isWritable:!1}),g({pubkey:lt.programId,isWritable:!1}),g({pubkey:pt,isWritable:!1})];return new ur({programId:o,keys:m,data:c})}function Ca(e){var n;let r=Buffer.alloc(me.span);me.encode({instruction:0,nonce:new ft(e.nonce),rewardTimeInfo:e.rewardInfoConfig},r);let t=[...Xe,g({pubkey:e.farmKeyPair.publicKey}),g({pubkey:e.farmAuthority,isWritable:!1}),g({pubkey:e.lpVault}),g({pubkey:e.lpMint,isWritable:!1}),g({pubkey:e.lockVault}),g({pubkey:e.lockMint,isWritable:!1}),g({pubkey:(n=e.lockUserAccount)!=null?n:C}),g({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)t.push(g({pubkey:o.rewardMint,isWritable:!1}),g({pubkey:o.rewardVault}),g({pubkey:o.userRewardToken}));return new ur({programId:e.programId,keys:t,data:r})}export{_n as FARM_LOCK_MINT,An as FARM_LOCK_VAULT,De as FARM_PROGRAMID_TO_VERSION,Ae as FARM_PROGRAM_ID_V3,Br as FARM_PROGRAM_ID_V3_PUBKEY,Ke as FARM_PROGRAM_ID_V5,Nr as FARM_PROGRAM_ID_V5_PUBKEY,Ve as FARM_PROGRAM_ID_V6,Fr as FARM_PROGRAM_ID_V6_PUBKEY,Me as FARM_VERSION_TO_LEDGER_LAYOUT,Ee as FARM_VERSION_TO_PROGRAMID,We as FARM_VERSION_TO_STATE_LAYOUT,de as associatedLedgerAccountLayout,Na as calFarmRewardAmount,Aa as calculateFarmPoolAprList,Ua as createAssociatedLedgerAccountInstruction,Hn as dwLayout,jn as farmAddRewardLayout,Vn as farmDespotVersionToInstruction,Yn as farmLedgerLayoutV3_1,qe as farmLedgerLayoutV3_2,$n as farmLedgerLayoutV5_1,Ge as farmLedgerLayoutV5_2,je as farmLedgerLayoutV6_1,Ba as farmRewardInfoToConfig,me as farmRewardLayout,Gn as farmRewardRestartLayout,Er as farmRewardTimeInfoLayout,ve as farmStateV3Layout,Ue as farmStateV5Layout,Ce as farmStateV6Layout,Dn as farmWithdrawVersionToInstruction,mt as fetchMultipleFarmInfoAndUpdate,Ra as getAssociatedAuthority,st as getAssociatedLedgerAccount,La as getAssociatedLedgerPoolAccount,ut as getFarmLedgerLayout,ka as getFarmProgramId,ct as getFarmStateLayout,at as getFarmVersion,Kn as isValidFarmVersion,Ia as judgeFarmType,Ca as makeCreateFarmInstruction,Fa as mergeSdkFarmInfo,Oe as poolTypeV6,Kr as realFarmStateV3Layout,Vr as realFarmStateV5Layout,Dr as realFarmV6Layout,dt as updateFarmPoolInfo,En as validateFarmRewards,_a as whetherIsStakeFarmPool,qn as withdrawRewardLayout};
//# sourceMappingURL=index.mjs.map