var lr=Object.defineProperty,pr=Object.defineProperties;var fr=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var gr=Object.prototype.hasOwnProperty,yr=Object.prototype.propertyIsEnumerable;var Re=(e,r,t)=>r in e?lr(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,S=(e,r)=>{for(var t in r||(r={}))gr.call(r,t)&&Re(e,t,r[t]);if(Le)for(var t of Le(r))yr.call(r,t)&&Re(e,t,r[t]);return e},N=(e,r)=>pr(e,fr(r));import{PublicKey as Sr}from"@solana/web3.js";import Ne,{isBN as Fe}from"bn.js";import{bits as wt,BitStructure as Pt,blob as br,Blob as ht,cstr as xt,f32 as St,f32be as Tt,f64 as Lt,f64be as Rt,greedy as kt,Layout as wr,ns64 as Bt,ns64be as Nt,nu64 as Ft,nu64be as It,offset as _t,s16 as At,s16be as Kt,s24 as Dt,s24be as Vt,s32 as Et,s32be as Wt,s40 as Mt,s40be as vt,s48 as Ot,s48be as Ut,s8 as Ct,seq as Pr,struct as qt,Structure as hr,u16 as Gt,u16be as jt,u24 as Yt,u24be as $t,u32 as Ht,u32be as Jt,u40 as zt,u40be as Xt,u48 as Zt,u48be as Qt,u8 as en,UInt as xr,union as rn,Union as tn,unionLayoutDiscriminator as nn,utf8 as on}from"@solana/buffer-layout";var ae=wr,ke=hr;var se=xr;var Be=Pr;var j=br;var X=class extends ae{constructor(t,n,o){super(t,o);this.blob=j(t),this.signed=n}decode(t,n=0){let o=new Ne(this.blob.decode(t,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,n,o=0){return typeof t=="number"&&(t=new Ne(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,o)}};function _(e){return new se(1,e)}function Z(e){return new se(4,e)}function i(e){return new X(8,!1,e)}function D(e){return new X(16,!1,e)}var ue=class extends ae{constructor(t,n,o,a){super(t.span,a);this.layout=t,this.decoder=n,this.encoder=o}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,o){return this.layout.encode(this.encoder(t),n,o)}getSpan(t,n){return this.layout.getSpan(t,n)}};function d(e){return new ue(j(32),r=>new Sr(r),r=>r.toBuffer(),e)}var ce=class extends ke{decode(r,t){return super.decode(r,t)}};function b(e,r,t){return new ce(e,r,t)}function k(e,r,t){let n,o=typeof r=="number"?r:Fe(r)?r.toNumber():new Proxy(r,{get(a,u){if(!n){let c=Reflect.get(a,"count");n=Fe(c)?c.toNumber():c,Reflect.set(a,"count",n)}return Reflect.get(a,u)},set(a,u,c){return u==="count"&&(n=c),Reflect.set(a,u,c)}});return Be(e,o,t)}import{PublicKey as Y}from"@solana/web3.js";import{get as Ie,set as Tr}from"lodash";import Ae from"dayjs";import Lr from"dayjs/plugin/utc";Ae.extend(Lr);var de=class{constructor(r){this.logLevel=r.logLevel!==void 0?r.logLevel:3,this.name=r.name}set level(r){this.logLevel=r}get time(){return Ae().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(r){return r<=this.logLevel}error(...r){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...r),this):this}logWithError(...r){let t=r.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...r){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...r),this):this}info(...r){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...r),this):this}debug(...r){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...r),this):this}},_e={},Rr={};function w(e){let r=Ie(_e,e);if(!r){let t=Ie(Rr,e);r=new de({name:e,logLevel:t}),Tr(_e,e,r)}return r}var Ke=w("Raydium_farm_config"),De="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",kr=new Y(De),Ve="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",Br=new Y(Ve),Ee="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",Nr=new Y(Ee),We={[De]:3,[Ve]:5,[Ee]:6},Me={3:kr,5:Br,6:Nr},Nn=new Y("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Fn=new Y("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),ve={3:Ce,5:qe,6:Ge},Oe={3:je,5:Ye,6:$e},In=e=>[3,5,6].indexOf(e)!==-1,Fr={3:10,5:11,6:1},_n=e=>{let r=Fr[e];return r||Ke.logWithError("invalid deposit farm version"),r},Ir={3:11,5:12,6:2},An=e=>{let r=Ir[e];return r||Ke.logWithError("invalid withdraw farm version"),r},Kn=e=>{var u;let{version:r,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,a={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(u=a[r])==null?void 0:u.call(a)},Ue={"Standard SPL":0,"Option tokens":1};var me=b([_("instruction")]),On=b([_("instruction")]),_r=b([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),D("accRewardPerShare"),d("rewardVault"),d("rewardMint"),d("rewardSender"),i("rewardType"),k(i(),15,"padding")]),Ar=b([i("state"),i("nonce"),d("lpVault"),d("rewardVault"),d(),d(),i(),i(),i("totalReward"),D("perShareReward"),i("lastSlot"),i("perSlotReward")]),Kr=b([i("state"),i("nonce"),d("lpVault"),d("rewardVaultA"),i("totalRewardA"),D("perShareRewardA"),i("perSlotRewardA"),_("option"),d("rewardVaultB"),j(7),i("totalRewardB"),D("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),d()]),Dr=b([i(),i("state"),i("nonce"),i("validRewardTokenNum"),D("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),d("lpMint"),d("lpVault"),k(_r,5,"rewardInfos"),d("creator"),d(),k(i(),32,"padding")]),Ce=new Proxy(Ar,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,r,t)}}),qe=new Proxy(Kr,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,r,t)}}),Ge=new Proxy(Dr,{get(e,r,t){return r==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:6,rewardInfos:o.rewardInfos.map(a=>{var u;return N(S({},a),{rewardType:((u=Object.entries(Ue).find(c=>String(c[1])===a.rewardType.toString()))!=null?u:["Standard SPL"])[0]})})})}:Reflect.get(e,r,t)}}),Vr=b([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),le=b([_("instruction"),i("nonce"),k(Vr,5,"rewardTimeInfo")]),Un=b([_("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),Cn=b([_("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),qn=b([i("state"),d("id"),d("owner"),i("deposited"),k(i(),1,"rewardDebts")]),je=b([i("state"),d("id"),d("owner"),i("deposited"),k(D(),1,"rewardDebts"),k(i(),17)]),Gn=b([i("state"),d("id"),d("owner"),i("deposited"),k(i(),2,"rewardDebts")]),Ye=b([i("state"),d("id"),d("owner"),i("deposited"),k(D(),2,"rewardDebts"),k(i(),17)]),$e=b([i(),i("state"),d("id"),d("owner"),i("deposited"),k(D(),5,"rewardDebts"),k(i(),16)]),jn=b([_("instruction"),i("amount")]);import h from"bn.js";import{PublicKey as Er}from"@solana/web3.js";function He(e,r=1,t=[]){let n=[...e];if(r<=0)return t;for(;n.length;)t.push(n.splice(0,r));return t}var pe=w("Raydium_accountInfo_util");async function Wr(e,r,t){let{batchRequest:n,commitment:o}=S({batchRequest:!1},t),a=He(r,100),u=new Array(a.length).fill([]);if(n){let c=a.map(x=>{let B=e._buildArgs([x.map(I=>I.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:B}});u=(await e._rpcBatchRequest(c)).map(x=>(x.error&&pe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${x.error.message}`),x.result.value.map(B=>{if(B){let{data:I,executable:W,lamports:L,owner:f,rentEpoch:K}=B;return I.length!==2&&I[1]!=="base64"&&pe.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(I[0],"base64"),executable:W,lamports:L,owner:new Er(f),rentEpoch:K}}return null})))}else try{u=await Promise.all(a.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&pe.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return u.flat()}async function Je(e,r,t){let n=await Wr(e,r.map(o=>o.pubkey),t);return r.map((o,a)=>N(S({},o),{accountInfo:n[a]}))}import P from"bn.js";import Gr from"big.js";import re from"bn.js";import Mr from"toformat";var vr=Mr,$=vr;import ee from"big.js";import Or from"decimal.js-light";var Q=w("module/fraction"),fe=$(ee),H=$(Or),Ur={[0]:H.ROUND_DOWN,[1]:H.ROUND_HALF_UP,[2]:H.ROUND_UP},Cr={[0]:ee.roundDown,[1]:ee.roundHalfUp,[2]:ee.roundUp},s=class{constructor(r,t=v){this.numerator=g(r),this.denominator=g(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new s(this.denominator,this.numerator)}add(r){let t=r instanceof s?r:new s(g(r));return this.denominator.eq(t.denominator)?new s(this.numerator.add(t.numerator),this.denominator):new s(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(r){let t=r instanceof s?r:new s(g(r));return this.denominator.eq(t.denominator)?new s(this.numerator.sub(t.numerator),this.denominator):new s(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(r){let t=r instanceof s?r:new s(g(r));return new s(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(r){let t=r instanceof s?r:new s(g(r));return new s(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(r,t={groupSeparator:""},n=1){Number.isInteger(r)||Q.logWithError(`${r} is not an integer.`),r<=0&&Q.logWithError(`${r} is not positive.`),H.set({precision:r+1,rounding:Ur[n]});let o=new H(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(r);return o.toFormat(o.decimalPlaces(),t)}toFixed(r,t={groupSeparator:""},n=1){return Number.isInteger(r)||Q.logWithError(`${r} is not an integer.`),r<0&&Q.logWithError(`${r} is negative.`),fe.DP=r,fe.RM=Cr[n]||1,new fe(this.numerator.toString()).div(this.denominator.toString()).toFormat(r,t)}isZero(){return this.numerator.isZero()}};var jr=w("Raydium_amount"),ze=$(Gr);function Yr(e,r){let t="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([t,n]=o,n=n.padEnd(r,"0")):jr.logWithError(`invalid number string, num: ${e}`)}else t=e;return[t,n.slice(0,r)||n]}var F=class extends s{constructor(t,n,o=!0,a){let u=new re(0),c=O.pow(new re(t.decimals));if(o)u=g(n);else{let m=new re(0),x=new re(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[B,I]=Yr(n.toString(),t.decimals);m=g(B),x=g(I)}m=m.mul(c),u=m.add(x)}super(u,c);this.logger=w(a||"Amount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new F(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new F(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,o=0){return super.toSignificant(t,n,o)}toFixed(t=this.token.decimals,n,o=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,o)}toExact(t={groupSeparator:""}){return ze.DP=this.token.decimals,new ze(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as $r}from"@solana/web3.js";var Xe={symbol:"SOL",name:"Solana",decimals:9},U={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},To={isQuantumSOL:!0,isLp:!1,official:!0,mint:new $r(U.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as ge}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Hr}from"@solana/spl-token";import{PublicKey as T,SystemProgram as Jr,SYSVAR_RENT_PUBKEY as zr}from"@solana/web3.js";function y({pubkey:e,isSigner:r=!1,isWritable:t=!0}){return{pubkey:e,isWritable:t,isSigner:r}}var Qe=[y({pubkey:Hr,isWritable:!1}),y({pubkey:Jr.programId,isWritable:!1}),y({pubkey:zr,isWritable:!1})];function te({publicKey:e,transformSol:r}){if(e instanceof T)return r&&e.equals(C)?Ze:e;if(r&&e===C.toBase58())return Ze;if(typeof e=="string")try{return new T(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function er(e){try{return new T(e)}catch{return e}}var rr=new T("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),No=new T("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Fo=new T("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Io=new T("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),_o=new T("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ao=new T("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ko=new T("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Do=new T("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Vo=new T("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Eo=new T("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Wo=new T("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ze=new T("So11111111111111111111111111111111111111112"),C=T.default;var ye=class{constructor({mint:r,decimals:t,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:a=!1}){if(r===C.toBase58()||r instanceof ge&&C.equals(r)){this.decimals=U.decimals,this.symbol=U.symbol,this.name=U.name,this.mint=new ge(U.mint);return}this.decimals=t,this.symbol=n,this.name=o,this.mint=a?ge.default:te({publicKey:r})}equals(r){return this===r?!0:this.mint.equals(r.mint)}},E=ye;E.WSOL=new ye(U);var we=class{constructor({decimals:r,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=r,this.symbol=t,this.name=n}equals(r){return this===r}},be=we;be.SOL=new we(Xe);var tr=new s(nr),q=class extends s{toSignificant(r=5,t,n){return this.mul(tr).toSignificant(r,t,n)}toFixed(r=2,t,n){return this.mul(tr).toFixed(r,t,n)}};var Xr=w("Raydium_price"),A=class extends s{constructor(t){let{baseToken:n,quoteToken:o,numerator:a,denominator:u}=t;super(a,u);this.baseToken=n,this.quoteToken=o,this.scalar=new s(Pe(n.decimals),Pe(o.decimals))}get raw(){return new s(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new A({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Xr.logWithError("mul token not equals");let n=super.mul(t);return new A({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(t,n,o)}toFixed(t=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(t,n,o)}};var ne=w("Raydium_bignumber");var ar=new P(0),v=new P(1),fi=new P(2),gi=new P(3),yi=new P(5),O=new P(10),nr=new P(100),bi=new P(1e3),wi=new P(1e4),or=9007199254740991;function g(e){if(e instanceof P)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new P(e);ne.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&ne.logWithError(`BigNumberish number underflow: ${e}`),(e>=or||e<=-or)&&ne.logWithError(`BigNumberish number overflow: ${e}`),new P(String(e))):typeof e=="bigint"?new P(e.toString()):(ne.logWithError(`invalid BigNumberish value: ${e}`),new P(0))}function Pe(e){return O.pow(g(e))}function sr(e){var c;if(e===void 0)return{denominator:"1",numerator:"0"};if(e instanceof P)return{numerator:e.toString(),denominator:"1"};if(e instanceof s)return{denominator:e.denominator.toString(),numerator:e.numerator.toString()};let r=String(e),[,t="",n="",o=""]=(c=r.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?c:[],a="1"+"0".repeat(o.length),u=t+(n==="0"?"":n)+o||"0";return{denominator:a,numerator:u,sign:t,int:n,dec:o}}function Zr(e){var n;let[,r="",t=""]=(n=e.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${r}${t}`}function Qr(e,r=0){return e instanceof P?e:new P(Zr(G(e).mul(O.pow(new P(String(r))))))}function G(e){if(e instanceof q)return new s(e.numerator,e.denominator);if(e instanceof A)return e.adjusted;if(e instanceof F)try{return G(e.toExact())}catch{return new s(ar)}if(e instanceof s)return e;let r=String(e),t=sr(r);return new s(t.numerator,t.denominator)}function ur(e,r){if(e==null||r==null)return;let t=G(e),n=G(r);return t.mul(n)}function ir(e){let r=new E({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),t=Qr(ur(e,10**r.decimals));return new F(r,t)}function he(e,r){return ir(!r||!e?0:ur(e,r))}import{PACKET_DATA_SIZE as Si,PublicKey as et,sendAndConfirmTransaction as Li,Transaction as Bi}from"@solana/web3.js";var Ii=w("Raydium_txTool");async function oe(e,r){let[t,n]=await et.findProgramAddress(e,r);return{publicKey:t,nonce:n}}var cr=e=>typeof e=="number";function xe(e,r,t){let n=cr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()<=n}function Se(e,r,t){let n=cr(r)?r*((t==null?void 0:t.unit)==="s"?1e3:1):r;return new Date(e).getTime()>n}var Te=b([d("mint"),d("owner"),i("amount"),Z("delegateOption"),d("delegate"),_("state"),Z("isNativeOption"),i("isNative"),i("delegatedAmount"),Z("closeAuthorityOption"),d("closeAuthority")]);import{PublicKey as rt}from"@solana/web3.js";import tt from"bn.js";var nt=[E,F,rt,s,tt,A,q];function ot(e){return typeof e=="object"&&e!==null&&!nt.some(r=>typeof r=="object"&&e instanceof r)}function J(e){return typeof e=="string"?er(e):Array.isArray(e)?e.map(r=>J(r)):ot(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,J(t)])):e}var z=w("Raydium.farm.util");async function xa({programId:e,poolId:r,mint:t,type:n}){let{publicKey:o}=await oe([r.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function it(e){let t=te({publicKey:e}).toBase58();return We[t]}async function at({programId:e,poolId:r,owner:t}){let{publicKey:n}=await oe([r.toBuffer(),t.toBuffer(),Buffer.from(it(e)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return n}var Sa=async({programId:e,poolId:r})=>await oe([r.toBuffer()],e);function Ta(e){return Me[e]}function La(e){return{isSet:new h(1),rewardPerSecond:g(e.rewardPerSecond),rewardOpenTime:g(e.rewardOpenTime),rewardEndTime:g(e.rewardEndTime),rewardType:g(e.rewardType)}}function Ra(e){return g(e.rewardEndTime).sub(g(e.rewardOpenTime)).mul(g(e.rewardPerSecond))}function st(e){let r=Oe[e];return r||z.logWithError("invalid version",e),r}function ut(e){let r=ve[e];return r||z.logWithError("invalid version",e),r}function ct(e,r,t,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new h(t)))return e;let o=new h(t).sub(e.lastSlot);e.lastSlot=new h(t);for(let a of e.rewardInfos){if(r.amount.eq(new h(0)))continue;let u=a.perSlotReward.mul(o);a.perShareReward=a.perShareReward.add(u.mul(new h(10).pow(new h(e.version===3?9:15))).div(r.amount)),a.totalReward=a.totalReward.add(u)}}else if(e.version===6)for(let o of e.rewardInfos){if(o.rewardState.eq(new h(0)))continue;let a=h.min(new h(n),o.rewardEndTime);if(o.rewardOpenTime.gte(a))continue;let c=a.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),m=o.totalReward.sub(o.totalRewardEmissioned);m.lt(c)?(c=m,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(m.div(o.rewardPerSecond))):o.rewardLastUpdateTime=a,!r.amount.eq(new h(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(c.mul(e.rewardMultiplier).div(r.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(c))}return e}async function dt({connection:e,farmPools:r,owner:t,config:n}){var W;let o=!1,a=!1,u=new h(10),c=[];for(let L of r){let f=J(L);f.version===6?a=!0:o=!0,c.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),t&&c.push({pubkey:await at({programId:f.programId,poolId:f.id,owner:t}),version:f.version,key:"ledger",poolId:f.id})}let m={},x=await Je(e,c,n);for(let{pubkey:L,version:f,key:K,poolId:ie,accountInfo:R}of x){let V=ie.toBase58();if(m[V]=S({},m[V]),K==="state"){let M=ut(f);(!R||!R.data||R.data.length!==M.span)&&z.logWithError(`invalid farm state account info, pools.id, ${L}`),m[V].state=M.decode(R.data)}else if(K==="lpVault")(!R||!R.data||R.data.length!==Te.span)&&z.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),m[V].lpVault=Te.decode(R.data);else if(K==="ledger"){let M=st(f);R&&R.data&&(R.data.length!==M.span&&z.logWithError(`invalid farm ledger account info, ledger, ${L}`),m[V].ledger=M.decode(R.data))}}let B=a||o?await e.getSlot():0,I=a&&(W=await e.getBlockTime(B))!=null?W:0;for(let L of Object.keys(m))m[L].state=ct(m[L].state,m[L].lpVault,B,I);for(let[L,{state:f,ledger:K}]of Object.entries(m))if(K){let ie=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?u.pow(new h(9)):u.pow(new h(15)),R=f.rewardInfos.map((V,M)=>{let mr=K.rewardDebts[M];return K.deposited.mul(f.version===6?V.accRewardPerShare:V.perShareReward).div(ie).sub(mr)});m[L].wrapped=N(S({},m[L].wrapped),{pendingRewards:R})}return m}async function ka(e){let{farmPools:r}=e,t=await dt(e);return r.map((o,a)=>N(S(S(S({},r[a]),J(o)),t[o.id]),{jsonInfo:r[a]}))}function Ba(e,r=Date.now()){if(e.version===6){let t=e.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>xe(r,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>Se(r,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}function Na(e){return e.state.rewardInfos.length===1&&String(e.lpMint)===rr.toBase58()}function Fa(e,r){return e.version===6?e.state.rewardInfos.map(({rewardPerSecond:t,rewardOpenTime:n,rewardEndTime:o},a)=>{var W;let u=xe(r.currentBlockChainDate,n.toNumber(),{unit:"s"}),c=Se(r.currentBlockChainDate,o.toNumber(),{unit:"s"});if(u||c)return;let m=r.rewardTokens[a];if(!m)return;let x=r.rewardTokenPrices[a];if(!x)return;let B=he(new s(t,v).div(O.pow(new h(m.decimals||1))).mul(new h(60*60*24*365)),x);return r.tvl?r.tvl.isZero()?G(0):B.div((W=r.tvl)!=null?W:v):void 0}):e.state.rewardInfos.map(({perSlotReward:n},o)=>{var x;let a=r.rewardTokens[o];if(!a)return;let u=r.rewardTokenPrices[o];if(!u)return;let c=he(new s(n,v).div(O.pow(new h(a.decimals||1))).mul(new h(r.blockSlotCountForSecond*60*60*24*365)),u);return r.tvl?r.tvl.isZero()?G(0):c.div((x=r.tvl)!=null?x:v):void 0})}import{SystemProgram as mt,SYSVAR_RENT_PUBKEY as lt,TransactionInstruction as dr}from"@solana/web3.js";import pt from"bn.js";var ft=w("Raydium_farm_instruction");async function Ma(e){let{version:r,id:t,ledger:n,programId:o,owner:a}=e,u={3:9,5:10}[r];u||ft.logWithError(`invalid farm pool version: ${r}`);let c=Buffer.alloc(me.span);me.encode({instruction:u},c);let m=[y({pubkey:t}),y({pubkey:n}),y({pubkey:a,isWritable:!1}),y({pubkey:mt.programId,isWritable:!1}),y({pubkey:lt,isWritable:!1})];return new dr({programId:o,keys:m,data:c})}function va(e){var n;let r=Buffer.alloc(le.span);le.encode({instruction:0,nonce:new pt(e.nonce),rewardTimeInfo:e.rewardInfoConfig},r);let t=[...Qe,y({pubkey:e.farmKeyPair.publicKey}),y({pubkey:e.farmAuthority,isWritable:!1}),y({pubkey:e.lpVault}),y({pubkey:e.lpMint,isWritable:!1}),y({pubkey:e.lockVault}),y({pubkey:e.lockMint,isWritable:!1}),y({pubkey:(n=e.lockUserAccount)!=null?n:C}),y({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)t.push(y({pubkey:o.rewardMint,isWritable:!1}),y({pubkey:o.rewardVault}),y({pubkey:o.userRewardToken}));return new dr({programId:e.programId,keys:t,data:r})}export{Nn as FARM_LOCK_MINT,Fn as FARM_LOCK_VAULT,We as FARM_PROGRAMID_TO_VERSION,De as FARM_PROGRAM_ID_V3,kr as FARM_PROGRAM_ID_V3_PUBKEY,Ve as FARM_PROGRAM_ID_V5,Br as FARM_PROGRAM_ID_V5_PUBKEY,Ee as FARM_PROGRAM_ID_V6,Nr as FARM_PROGRAM_ID_V6_PUBKEY,Oe as FARM_VERSION_TO_LEDGER_LAYOUT,Me as FARM_VERSION_TO_PROGRAMID,ve as FARM_VERSION_TO_STATE_LAYOUT,me as associatedLedgerAccountLayout,Ra as calFarmRewardAmount,Fa as calculateFarmPoolAprList,Ma as createAssociatedLedgerAccountInstruction,jn as dwLayout,Cn as farmAddRewardLayout,_n as farmDespotVersionToInstruction,qn as farmLedgerLayoutV3_1,je as farmLedgerLayoutV3_2,Gn as farmLedgerLayoutV5_1,Ye as farmLedgerLayoutV5_2,$e as farmLedgerLayoutV6_1,La as farmRewardInfoToConfig,le as farmRewardLayout,Un as farmRewardRestartLayout,Vr as farmRewardTimeInfoLayout,Ce as farmStateV3Layout,qe as farmStateV5Layout,Ge as farmStateV6Layout,An as farmWithdrawVersionToInstruction,dt as fetchMultipleFarmInfoAndUpdate,Sa as getAssociatedAuthority,at as getAssociatedLedgerAccount,xa as getAssociatedLedgerPoolAccount,st as getFarmLedgerLayout,Ta as getFarmProgramId,ut as getFarmStateLayout,it as getFarmVersion,In as isValidFarmVersion,Ba as judgeFarmType,va as makeCreateFarmInstruction,ka as mergeSdkFarmInfo,Ue as poolTypeV6,Ar as realFarmStateV3Layout,Kr as realFarmStateV5Layout,Dr as realFarmV6Layout,ct as updateFarmPoolInfo,Kn as validateFarmRewards,Na as whetherIsStakeFarmPool,On as withdrawRewardLayout};
//# sourceMappingURL=index.mjs.map