var Rt=Object.create;var Y=Object.defineProperty,Nt=Object.defineProperties,_t=Object.getOwnPropertyDescriptor,kt=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertyNames,Re=Object.getOwnPropertySymbols,At=Object.getPrototypeOf,_e=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable;var Ne=(e,t,r)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,S=(e,t)=>{for(var r in t||(t={}))_e.call(t,r)&&Ne(e,r,t[r]);if(Re)for(var r of Re(t))It.call(t,r)&&Ne(e,r,t[r]);return e},N=(e,t)=>Nt(e,kt(t));var Dt=(e,t)=>{for(var r in t)Y(e,r,{get:t[r],enumerable:!0})},ke=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ft(t))!_e.call(e,o)&&o!==r&&Y(e,o,{get:()=>t[o],enumerable:!(n=_t(t,o))||n.enumerable});return e};var _=(e,t,r)=>(r=e!=null?Rt(At(e)):{},ke(t||!e||!e.__esModule?Y(r,"default",{value:e,enumerable:!0}):r,e)),Vt=e=>ke(Y({},"__esModule",{value:!0}),e);var lr={};Dt(lr,{calFarmRewardAmount:()=>ur,calculateFarmPoolAprList:()=>pr,farmRewardInfoToConfig:()=>sr,fetchMultipleFarmInfoAndUpdate:()=>Tt,getAssociatedAuthority:()=>ir,getAssociatedLedgerAccount:()=>ht,getAssociatedLedgerPoolAccount:()=>or,getFarmLedgerLayout:()=>xt,getFarmProgramId:()=>ar,getFarmStateLayout:()=>St,getFarmVersion:()=>Pt,judgeFarmType:()=>dr,mergeSdkFarmInfo:()=>cr,updateFarmPoolInfo:()=>Lt,whetherIsStakeFarmPool:()=>mr});module.exports=Vt(lr);var P=_(require("bn.js"));var Ve=require("@solana/web3.js");function Fe(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}var $=require("lodash"),Ie=_(require("pino")),De=_(require("pino-pretty")),Ae={},Et={},Wt=(0,De.default)({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),Kt=(0,Ie.default)({base:null,level:"silent"},Wt);function h(e){let t=(0,$.get)(Ae,e);if(!t){let r=(0,$.get)(Et,e);t=Kt.child({name:e},{level:r}),(0,$.set)(Ae,e,t)}return t.logWithError=(...r)=>{let n=r.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(n)},t}var me=h("Raydium_accountInfo_util");async function Ot(e,t,r){let{batchRequest:n,commitment:o}=S({batchRequest:!1},r),s=Fe(t,100),d=new Array(s.length).fill([]);if(n){let c=s.map(x=>{let R=e._buildArgs([x.map(F=>F.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:R}});d=(await e._rpcBatchRequest(c)).map(x=>(x.error&&me.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${x.error.message}`),x.result.value.map(R=>{if(R){let{data:F,executable:K,lamports:L,owner:f,rentEpoch:D}=R;return F.length!==2&&F[1]!=="base64"&&me.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(F[0],"base64"),executable:K,lamports:L,owner:new Ve.PublicKey(f),rentEpoch:D}}return null})))}else try{d=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&me.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return d.flat()}async function Ee(e,t,r){let n=await Ot(e,t.map(o=>o.pubkey),r);return t.map((o,s)=>N(S({},o),{accountInfo:n[s]}))}var b=_(require("bn.js"));var Me=_(require("big.js")),X=_(require("bn.js"));var We=_(require("toformat")),Mt=We.default,H=Mt;var z=_(require("big.js")),Ke=_(require("decimal.js-light"));var ne=h("module/fraction"),pe=H(z.default),J=H(Ke.default),Ut={[0]:J.ROUND_DOWN,[1]:J.ROUND_HALF_UP,[2]:J.ROUND_UP},vt={[0]:z.default.roundDown,[1]:z.default.roundHalfUp,[2]:z.default.roundUp},u=class{constructor(t,r=M){this.numerator=y(t),this.denominator=y(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new u(this.denominator,this.numerator)}add(t){let r=t instanceof u?t:new u(y(t));return this.denominator.eq(r.denominator)?new u(this.numerator.add(r.numerator),this.denominator):new u(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof u?t:new u(y(t));return this.denominator.eq(r.denominator)?new u(this.numerator.sub(r.numerator),this.denominator):new u(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof u?t:new u(y(t));return new u(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof u?t:new u(y(t));return new u(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||ne.logWithError(`${t} is not an integer.`),t<=0&&ne.logWithError(`${t} is not positive.`),J.set({precision:t+1,rounding:Ut[n]});let o=new J(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||ne.logWithError(`${t} is not an integer.`),t<0&&ne.logWithError(`${t} is negative.`),pe.DP=t,pe.RM=vt[n]||1,new pe(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var qt=h("Raydium_amount"),Oe=H(Me.default);function Gt(e,t){let r="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([r,n]=o,n=n.padEnd(t,"0")):qt.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var k=class extends u{constructor(r,n,o=!0,s){let d=new X.default(0),c=U.pow(new X.default(r.decimals));if(o)d=y(n);else{let p=new X.default(0),x=new X.default(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[R,F]=Gt(n.toString(),r.decimals);p=y(R),x=y(F)}p=p.mul(c),d=p.add(x)}super(d,c);this.logger=h(s||"Amount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new k(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new k(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return Oe.DP=this.token.decimals,new Oe(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};var Ue=require("@solana/web3.js"),ve={symbol:"SOL",name:"Solana",decimals:9},v={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},vr={isQuantumSOL:!0,isLp:!1,official:!0,mint:new Ue.PublicKey(v.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var ie=require("@solana/web3.js");var qe=require("@solana/spl-token"),g=require("@solana/web3.js");function le({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var Gr=[le({pubkey:qe.TOKEN_PROGRAM_ID,isWritable:!1}),le({pubkey:g.SystemProgram.programId,isWritable:!1}),le({pubkey:g.SYSVAR_RENT_PUBKEY,isWritable:!1})];function oe({publicKey:e,transformSol:t}){if(e instanceof g.PublicKey)return t&&e.equals(Z)?Ce:e;if(t&&e===Z.toBase58())return Ce;if(typeof e=="string")try{return new g.PublicKey(e)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}function Ge(e){try{return new g.PublicKey(e)}catch{return e}}var je=new g.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),jr=new g.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Yr=new g.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),$r=new g.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Hr=new g.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),zr=new g.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Jr=new g.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Xr=new g.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Zr=new g.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Qr=new g.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),en=new g.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ce=new g.PublicKey("So11111111111111111111111111111111111111112"),Z=g.PublicKey.default;var fe=class{constructor({mint:t,decimals:r,symbol:n="UNKNOWN",name:o="UNKNOWN",skipMint:s=!1}){if(t===Z.toBase58()||t instanceof ie.PublicKey&&Z.equals(t)){this.decimals=v.decimals,this.symbol=v.symbol,this.name=v.name,this.mint=new ie.PublicKey(v.mint);return}this.decimals=r,this.symbol=n,this.name=o,this.mint=s?ie.PublicKey.default:oe({publicKey:t})}equals(t){return this===t?!0:this.mint.equals(t.mint)}},W=fe;W.WSOL=new fe(v);var ye=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},ge=ye;ge.SOL=new ye(ve);var Ye=new u($e),C=class extends u{toSignificant(t=5,r,n){return this.mul(Ye).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(Ye).toFixed(t,r,n)}};var jt=h("Raydium_price"),A=class extends u{constructor(r){let{baseToken:n,quoteToken:o,numerator:s,denominator:d}=r;super(s,d);this.baseToken=n,this.quoteToken=o,this.scalar=new u(be(n.decimals),be(o.decimals))}get raw(){return new u(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new A({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&jt.logWithError("mul token not equals");let n=super.mul(r);return new A({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};var ae=h("Raydium_bignumber");var Je=new b.default(0),M=new b.default(1),Fn=new b.default(2),An=new b.default(3),In=new b.default(5),U=new b.default(10),$e=new b.default(100),Dn=new b.default(1e3),Vn=new b.default(1e4),He=9007199254740991;function y(e){if(e instanceof b.default)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new b.default(e);ae.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&ae.logWithError(`BigNumberish number underflow: ${e}`),(e>=He||e<=-He)&&ae.logWithError(`BigNumberish number overflow: ${e}`),new b.default(String(e))):typeof e=="bigint"?new b.default(e.toString()):(ae.logWithError(`invalid BigNumberish value: ${e}`),new b.default(0))}function be(e){return U.pow(y(e))}function Xe(e){var c;if(e===void 0)return{denominator:"1",numerator:"0"};if(e instanceof b.default)return{numerator:e.toString(),denominator:"1"};if(e instanceof u)return{denominator:e.denominator.toString(),numerator:e.numerator.toString()};let t=String(e),[,r="",n="",o=""]=(c=t.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?c:[],s="1"+"0".repeat(o.length),d=r+(n==="0"?"":n)+o||"0";return{denominator:s,numerator:d,sign:r,int:n,dec:o}}function Yt(e){var n;let[,t="",r=""]=(n=e.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${t}${r}`}function $t(e,t=0){return e instanceof b.default?e:new b.default(Yt(q(e).mul(U.pow(new b.default(String(t))))))}function q(e){if(e instanceof C)return new u(e.numerator,e.denominator);if(e instanceof A)return e.adjusted;if(e instanceof k)try{return q(e.toExact())}catch{return new u(Je)}if(e instanceof u)return e;let t=String(e),r=Xe(t);return new u(r.numerator,r.denominator)}function Ze(e,t){if(e==null||t==null)return;let r=q(e),n=q(t);return r.mul(n)}function ze(e){let t=new W({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),r=$t(Ze(e,10**t.decimals));return new k(t,r)}function we(e,t){return ze(!t||!e?0:Ze(e,t))}var Q=require("@solana/web3.js");var Cn=h("Raydium_txTool");async function se(e,t){let[r,n]=await Q.PublicKey.findProgramAddress(e,t);return{publicKey:r,nonce:n}}var Qe=e=>typeof e=="number";function Pe(e,t,r){let n=Qe(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()<=n}function he(e,t,r){let n=Qe(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()>n}var rt=require("@solana/web3.js"),G=_(require("bn.js"));var a=require("@solana/buffer-layout"),xe=a.Layout,et=a.Structure;var Se=a.UInt;var tt=a.seq;var ee=a.blob;var ue=class extends xe{constructor(r,n,o){super(r,o);this.blob=ee(r),this.signed=n}decode(r,n=0){let o=new G.default(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new G.default(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function I(e){return new Se(1,e)}function ce(e){return new Se(4,e)}function i(e){return new ue(8,!1,e)}function V(e){return new ue(16,!1,e)}var Le=class extends xe{constructor(r,n,o,s){super(r.span,s);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function m(e){return new Le(ee(32),t=>new rt.PublicKey(t),t=>t.toBuffer(),e)}var Te=class extends et{decode(t,r){return super.decode(t,r)}};function w(e,t,r){return new Te(e,t,r)}function B(e,t,r){let n,o=typeof t=="number"?t:(0,G.isBN)(t)?t.toNumber():new Proxy(t,{get(s,d){if(!n){let c=Reflect.get(s,"count");n=(0,G.isBN)(c)?c.toNumber():c,Reflect.set(s,"count",n)}return Reflect.get(s,d)},set(s,d,c){return d==="count"&&(n=c),Reflect.set(s,d,c)}});return tt(e,o,r)}var Be=w([m("mint"),m("owner"),i("amount"),ce("delegateOption"),m("delegate"),I("state"),ce("isNativeOption"),i("isNative"),i("delegatedAmount"),ce("closeAuthorityOption"),m("closeAuthority")]);var j=require("@solana/web3.js");var co=w([I("instruction")]),mo=w([I("instruction")]),Ht=w([i("rewardState"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardLastUpdateTime"),i("totalReward"),i("totalRewardEmissioned"),i("rewardClaimed"),i("rewardPerSecond"),V("accRewardPerShare"),m("rewardVault"),m("rewardMint"),m("rewardSender"),i("rewardType"),B(i(),15,"padding")]),zt=w([i("state"),i("nonce"),m("lpVault"),m("rewardVault"),m(),m(),i(),i(),i("totalReward"),V("perShareReward"),i("lastSlot"),i("perSlotReward")]),Jt=w([i("state"),i("nonce"),m("lpVault"),m("rewardVaultA"),i("totalRewardA"),V("perShareRewardA"),i("perSlotRewardA"),I("option"),m("rewardVaultB"),ee(7),i("totalRewardB"),V("perShareRewardB"),i("perSlotRewardB"),i("lastSlot"),m()]),Xt=w([i(),i("state"),i("nonce"),i("validRewardTokenNum"),V("rewardMultiplier"),i("rewardPeriodMax"),i("rewardPeriodMin"),i("rewardPeriodExtend"),m("lpMint"),m("lpVault"),B(Ht,5,"rewardInfos"),m("creator"),m(),B(i(),32,"padding")]),nt=new Proxy(zt,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,t,r)}}),ot=new Proxy(Jt,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,t,r)}}),it=new Proxy(Xt,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return N(S({},o),{version:6,rewardInfos:o.rewardInfos.map(s=>{var d;return N(S({},s),{rewardType:((d=Object.entries(ct).find(c=>String(c[1])===s.rewardType.toString()))!=null?d:["Standard SPL"])[0]})})})}:Reflect.get(e,t,r)}}),Zt=w([i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime"),i("rewardType")]),po=w([I("instruction"),i("nonce"),B(Zt,5,"rewardTimeInfo")]),lo=w([I("instruction"),i("rewardReopenTime"),i("rewardEndTime"),i("rewardPerSecond")]),fo=w([I("instruction"),i("isSet"),i("rewardPerSecond"),i("rewardOpenTime"),i("rewardEndTime")]),go=w([i("state"),m("id"),m("owner"),i("deposited"),B(i(),1,"rewardDebts")]),at=w([i("state"),m("id"),m("owner"),i("deposited"),B(V(),1,"rewardDebts"),B(i(),17)]),yo=w([i("state"),m("id"),m("owner"),i("deposited"),B(i(),2,"rewardDebts")]),st=w([i("state"),m("id"),m("owner"),i("deposited"),B(V(),2,"rewardDebts"),B(i(),17)]),ut=w([i(),i("state"),m("id"),m("owner"),i("deposited"),B(V(),5,"rewardDebts"),B(i(),16)]),bo=w([I("instruction"),i("amount")]);var Lo=h("Raydium_farm_config"),dt="EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q",Qt=new j.PublicKey(dt),mt="9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z",er=new j.PublicKey(mt),pt="FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG",tr=new j.PublicKey(pt),lt={[dt]:3,[mt]:5,[pt]:6},ft={3:Qt,5:er,6:tr},To=new j.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Bo=new j.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),gt={3:nt,5:ot,6:it},yt={3:at,5:st,6:ut};var ct={"Standard SPL":0,"Option tokens":1};var bt=require("@solana/web3.js"),wt=_(require("bn.js"));var rr=[W,k,bt.PublicKey,u,wt.default,A,C];function nr(e){return typeof e=="object"&&e!==null&&!rr.some(t=>typeof t=="object"&&e instanceof t)}function te(e){return typeof e=="string"?Ge(e):Array.isArray(e)?e.map(t=>te(t)):nr(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,te(r)])):e}var re=h("Raydium.farm.util");async function or({programId:e,poolId:t,mint:r,type:n}){let{publicKey:o}=await se([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function Pt(e){let r=oe({publicKey:e}).toBase58();return lt[r]}async function ht({programId:e,poolId:t,owner:r}){let{publicKey:n}=await se([t.toBuffer(),r.toBuffer(),Buffer.from(Pt(e)===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return n}var ir=async({programId:e,poolId:t})=>await se([t.toBuffer()],e);function ar(e){return ft[e]}function sr(e){return{isSet:new P.default(1),rewardPerSecond:y(e.rewardPerSecond),rewardOpenTime:y(e.rewardOpenTime),rewardEndTime:y(e.rewardEndTime),rewardType:y(e.rewardType)}}function ur(e){return y(e.rewardEndTime).sub(y(e.rewardOpenTime)).mul(y(e.rewardPerSecond))}function xt(e){let t=yt[e];return t||re.logWithError("invalid version",e),t}function St(e){let t=gt[e];return t||re.logWithError("invalid version",e),t}function Lt(e,t,r,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new P.default(r)))return e;let o=new P.default(r).sub(e.lastSlot);e.lastSlot=new P.default(r);for(let s of e.rewardInfos){if(t.amount.eq(new P.default(0)))continue;let d=s.perSlotReward.mul(o);s.perShareReward=s.perShareReward.add(d.mul(new P.default(10).pow(new P.default(e.version===3?9:15))).div(t.amount)),s.totalReward=s.totalReward.add(d)}}else if(e.version===6)for(let o of e.rewardInfos){if(o.rewardState.eq(new P.default(0)))continue;let s=P.default.min(new P.default(n),o.rewardEndTime);if(o.rewardOpenTime.gte(s))continue;let c=s.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond),p=o.totalReward.sub(o.totalRewardEmissioned);p.lt(c)?(c=p,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(p.div(o.rewardPerSecond))):o.rewardLastUpdateTime=s,!t.amount.eq(new P.default(0))&&(o.accRewardPerShare=o.accRewardPerShare.add(c.mul(e.rewardMultiplier).div(t.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(c))}return e}async function Tt({connection:e,farmPools:t,owner:r,config:n}){var K;let o=!1,s=!1,d=new P.default(10),c=[];for(let L of t){let f=te(L);f.version===6?s=!0:o=!0,c.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id},{pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),r&&c.push({pubkey:await ht({programId:f.programId,poolId:f.id,owner:r}),version:f.version,key:"ledger",poolId:f.id})}let p={},x=await Ee(e,c,n);for(let{pubkey:L,version:f,key:D,poolId:de,accountInfo:T}of x){let E=de.toBase58();if(p[E]=S({},p[E]),D==="state"){let O=St(f);(!T||!T.data||T.data.length!==O.span)&&re.logWithError(`invalid farm state account info, pools.id, ${L}`),p[E].state=O.decode(T.data)}else if(D==="lpVault")(!T||!T.data||T.data.length!==Be.span)&&re.logWithError(`invalid farm lp vault account info, pools.lpVault, ${L}`),p[E].lpVault=Be.decode(T.data);else if(D==="ledger"){let O=xt(f);T&&T.data&&(T.data.length!==O.span&&re.logWithError(`invalid farm ledger account info, ledger, ${L}`),p[E].ledger=O.decode(T.data))}}let R=s||o?await e.getSlot():0,F=s&&(K=await e.getBlockTime(R))!=null?K:0;for(let L of Object.keys(p))p[L].state=Lt(p[L].state,p[L].lpVault,R,F);for(let[L,{state:f,ledger:D}]of Object.entries(p))if(D){let de=f.version===6?f.rewardMultiplier:f.rewardInfos.length===1?d.pow(new P.default(9)):d.pow(new P.default(15)),T=f.rewardInfos.map((E,O)=>{let Bt=D.rewardDebts[O];return D.deposited.mul(f.version===6?E.accRewardPerShare:E.perShareReward).div(de).sub(Bt)});p[L].wrapped=N(S({},p[L].wrapped),{pendingRewards:T})}return p}async function cr(e){let{farmPools:t}=e,r=await Tt(e);return t.map((o,s)=>N(S(S(S({},t[s]),te(o)),r[o.id]),{jsonInfo:t[s]}))}function dr(e,t=Date.now()){if(e.version===6){let r=e.state.rewardInfos;if(r.every(({rewardOpenTime:n})=>Pe(t,n.toNumber(),{unit:"s"})))return"upcoming pool";if(r.every(({rewardEndTime:n})=>he(t,n.toNumber(),{unit:"s"})))return"closed pool"}else{let r=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(r.length===2){if(String(r[0])==="0"&&String(r[1])!=="0")return"normal fusion pool";if(String(r[0])!=="0"&&String(r[1])!=="0")return"dual fusion pool";if(String(r[0])==="0"&&String(r[1])==="0")return"closed pool"}else if(r.length===1&&String(r[0])==="0")return"closed pool"}}function mr(e){return e.state.rewardInfos.length===1&&String(e.lpMint)===je.toBase58()}function pr(e,t){return e.version===6?e.state.rewardInfos.map(({rewardPerSecond:r,rewardOpenTime:n,rewardEndTime:o},s)=>{var K;let d=Pe(t.currentBlockChainDate,n.toNumber(),{unit:"s"}),c=he(t.currentBlockChainDate,o.toNumber(),{unit:"s"});if(d||c)return;let p=t.rewardTokens[s];if(!p)return;let x=t.rewardTokenPrices[s];if(!x)return;let R=we(new u(r,M).div(U.pow(new P.default(p.decimals||1))).mul(new P.default(60*60*24*365)),x);return t.tvl?t.tvl.isZero()?q(0):R.div((K=t.tvl)!=null?K:M):void 0}):e.state.rewardInfos.map(({perSlotReward:n},o)=>{var x;let s=t.rewardTokens[o];if(!s)return;let d=t.rewardTokenPrices[o];if(!d)return;let c=we(new u(n,M).div(U.pow(new P.default(s.decimals||1))).mul(new P.default(t.blockSlotCountForSecond*60*60*24*365)),d);return t.tvl?t.tvl.isZero()?q(0):c.div((x=t.tvl)!=null?x:M):void 0})}0&&(module.exports={calFarmRewardAmount,calculateFarmPoolAprList,farmRewardInfoToConfig,fetchMultipleFarmInfoAndUpdate,getAssociatedAuthority,getAssociatedLedgerAccount,getAssociatedLedgerPoolAccount,getFarmLedgerLayout,getFarmProgramId,getFarmStateLayout,getFarmVersion,judgeFarmType,mergeSdkFarmInfo,updateFarmPoolInfo,whetherIsStakeFarmPool});
//# sourceMappingURL=util.js.map