var ve=Object.create;var R=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames,ue=Object.getOwnPropertySymbols,qe=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ce=(n,e,t)=>e in n?R(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,T=(n,e)=>{for(var t in e||(e={}))me.call(e,t)&&ce(n,t,e[t]);if(ue)for(var t of ue(e))je.call(e,t)&&ce(n,t,e[t]);return n};var He=(n,e)=>{for(var t in e)R(n,t,{get:e[t],enumerable:!0})},pe=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Me(e))!me.call(n,o)&&o!==t&&R(n,o,{get:()=>e[o],enumerable:!(r=Fe(e,o))||r.enumerable});return n};var g=(n,e,t)=>(t=n!=null?ve(qe(n)):{},pe(e||!n||!n.__esModule?R(t,"default",{value:n,enumerable:!0}):t,n)),$e=n=>pe(R({},"__esModule",{value:!0}),n);var st={};He(st,{default:()=>Y});module.exports=$e(st);var x=require("@solana/spl-token"),Oe=require("@solana/web3.js");var D=require("lodash"),z=g(require("dayjs")),de=g(require("dayjs/plugin/utc"));z.default.extend(de.default);var V=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:3,this.name=e.name}set level(e){this.logLevel=e}get time(){return(0,z.default)().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},le={},Ye={};function d(n){let e=(0,D.get)(le,n);if(!e){let t=(0,D.get)(Ye,n);e=new V({name:n,logLevel:t}),(0,D.set)(le,n,e)}return e}var k=require("@solana/web3.js");var gt=d("Raydium_txTool"),v=class{constructor(e){this.instructions=[];this.endInstructions=[];this.signers=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers}}get allInstructions(){return[...this.instructions,...this.endInstructions]}addInstruction({instructions:e=[],endInstructions:t=[],signers:r=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...r),this}build(e){let t=new k.Transaction;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{transaction:t,signers:this.signers,execute:async()=>{var o;let r=await fe(this.connection);if(t.recentBlockhash=r,(o=this.owner)!=null&&o.isKeyPair)return(0,k.sendAndConfirmTransaction)(this.connection,t,this.signers);if(this.signAllTransactions){this.signers.length&&t.partialSign(...this.signers);let s=await this.signAllTransactions([t]);return await this.connection.sendRawTransaction(s[0].serialize(),{skipPreflight:!0})}throw new Error("please connect wallet first")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:r}=e,{transaction:o}=this.build(r),s=t.filter(m=>m.transaction.instructions.length>0),a=[...s.map(m=>m.transaction),o],p=[...s.map(m=>m.signers),this.signers];return{transactions:a,signers:p,execute:async()=>{var y;let m=await fe(this.connection);if((y=this.owner)!=null&&y.isKeyPair)return await Promise.all(a.map(async(L,P)=>(L.recentBlockhash=m,await(0,k.sendAndConfirmTransaction)(this.connection,L,p[P]))));if(this.signAllTransactions){let L=a.map((w,O)=>(w.recentBlockhash=m,p[O].length&&w.partialSign(...p[O]),w)),P=await this.signAllTransactions(L),B=[];for(let w=0;w<P.length;w+=1){let O=await this.connection.sendRawTransaction(P[w].serialize(),{skipPreflight:!0});B.push(O)}return B}throw new Error("please connect wallet first")},extInfo:r||{}}}};async function fe(n){var e,t;try{return((t=await((e=n.getLatestBlockhash)==null?void 0:e.call(n)))==null?void 0:t.blockhash)||(await n.getRecentBlockhash()).blockhash}catch{return(await n.getRecentBlockhash()).blockhash}}var G=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),I=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=d(t)}createTxBuilder(e){return this.scope.checkOwner(),new v({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(G(e))}logInfo(...e){this.logger.info(G(e))}logAndCreateError(...e){let t=G(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var ge=require("@solana/web3.js"),be={symbol:"SOL",name:"Solana",decimals:9},b={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},wt={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ge.PublicKey(b.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};var A=require("@solana/spl-token"),_=require("@solana/web3.js"),We=g(require("bn.js"));var tt=require("@solana/web3.js"),nt=g(require("bn.js"));var Le=g(require("big.js")),et=g(require("bn.js"));var f=g(require("bn.js"));var F=d("Raydium_bignumber");var ze=new f.default(0),he=new f.default(1),Lt=new f.default(2),Bt=new f.default(3),St=new f.default(5),Ge=new f.default(10),Pe=new f.default(100),Nt=new f.default(1e3),_t=new f.default(1e4),ye=9007199254740991;function h(n){if(n instanceof f.default)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new f.default(n);F.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&F.logWithError(`BigNumberish number underflow: ${n}`),(n>=ye||n<=-ye)&&F.logWithError(`BigNumberish number overflow: ${n}`),new f.default(String(n))):typeof n=="bigint"?new f.default(n.toString()):(F.logWithError(`invalid BigNumberish value: ${n}`),new f.default(0))}var ke=g(require("toformat")),Je=ke.default,W=Je;var K=g(require("big.js")),Ae=g(require("decimal.js-light"));var M=d("module/fraction"),J=W(K.default),C=W(Ae.default),Ze={[0]:C.ROUND_DOWN,[1]:C.ROUND_HALF_UP,[2]:C.ROUND_UP},Qe={[0]:K.default.roundDown,[1]:K.default.roundHalfUp,[2]:K.default.roundUp},c=class{constructor(e,t=he){this.numerator=h(e),this.denominator=h(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new c(this.denominator,this.numerator)}add(e){let t=e instanceof c?e:new c(h(e));return this.denominator.eq(t.denominator)?new c(this.numerator.add(t.numerator),this.denominator):new c(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof c?e:new c(h(e));return this.denominator.eq(t.denominator)?new c(this.numerator.sub(t.numerator),this.denominator):new c(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof c?e:new c(h(e));return new c(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof c?e:new c(h(e));return new c(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||M.logWithError(`${e} is not an integer.`),e<=0&&M.logWithError(`${e} is not positive.`),C.set({precision:e+1,rounding:Ze[r]});let o=new C(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||M.logWithError(`${e} is not an integer.`),e<0&&M.logWithError(`${e} is negative.`),J.DP=e,J.RM=Qe[r]||1,new J(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var $t=d("Raydium_amount"),Yt=W(Le.default);var q=require("@solana/web3.js");var Se=require("@solana/spl-token"),l=require("@solana/web3.js");function X({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Gt=[X({pubkey:Se.TOKEN_PROGRAM_ID,isWritable:!1}),X({pubkey:l.SystemProgram.programId,isWritable:!1}),X({pubkey:l.SYSVAR_RENT_PUBKEY,isWritable:!1})];function Ne({publicKey:n,transformSol:e}){if(n instanceof l.PublicKey)return e&&n.equals(E)?Be:n;if(e&&n===E.toBase58())return Be;if(typeof n=="string")try{return new l.PublicKey(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var Jt=new l.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Xt=new l.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Zt=new l.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Qt=new l.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),en=new l.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),tn=new l.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),nn=new l.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),rn=new l.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),on=new l.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),sn=new l.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),an=new l.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Be=new l.PublicKey("So11111111111111111111111111111111111111112"),E=l.PublicKey.default;var Z=class{constructor({mint:e,decimals:t,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:s=!1}){if(e===E.toBase58()||e instanceof q.PublicKey&&E.equals(e)){this.decimals=b.decimals,this.symbol=b.symbol,this.name=b.name,this.mint=new q.PublicKey(b.mint);return}this.decimals=t,this.symbol=r,this.name=o,this.mint=s?q.PublicKey.default:Ne({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},S=Z;S.WSOL=new Z(b);var ee=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},Q=ee;Q.SOL=new ee(be);var Pn=new c(Pe);var Sn=d("Raydium_price");var rt=require("@solana/web3.js");var Gn=d("Raydium_accountInfo_util");var Re=require("@solana/web3.js"),j=g(require("bn.js"));var i=require("@solana/buffer-layout"),te=i.Layout,_e=i.Structure;var ne=i.UInt;var re=i.blob;var oe=class extends te{constructor(t,r,o){super(t,o);this.blob=re(t),this.signed=r}decode(t,r=0){let o=new j.default(this.blob.decode(t,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(t,r,o=0){return typeof t=="number"&&(t=new j.default(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),r,o)}};function De(n){return new ne(1,n)}function H(n){return new ne(4,n)}function $(n){return new oe(8,!1,n)}var ie=class extends te{constructor(t,r,o,s){super(t.span,s);this.layout=t,this.decoder=r,this.encoder=o}decode(t,r){return this.decoder(this.layout.decode(t,r))}encode(t,r,o){return this.layout.encode(this.encoder(t),r,o)}getSpan(t,r){return this.layout.getSpan(t,r)}};function U(n){return new ie(re(32),e=>new Re.PublicKey(e),e=>e.toBuffer(),n)}var se=class extends _e{decode(e,t){return super.decode(e,t)}};function Ie(n,e,t){return new se(n,e,t)}var N=Ie([U("mint"),U("owner"),$("amount"),H("delegateOption"),U("delegate"),De("state"),H("isNativeOption"),$("isNative"),$("delegatedAmount"),H("closeAuthorityOption"),U("closeAuthority")]);function ot(n){let{mint:e,tokenAccount:t,owner:r}=n;return(0,A.createInitializeAccountInstruction)(t,e,r)}function ae(n){let{tokenAccount:e,payer:t,multiSigners:r=[],owner:o}=n;return(0,A.createCloseAccountInstruction)(e,t,o,r)}async function Ke(n){let{connection:e,amount:t,commitment:r,payer:o,owner:s,skipCloseAccount:a}=n,p=await e.getMinimumBalanceForRentExemption(N.span,r),m=h(t).add(new We.default(p)),y=_.Keypair.generate();return{signers:[y],instructions:[_.SystemProgram.createAccount({fromPubkey:o,newAccountPubkey:y.publicKey,lamports:m.toNumber(),space:N.span,programId:A.TOKEN_PROGRAM_ID}),ot({mint:new _.PublicKey(b.mint),tokenAccount:y.publicKey,owner:s})],endInstructions:a?[]:[ae({tokenAccount:y.publicKey,payer:o,owner:s})]}}var Ce=require("@solana/web3.js"),Ee=g(require("bn.js"));var it=d("Raydium_Util");function Ue({solAccountResp:n,tokenAccountResp:e}){let t=[],r=[];for(let{pubkey:o,account:s}of e.value){if(s.data.length!==N.span)throw it.error("invalid token account layout length","publicKey",o.toBase58()),new Error("invalid token account layout length");let a=N.decode(s.data),{mint:p,amount:m}=a;t.push({publicKey:o,mint:p,amount:m,isNative:!1}),r.push({pubkey:o,accountInfo:a})}return n&&t.push({mint:Ce.PublicKey.default,amount:new Ee.default(n.lamports),isNative:!0}),{tokenAccounts:t,tokenAccountRawInfos:r}}var Y=class extends I{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._ataCache=new Map;this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:r,tokenAccountRawInfos:o}=t;this._tokenAccounts=r||[],this._tokenAccountRawInfos=o||[],this._clientOwnedToken=!!(r||o)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:r}){return t&&(this._tokenAccounts=t),r&&(this._tokenAccountRawInfos=r),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(r=>r!==t),this}async getAssociatedTokenAccount(t){this.scope.checkOwner();let r=`${this.scope.ownerPubKey.toBase58()}_${t.toBase58()}`;if(this._ataCache.has(r))return this._ataCache.get(r);let o=await(0,x.getAssociatedTokenAddress)(t,this.scope.ownerPubKey,!0);return this._ataCache.set(r,o),o}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let o=T(T({},{}),t),s=await this.scope.connection.getAccountInfo(this.scope.ownerPubKey,o.commitment),a=await this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:x.TOKEN_PROGRAM_ID},o.commitment),{tokenAccounts:p,tokenAccountRawInfos:m}=Ue({solAccountResp:s,tokenAccountResp:a});return this._tokenAccounts=p,this._tokenAccountRawInfos=m,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:p,tokenAccountRawInfos:m}}async getCreatedTokenAccount({mint:t,associatedOnly:r=!0}){await this.fetchWalletTokenAccounts();let o=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(t)).sort((a,p)=>a.amount.lt(p.amount)?1:-1),s=await this.getAssociatedTokenAccount(t);for(let a of o){let{publicKey:p}=a;if(p)return r&&s.equals(p),p}}async checkOrCreateAta({mint:t,autoUnwrapWSOLToSOL:r}){var p;await this.fetchWalletTokenAccounts();let o=(p=this.scope.account.tokenAccounts.find(({mint:m})=>(m==null?void 0:m.toBase58())===t.toBase58()))==null?void 0:p.publicKey,s=this.scope.ownerPubKey,a={};if(!o){let m=await this.getAssociatedTokenAccount(t),y=await(0,x.createAssociatedTokenAccountInstruction)(s,m,s,t);a.instructions=[y],o=m}return r&&b.mint===t.toBase58()&&(a.endInstructions=[ae({owner:s,payer:s,tokenAccount:o})]),{pubKey:o,newInstructions:a}}async handleTokenAccount(t){let{side:r,amount:o,mint:s,tokenAccount:a,payer:p=this.scope.ownerPubKey,bypassAssociatedCheck:m,skipCloseAccount:y}=t,L=this.createTxBuilder(),P=await(0,x.getAssociatedTokenAddress)(s,this.scope.ownerPubKey,!0);if(new Oe.PublicKey(b.mint).equals(s)){let B=await Ke({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:p,amount:o,skipCloseAccount:y});return L.addInstruction(B),T({tokenAccount:B.signers[0].publicKey},B)}else if(!a||r==="out"&&!P.equals(a)&&!m)return{tokenAccount:P,instructions:[(0,x.createAssociatedTokenAccountInstruction)(this.scope.ownerPubKey,P,this.scope.ownerPubKey,s)]};return{tokenAccount:a}}};0&&(module.exports={});
//# sourceMappingURL=account.js.map