import le from"axios";import{get as O,set as J}from"lodash";import I from"dayjs";import z from"dayjs/plugin/utc";I.extend(z);var B=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return I().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},F={},X={};function c(r){let e=O(F,r);if(!e){let t=O(X,r);e=new B({name:r,logLevel:t}),J(F,r,e)}return e}import{PublicKey as Ht}from"@solana/web3.js";import Jt from"bn.js";import se from"big.js";import Me from"bn.js";import m from"bn.js";var T=c("Raydium_bignumber");var V=new m(0),K=new m(1),we=new m(2),Te=new m(3),Ne=new m(5),Q=new m(10),M=new m(100),Pe=new m(1e3),ke=new m(1e4),C=9007199254740991;function p(r){if(r instanceof m)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new m(r);T.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&T.logWithError(`BigNumberish number underflow: ${r}`),(r>=C||r<=-C)&&T.logWithError(`BigNumberish number overflow: ${r}`),new m(String(r))):typeof r=="bigint"?new m(r.toString()):(T.logWithError(`invalid BigNumberish value: ${r}`),new m(0))}import ee from"toformat";var te=ee,y=te;import P from"big.js";import ne from"decimal.js-light";var N=c("module/fraction"),W=y(P),x=y(ne),ie={[0]:x.ROUND_DOWN,[1]:x.ROUND_HALF_UP,[2]:x.ROUND_UP},oe={[0]:P.roundDown,[1]:P.roundHalfUp,[2]:P.roundUp},i=class{constructor(e,t=K){this.numerator=p(e),this.denominator=p(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new i(this.denominator,this.numerator)}add(e){let t=e instanceof i?e:new i(p(e));return this.denominator.eq(t.denominator)?new i(this.numerator.add(t.numerator),this.denominator):new i(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof i?e:new i(p(e));return this.denominator.eq(t.denominator)?new i(this.numerator.sub(t.numerator),this.denominator):new i(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof i?e:new i(p(e));return new i(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof i?e:new i(p(e));return new i(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||N.logWithError(`${e} is not an integer.`),e<=0&&N.logWithError(`${e} is not positive.`),x.set({precision:e+1,rounding:ie[n]});let a=new x(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return a.toFormat(a.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||N.logWithError(`${e} is not an integer.`),e<0&&N.logWithError(`${e} is negative.`),W.DP=e,W.RM=oe[n]||1,new W(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ye=c("Raydium_amount"),Je=y(se);import{PublicKey as ae}from"@solana/web3.js";var v={symbol:"SOL",name:"Solana",decimals:9},g={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Ge={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ae(g.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as R}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ue}from"@solana/spl-token";import{PublicKey as u,SystemProgram as ce,SYSVAR_RENT_PUBKEY as me}from"@solana/web3.js";function D({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var tt=[D({pubkey:ue,isWritable:!1}),D({pubkey:ce.programId,isWritable:!1}),D({pubkey:me,isWritable:!1})];function $({publicKey:r,transformSol:e}){if(r instanceof u)return e&&r.equals(w)?j:r;if(e&&r===w.toBase58())return j;if(typeof r=="string")try{return new u(r)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var rt=new u("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),nt=new u("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),it=new u("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ot=new u("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),st=new u("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),at=new u("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ut=new u("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ct=new u("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),mt=new u("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),lt=new u("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),pt=new u("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),j=new u("So11111111111111111111111111111111111111112"),w=u.default;var A=class{constructor({mint:e,decimals:t,symbol:n="UNKNOWN",name:a="UNKNOWN",skipMint:l=!1}){if(e===w.toBase58()||e instanceof R&&w.equals(e)){this.decimals=g.decimals,this.symbol=g.symbol,this.name=g.name,this.mint=new R(g.mint);return}this.decimals=t,this.symbol=n,this.name=a,this.mint=l?R.default:$({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},d=A;d.WSOL=new A(g);var E=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},L=E;L.SOL=new E(v);var St=new i(M);var Ot=c("Raydium_price");async function H(r){new Promise(e=>setTimeout(e,r))}import{PACKET_DATA_SIZE as Qt,PublicKey as er,sendAndConfirmTransaction as rr,Transaction as or}from"@solana/web3.js";var ur=c("Raydium_txTool");import{PublicKey as hr}from"@solana/web3.js";var wr=c("Raydium_accountInfo_util");var f=c("Raydium_Api");async function vr(r,e,t=1e3){let n;for(;n==null;)try{f.debug(`Request ${r} through endlessRetry`),n=await e()}catch(a){f.error(`Request ${r} failed, retry after ${t} ms`,a),await H(t)}return n}var Y=class{constructor({cluster:e,timeout:t}){this.cluster=e,this.api=le.create({baseURL:"https://api.raydium.io/v2",timeout:t}),this.api.interceptors.request.use(n=>{let{method:a,baseURL:l,url:b}=n;return f.debug(`${a==null?void 0:a.toUpperCase()} ${l}${b}`),n},n=>(f.error("Request failed"),Promise.reject(n))),this.api.interceptors.response.use(n=>{let{config:a,data:l,status:b}=n,{method:h,baseURL:k,url:S}=a;return f.debug(`${h==null?void 0:h.toUpperCase()} ${k}${S}  ${b}`),l},n=>{let{config:a,response:l={}}=n,{status:b}=l,{method:h,baseURL:k,url:S}=a;return f.error(`${h.toUpperCase()} ${k}${S} ${b||n.message}`),Promise.reject(n)})}async getTokens(){return this.api.get("/sdk/token/raydium.mainnet.json")}async getLiquidityPools(){return this.api.get(`/sdk/liquidity/${this.cluster}.json`)}async getPairsInfo(){return this.api.get("https://api.raydium.io/v2/main/pairs")}async getFarmPools(){return this.api.get(`/sdk/farm-v2/${this.cluster}.json`)}async getCoingeckoPrice(e){return this.api.get(`https://api.coingecko.com/api/v3/simple/price?ids=${e.join(",")}&vs_currencies=usd`)}async getRaydiumTokenPrice(){return this.api.get("https://api.raydium.io/v2/main/price")}async getBlockSlotCountForSecond(e){if(!e)return 2;let n=(await this.api.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(a=>a.numSlots);return n.reduce((a,l)=>a+l,0)/n.length/60}};export{Y as Api,vr as endlessRetry};
//# sourceMappingURL=api.mjs.map