import pe from"axios";import{get as L,set as H}from"lodash";import Y from"pino";import J from"pino-pretty";var O={},z={},X=J({colorize:!0,levelFirst:!0,translateTime:"SYS:yyyymmdd HH:MM:ss.l"}),G=Y({base:null,level:"silent"},X);function c(n){let e=L(O,n);if(!e){let t=L(z,n);e=G.child({name:n},{level:t}),H(O,n,e)}return e.logWithError=(...t)=>{let r=t.map(o=>typeof o=="object"?JSON.stringify(o):o).join(", ");throw new Error(r)},e}import{PublicKey as zt}from"@solana/web3.js";import Gt from"bn.js";import ae from"big.js";import _e from"bn.js";import m from"bn.js";var T=c("Raydium_bignumber");var Q=new m(0),I=new m(1),Pe=new m(2),ke=new m(3),Se=new m(5),ee=new m(10),C=new m(100),Be=new m(1e3),We=new m(1e4),F=9007199254740991;function p(n){if(n instanceof m)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new m(n);T.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&T.logWithError(`BigNumberish number underflow: ${n}`),(n>=F||n<=-F)&&T.logWithError(`BigNumberish number overflow: ${n}`),new m(String(n))):typeof n=="bigint"?new m(n.toString()):(T.logWithError(`invalid BigNumberish value: ${n}`),new m(0))}import te from"toformat";var ne=te,y=ne;import P from"big.js";import ie from"decimal.js-light";var N=c("module/fraction"),B=y(P),x=y(ie),oe={[0]:x.ROUND_DOWN,[1]:x.ROUND_HALF_UP,[2]:x.ROUND_UP},se={[0]:P.roundDown,[1]:P.roundHalfUp,[2]:P.roundUp},i=class{constructor(e,t=I){this.numerator=p(e),this.denominator=p(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new i(this.denominator,this.numerator)}add(e){let t=e instanceof i?e:new i(p(e));return this.denominator.eq(t.denominator)?new i(this.numerator.add(t.numerator),this.denominator):new i(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof i?e:new i(p(e));return this.denominator.eq(t.denominator)?new i(this.numerator.sub(t.numerator),this.denominator):new i(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof i?e:new i(p(e));return new i(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof i?e:new i(p(e));return new i(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},r=1){Number.isInteger(e)||N.logWithError(`${e} is not an integer.`),e<=0&&N.logWithError(`${e} is not positive.`),x.set({precision:e+1,rounding:oe[r]});let o=new x(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return o.toFormat(o.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},r=1){return Number.isInteger(e)||N.logWithError(`${e} is not an integer.`),e<0&&N.logWithError(`${e} is negative.`),B.DP=e,B.RM=se[r]||1,new B(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Xe=c("Raydium_amount"),Ge=y(ae);import{PublicKey as ue}from"@solana/web3.js";var q={symbol:"SOL",name:"Solana",decimals:9},d={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}},Qe={isQuantumSOL:!0,isLp:!1,official:!0,mint:new ue(d.mint),decimals:9,symbol:"SOL",id:"sol",name:"solana",icon:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",extensions:{coingeckoId:"solana"}};import{PublicKey as D}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ce}from"@solana/spl-token";import{PublicKey as u,SystemProgram as me,SYSVAR_RENT_PUBKEY as le}from"@solana/web3.js";function W({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var it=[W({pubkey:ce,isWritable:!1}),W({pubkey:me.programId,isWritable:!1}),W({pubkey:le,isWritable:!1})];function j({publicKey:n,transformSol:e}){if(n instanceof u)return e&&n.equals(w)?_:n;if(e&&n===w.toBase58())return _;if(typeof n=="string")try{return new u(n)}catch{throw new Error("invalid public key")}throw new Error("invalid public key")}var ot=new u("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),st=new u("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),at=new u("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ut=new u("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ct=new u("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),mt=new u("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),lt=new u("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),pt=new u("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),dt=new u("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),gt=new u("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ft=new u("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),_=new u("So11111111111111111111111111111111111111112"),w=u.default;var R=class{constructor({mint:e,decimals:t,symbol:r="UNKNOWN",name:o="UNKNOWN",skipMint:l=!1}){if(e===w.toBase58()||e instanceof D&&w.equals(e)){this.decimals=d.decimals,this.symbol=d.symbol,this.name=d.name,this.mint=new D(d.mint);return}this.decimals=t,this.symbol=r,this.name=o,this.mint=l?D.default:j({publicKey:e})}equals(e){return this===e?!0:this.mint.equals(e.mint)}},g=R;g.WSOL=new R(d);var E=class{constructor({decimals:e,symbol:t="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=r}equals(e){return this===e}},A=E;A.SOL=new E(q);var Dt=new i(C);var Ct=c("Raydium_price");async function $(n){new Promise(e=>setTimeout(e,n))}import{PACKET_DATA_SIZE as nn,PublicKey as rn,sendAndConfirmTransaction as sn,Transaction as cn}from"@solana/web3.js";var pn=c("Raydium_txTool");import{PublicKey as Tn}from"@solana/web3.js";var kn=c("Raydium_accountInfo_util");var f=c("Raydium_Api");async function Yn(n,e,t=1e3){let r;for(;r==null;)try{f.debug(`Request ${n} through endlessRetry`),r=await e()}catch(o){f.error(`Request ${n} failed, retry after ${t} ms`,o),await $(t)}return r}var v=class{constructor({cluster:e,timeout:t}){this.cluster=e,this.api=pe.create({baseURL:"https://api.raydium.io/v2",timeout:t}),this.api.interceptors.request.use(r=>{let{method:o,baseURL:l,url:b}=r;return f.debug(`${o==null?void 0:o.toUpperCase()} ${l}${b}`),r},r=>(f.error("Request failed"),Promise.reject(r))),this.api.interceptors.response.use(r=>{let{config:o,data:l,status:b}=r,{method:h,baseURL:k,url:S}=o;return f.debug(`${h==null?void 0:h.toUpperCase()} ${k}${S}  ${b}`),l},r=>{let{config:o,response:l={}}=r,{status:b}=l,{method:h,baseURL:k,url:S}=o;return f.error(`${h.toUpperCase()} ${k}${S} ${b||r.message}`),Promise.reject(r)})}async getTokens(){return this.api.get("/sdk/token/raydium.mainnet.json")}async getLiquidityPools(){return this.api.get(`/sdk/liquidity/${this.cluster}.json`)}async getPairsInfo(){return this.api.get("https://api.raydium.io/v2/main/pairs")}async getFarmPools(){return this.api.get(`/sdk/farm-v2/${this.cluster}.json`)}async getCoingeckoPrice(e){return this.api.get(`https://api.coingecko.com/api/v3/simple/price?ids=${e.join(",")}&vs_currencies=usd`)}async getRaydiumTokenPrice(){return this.api.get("https://api.raydium.io/v2/main/price")}async getBlockSlotCountForSecond(e){if(!e)return 2;let r=(await this.api.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(o=>o.numSlots);return r.reduce((o,l)=>o+l,0)/r.length/60}};export{v as Api,Yn as endlessRetry};
//# sourceMappingURL=api.mjs.map